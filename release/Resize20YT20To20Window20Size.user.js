// ==UserScript==
// @name            Resize YT To Window Size
// @author          Chris H (Zren / Shade)
// @license         MIT
// @icon            https://s.ytimg.com/yts/img/favicon_32-vflOogEID.png
// @homepageURL     https://github.com/Zren/ResizeYoutubePlayerToWindowSize/
// @namespace       http://xshade.ca
// @version         139
// @include         http*://*.youtube.com/*
// @include         http*://youtube.com/*
// @include         http*://*.youtu.be/*
// @include         http*://youtu.be/*
// @grant           none
// @downloadURL https://raw.githubusercontent.com/FiorenMas/Userscripts/release/release/Resize20YT20To20Window20Size.user.js
// @updateURL https://raw.githubusercontent.com/FiorenMas/Userscripts/release/release/Resize20YT20To20Window20Size.meta.js
// ==/UserScript==
(function(s){"use strict";var y="100vh",L=!0,I="w",d=s;if(d.ytwp)return;function M(){try{return s.self!==s.top}catch{return!0}}if(M())return;function z(t){return typeof t=="string"}function A(t){return t instanceof Array}function k(t){return typeof t=="object"}function x(t){return typeof t>"u"}function f(t,n){var i={};for(var r in t)i[t[r]]=n;return i}function q(t,n,i){var r=new MutationObserver(function(m){m.forEach(function(R){i(R)})}),p=document.querySelector(t);return p?(r.observe(p,n),r):null}var u=function(t){this.id=t,this.stylesheet=""};u.prototype.buildRule=function(t,n){var i="";for(var r in n)i+="	"+r+": "+n[r]+`;
`;return t+` {
`+i+`}
`},u.prototype.appendRule=function(t,n,i){A(t)&&(t=t.join(`,
`));var r;if(!x(n)&&!x(i)&&z(n)){var p={};p[n]=i,r=this.buildRule(t,p)}else if(!x(n)&&x(i)&&k(n))r=this.buildRule(t,n);else{console.log("Illegal arguments",arguments);return}this.stylesheet+=r},u.injectIntoHeader=function(t,n){var i=document.getElementById(t);i||(i=document.createElement("style"),i.type="text/css",i.id=t,document.getElementsByTagName("head")[0].appendChild(i)),i.appendChild(document.createTextNode(n))},u.prototype.injectIntoHeader=function(){u.injectIntoHeader(this.id,this.stylesheet)};var l=function(){};l.listeners=[],l.dispatch=function(t,n,i){for(var r=this.listeners,p=0,m=r.length;p<m;p++)r[p].call(this,t,n,i)},l.onPushState=function(t,n,i){return l.dispatch(t,n,i),l.origPushState.apply(s.history,arguments)},l.onReplaceState=function(t,n,i){return l.dispatch(t,n,i),l.origReplaceState.apply(s.history,arguments)},l.inject=function(){l.injected||(l.origPushState=s.history.pushState,l.origReplaceState=s.history.replaceState,s.history.pushState=l.onPushState,s.history.replaceState=l.onReplaceState,l.injected=!0)},l.timerId=0,l.onTick=function(){var t=s.location.pathname+s.location.search;l.lastPage!=t&&(l.dispatch({},document.title,s.location.href),l.lastPage=t)},l.startTimer=function(){l.lastPage=s.location.pathname+s.location.search,l.timerId=setInterval(l.onTick,500)},l.stopTimer=function(){clearInterval(l.timerId)},s.ytwpHistoryEvent=l;var g="ytwp",S=g+"-style",v=g+"-window-player",h=g+"-viewing-video",P=g+"-scrolltop",c='html:not([fullscreen="true"])',o="body."+v;o+=":not(.enhancer-for-youtube-pinned-player)";var a=c+" "+o,H="player",N=g+"-placemarker",b=["transition","-ms-transition","-moz-transition","-webkit-transition","-o-transition"],C=["transform","-ms-transform","-moz-transform","-webkit-transform","-o-transform"],e=d.ytwp={scriptShortName:g,log_:function(t,n){return t.apply(console,["["+this.scriptShortName+"] "].concat(Array.prototype.slice.call(n))),1},log:function(){return this.log_(console.log,arguments)},error:function(){return this.log_(console.error,arguments)},initialized:!1,pageReady:!1,isWatchPage:!1};e.debugPage=function(){function t(_){var E=_.outerHTML;return E.substr(0,E.indexOf(">")+1)}for(var n={display:"block",position:"static",left:"auto",right:"auto",top:"auto",bottom:"auto","padding-left":"0px","padding-right":"0px","padding-top":"0px","padding-bottom":"0px","margin-left":"0px","margin-right":"0px","margin-top":"0px","margin-bottom":"0px",width:"auto","min-width":"auto","max-width":"auto",height:"auto","min-height":"auto","max-height":"auto"},i=Object.keys(n),r=document.querySelector("#movie_player video"),p="";r&&r.parentNode;){var m=getComputedStyle(r),R={};for(var w of m)i.includes(w)&&m[w]!=n[w]&&(R[w]=m[w]);p+=t(r)+" "+JSON.stringify(R)+`
`,r=r.parentNode}p=p.split(`
`).reverse().join(`
`),e.log("debugPage",p)},e.hasYoutubeChanged=function(){var t=["html","body","ytd-app","#content.ytd-app","ytd-page-manager#page-manager.ytd-app","ytd-watch-flexy.ytd-page-manager","#full-bleed-container.ytd-watch-flexy","#player-full-bleed-container.ytd-watch-flexy","#player-container.ytd-watch-flexy","ytd-player#ytd-player.ytd-watch-flexy","#container.ytd-player",".html5-video-player",".html5-video-container","video.html5-main-video"];t=t.reverse();var n=document.querySelector(t[0]);if(!n)return e.error("YT has changed!",t[0],"no longer exists!"),!0;for(var i=1;i<t.length;i++){var r=n.parentNode,p=t[i];r.matches(p)?n=r:e.error("YT has changed!",p,"no longer exists!")}return!1},e.isWatchUrl=function(t){return t||(t=d.location.href),t.match(/https?:\/\/(www\.)?youtube.com\/(c|channel|user)\/[^\/]+\/live/)?!document.querySelector("ytd-browse"):t.match(/https?:\/\/(www\.)?youtube.com\/watch\?/)},e.setTheaterMode=function(t){var n=document.querySelector("ytd-watch:not([hidden])")||document.querySelector("ytd-watch-flexy:not([hidden])")||document.querySelector("ytd-watch-grid:not([hidden])");if(n){var i=n.hasAttribute("theater");if(t!=i){var r=document.querySelector(n.tagName+":not([hidden]) button.ytp-size-button");if(!r){var p=document.querySelectorAll(n.tagName+":not([hidden]) button.ytp-screen-mode-settings-button");r=p[1]}r&&r.click()}n.canFitTheater_=!0}else if(n=document.querySelector("#page.watch")){var i=n.classList.contains("watch-stage-mode");if(t!=i){var r=n.querySelector("button.ytp-size-button");r&&r.click()}}},e.enterTheaterMode=function(){document.body.classList.contains(v)&&e.setTheaterMode(!0)},e.enterTheaterMode(),d.addEventListener("resize",e.enterTheaterMode),e.detectPlayerUnavailable=function(){document.querySelector("[player-unavailable]")&&e.event.removeBodyClass()},e.init=function(){e.log("init"),e.initialized||(e.isWatchPage=e.isWatchUrl(),e.isWatchPage&&(e.removeSearchAutofocus(),document.getElementById(S)||e.event.initStyle(),e.initScroller(),e.initialized=!0,e.pageReady=!1)),e.event.onWatchInit(),e.isWatchPage&&e.html5PlayerFix()},e.initScroller=function(){d.addEventListener("scroll",e.onScroll,!1),d.addEventListener("resize",e.onScroll,!1),e.onScroll()},e.onScroll=function(){var t=document.documentElement.clientHeight;e.isWatchPage&&d.scrollY==0?document.body.classList.add(P):document.body.classList.remove(P),e.isWatchPage&&d.scrollY<=t?document.body.classList.add(h):document.body.classList.remove(h)},e.event={initStyle:function(){if(e.log("initStyle"),e.style=new u(S),e.event.buildStylesheet(),d.spf){var t=o;o='body[data-spf-name="watch"]',a=c+" "+o,e.event.buildStylesheet(),e.style.appendRule('body[data-spf-name="watch"]:not(.ytwp-window-player) #masthead-positioner',{position:"absolute",top:y+" !important"})}e.style.injectIntoHeader()},buildStylesheet:function(){e.log("buildStylesheet"),e.style.appendRule(o+"::-webkit-scrollbar",{width:"0 !important",height:"0 !important"}),e.style.appendRule("html",{"scrollbar-width":"none"});var t;t=f(b,"left 0s linear, padding-left 0s linear"),t.padding="0 !important",t.margin="0 !important",e.style.appendRule([o+" #player",o+".ytcenter-site-center.ytcenter-non-resize.ytcenter-guide-visible #player",o+".ltr.ytcenter-site-center.ytcenter-non-resize.ytcenter-guide-visible.guide-collapsed #player",o+".ltr.ytcenter-site-center.ytcenter-non-resize.ytcenter-guide-visible.guide-collapsed #player-legacy",o+".ltr.ytcenter-site-center.ytcenter-non-resize.ytcenter-guide-visible.guide-collapsed #watch7-main-container"],t),t=f(b,"width 0s linear, left 0s linear"),t.float="initial",t.left=0,t["margin-left"]=0,e.style.appendRule(o+" #player-api",t),e.style.appendRule(o+" .watch-stage-mode #player .player-api",{left:"initial !important","margin-left":"initial !important"}),e.style.appendRule([a+" #player",a+" #player-wrap",a+" #player-api",c+":not(.floater):not(.iri-always-visible) "+o+" #movie_player",a+" #player-mole-container",c+":not(.floater):not(.iri-always-visible) "+o+" .html5-video-container",c+":not(.floater):not(.iri-always-visible) "+o+" .html5-main-video",a+" ytd-watch-flexy[theater] #player-theater-container.ytd-watch-flexy",a+" ytd-watch-flexy[flexy] #player-container-outer.ytd-watch-flexy",a+" ytd-watch-flexy[flexy] #player-container-inner.ytd-watch-flexy",a+" ytd-watch-flexy[flexy] #player-container.ytd-watch-flexy",a+" ytd-watch-grid[theater] #player-theater-container.ytd-watch-grid",a+" ytd-watch-grid[flexy] #player-container-outer.ytd-watch-grid",a+" ytd-watch-grid[flexy] #player-container-inner.ytd-watch-grid",a+" ytd-watch-grid[flexy] #player-container.ytd-watch-grid"],{width:"100% !important","min-width":"100% !important","max-width":"100% !important",height:y+" !important","min-height":y+" !important","max-height":y+" !important"}),e.style.appendRule([a+" #player",a+" .html5-main-video"],{top:"0 !important",right:"0 !important",bottom:"0 !important",left:"0 !important"}),e.style.appendRule(a+" #player .player-width","width","100% !important"),e.style.appendRule(a+" #player .player-height","height","100% !important"),e.style.appendRule([a+" .html5-video-player .ad-container-single-media-element-annotations",a+" .html5-video-player .ytp-upnext"],"top","0"),e.style.appendRule(a+" .ytp-fit-cover-video .html5-main-video","object-fit","contain !important"),e.style.appendRule(a+" .ytp-cued-thumbnail-overlay-image",{"background-size":"contain !important","-moz-background-size":"contain !important","-webkit-background-size":"contain !important"}),e.style.appendRule(a+" #movie_player","background-color","#000000"),e.style.appendRule(a+" #player",{position:"absolute"}),e.style.appendRule(a,{"margin-top":y}),e.style.appendRule(a+" button.ytp-button.ytp-cards-button","top","0"),t=f(b,"margin-top 0s linear, padding-top 0s linear"),t["margin-top"]="0 !important",t.top="0 !important",e.style.appendRule(a+" #watch7-sidebar",t),e.style.appendRule(a+".cardified-page #watch7-sidebar-contents","padding-top","0"),e.style.appendRule("#skip-navigation.ytd-masthead","top","-150vh"),t=f(b,"top 0s linear !important"),e.style.appendRule(a+".hide-header-transition #masthead-positioner",t),e.style.appendRule(a+"."+h+" #masthead-positioner",{position:"absolute",top:y+" !important"}),e.style.appendRule("html.floater "+o+"."+h+" #masthead-positioner",{"z-index":"5"}),e.style.appendRule(a+" .sbdd_a",{top:"56px"}),e.style.appendRule(a+"."+h+" .sbdd_a",{top:"calc("+y+" + 56px) !important",position:"absolute !important"}),e.style.appendRule(a+"."+h+" #appbar-guide-menu",{display:"initial",position:"absolute",top:"100% !important"}),e.style.appendRule(a+"."+h+" #page.watch #guide",{display:"initial",margin:"0",position:"initial"}),e.style.appendRule(a+".lock-scrollbar",{top:"0 !important",position:"static !important"}),e.style.appendRule(a+" #miniplayer-bar #player",{position:"static"}),e.style.appendRule([a+" #miniplayer-bar #player",a+" #miniplayer-bar #player-api",c+":not(.floater):not(.iri-always-visible) "+o+" #miniplayer-bar #movie_player",a+" #player-mole-container",c+":not(.floater):not(.iri-always-visible) "+o+" #miniplayer-bar .html5-video-container",c+":not(.floater):not(.iri-always-visible) "+o+" #miniplayer-bar .html5-main-video"],{width:"252px !important","min-width":"252px !important","max-width":"252px !important",height:"142px !important","min-height":"142px !important","max-height":"142px !important"}),e.style.appendRule(".video-stream.html5-main-video",{top:"0 !important"}),e.style.appendRule(a+"."+P,"overflow-x","hidden"),e.style.appendRule(a+" #placeholder-player","display","none"),e.style.appendRule(a+" #watch-sidebar-spacer","display","none"),e.style.appendRule(a+" .skip-nav","display","none"),e.style.appendRule(a+" #page.watch","padding-top","0"),e.style.appendRule(a+" .player-branded-banner","height","0"),e.style.appendRule(a+" #body-container","position","static"),e.style.appendRule(c+".part_static_size:not(.content-snap-width-skinny-mode) "+o+" .watch-non-stage-mode #player-playlist","width","1066px"),e.style.appendRule([a+" #placeholder-playlist",a+" #player .player-height#watch-appbar-playlist"],{height:"540px !important","max-height":"540px !important"}),t=f(b,"transform 0s linear"),e.style.appendRule(a+" #watch-appbar-playlist",t),t=f(C,"translateY(0px)"),t["margin-left"]="0",t.top="calc("+y+" + 60px)",e.style.appendRule(a+" #player .player-height#watch-appbar-playlist",t),e.style.appendRule(a+" .playlist-videos-list",{"max-height":"470px !important",height:"initial !important"}),e.style.appendRule(a+" #player .player-height#watch-appbar-playlist",{left:"calc((100vw - 1066px)/2 + 640px + 10px)",width:"416px"}),e.style.stylesheet+=`@media screen and (min-height: 630px) and (min-width: 1294px) {
`,e.style.appendRule(a+" #player .player-height#watch-appbar-playlist",{left:"calc((100vw - 1280px)/2 + 854px + 10px)"}),e.style.stylesheet+=`}
 @media screen and (min-width: 1720px) and (min-height:980px) {
`,e.style.appendRule(a+" #player .player-height#watch-appbar-playlist",{left:"calc((100vw - 1706px)/2 + 1280px + 10px)"}),e.style.stylesheet+=`}
`,e.style.appendRule(a+".ytwp-scrolltop #extra-buttons","display","none !important"),e.style.appendRule("ytd-app","position","static !important"),e.style.appendRule("ytd-watch #top","margin-top","71px !important"),e.style.appendRule("ytd-watch #container","margin-top","0 !important"),e.style.appendRule("ytd-watch #content-separator","margin-top","0 !important"),e.style.appendRule([a+" ytd-watch-flexy[theater] #player-wide-container.ytd-watch-flexy",a+" ytd-watch-flexy[fullscreen] #player-wide-container.ytd-watch-flexy",a+" ytd-watch-flexy[full-bleed-player] #player-full-bleed-container.ytd-watch-flexy",a+" ytd-watch-flexy[full-bleed-player] #full-bleed-container.ytd-watch-flexy",a+" ytd-watch-grid[theater] #player-wide-container.ytd-watch-grid",a+" ytd-watch-grid[fullscreen] #player-wide-container.ytd-watch-grid",a+" ytd-watch-grid[full-bleed-player] #player-full-bleed-container.ytd-watch-grid",a+" ytd-watch-grid[full-bleed-player] #full-bleed-container.ytd-watch-grid"],{position:"static",height:0,"min-height":0}),e.style.appendRule(a+".ytwp-viewing-video ytd-app #masthead-container.ytd-app",{position:"absolute",top:y,"z-index":0}),e.style.appendRule(a+".ytwp-viewing-video ytd-watch #masthead-positioner",{top:y+" !important"}),e.style.appendRule(a+" .ytp-cued-thumbnail-overlay","z-index","10"),e.style.appendRule([a+" ytd-watch-flexy[theater] #player-theater-container.ytd-watch-flexy",a+" ytd-watch-grid[theater] #player-theater-container.ytd-watch-grid"],{position:"absolute",top:"0"}),e.style.appendRule("#page-manager.ytd-app","padding-top","var(--ytd-masthead-height,var(--ytd-toolbar-height))"),e.style.appendRule(a+" #error-screen","z-index","11")},onWatchInit:function(){e.log("onWatchInit"),e.initialized&&(e.pageReady||(L&&e.event.addBodyClass(),e.hasYoutubeChanged()&&e.debugPage(),e.pageReady=!0))},onDispose:function(){e.log("onDispose"),e.initialized=!1,e.pageReady=!1,e.isWatchPage=!1},addBodyClass:function(){document.body.classList.add(v),e.log("Applied "+o)},removeBodyClass:function(){document.body.classList.remove(v),e.log("Removed "+o)}},e.html5PlayerFix=function(){e.log("html5PlayerFix");return;try{!d.ytcenter&&!d.html5Patched&&!e.html5.app&&d.ytplayer&&d.ytplayer.config&&d.yt&&d.yt.player&&d.yt.player.Application&&d.yt.player.Application.create&&(e.html5.app=e.html5.getPlayerInstance()),e.html5.update(),e.html5.autohideControls()}catch(t){e.error(t)}},e.fixMasthead=function(){e.log("fixMasthead");var t=document.querySelector("#masthead-positioner-height-offset");t&&e.fixMastheadElement(t)},e.fixMastheadElement=function(t){e.log("fixMastheadElement",t),t.style.height&&setTimeout(function(){t.style.height="",document.querySelector("#appbar-guide-menu").style.marginTop=""},0)},u.injectIntoHeader(S+"-focusfix","input#search[autofocus] { display: none; }"),e.removeSearchAutofocus=function(){var t=document.querySelector("input#search");t&&t.removeAttribute("autofocus")},e.registerMastheadFix=function(){e.log("registerMastheadFix"),q("#masthead-positioner-height-offset",{attributes:!0},function(t){if(console.log(t.type,t),t.attributeName==="style"){var n=t.target;n.style.height&&setTimeout(function(){n.style.height="",document.querySelector("#appbar-guide-menu").style.marginTop=""},0)}})},e.materialPageTransition=function(){e.log("materialPageTransition"),e.init(),e.isWatchUrl()?(e.removeSearchAutofocus(),L&&e.event.addBodyClass(),e.initialized||(e.log("materialPageTransition !ytwp.html5.app",e.html5.app),setTimeout(e.materialPageTransition,100))):(e.event.onDispose(),document.body.classList.remove(v)),e.onScroll(),e.fixMasthead(),e.attemptToUpdatePlayer()},e.registerListeners=function(){e.registerMaterialListeners(),e.registerMastheadFix()},e.registerMaterialListeners=function(){document.addEventListener("yt-page-data-fetched",e.materialPageTransition),document.addEventListener("yt-navigate-finish",e.materialPageTransition),document.addEventListener("yt-page-data-fetched",function(t){e.log("document.yt-page-data-fetched",t)}),document.addEventListener("yt-navigate-finish",function(t){e.log("document.yt-navigate-finish",t)})},e.main=function(){e.registerListeners(),e.init(),e.fixMasthead()},e.main(),e.updatePlayerAttempts=-1,e.updatePlayerMaxAttempts=150,e.attemptToUpdatePlayer=function(){0<=e.updatePlayerAttempts&&e.updatePlayerAttempts<e.updatePlayerMaxAttempts?e.updatePlayerAttempts=0:(e.updatePlayerAttempts=0,e.attemptToUpdatePlayerTick())},e.attemptToUpdatePlayerTick=function(){e.updatePlayerAttempts<e.updatePlayerMaxAttempts&&(e.updatePlayerAttempts+=1,e.updatePlayer(),requestAnimationFrame(e.attemptToUpdatePlayerTick))},e.updatePlayer=function(){e.removeSearchAutofocus(),e.enterTheaterMode(),e.detectPlayerUnavailable()},e.toggleExtension=function(){document.body.classList.toggle("ytwp-window-player"),e.setTheaterMode(document.body.classList.contains("ytwp-window-player"))},e.materialPageTransition(),setInterval(e.updatePlayer,2500);function j(t,n){for(var i=t.parentNode;i;){if(i==n)return!0;i=i.parentNode}return!1}function T(t,n){var i=n.key===I,r=n.target===document.body||n.target.id==="player-api"||n.target.id==="movie_player"||j(n.target,document.querySelector("#movie_player"));r&&i&&(n.preventDefault(),n.stopPropagation(),console.log("cancelIfToggleKey.validKeyCallback",t,"e",n),t&&t())}s.addEventListener("keydown",T.bind(null,e.toggleExtension),!0),s.addEventListener("keyup",T.bind(null,null),!0),s.addEventListener("keypress",T.bind(null,null),!0),typeof browser<"u"&&browser.runtime.onMessage.addListener(t=>t.id=="toggle"?(e.toggleExtension(),Promise.resolve({enabled:document.body.classList.contains("ytwp-window-player")})):Promise.reject(new Error("Unreconized message.id")))})(window);
