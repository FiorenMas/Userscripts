// ==UserScript==
// @name                  Tabview Youtube
// @name:en               Tabview Youtube




// @version               4.73.38
// @resource              contentCSS        https://raw.githubusercontent.com/cyfung1031/Tabview-Youtube/e31a16acca16b6e0602907b05cf75e576cdf2d99/css/style_content.css
// @resource              chatCSS           https://raw.githubusercontent.com/cyfung1031/Tabview-Youtube/e31a16acca16b6e0602907b05cf75e576cdf2d99/css/style_chat.css
// @resource              controlCSS        https://raw.githubusercontent.com/cyfung1031/Tabview-Youtube/e31a16acca16b6e0602907b05cf75e576cdf2d99/css/style_control.css
// @resource              injectionJS1      https://raw.githubusercontent.com/cyfung1031/Tabview-Youtube/e31a16acca16b6e0602907b05cf75e576cdf2d99/js/injection_script_1.js
// @require               https://greasyfork.org/scripts/465421-vanilla-js-dialog/code/Vanilla%20JS%20Dialog.js?version=1188332

// @namespace             http://tampermonkey.net/
// @author                CY Fung
// @license               MIT
// @supportURL            https://github.com/cyfung1031/Tabview-Youtube
// @run-at                document-start
// @match                 https://www.youtube.com/*
// @exclude               /^https?://\w+\.youtube\.com\/live_chat.*$/
// @exclude               /^https?://\S+\.(txt|png|jpg|jpeg|gif|xml|svg|manifest|log|ini)[^\/]*$/
// @icon                  https://raw.githubusercontent.com/cyfung1031/Tabview-Youtube/main/images/icon128p.png

// @compatible            edge Edge [Blink] >= 79;                      Tampermonkey (Beta) / Violentmonkey
// @compatible            chrome Chrome >= 54;                          Tampermonkey (Beta) / Violentmonkey
// @compatible            firefox FireFox / Waterfox (Classic) >= 55;   Tampermonkey / Violentmonkey
// @compatible            opera Opera >= 41;                            Tampermonkey (Beta) / Violentmonkey
// @compatible            safari Safari >= 12.1

// @grant                 GM_getResourceText
// @grant                 GM.getResourceText
// @grant                 GM_registerMenuCommand
// @noframes
// @downloadURL https://raw.githubusercontent.com/FiorenMas/Userscripts/release/release/Tabview20Youtube.user.js
// @updateURL https://raw.githubusercontent.com/FiorenMas/Userscripts/release/release/Tabview20Youtube.meta.js
// ==/UserScript==
function main(){"use strict";if(typeof trustedTypes<"u"&&trustedTypes.defaultPolicy===null){let oe=ke=>ke;trustedTypes.createPolicy("default",{createHTML:oe,createScriptURL:oe,createScript:oe})}const Vt=typeof trustedTypes<"u"&&trustedTypes.defaultPolicy||{createHTML:oe=>oe};function Ve(oe){return Vt.createHTML(oe)}let st=null;try{document.createElement("div").innerHTML=Ve("1")}catch(oe){st=oe}if(st&&(console.log("trustHTMLErr",st),st()),typeof window=="object"){let oe=function(){(()=>{let A=typeof unsafeWindow<"u"?unsafeWindow:this instanceof Window?this:window;if(!A._ytConfigHacks){let zt=function(k){ct(),k&&A.removeEventListener("DOMContentLoaded",zt,!1)},he=4;class je extends Set{add(V){if(he<=0)return console.warn("yt.config_ is already applied on the page.");typeof V=="function"&&super.add(V)}}let F=(async()=>{})().constructor,Je=A._ytConfigHacks=new je,Fe=()=>{let k=A.ytcsi.originalYtcsi;k&&(A.ytcsi=k,Fe=null)},y=null,ct=()=>{if(he>=1){let k=(A.yt||0).config_||(A.ytcfg||0).data_||0;if(typeof k.INNERTUBE_API_KEY=="string"&&typeof k.EXPERIMENT_FLAGS=="object")for(let V of(--he<=0&&Fe&&Fe(),y=!0,Je))V(k)}},bi=1,dt=k=>{if(k=k||A.ytcsi)return A.ytcsi=new Proxy(k,{get:(V,Ct,gi)=>Ct==="originalYtcsi"?V:(ct(),y&&--bi<=0&&Fe&&Fe(),V[Ct])}),!0};dt()||Object.defineProperty(A,"ytcsi",{get(){},set:k=>(k&&(delete A.ytcsi,dt(k)),!0),enumerable:!1,configurable:!0});let{addEventListener:le,removeEventListener:ut}=Document.prototype;new F(k=>{if(typeof AbortSignal<"u")le.call(document,"yt-page-data-fetched",k,{once:!0}),le.call(document,"yt-navigate-finish",k,{once:!0}),le.call(document,"spfdone",k,{once:!0});else{let V=()=>{k(),ut.call(document,"yt-page-data-fetched",V,!1),ut.call(document,"yt-navigate-finish",V,!1),ut.call(document,"spfdone",V,!1)};le.call(document,"yt-page-data-fetched",V,!1),le.call(document,"yt-navigate-finish",V,!1),le.call(document,"spfdone",V,!1)}}).then(ct),new F(k=>{if(typeof AbortSignal<"u")le.call(document,"yt-action",k,{once:!0,capture:!0});else{let V=()=>{k(),ut.call(document,"yt-action",V,!0)};le.call(document,"yt-action",V,!0)}}).then(ct),F.resolve().then(()=>{document.readyState!=="loading"?zt():A.addEventListener("DOMContentLoaded",zt,!1)})}})();let ye=!1;window._ytConfigHacks.add(A=>{if(ye)return;ye=!0;const he=A.EXPERIMENT_FLAGS||0,je=A.EXPERIMENTS_FORCED_FLAGS||0;for(const F of[he,je])F&&(F.kevlar_watch_metadata_refresh_no_old_secondary_data=!1,F.live_chat_overflow_hide_chat=!1,F.web_watch_chat_hide_button_killswitch=!1,F.web_watch_theater_chat=!1,F.suppress_error_204_logging=!0,F.kevlar_watch_grid=!1,F.enable_shadydom_free_scoped_node_methods=!1,F.enable_shadydom_free_scoped_query_methods=!1,F.enable_shadydom_free_scoped_readonly_properties_batch_one=!1,F.enable_shadydom_free_parent_node=!1,F.enable_shadydom_free_children=!1,F.enable_shadydom_free_last_child=!1)});const B=A=>A?A.polymerController||A.inst||A||0:A||0;new Promise(A=>{document.addEventListener("yt-action",A,{once:!0,capture:!0})}).then(()=>{typeof EventTarget.prototype.addEventListener52178!="function"&&typeof EventTarget.prototype.addEventListener=="function"&&(EventTarget.prototype.addEventListener52178=EventTarget.prototype.addEventListener,EventTarget.prototype.addEventListener=function(A,he,je=void 0){if(A==="wheel"&&!je&&typeof he=="function"&&this.overscrollConfigDisable===void 0)try{this.overscrollConfigDisable=!0,delete this.overscrollConfig,Object.defineProperty(this,"overscrollConfig",{get(){},set(Je){return!0},configurable:!0,enumerable:!1});const F=B(this);F!==this&&(delete F.overscrollConfig,Object.defineProperty(F,"overscrollConfig",{get(){},set(Je){return!0},configurable:!0,enumerable:!1}))}catch{}return this.addEventListener52178(A,he,je)})})},ke=document.createElement("button");ke.setAttribute("onclick",`(${oe})()`),ke.click()}-function(oe){"use strict";let ke;try{ke=(async()=>{})().constructor}catch{throw"Please update your browser to use Tabview Youtube."}const ze=(e,t)=>{let n=null;try{n=Object.getOwnPropertyDescriptor(e,t).get}catch{}return typeof n=="function"?i=>n.call(i):i=>i[t]},ye=(e,t)=>{const n=e[t];return typeof n=="function"?(i,...o)=>n.apply(i,o):(i,...o)=>i[t](...o)},B=ze(Node.prototype,"parentNode"),A=ze(Node.prototype,"firstChild"),he=ze(Node.prototype,"nextSibling"),je=ze(Node.prototype,"previousSibling"),F=ze(Element.prototype,"nextElementSibling"),Je=Document.prototype.createDocumentFragment,Fe=DocumentFragment.prototype.append,y=ke,{requestAnimationFrame:ct,cancelAnimationFrame:bi}=oe;let dt=null;const le=()=>dt||(dt=new y(e=>{ct(t=>{dt=null,e(t)})}));function ut(){try{return window.self!==window.top}catch{return!0}}if(ut())return;if(document.documentElement&&document.documentElement.hasAttribute("plugin-tabview-youtube")){console.warn("Multiple instances of Tabview Youtube is attached. [0x7F01]");return}const k=(()=>{let e=y.resolve();return n=>new y((i,o)=>{e=e.then(async()=>{let l;try{l=await n()}catch(r){console.log("error_F1",r),o(r)}i(l)}).catch(console.warn)})})(),V="2022/12/04",Ct=()=>typeof GM>"u"&&typeof(((window||0).chrome||0).runtime||0).getURL=="function",gi=()=>typeof GM<"u"&&!Ct(),Mo=`<path d="M80 27H12A12 12 90 0 0 0 39v42a12 12 90 0 0 12 12h12v20a2 2 90 0 0 3.4 2L47 93h33a12 
  12 90 0 0 12-12V39a12 12 90 0 0-12-12zM20 47h26a2 2 90 1 1 0 4H20a2 2 90 1 1 0-4zm52 28H20a2 2 90 1 1 0-4h52a2 2 90 
  1 1 0 4zm0-12H20a2 2 90 1 1 0-4h52a2 2 90 1 1 0 4zm36-58H40a12 12 90 0 0-12 12v6h52c9 0 16 7 16 16v42h0v4l7 7a2 2 90 
  0 0 3-1V71h2a12 12 90 0 0 12-12V17a12 12 90 0 0-12-12z"/>`.trim(),qo=`<path d="M89 10c0-4-3-7-7-7H7c-4 0-7 3-7 7v70c0 4 3 7 7 7h75c4 0 7-3 7-7V10zm-62 2h13v10H27V12zm-9 
  66H9V68h9v10zm0-56H9V12h9v10zm22 56H27V68h13v10zm-3-25V36c0-2 2-3 4-2l12 8c2 1 2 4 0 5l-12 8c-2 1-4 0-4-2zm25 
  25H49V68h13v10zm0-56H49V12h13v10zm18 56h-9V68h9v10zm0-56h-9V12h9v10z"/>`.trim(),Io=`<path d="M30 0C13.3 0 0 13.3 0 30s13.3 30 30 30 30-13.3 30-30S46.7 0 30 0zm6.2 46.6c-1.5.5-2.6 
  1-3.6 1.3a10.9 10.9 0 0 1-3.3.5c-1.7 0-3.3-.5-4.3-1.4a4.68 4.68 0 0 1-1.6-3.6c0-.4.2-1 .2-1.5a20.9 20.9 90 0 1 
  .3-2l2-6.8c.1-.7.3-1.3.4-1.9a8.2 8.2 90 0 0 .3-1.6c0-.8-.3-1.4-.7-1.8s-1-.5-2-.5a4.53 4.53 0 0 0-1.6.3c-.5.2-1 
  .2-1.3.4l.6-2.1c1.2-.5 2.4-1 3.5-1.3s2.3-.6 3.3-.6c1.9 0 3.3.6 4.3 1.3s1.5 2.1 1.5 3.5c0 .3 0 .9-.1 1.6a10.4 10.4 
  90 0 1-.4 2.2l-1.9 6.7c-.2.5-.2 1.1-.4 1.8s-.2 1.3-.2 1.6c0 .9.2 1.6.6 1.9s1.1.5 2.1.5a6.1 6.1 90 0 0 1.5-.3 9 9 90 
  0 0 1.4-.4l-.6 2.2zm-3.8-35.2a1 1 0 010 8.6 1 1 0 010-8.6z"/>`.trim(),No='<path d="M0 3h12v2H0zm0 4h12v2H0zm0 4h8v2H0zm16 0V7h-2v4h-4v2h4v4h2v-4h4v-2z"/>'.trim(),Ro='<svg stroke="currentColor" fill="none"><path d="M8 2h2v2M7 5l3-3m-6 8H2V8m0 2l3-3"/></svg>',Ho='<svg stroke="currentColor" fill="none"><path d="M7 3v2h2M7 5l3-3M5 9V7H3m-1 3l3-3"/></svg>',vi=!0,wi=!0,$o=!0,En=!1;function Oo(){return Math.floor(Math.random()*982451653+982451653).toString(36)}function Bo(){return`${Oo()}-${Date.now().toString(36)}`}const Vo=Bo(),jt=1,L=2,we=4,Pe=8,xe=16,Se=32,G=64,X=128,K=256,ne=512,zo="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",We=!1,jo=function(){};let g=!1,ft=0,xi=0;const Wo=Date.now()-152e6;let Ae=0,Ei=!1,Tt=null,q=null,J=null,_t=null,z=null,Lt=null,Sn=null,An=!1,Dt=10,Wt="",kt=null,Ce=null;const Qe={},Yt="#tab-videos",mt={defaultTab:Yt},Si=1,Cn="userscript-tabview-settings",Ut="my-default-tab";let Ye=0,Gt=0,Tn=null,Ai=!1,T={base:null,new:null,fetched:!1,count:null},_n="en";const Ln={en:{info:"Info",videos:"Videos",playlist:"Playlist"},jp:{info:"\u60C5\u5831",videos:"\u52D5\u753B",playlist:"\u518D\u751F\u30EA\u30B9\u30C8"},tw:{info:"\u8CC7\u8A0A",videos:"\u5F71\u7247",playlist:"\u64AD\u653E\u6E05\u55AE"},cn:{info:"\u8D44\u8BAF",videos:"\u89C6\u9891",playlist:"\u64AD\u653E\u5217\u8868"},du:{info:"Info",videos:"Videos",playlist:"Playlist"},fr:{info:"Info",videos:"Vid\xE9os",playlist:"Playlist"},kr:{info:"\uC815\uBCF4",videos:"\uB3D9\uC601\uC0C1",playlist:"\uC7AC\uC0DD\uBAA9\uB85D"},ru:{info:"\u041E\u043F\u0438\u0441\u0430\u043D\u0438\u0435",videos:"\u0412\u0438\u0434\u0435\u043E",playlist:"\u041F\u043B\u0435\u0439\u043B\u0438\u0441\u0442"}},yt=()=>{let e=new Date("2023-01-01T00:00:00Z");return e.getDate()===1?`+${e.getHours()}`:`-${24-e.getHours()}`};function Tr(e){return e}function _r(e){return e}function Ci(e){const{hrs:t,mins:n,seconds:i}=e;let o=[];return o.push("Length:"),t>0&&o.push(`${t} ${t===1?"hour":"hours"}`),n>0&&o.push(`${n} ${n===1?"minute":"minutes"}`),i!==null&&o.push(`${i} ${i===1?"second":"seconds"}`),o.join(" ")}function Ti(e){const{hrs:t,mins:n,seconds:i}=e;let o=[];return o.push("\u9577\u3055\uFF1A"),t>0&&o.push(`${t}\u6642\u9593`),n>0&&o.push(`${n}\u5206`),i!==null&&o.push(`${i}\u79D2`),o.join("")}function Yo(e,t){const{bd1:n,bd2:i,durationInfo:o,formatDates:l}=t;switch(e){case 512:return[`The livestream was in ${n.lokStringDateEN()} from ${n.lokStringTime()} to ${i.lokStringTime()}. [GMT${yt()}]`,Ci(o)].join(`
`);case 528:return[`The livestream was from ${n.lokStringDateEN()} ${n.lokStringTime()} to ${i.lokStringDateEN()} ${i.lokStringTime()}. [GMT${yt()}]`,Ci(o)].join(`
`);case 768:return`The livestream started at ${n.lokStringTime()} [GMT${yt()}] in ${n.lokStringDateEN()}.`;case 1536:return`The video was uploaded in ${l.uploadDate} and published in ${l.publishDate}.`;case 1552:return`The video was uploaded in ${l.uploadDate}.`;case 1792:return`The video was published in ${l.publishDate}.`}return""}function Uo(e,t){const{bd1:n,bd2:i,durationInfo:o,formatDates:l}=t;switch(e){case 512:return[`\u30E9\u30A4\u30D6\u914D\u4FE1\u306F${n.lokStringDateJP()}\u306E${n.lokStringTime()}\u304B\u3089\u958B\u59CB\u3057\u3001${i.lokStringTime()}\u307E\u3067\u7D9A\u304D\u307E\u3057\u305F\u3002[GMT${yt()}]`,Ti(o)].join(`
`);case 528:return[`\u30E9\u30A4\u30D6\u914D\u4FE1\u306F${n.lokStringDateJP()}\u306E${n.lokStringTime()}\u304B\u3089${i.lokStringDateJP()}\u306E${i.lokStringTime()}\u307E\u3067\u884C\u308F\u308C\u307E\u3057\u305F\u3002[GMT${yt()}]`,Ti(o)].join(`
`);case 768:return`\u30E9\u30A4\u30D6\u914D\u4FE1\u306F${n.lokStringDateJP()}\u306E${n.lokStringTime()}\u304B\u3089\u958B\u59CB\u3057\u307E\u3057\u305F\u3002[GMT${yt()}]`;case 1536:return`\u3053\u306E\u52D5\u753B\u306F${l.uploadDate}\u306B\u30A2\u30C3\u30D7\u30ED\u30FC\u30C9\u3055\u308C\u3001${l.publishDate}\u306B\u516C\u958B\u3055\u308C\u307E\u3057\u305F\u3002`;case 1552:return`\u3053\u306E\u52D5\u753B\u306F${l.uploadDate}\u306B\u30A2\u30C3\u30D7\u30ED\u30FC\u30C9\u3055\u308C\u307E\u3057\u305F\u3002`;case 1792:return`\u3053\u306E\u52D5\u753B\u306F${l.publishDate}\u306B\u516C\u958B\u3055\u308C\u307E\u3057\u305F\u3002`}return""}function Go(){switch(ao()){case"jp":return Uo;case"en":default:return Yo}}let _i=[],Li={},Dn=0,de=!1,Te=!1,Di=0,kn=!1,ki=!1,ht=203,Me=0,Xt=new WeakMap;const p={get ytdFlexy(){return fe(Ce)},get storeLastPanel(){return fe(Lt)}},O=new Proxy(console,{get(e,t,n){return!En&&t==="log"?jo:Reflect.get(...arguments)}});let ue=En?e=>{O.log(901,e.type)}:0;const Fi=typeof IntersectionObserver=="function",pe=Fi?{capture:!1,passive:!0}:!1,Ft=Fi?{capture:!0,passive:!0}:!0,_=HTMLElement.prototype.__shady_native_querySelector||HTMLElement.prototype.querySelector,Ue=HTMLElement.prototype.__shady_native_querySelectorAll||HTMLElement.prototype.querySelectorAll,P=HTMLElement.prototype.closest,Pt=function(e,t){return e instanceof HTMLElement&&_.call(e,t)||null},Pi=function(e,t){return e instanceof HTMLElement&&P.call(e,t)||null},{elementAppend:Ge,_setAttribute:Xo,_insertBefore:Ko}=(()=>{let e=HTMLElement.prototype.appendChild;try{e=ShadyDOM.nativeMethods.appendChild||e}catch{}let t=Element.prototype.setAttribute;try{t=ShadyDOM.nativeMethods.setAttribute||t}catch{}let n=Node.prototype.insertBefore;try{n=ShadyDOM.nativeMethods.insertBefore||n}catch{}return{elementAppend:e,_setAttribute:t,_insertBefore:n}})(),Mi=()=>{let e=document.getElementById("d-m");e||(e=document.createElementNS("http://www.w3.org/2000/svg","defs"),e.id="d-m",Ko.call(document.documentElement,e,document.documentElement.firstChild));const t=e;t._setAttribute=Xo;let n=0,i;for(;t.hasAttribute(i=`dm-${Math.floor(Math.random()*314159265359+314159265359).toString(36)}`););const o=i;let l=null;return new MutationObserver(()=>{l!==null&&(n>8&&(n=0),l=(l(),null))}).observe(document,{childList:!0,subtree:!0,attributes:!0}),a=>(l||t._setAttribute(o,++n),l=a)},Jo=Mi();let Fn=null;const x=()=>Fn||(Fn=new y(Jo).then(()=>{Fn=null})),Ze=function(e,t,n){return(e&(t|n))===t},et=typeof WeakRef=="function"?e=>e?new WeakRef(e):null:e=>e||null,fe=e=>e&&e.deref?e.deref():e;function Qo(e){const t=document.createElement("script");t.type="text/javascript",t.textContent=e;try{document.documentElement.appendChild(t)}catch(n){console.log("addScript Error",n)}return t}function Zo(e){const t=document.createElement("script");t.type="text/javascript",t.src=e;try{document.documentElement.appendChild(t)}catch(n){console.log("addScriptByURL Error",n)}return t}class el{constructor(){this.q=0}set(t){this.q=t}valueOf(){return this.q}inc(){return++this.q>1e9&&(this.q=9),this.q}}const qe=()=>new el,Pn=qe();Pn.auto=!1;const Mt=((e,t)=>{const n=(i,o)=>{e=i,t=o};return class extends y{constructor(o=n){super(o),o===n&&(this.resolve=e,this.reject=t)}}})(),Mn=new Mt;let se={allowChatControl:!0};class Kt{constructor(){this.reset()}debounce(t,n){let i=t;if(n){const o=n.auto===!1?n.valueOf():n.inc();i=()=>o===n.valueOf()?t():0}return this.promise.then().then(i).catch(console.warn)}d(){return this.promise.then().catch(console.warn)}reset(){this.resolved=!1,this.promise=new Mt}resolve(){return this.resolved!==!1?!1:(this.resolved=!0,this.promise.resolve(...arguments),!0)}}class Jt{constructor(){this.p=y.resolve()}lockWith(t){this.p=this.p.then(()=>new y(t).catch(console.warn))}}const qi=Symbol(),Ii=(e,t)=>{if(e.constructor!==t){const n=t[qi]||(t[qi]=Object.keys(Object.getOwnPropertyDescriptors(t.prototype)));for(const i of n)e[i]=t.prototype[i]}};class qt extends MutationObserver{constructor(t){super((n,i)=>{for(const o of n)o.type==="attributes"&&this.checker(o.target,o.attributeName)}),this.flist=t,this.res={},Ii(this,qt)}takeRecords(){super.takeRecords()}disconnect(){this._target=null,super.disconnect()}observe(t){if(this._target)return;this._target=et(t);const n={attributes:!0,attributeFilter:Object.keys(this.flist),attributeOldValue:!0};super.observe(t,n)}checker(t,n){let i=t.getAttribute(n);if(this.res[n]!==i){this.res[n]=i;let o=this.flist[n];o&&o(n,i)}}check(t=0){setTimeout(()=>{let n=fe(this._target);if(n!==null)for(const i of Object.keys(this.flist))this.checker(n,i);else console.log("target is null");n=null},t)}}class It extends Date{constructor(...t){super(...t),this.dayBack=!1}browserSupported(){}lokStringDateEN(){const t=this;let n=t.getFullYear(),i=t.getMonth()+1,o=t.getDate(),l=n<1e3?`0000${n}`.slice(-4):""+n,r=i<10?"0"+i:""+i,a=o<10?"0"+o:""+o;return`${l}.${r}.${a}`}lokStringDateJP(){const t=this;let n=t.getFullYear(),i=t.getMonth()+1,o=t.getDate(),l=n<1e3?`0000${n}`.slice(-4):""+n,r=i<10?"0"+i:""+i,a=o<10?"0"+o:""+o;return`${l}/${r}/${a}`}lokStringTime(){const t=this;let n=t.getHours(),i=t.getMinutes();this.dayBack&&(n+=24);let l=n<10?"0"+n:""+n,r=i<10?"0"+i:""+i;return`${l}:${r}`}}if(console.assert("browserSupported"in new It,{error:"0x87FF",errorMsg:"Your userscript manager is not supported. FireMonkey is not recommended."}),!("browserSupported"in new It))return;let Qt=null;try{const e=[{id:"tabview-css-content",path:"css/style_content.css"},{id:"tabview-css-chat",path:"css/style_chat.css"},{id:"tabview-css-control",path:"css/style_control.css"}];for(const t of e)t.url=chrome.runtime.getURL(t.path)||"";Qt=e}catch{}if(Qt){const e=document.head||document.documentElement;for(const{path:t,url:n,id:i}of Qt)if(n&&typeof n=="string"&&n.length>4){const o=document.createElement("link");o.id=i,o.rel="stylesheet",o.type="text/css",o.href=n,e.appendChild(o)}Qt=null}function Ni(){document.querySelector("ytd-watch-flexy[is-two-columns_][theater] ytd-live-chat-frame#chat:not([collapsed])")&&_e()}function tl(){document.querySelector("ytd-watch-flexy[is-two-columns_][theater] ytd-live-chat-frame#chat[collapsed]")&&Ki()}function qn(){if(se.ytlstmTheaterMode&&(document.fullscreenElement||document.querySelector("ytd-watch-flexy[fullscreen]"))){se.allowChatControl=!0,se.ytlstmTheaterMode=!1;return}se.allowChatControl?document.body.hasAttribute("data-ytlstm-theater-mode")&&(se.allowChatControl=!1,se.ytlstmTheaterMode=!0):document.body.hasAttribute("data-ytlstm-theater-mode")||(se.allowChatControl=!0,se.ytlstmTheaterMode=!1)}function nl(){let e=document.getElementById("tabview-css-content");if(!e)return;let t=document.getElementById("tabview-css-chat");if(t){if(e.disabled===!1){if(se.ytlstmTheaterMode){e.disabled=!0,t.disabled=!0;let n=document.querySelector(".youtube-genius-lyrics-found-hide-btn");return n&&n.click(),Re(),1}}else if(e.disabled===!0&&!se.ytlstmTheaterMode)return e.disabled=!1,t.disabled=!1,2}}function il(){function e(t,n,i,o){return new y(l=>{t||(t=document.createElement("link")),t.rel=n,o&&t.setAttribute("as",o),t.onload=function(){l({link:this,success:!0}),this.remove()},t.onerror=function(){l({link:this,success:!1}),this.remove()},t.href=i,(document.head||document.documentElement).appendChild(t),t=null})}new y(t=>{if(document.documentElement)t();else{let n=new MutationObserver(()=>{n!==null&&document.documentElement&&(n.takeRecords(),n.disconnect(),n=null,t())});n.observe(document,{childList:!0,subtree:!1})}}).then(()=>{const t=["https://i.ytimg.com","https://www.youtube.com","https://rr2---sn-5n5ip-ioqd.googlevideo.com","https://googlevideo.com","https://accounts.youtube.com","https://jnn-pa.googleapis.com","https://googleapis.com","https://fonts.gstatic.com","https://www.gstatic.com","https://yt3.ggpht.com","https://yt4.ggpht.com"];for(const n of t)e(null,"preconnect",n)})}il();const be=new Kt;be.resolve();const Nt=function(e){!g&&be.resolved||be.debounce(e,Pn)};let Q=new Jt,ol=new Jt;const ge=new Kt;let tt=0,me=qe();me.auto=!1;const R=new Kt;function ll(e,t,n){let i={script_id:e,inject:function(){let o=this,l=this.script_id;document.querySelector(`script#${l}`)||(o.runtime_url?Zo(o.runtime_url).id=l:Qo(`${o.injection_script}`).id=l)}};return i.script_id=e,Ct()?i.runtime_url=window.chrome.runtime.getURL(t):i.injection_script=GM_getResourceText(n),i}const rl=ll("userscript-tabview-injection-1","js/injection_script_1.js","injectionJS1");let Ri=!1;R.debounce(()=>{Ri=!0});const In=new Map;async function Z(e,t,...n){if(!Ri){const i=(In.get(t)||0)+1;In.set(t,i),await R.d();const o=In.get(t);if(i!==o)return}e.dispatchEvent(new CustomEvent("tabview-page-script",{detail:{id:t,args:n.length?n:null}}))}function Hi(e){const t=new Array(e),n=zo,i=n.length;for(let o=0;o<e;o++){let l=null;do l=n.charAt(Math.floor(Math.random()*i));while(o===0&&10-l>0);t[o]=l}return t.join("")}const $i=new Map;function al(e){let t=$i.get(e);if(!t){const n=ve.uidStore;do t=Hi(5);while(n[t]);$i.set(e,t)}return t}class ve{constructor(t){let n=null;const i=ve.uidStore;do n=Hi(5);while(i[n]);i[n]=!0,this.uid=n,this.observerCreator=t,this.observer=null,this.bindCount=0,Ii(this,ve)}bindElement(t,...n){return t.hasAttribute(`o3r-${this.uid}`)?!1:(t.setAttribute(`o3r-${this.uid}`,""),this.bindCount++,this.observer===null&&(this.observer=this.observerCreator()),this.observer.observe(t,...n),!0)}clear(t){if(this.observer!==null){t===!0&&(this.observer.takeRecords(),this.observer.disconnect()),this.observer=null,this.bindCount=0;for(const n of document.querySelectorAll(`[o3r-${this.uid}]`))n.removeAttribute(`o3r-${this.uid}`)}}}ve.uidStore={};const sl=new ve(()=>new IntersectionObserver(nr,{root:null,rootMargin:"0px"})),Nn=new ve(()=>new MutationObserver(or)),Rn=new ve(()=>new MutationObserver(lr)),Oi=new ve(()=>new MutationObserver(ot.mtf_attrEngagementPanel)),Zt=new ve(()=>new qt({hidden:ot.mtf_attrPlaylist})),cl=Zt.uid,en=new ve(()=>new qt({hidden:ot.mtf_attrComments})),dl=en.uid,Hn=new ve(()=>new qt({collapsed:ot.mtf_attrChatroom}));function Bi(e){return!!(e.offsetWidth||e.offsetHeight||e.getClientRects().length)}function ul(e){return typeof e=="string"&&e.length>0}async function fl(){return window.dispatchEvent(new Event("resize"))}async function tn(){if(q!=="watch")return;const e=p.ytdFlexy;e&&e.getAttribute("tyt-tab")==="#tab-comments"&&Z(document,"tabview-resize-comments-rows")}function Vi(e,t){return new y(n=>{e&&typeof e.requestPictureInPicture=="function"&&typeof document.exitPictureInPicture=="function"?xl(e)&&document.pictureInPictureElement===null?e.requestPictureInPicture().then(i=>{n(!0)}).catch(i=>{t===void 0?console.warn(i):typeof t=="function"&&t(i),n(!1)}):n(!1):n(null)})}function $n(){document.pictureInPictureElement!==null&&typeof document.exitPictureInPicture=="function"&&document.exitPictureInPicture().then(e=>{}).catch(console.warn)}function On(){if(J&&typeof J.txt_expand=="string"&&typeof J.txt_collapse=="string"){let e=document.querySelector("ytd-live-chat-frame#chat");if(!e)return;let t=_.call(e,'span.yt-core-attributed-string[role="text"]'),n=(t||0).textContent;typeof n=="string"&&n.length>2&&(e.hasAttribute("collapsed")?n!==J.txt_expand&&(t.textContent=J.txt_expand):n!==J.txt_collapse&&(t.textContent=J.txt_collapse))}else if(J&&typeof J.txt_expand=="string"){let e=document.querySelector("ytd-live-chat-frame#chat");if(!e)return;let t=_.call(e,'span.yt-core-attributed-string[role="text"]'),n=(t||0).textContent;typeof n=="string"&&n.length>2&&e.hasAttribute("collapsed")&&n!==J.txt_expand&&(t.textContent=J.txt_expand)}}function ml(){R.debounce(()=>{async function e(){let n=document.documentElement.clientHeight,i=(document.querySelector("#right-tabs")||0).clientHeight;return await y.resolve(0),n>300&&i>300?i/n:0}async function t(){let n=document.querySelector("#secondary.ytd-watch-flexy");if(n){if(n.classList.contains("tabview-hover-slider-enable"))n.dispatchEvent(new CustomEvent("tabview-hover-slider-restore"));else{let i=_.call(n,"#secondary-inner.ytd-watch-flexy");if(i){n.classList.contains("tabview-hover-slider")||i.style.setProperty("--tabview-slider-right",`${ji()}px`);let o=await e();if(o>0&&o<=1){i.style.setProperty("--ytd-watch-flexy-sidebar-width-d",`${Math.round(100*o*10)/10}vw`),n.classList.add("tabview-hover-slider"),n.classList.add("tabview-hover-slider-enable");let l=document.querySelector("#player video");Vi(l)}}}tn()}}t()})}let nn=null;function yl(e,t){if(!e||!t)return;let n=`o4r-${al("tabview-hover-slider-restore")}`;if(e.hasAttribute(n))return;e.setAttribute(n,"");let i=document.querySelector("tabview-view-secondary-xpander");i||(i=document.createElement("tabview-view-secondary-xpander"),dn(i,e));let o=document.querySelector("tabview-view-columns-endpos");o&&o.remove(),o=document.createElement("tabview-view-columns-endpos");let l=new IntersectionObserver(r=>{let a=null,s=An;for(const f of r){if(f.rootBounds===null)continue;let d=f.boundingClientRect,u=f.rootBounds;a=!f.isIntersecting&&d.left>u.right&&u.left<=0}let c=document.querySelector("#columns.style-scope.ytd-watch-flexy");c&&c.classList.toggle("tyt-column-overflow",a),s!==a&&a!==null&&(An=a)});Ge.call(t,o),(I.layoutStatus&L)===L&&l.observe(o),nn=l,e.addEventListener("tabview-hover-slider-restore",function(r){let a=r.target;if(!a.classList.contains("tabview-hover-slider-enable"))return;let s=_.call(a,"#secondary-inner.ytd-watch-flexy");if(s){if(a.classList.contains("tabview-hover-slider-hover"))y.resolve(0).then(()=>{s.style.removeProperty("--ytd-watch-flexy-sidebar-width-d")}).then(()=>{a.classList.remove("tabview-hover-slider-enable"),$n()});else{let c=r.target;c.classList.remove("tabview-hover-slider"),c.classList.remove("tabview-hover-slider-enable"),s.style.removeProperty("--ytd-watch-flexy-sidebar-width-d"),s.style.removeProperty("--tabview-slider-right"),$n()}x().then(()=>{on()})}},!1)}function zi(e){if(!e)return null;let t=e.id;if(!t||typeof t!="string")return null;if(_.call(e,`#${t} > tabview-view-tab-expander`))return!1;let n=document.createElement("tabview-view-tab-expander");return dn(n,e),n.innerHTML=Ve(`<div>${pt(16,16,12,12,Ro,"svg-expand")}${pt(16,16,12,12,Ho,"svg-collapse")}</div>`),n.addEventListener("click",ml,!1),!0}function hl(){let e=document.documentElement.getBoundingClientRect().width,t=document.querySelector("#secondary.style-scope.ytd-watch-flexy + tabview-view-columns-endpos");return t?t.getBoundingClientRect().x-e:null}function ji(){let e=document.querySelector("#secondary.style-scope.ytd-watch-flexy + tabview-view-columns-endpos"),t=document.querySelector("#secondary.style-scope.ytd-watch-flexy > tabview-view-secondary-xpander");return e&&t?e.getBoundingClientRect().x-t.getBoundingClientRect().right:null}const pl=e=>{let t=document.querySelector("#secondary.style-scope.ytd-watch-flexy + tabview-view-columns-endpos"),n=document.querySelector("#secondary.style-scope.ytd-watch-flexy > tabview-view-secondary-xpander");if(t&&n){let i=hl(),o=1;i>=125||i>=75?o=1:i>=25?o=.25:o=0,e.style.setProperty("--tabview-slider-offset-k2",`${o}`),e.style.setProperty("--tabview-slider-offset",`${i}px`);let l=n.getBoundingClientRect().width;e.style.setProperty("--tabview-slider-ow",`${l}px`);let r="var(--ytd-watch-flexy-sidebar-width-d)",a="var(--tabview-slider-ow)",s=`${i}px`;e.style.setProperty("--tabview-slider-offset-actual",`calc(${r} - ${a} + ${s})`)}};async function bl(e){await x();let t=B(e);if(!t||t.classList.contains("tabview-hover-slider-enable")||!t.matches("#columns.ytd-watch-flexy #primary.ytd-watch-flexy ~ #secondary.ytd-watch-flexy"))return;const n=An===!0,i=t.classList.contains("tabview-hover-slider-hover")===!0;(n||i)&&(await y.resolve(0),t.classList.add("tabview-hover-final"),i&&!n?(e.style.removeProperty("--tabview-slider-right"),e.style.removeProperty("--tabview-slider-offset")):(i||e.style.setProperty("--tabview-slider-right",`${ji()}px`),pl(e)),n^i&&(t.classList.toggle("tabview-hover-slider",n),t.classList.toggle("tabview-hover-slider-hover",n)),await y.resolve(0),setTimeout(()=>{t.classList.remove("tabview-hover-final")},350))}function on(){let e=document.querySelector("ytd-watch-flexy[flexy][is-two-columns_] #secondary-inner.ytd-watch-flexy");if(!e)return;let t=B(e);if(!t||t.classList.contains("tabview-hover-slider-enable"))return;let n=document.documentElement.clientWidth;ol.lockWith(i=>{let o=document.documentElement.clientWidth;n===o&&e.matches("body ytd-watch-flexy[flexy][is-two-columns_] #secondary-inner.ytd-watch-flexy")?bl(e).then(i):i()})}async function gl(){const e=document.getElementById("chatframe");if(!(e instanceof HTMLIFrameElement)||(gt.get(e)||0)%2===1||(await k(()=>{}),(gt.get(e)||0)%2===1))return;let t;try{t=e.contentDocument.location}catch{}t&&t.href.includes("youtube.com")&&await k(async()=>{(gt.get(e)||0)%2!==1&&(await ii.then(),e.isConnected===!0&&e.matches("body iframe.style-scope.ytd-live-chat-frame#chatframe")&&await po(e))})}const Bn=(()=>{const e=document.createElementNS("http://www.w3.org/2000/svg","defs");let t=0;try{e.scrollIntoView({get behavior(){t++},get block(){t++}})}catch{}return t===2})(),vl=async(e,t)=>{const n=o=>`${o.height}|${o.width}|${o.left}|${o.top}`;let i=0;for(;i++<4;){const o=e.getBoundingClientRect(),l=n(o),r=new y(c=>{document.addEventListener("scroll",c,{capture:!0,passive:!0,once:!0})});e.scrollIntoView(t),await r,await new y(c=>{let f=new IntersectionObserver(()=>{c(),f.disconnect(),f=null});f.observe(e)});const a=e.getBoundingClientRect(),s=n(a);if(l===s)break}},Wi=Bn?()=>{const e=document.querySelector("ytd-app[scrolling]");if(!(e&&Vn()&&ie()&&(bt()||El()||an()||Rt())))return;const n=document.querySelector("#right-tabs"),i=n.getBoundingClientRect().top-e.getBoundingClientRect().top;if(n&&i>0){const o=n.closest("#secondary-inner");o&&o.getBoundingClientRect().height<document.documentElement.clientHeight&&document.documentElement.clientHeight>80&&vl(o,{behavior:"instant",block:"end",inline:"nearest"})}}:null;function Ie(e){if(Ne()&&ie())return;const t=document.querySelector(`a[tyt-tab-content="${_t}"]:not(.tab-btn-hidden)`)||document.querySelector(`a[tyt-tab-content="${e||mt.defaultTab}"]:not(.tab-btn-hidden)`)||document.querySelector(`a[tyt-tab-content="${Yt}"]:not(.tab-btn-hidden)`)||document.querySelector("a[tyt-tab-content]:not(.tab-btn-hidden)")||null;return ee(t),!!t}let ln=!1;function wl(e,t){(t&L)===0&&$l();const n=p.ytdFlexy;if(!n)return;const i=L|we;let o=!!(t&K),l=!!(t&Se)&&!!(t&xe),r=!!(t&G),a=!!(t&Pe),s=!!(t&X),c=!!(t&ne);function f(){Q.lockWith(N=>{z.lastPanel=="#chatroom"?(r&&ee(null),o||Ki()):z.lastPanel&&z.lastPanel.indexOf("#engagement-panel-")==0?(r&&ee(null),s||Al(z.lastPanel)):z.lastPanel=="#donation-shelf"?(r&&ee(null),c||Cl()):(o&&_e(),r||Ie()),x().then(N)})}function d(){Q.lockWith(N=>{r&&ee(null),o&&_e(),s&&Re(),c&&nt(),x().then(N)})}const u=!!(t&(G|X|ne|K)),m=!u;let b=e&jt?e^t:0,S=!!(b&Se),E=!!(b&K),D=!!(b&G),re=!!(b&we),U=!!(b&L),ce=!!(b&Pe),Be=!!(b&X),wn=!!(b&ne),Le=b&(G|K|X|ne),te=Le,lt=!!(t&Le),Et=!!(~t&Le);const xn=r+o+s+c>1,St=L|we|xe|Se,w=L|0|xe|0,C=St|G|X,h=w|0|X,M=St|G|ne,$=w|0|ne,ae=i,rt=L,mi=St|G,At=w|G,at=L|G|xe|Se,xr=L|G|xe|0,Do=i,ko=i,Er=Pe|L|we|G|X|ne|K,Sr=0|L|0|0|0|0|0;let yi=null,hi=()=>yi===null?yi=n.classList.contains("tyt-chat-popup"):yi;E&&o&&gl();const Fo=()=>{xn&&(t&L)===L&&Q.lockWith(N=>{if(r&&z.lastPanel===null)o&&_e(),s&&Re(),c&&nt();else if(z.lastPanel){let De=z.lastPanel||"";typeof De!="string"&&(De=""),o&&De!=="#chatroom"&&_e(),s&&De.indexOf("#engagement-panel-")<0&&Re(),c&&De!=="#donation-shelf"&&nt(),ee(null)}x().then(N)})};let Po=y.resolve();if(a?(te==K&&(t&at)===xr&&u&&!U&&ee(null),te&K&&o&&Bn&&Po.then(async()=>{if(await x(),!document.querySelector("ytd-app[scrolling]"))return;document.querySelector("ytd-live-chat-frame#chat")&&bt()&&Wi()}),te&X&&s&&Po.then(async()=>{if(await x(),!document.querySelector("ytd-app[scrolling]"))return;let De=document.querySelector('ytd-watch-flexy[flexy][tyt-tab] #panels.ytd-watch-flexy ytd-engagement-panel-section-list-renderer[target-id][visibility][visibility="ENGAGEMENT_PANEL_VISIBILITY_EXPANDED"]:not([hidden])');if(De){let Ar=50,Cr=setInterval(()=>{--Ar?De.scrollIntoView(!0):clearInterval(Cr)},17)}})):ce?(!a&&m&&ie()&&!Ne()?f():!a&&u&&ie()&&Ne()&&(hi()||sn()),!a&&u&&ie()&&y.resolve().then(Fo)):(t&C)===h&&!U&&(te==K||te==X)?Be?Q.lockWith(N=>{_e(),x().then(N)}):S&&Q.lockWith(N=>{Re(),x().then(N)}):(t&M)===$&&!U&&(te==K||te==ne)?wn?Q.lockWith(N=>{_e(),x().then(N)}):S&&Q.lockWith(N=>{nt(),Mi().then(N)}):!te&&U&&(t&ae)===rt&&xn?f():te==K&&(t&mi)===At&&u&&!U?ee(null):lt&&(t&Do)===ko&&u&&(b&i)===0?sn():(t&Do)===ko&&u?hi()||d():Et&&(t&ae)===rt&&m&&!U?te==X||te==ne||te==K?(z.lastPanel=null,a||f()):a||jn():!te&&b&i&&(t&ae)===rt&&m?f():(t&Er)===Sr&&Q.lockWith(N=>{Ie(),x().then(N)}),re){let N=Date.now();Di=N,setTimeout(()=>{Di===N&&on()},130)}let pi=null;(pi=document.querySelector(".tabview-hover-slider-enable"))&&R.debounce(()=>{pi.isConnected&&pi.dispatchEvent(new CustomEvent("tabview-hover-slider-restore"))}),ce&&(kn=!0,x().then(Vl)),U&&y.resolve(0).then(()=>{if(Fo(),Qn(),nn!==null)if((t&L)===L){let N=document.querySelector("tabview-view-columns-endpos");N!==null&&nn.observe(N)}else nn.disconnect();x().then(()=>{di(!0)})}),ln===!0&&(Ze(t,L|we,0)&&o&&hi()||(ln=!1,Z(document,"tyt-close-popup")))}function Yi(e){return!(e&Se)&&e&xe?e|K:e&~K}const I=new Proxy({layoutStatus:void 0},{get:function(e,t){return e[t]},set:function(e,t,n){if(t=="layoutStatus"){if(n===0)return e[t]=n,!0;if(e[t]===n)return!0;if(!e.layoutStatus_pending){e.layoutStatus_pending=!0;const i=e[t];return e[t]=n,Q.lockWith(o=>{e.layoutStatus_pending=!1;let l=e[t];i!==l?(wl(i,l),x().then(o)):o()}),!0}}return e[t]=n,!0},has:function(e,t){return t in e}}),pt=(e,t,n,i,o,l)=>`<svg${l?` class=${l}`:""} width="${e}" height="${t}" viewBox="0 0 ${n} ${i}" preserveAspectRatio="xMidYMid meet">${o}</svg>`;function xl(e){return e.currentTime>0&&!e.paused&&!e.ended&&e.readyState>e.HAVE_CURRENT_DATA}function W(e,t,n){e&&(n===!0?e.setAttribute(t,""):n===!1?e.removeAttribute(t):n===null||typeof n=="string"&&e.setAttribute(t,n))}function rn(e,t){let n=!1;e.getAttribute("tyt-tab-content")==="#tab-comments"?(Ai=!t,(Ye&2)!==2&&(n=!0)):n=!0,n&&(t?e.classList.remove("tab-btn-hidden"):e.classList.add("tab-btn-hidden"))}function Ui(e){let t=e.classList.contains("active");rn(e,!1),t&&Ie()}function Ne(){const e=p.ytdFlexy;return e&&e.hasAttribute("theater")}function Vn(){const e=p.ytdFlexy;return e&&e.hasAttribute("fullscreen")}function El(){const e=p.ytdFlexy;return e&&(e.getAttribute("tyt-tab")||"").charAt(0)==="#"}function bt(){const e=p.ytdFlexy;return e&&(e.getAttribute("tyt-chat")||"").charAt(0)==="+"}function ie(){const e=p.ytdFlexy;return e&&e.hasAttribute("is-two-columns_")}function Sl(){return document.querySelector("#right-tabs .tab-btn.active")!==null}function an(){const e=p.ytdFlexy;return e&&+e.getAttribute("tyt-ep-visible")>0}function Rt(){const e=p.ytdFlexy;return e&&e.hasAttribute("tyt-donation-shelf")}const Gi=new Map;let Ht=1;function zn(){let e=[],t=0;for(const n of document.querySelectorAll("ytd-watch-flexy[flexy][tyt-tab] #panels.ytd-watch-flexy ytd-engagement-panel-section-list-renderer[target-id][visibility]:not([hidden])")){let i=n.getAttribute("target-id");if(typeof i!="string")continue;let o=Gi.get(i);o||(Gi.set(i,o=Ht),Ht===1<<62?(Ht=1,console.warn("engagementId reached 1 << 62")):Ht=Ht<<1);let l=n.getAttribute("visibility"),r=o;switch(l){case"ENGAGEMENT_PANEL_VISIBILITY_EXPANDED":t|=r,e.push({ePanel:n,k:r,visible:!0});break;case"ENGAGEMENT_PANEL_VISIBILITY_HIDDEN":e.push({ePanel:n,k:r,visible:!1});break;default:e.push({ePanel:n,k:r,visible:!1})}}return{list:e,value:t}}function Al(e){if(typeof e=="string"&&(e=e.replace("#engagement-panel-",""),e=parseInt(e)),!(e>=0))return!1;let t=zn(),n=[];for(const{ePanel:i,k:o,visible:l}of t.list)(e&o)===o?l||n.push({panelId:i.getAttribute("target-id"),toShow:!0}):l&&n.push({panelId:i.getAttribute("target-id"),toHide:!0});if(n.length>0){const i=n;R.debounce(()=>{document.dispatchEvent(new CustomEvent("tyt-engagement-panel-visibility-change",{detail:i}))})}n=null}function Xi(e){let t=e.getAttribute("target-id");R.debounce(()=>{document.dispatchEvent(new CustomEvent("tyt-engagement-panel-visibility-change",{detail:{panelId:t,toHide:!0}}))})}function Re(){if(an())for(const e of document.querySelectorAll("ytd-watch-flexy[flexy][tyt-tab] #panels.ytd-watch-flexy ytd-engagement-panel-section-list-renderer[target-id][visibility]:not([hidden])"))e.getAttribute("visibility")=="ENGAGEMENT_PANEL_VISIBILITY_EXPANDED"&&Xi(e)}function Cl(){if(!Rt()){let e=document.querySelector("#tyt-donation-shelf-toggle-btn");if(e)return e.click(),!0}return!1}function nt(){if(Rt()){let e=document.querySelector("#tyt-donation-shelf-toggle-btn");if(e)return e.click(),!0}return!1}function jn(){if(!Ne()){const e=document.querySelector("ytd-watch-flexy #ytd-player button.ytp-size-button");e&&e.click()}}function sn(){if(Ne()){const e=document.querySelector("ytd-watch-flexy #ytd-player button.ytp-size-button");e&&e.click()}}function Ki(){let e=document.querySelector("ytd-live-chat-frame#chat[collapsed] > .ytd-live-chat-frame#show-hide-button");e&&(e=_.call(e,"div.yt-spec-touch-feedback-shape")||_.call(e,"ytd-toggle-button-renderer"),e&&e.click())}function _e(){let e=document.querySelector("ytd-live-chat-frame#chat:not([collapsed]) > .ytd-live-chat-frame#show-hide-button");e&&(e=_.call(e,"div.yt-spec-touch-feedback-shape")||_.call(e,"ytd-toggle-button-renderer"),e&&e.click())}async function Tl(){let e=document.querySelector("ytd-watch-flexy #tab-videos [placeholder-videos]");if(!e)return null;await y.resolve(0);let t=document.querySelector("tabview-view-videos-endpos");t&&t.remove(),t=document.createElement("tabview-view-videos-endpos"),Fl(t,e),await y.resolve(0),kt?(kt.disconnect(),kt.observe(t)):(kt=new IntersectionObserver(n=>{if((I.layoutStatus&L)===L||n.length!==1||n[0].isIntersecting!==!0)return;let i=(n[0]||0).target||0;i&&(i=null,n=null,new y(o=>{document.querySelector("#related.style-scope.ytd-watch-flexy ytd-watch-next-secondary-results-renderer.style-scope.ytd-watch-flexy ytd-compact-video-renderer.yt-search-generated.style-scope.ytd-item-section-renderer ~ ytd-continuation-item-renderer.style-scope.ytd-item-section-renderer[hidden]")||document.querySelector('ytd-watch-next-secondary-results-renderer.style-scope.ytd-watch-flexy yt-chip-cloud-renderer.style-scope.yt-related-chip-cloud-renderer yt-chip-cloud-chip-renderer.style-scope.yt-chip-cloud-renderer[aria-selected="false"] ~ [aria-selected="true"]')||x().then(o)}).then(()=>{let o=pr(6,!0);if(o.m2&&o.m3){const l=P.call(o.m2,"ytd-continuation-item-renderer");if(l){const r=_.call(l,"ytd-button-renderer.style-scope.ytd-continuation-item-renderer, yt-button-renderer.style-scope.ytd-continuation-item-renderer"),a=Pt(r,"button.yt-spec-button-shape-next--call-to-action");a?a.click():r?r.click():l.dispatchEvent(new Event("yt-service-request-sent-button-renderer"))}}o=null}))},{rootMargin:"0px",threshold:[0]}),kt.observe(t))}function Wn(){R.debounce(()=>{if(!g)return;let e=document.querySelector("*:not(#tab-videos) > #related.ytd-watch-flexy > ytd-watch-next-secondary-results-renderer");if(!!e){let i=P.call(e,"#related.ytd-watch-flexy"),o=document.querySelector("#right-tabs"),l=Pt(o,"#tab-videos");if(l!==null){let r=document.querySelector("ytd-watch-flexy:not([is-two-columns_]) #primary-inner.ytd-watch-flexy, ytd-watch-flexy[is-two-columns_] #secondary-inner.ytd-watch-flexy");r&&Ge.call(r,o),Ge.call(l,i),i.setAttribute("placeholder-for-youtube-play-next-queue",""),i.setAttribute("placeholder-videos",""),Tl()}}if(qn(),!se.allowChatControl)return;let n=null;if(n=document.querySelector("ytd-live-chat-frame#chat")){const i=n.parentNode.id==="chat-container"?n.parentNode:n;let o=document.querySelector('tabview-view-pholder[data-positioner="before|#chat"]');if(!o||o.nextElementSibling!==i){if(o&&o.remove(),!document.querySelector(".YouTubeLiveFilledUpView")){let l=document.querySelector("#right-tabs");if(l&&l.previousSibling!==i){const r=l.parentNode;let a=!0;if(r===i.parentNode&&r instanceof HTMLElement&&typeof Je=="function"&&typeof Fe=="function"){const s=[],c=[];let f=0;for(let d=r.firstChild;d instanceof Node;d=d.nextSibling)if(d===l)f|=1;else if(d===i)f|=2;else{if(d instanceof HTMLIFrameElement||d instanceof Element&&d.querySelector("iframe")){f|=4;break}f&1?c.push(d):s.push(d)}if(f===3&&s.length+c.length<8e3){if(s.length>0){const u=Je.call(document);Fe.call(u,...s),r.insertBefore(u,r.firstChild)}const d=Je.call(document);Fe.call(d,l,...c),r.appendChild(d),a=!1}}a&&cn(i,l)}}o||(o=document.createElement("tabview-view-pholder"),o.setAttribute("data-positioner","before|#chat")),cn(o,i)}}})}async function _l(){return document.fullscreenElement!==null}const Ji=`ep5wbmokDB-${Vo}`;async function Lr(){let e;const t=window.indexedDB;try{let n=t.open(Ji,3);e=await new y((i,o)=>{n.onupgradeneeded=function(l){const r=l.target.result;let a=r.createObjectStore("customers",{keyPath:"ssn"});a.createIndex("name","name",{unique:!1}),a.createIndex("email","email",{unique:!0}),a=null,r.deleteObjectStore("customers"),i(r)},n.onsuccess=function(l){const r=l.target.result;i(r)},n.onerror=function(){o()}})}finally{e&&e.close()}try{let n=t.deleteDatabase(Ji);await new y((i,o)=>{n.onsuccess=function(l){i(1)},n.onerror=function(l){i(-1)},n.onblocked=function(l){i(-2)}})}catch{}postMessage({tabviewEnergized:!0},"https://www.youtube.com")}async function Ll(){await _l()||(Me++,Me>=88e6&&Me%88e6===0&&(Me=0),(Me+ht)%11===0&&(ht>208&&(ht=200,Me=Me%8+1),document.head.dataset.viTime=`${ht+1}`,await y.resolve(0),ht=+document.head.dataset.viTime||0))}function Dl(){let e=document.createElement("tabview-view-autocomplete-pos"),t=document.querySelector("tabview-view-autocomplete-pos");return t&&t.remove(),e}function Qi(){if(document.querySelector("autocomplete-holder"))return;let e,t;e=this,this.removeEventListener("tyt-autocomplete-sc-exist",Qi,!1);let n=this.getAttribute("data-autocomplete-results-id");if(t=document.querySelector(`[data-autocomplete-input-id="${n}"]`),!n||!e)return;let i=je(e);(!i||i.nodeName.toLowerCase()!=="tabview-view-autocomplete-pos")&&(i=Dl(),cn(i,e)),dn(t,i),kl(e,i)}async function kl(e,t){let n=e.offsetHeight+"px";t.style.setProperty("--tyt-swwv-searchbox-h",n),Zi()}function Zi(){const e=p.ytdFlexy;if(!g||!e)return;const t=_.call(e,"[placeholder-for-youtube-play-next-queue] #suggestions-search-container tabview-view-autocomplete-pos > .autocomplete-suggestions[data-autocomplete-input-id]:not([position-fixed-by-tabview-youtube])");if(t){const n=document.querySelector("[placeholder-for-youtube-play-next-queue] input#suggestions-search");if(n){let o=function(r,a){r.style.display=a?"block":"none"},l=function(r,a){return(r.value||"").length>0&&(a.textContent||"").length>0};const i=et(t);if(B(t).setAttribute("position-fixed-by-tabview-youtube",""),t.setAttribute("position-fixed-by-tabview-youtube",""),t.setAttribute("userscript-scrollbar-render",""),!n.hasAttribute("is-set-click-to-toggle")){n.setAttribute("is-set-click-to-toggle",""),n.addEventListener("click",function(){y.resolve(0).then(()=>{const s=fe(i);if(!s)return;l(this,s)&&(Bi(s)?o(s,!1):o(s,!0))})},pe);let r=null,a=0;n.addEventListener("keydown",function(s){switch(s.code){case"ArrowUp":case"ArrowDown":let c=Date.now();a===0&&(le().then(()=>{if(a=0,Date.now()-c>300)return;const d=fe(i);if(!d)return;let u=_.call(d,".autocomplete-suggestion.selected"),m=u&&u!==r;if(r=u,m)try{u.scrollIntoView({block:"nearest",inline:"nearest"})}catch{}}),a=1);default:}},pe),n.addEventListener("tyt-autocomplete-suggestions-change",function(s){s.target===document.activeElement&&x().then(()=>{const c=document.querySelector(`.autocomplete-suggestions[data-autocomplete-input-id="${this.getAttribute("data-autocomplete-results-id")}"]`);if(!c)return;l(this,c)&&o(c,!0)})},pe)}}}}const cn=HTMLElement.prototype.before?(e,t)=>!t||!e?null:(HTMLElement.prototype.before.call(t,e),!0):(e,t)=>{if(!t||!e)return null;try{return HTMLElement.prototype.insertBefore.call(B(t),e,t),!0}catch{console.log("element insert failed in old browser CE")}return!1},Fl=HTMLElement.prototype.after?(e,t)=>!t||!e?null:(HTMLElement.prototype.after.call(t,e),!0):(e,t)=>{if(!t||!e)return null;try{return HTMLElement.prototype.insertBefore.call(B(t),e,he(t)),!0}catch{console.log("element insert failed in old browser CE")}return!1},dn=HTMLElement.prototype.prepend?(e,t)=>!t||!e?null:(HTMLElement.prototype.prepend.call(t,e),!0):(e,t)=>{if(!t||!e)return null;try{return HTMLElement.prototype.insertBefore.call(t,e,A(t)),!0}catch{console.log("element insert failed in old browser CE")}return!1},Dr=HTMLElement.prototype.append?(e,...t)=>(HTMLElement.prototype.append.call(e,...t),!0):(e,...t)=>{for(const n of t)e.appendChild(n);return!0};function Pl(e){let t=document.getElementById(e);return t||(t=document.createElement("div"),t.id=e),t}function Yn(e){if(e===null&&(e=document.querySelector("ytd-watch-flexy[playlist] *:not(#tabview-playlist-wrapper) > ytd-playlist-panel-renderer.style-scope.ytd-watch-flexy#playlist:not(.ytd-miniplayer)"),!e))return;const t=p.ytdFlexy;if(!g||!t)return;if(_.call(e,"*:not(#tabview-playlist-wrapper) > ytd-playlist-panel-renderer#playlist:not(.ytd-miniplayer) #items.ytd-playlist-panel-renderer:not(:empty)")!==null&&e.nodeName.toUpperCase()==="YTD-PLAYLIST-PANEL-RENDERER"){let i=document.querySelector("#tab-list");if(!i)return;let o=Pl("tabview-playlist-wrapper"),l=new DocumentFragment;l.appendChild(o),Ge.call(o,e),Ge.call(i,l),l=null,o=null}}function un(e){return`${Tt||0}...${e.textContent}`}function Ml(){let e=document.querySelector("#tab-list ytd-playlist-panel-renderer#playlist");if(e&&e.matches("[collapsed], [collapsible]")){const t=e;e=null;const n=P.call(t,"ytd-watch-flexy #tab-list");if(!n||n.nodeType!==1)return;t.hasAttribute("collapsed")&&W(t,"collapsed",!1),t.hasAttribute("collapsible")&&W(t,"collapsible",!1)}}async function ql(){if(!g)return 0;await R.d(),await y.all([y.resolve().then(()=>{let e=document.querySelector("ytd-watch-flexy #tab-info ytd-expander tp-yt-paper-button#less.ytd-expander:not([hidden]), #tab-info ytd-expander tp-yt-paper-button#more.ytd-expander:not([hidden])");if(e){const t=e;e=null;const n=P.call(t,"ytd-watch-flexy #tab-info ytd-expander");if(!n||n.nodeType!==1)return;n.style.getPropertyValue("--ytd-expander-collapsed-height")&&n.style.setProperty("--ytd-expander-collapsed-height",""),Z(n,"tabview-expander-config")}}),y.resolve().then(()=>{let e=document.querySelector("ytd-watch-flexy #tab-info ytd-structured-description-content-renderer.style-scope.ytd-video-secondary-info-renderer");if(e){const t=P.call(e,"[hidden]");if(t){e.hasAttribute("hidden")&&e.removeAttribute("hidden");const n=P.call(e,"ytd-expander.style-scope.ytd-video-secondary-info-renderer #description.style-scope.ytd-video-secondary-info-renderer");n&&n.hasAttribute("hidden")&&n.removeAttribute("hidden")}t&&setTimeout(()=>{let n=P.call(e,"ytd-watch-flexy #tab-info ytd-expander");if(!n)return;let i=Ue.call(n,'#tab-info .more-button.style-scope.ytd-video-secondary-info-renderer[role="button"]');if(i.length===1){let o=B(i[0]);o.nodeName.toUpperCase()==="TP-YT-PAPER-BUTTON"&&o.click()}},300)}}),y.resolve().then(()=>{let e=document.querySelector("#primary.ytd-watch-flexy #below ytd-watch-metadata #owner #owner-sub-count");if(e){if(!e.hasAttribute("title")){let t=P.call(e,"body #primary.ytd-watch-flexy #below ytd-watch-metadata:not([tabview-uploader-hover])");if(t){t.setAttribute("tabview-uploader-hover","");let n=0;t.addEventListener("transitionend",function(i){let o=i.propertyName==="background-position-y"?1:i.propertyName==="background-position-x"?2:0;if(o&&i.target){let l=this;if(l.classList.contains("tabview-uploader-hover")){if(i.target.id!=="owner")return;l.classList.toggle("tabview-uploader-hover",!1)}}if(o===1){let l=i.elapsedTime<.03,r=this;l?l&&(n=0):(n>0&&r.classList.toggle("tabview-uploader-hover",!1),n=0)}else if(o===2){i.elapsedTime<.03?n++:n--;let r=this;n<=0?(r.classList.toggle("tabview-uploader-hover",!1),n=0):n===1&&r.classList.toggle("tabview-uploader-hover",!0)}},Ft)}}e.setAttribute("title",e.textContent)}})])}const Il=[function(){let e=fe(this.elm);if(!e)return;let t=document.querySelector("span#tyt-cm-count");if(t){let n=P.call(t,'.tab-btn[tyt-tab-content="#tab-comments"]');n&&n.setAttribute("loaded-comment","normal"),Z(document,"tyt-update-cm-count")}return vt(1),Wt=un(e),!0},function(){let e=fe(this.elm);if(!e)return;let t=document.querySelector("span#tyt-cm-count");if(t){let n=P.call(t,'.tab-btn[tyt-tab-content="#tab-comments"]');n&&n.setAttribute("loaded-comment","message"),t.textContent="\u200B"}return vt(1),Wt=un(e),!0}];let Un=null;function $t(e){const t=p.ytdFlexy;if(!g||!t||q!=="watch")return;const n=document.querySelector("ytd-comments#comments");if(!n)return;const i=Ue.call(n,"#count.ytd-comments-header-renderer, ytd-item-section-renderer.ytd-comments#sections #header ~ #contents > ytd-message-renderer.ytd-item-section-renderer"),o=+`${Date.now()-Wo}00`;let l=new Array(i.length);l.newFound=!1;let r=0,a=-1,s=xi;xi=o;for(const c of i){let f=0;if(c.id==="count"?f=1:(c.textContent||"").trim()&&(f=2),f>0){let d=Xt.get(c)||0,u=s-d,m=u>4||u<-4;m?(Xt.set(c,o+1),l.newFound=!0,a=r):Xt.set(c,o),l[r]={elm:et(c),isNew:m,isLatest:!1,f:Il[f-1]},En&&(l[r].status=f,l[r].text=c.textContent),r++}}if(l.length>r&&(l.length=r),a>=0){l[a].isLatest=!0;let c=fe(l[a].elm);c&&(Un=c.textContent)}else if(l.length===1){let c=fe(l[0].elm),f=null;if(c){let d=c.textContent;d!==Un&&(Xt.set(c,o+1),l.newFound=!0,l[0].isNew=!0,a=0,l[a].isLatest=!0),Un=d}}return e&&Nl(l),l}function eo(){if(Ae===2)return;const e=p.ytdFlexy;if(!e||(e.getAttribute("tyt-comments")||"").indexOf("K")>=0||!_.call(e,"ytd-comments#comments:not([hidden])"))return;e.setAttribute("tyt-comments","Kz");const n=document.querySelector('[tyt-tab-content="#tab-comments"]');let i=_.call(n,"span#tyt-cm-count");n.removeAttribute("loaded-comment"),i.innerHTML=Ve(""),n&&rn(n,!0)}function it(){ge.resolved&&Qe.comments_section_loaded===0&&T.new&&!T.fetched&&(T.new.f(),T.fetched=!0,hn())}function to(e){let t=!1;e&&Ae!==2&&document.querySelector("ytd-comments#comments:not([hidden])")&&(vt(0),it(),t=!0),no(t)}function no(e){Ae!==2&&(document.querySelector("ytd-comments#comments").hasAttribute("hidden")?li():Qe.comments_section_loaded===0&&(e||(ft&3)===3)&&fo())}const Nl=e=>{if(!e||(T.count=e.length,T.new))return;if(e.newFound){if(e.length===1)return T.new=e[0],!0;if(e.length>1){for(const n of e)if(n.isLatest===!0&&n.isNew)return T.new=n,!0}}else if(e.length===1)return T.base=e[0],!1},Gn=()=>{let e=document.querySelector(`ytd-comments#comments:not([o3r-${dl}])`);if(!e)return;const t=p.ytdFlexy;!g||!t||en.bindElement(e)&&en.observer.check(9)},Xn=()=>{Z(document,"tabview-fix-live-chat-toggle-btn")},ot={mtf_attrPlaylist:(e,t)=>{if(!g||q!=="watch"||!p.ytdFlexy)return;let i=document.querySelector("#tab-list ytd-playlist-panel-renderer#playlist"),o=i&&!i.hasAttribute("hidden");const l=document.querySelector('[tyt-tab-content="#tab-list"]');if(l){let r=l.classList.contains("tab-btn-hidden");r&&o?l.classList.remove("tab-btn-hidden"):!r&&!o&&Ui(l)}},mtf_attrComments:(e,t)=>{if(ge.resolved&&$t(!0),q!=="watch")return;let n=document.querySelector("ytd-comments#comments");const i=document.querySelector('[tyt-tab-content="#tab-comments"]');if(!n||!i)return;let o=n.hasAttribute("hidden");const l=p.ytdFlexy;!g||!l||Ae===2||(o?o&&(l.setAttribute("tyt-comments","Kh"),q==="watch"&&Qe.comments_section_loaded===1&&wt()):(l.setAttribute("tyt-comments","Kv"),T.fetched||wt(),rn(i,!0)))},mtf_attrChatroom:()=>{const e=p.ytdFlexy;!g||!e||q==="watch"&&(On(),Q.lockWith(t=>{const n=document.querySelector("ytd-live-chat-frame#chat"),i=p.ytdFlexy;if(!n||!i){t();return}if(q!=="watch"){t();return}let o="",l=!!n.hasAttribute("collapsed"),r=i.getAttribute("tyt-chat");if(r!==null&&r.charCodeAt(0)<46&&(o=r.substring(1)),l&&(o=`-${o}`),l||(o=`+${o}`),W(i,"tyt-chat",o),typeof o=="string"&&!l&&(z.lastPanel="#chatroom"),!l&&Sl()&&ie()&&!Ne()?(ee(null),x().then(t)):t(),l){n.classList.remove("tyt-chat-frame-ready");let a=document.querySelector("tyt-iframe-popup-btn");a&&a.remove()}else{const a=_.call(n,"body iframe.style-scope.ytd-live-chat-frame#chatframe");a&&y.resolve(a).then(bo)}Xn()}))},mtf_attrEngagementPanel:(e,t)=>{const n=p.ytdFlexy;if(!g||!n)return;let i=null;if(e===9)i=t;else{document.querySelector('ytd-watch-flexy[flexy][tyt-tab] #panels.ytd-watch-flexy ytd-engagement-panel-section-list-renderer[target-id][visibility="ENGAGEMENT_PANEL_VISIBILITY_EXPANDED"]:not([hidden])')||(Oi.clear(!0),Lt=null,W(n,"tyt-ep-visible",!1));return}let o=zn().value,l=+n.getAttribute("tyt-ep-visible")||0;o===0||l===o||(n.setAttribute("tyt-ep-visible",o),z.lastPanel=`#engagement-panel-${o}`,Lt=et(i),Nt(()=>{p.storeLastPanel===i&&Q.lockWith(r=>{p.storeLastPanel===i&&jl()?x().then(r):r()})}))}};function io(){z={lastTab:null,lastPanel:null,last:null},g=!1,Ce=null,I.layoutStatus=0,Zt.clear(!0),en.clear(!0),Hn.clear(!0),Nn.clear(!0),Rn.clear(!0),Sn=null}function oo(e){if(!(e instanceof HTMLElement))return null;let t=e.textContent;if(t.trim().length===0)return null;let i=e.nodeName,o=e.id;return o&&(i+="#"+o),i+`
`+t}async function lo(){let e=document.querySelector("#primary.ytd-watch-flexy #above-the-fold.ytd-watch-metadata"),t=document.querySelector("#tab-info ytd-expander > #content");if(e&&t){const n=new Set;for(let i=F(t);i instanceof HTMLElement;i=F(i)){let o=oo(i);o!==null&&n.add(o)}for(let i=F(e);i instanceof HTMLElement;i=F(i)){let o=oo(i);o!==null&&n.has(o)?i.classList.add("tyt-hidden-duplicated-meta"):i.classList.remove("tyt-hidden-duplicated-meta")}n.clear()}}const fn=new WeakMap,ro=()=>document.querySelectorAll("[tyt-info-expander-placeholder]").length===1&&document.querySelectorAll("[tyt-info-expander-content]").length===1;let mn=new Mt;async function Kn(){if(!document.querySelector("#tab-info"))return;const e=document.querySelectorAll("[tyt-info-expander-placeholder]");if(e.length===1){const t=e[0],n=fn.get(t);if(!n)return;for(const i of document.querySelectorAll("[tyt-info-expander-content]"))n!==i&&i.remove();n.isConnected===!1&&document.querySelector("#tab-info").appendChild(n),ro()&&mn.resolve()}}function Jn(e){return Ln[_n][e]||Ln.en[e]||""}function Rl(){const e=`${pt(16,16,90,90,qo)}<span>${Jn("videos")}</span>`,t=`${pt(16,16,60,60,Io)}<span>${Jn("info")}</span>`,n=`${pt(16,16,20,20,No)}<span>${Jn("playlist")}</span>`;let i=`
        <paper-ripple class="style-scope yt-icon-button">
            <div id="background" class="style-scope paper-ripple" style="opacity:0;"></div>
            <div id="waves" class="style-scope paper-ripple"></div>
        </paper-ripple>
        `,o=`
    <div class="font-size-right">
    <div class="font-size-btn font-size-plus" tyt-di="8rdLQ">
    <svg width="12" height="12" viewbox="0 0 50 50" preserveAspectRatio="xMidYMid meet" 
    stroke="currentColor" stroke-width="6" stroke-linecap="round" vector-effect="non-scaling-size">
      <path d="M12 25H38M25 12V38"/>
    </svg>
    </div><div class="font-size-btn font-size-minus" tyt-di="8rdLQ">
    <svg width="12" height="12" viewbox="0 0 50 50" preserveAspectRatio="xMidYMid meet"
    stroke="currentColor" stroke-width="6" stroke-linecap="round" vector-effect="non-scaling-size">
      <path d="M12 25h26"/>
    </svg>
    </div>
    </div>
    `.replace(/[\r\n]+/g,"");return`
        <div id="right-tabs">
            <tabview-view-pos-thead></tabview-view-pos-thead>
            <header>
                <div id="material-tabs">
                    ${[`<a id="tab-btn1" tyt-di="q9Kjc" tyt-tab-content="#tab-info" class="tab-btn${(Ye&1)===1?" tab-btn-hidden":""}">${t}${i}${o}</a>`,`<a id="tab-btn3" tyt-di="q9Kjc" tyt-tab-content="#tab-comments" class="tab-btn${(Ye&2)===2?" tab-btn-hidden":""}">${pt(16,16,120,120,Mo)}<span id="tyt-cm-count"></span>${i}${o}</a>`,`<a id="tab-btn4" tyt-di="q9Kjc" tyt-tab-content="#tab-videos" class="tab-btn${(Ye&4)===4?" tab-btn-hidden":""}">${e}${i}${o}</a>`,`<a id="tab-btn5" tyt-di="q9Kjc" tyt-tab-content="#tab-list" class="tab-btn tab-btn-hidden">${n}${i}${o}</a>`].join("")}
                </div>
            </header>
            <div class="tab-content">
                <div id="tab-info" class="tab-content-cld tab-content-hidden" tyt-hidden userscript-scrollbar-render></div>
                <div id="tab-comments" class="tab-content-cld tab-content-hidden" tyt-hidden userscript-scrollbar-render></div>
                <div id="tab-videos" class="tab-content-cld tab-content-hidden" tyt-hidden userscript-scrollbar-render></div>
                <div id="tab-list" class="tab-content-cld tab-content-hidden" tyt-hidden userscript-scrollbar-render></div>
            </div>
        </div>
        `}function ao(){let e="en";switch(((document||0).documentElement||0).lang||""){case"en":case"en-GB":e="en";break;case"de":case"de-DE":e="du";break;case"fr":case"fr-CA":case"fr-FR":e="fr";break;case"zh-Hant":case"zh-Hant-HK":case"zh-Hant-TW":e="tw";break;case"zh-Hans":case"zh-Hans-CN":e="cn";break;case"ja":case"ja-JP":e="jp";break;case"ko":case"ko-KR":e="kr";break;case"ru":case"ru-RU":e="ru";break;default:e="en"}return e}function Hl(){let e=ao();Ln[e]?_n=e:_n="en"}function Qn(){const e=p.ytdFlexy;if(!g||!e)return;const t=document.documentElement;t.setAttribute("sxmq8",t.getAttribute("sxmq8")==="1"?"0":"1"),console.log("sxmq8 r1",document.documentElement.getAttribute("sxmq8"));let n=_.call(e,"#primary.ytd-watch-flexy ytd-watch-metadata ~ ytd-comments#comments");if(n){let i=document.querySelector("#tab-comments");i&&Ge.call(i,n)}Yn(null),Wn(),Zi()}function Y(e,t){if(!t)return;const n=(Li[e]||0)+1;Li[e]=n;const i=_i[n-1]||(_i[n-1]=Symbol());document.addEventListener(e,function(o){o[i]||(o[i]=!0,y.resolve().then(()=>{t(o)}))},Ft)}async function $l(){if(ki)return;ki=!0,await y.resolve(0);const[e,t,n]=await y.all([y.resolve().then(()=>document.querySelector("#right-tabs header")),y.resolve().then(()=>document.querySelector("#right-tabs tabview-view-pos-thead")),y.resolve().then(()=>document.querySelector("#masthead-container, #masthead"))]);let i=0;new IntersectionObserver(l=>{let r=null,a=null,s=null;for(const d of l)!d.boundingClientRect||!d.rootBounds||(!d.isIntersecting&&d.boundingClientRect.y<=d.rootBounds.top&&d.boundingClientRect.y<d.rootBounds.bottom?(r=2,a=d.boundingClientRect,s=d.rootBounds):d.isIntersecting&&d.boundingClientRect.y>=d.rootBounds.top&&d.boundingClientRect.y<d.rootBounds.bottom&&(r=1,a=d.boundingClientRect,s=d.rootBounds));let c=I.layoutStatus;r!==null&&(r===2&&de===!0||r===1&&de===!1||ur(r,a.width,{left:a.left,right:s.width-a.right}));let f=Date.now();i=f,setTimeout(()=>{i===f&&c!==I.layoutStatus&&di()},300)},{rootMargin:"0px 0px 0px 0px",threshold:[0]}).observe(t)}function so(){let e=document.querySelector("#below h1.ytd-watch-metadata yt-formatted-string");if(e){let t="";try{if(v&&Object.keys(v).length>0){let n=function(o,l){let r=l-o,a=Math.floor(r/36e5);r=r-a*36e5;let s=Math.round(r/6e4),c=null;return s<10&&a===0&&(s=Math.floor(r/6e4),r=r-s*6e4,c=Math.round(r/1e3),c===0&&(c=null)),{hrs:a,mins:s,seconds:c}};const i=Go();if(v.broadcastBeginAt&&v.isLiveNow===!1){let o=new It(v.broadcastBeginAt),l=v.broadcastEndAt?new It(v.broadcastEndAt):null,r=0;l&&o.toLocaleDateString()===l.toLocaleDateString()?r=1:l&&+l>+o&&l-o<864e5&&o.getHours()>=6&&l.getHours()<6&&(r=2);let a=n(o,l);r>0?(l.dayBack=r===2,t=i(512,{bd1:o,bd2:l,isSameDay:r,durationInfo:a,formatDates:v})):l&&r===0&&(t=i(528,{bd1:o,bd2:l,isSameDay:r,durationInfo:a,formatDates:v}))}else if(v.broadcastBeginAt&&v.isLiveNow===!0){let o=new It(v.broadcastBeginAt);t=i(768,{bd1:o,formatDates:v})}else v.uploadDate?v.publishDate&&v.publishDate!==v.uploadDate?t=i(1536,{formatDates:v}):t=i(1552,{formatDates:v}):!v.uploadDate&&v.publishDate&&(t=i(1792,{formatDates:v}))}}catch{t=""}t?e.setAttribute("data-title-details",t):e.removeAttribute("data-title-details")}}const Ol=qe();function Zn(){let e=document.querySelector(`#tab-list ytd-playlist-panel-renderer#playlist:not([o3r-${cl}])`);const t=p.ytdFlexy;if(!(!g||!t)){if(e){Zt.bindElement(e)&&Zt.observer.check(9);let n=et(e);R.debounce(()=>{let i=fe(n);n=null,i&&i.isConnected===!0&&Z(i,"tabview-yt-data-reassign"),i=null},Ol),e=null}}ot.mtf_attrPlaylist(),y.resolve(0).then(()=>{const n=p.ytdFlexy;!g||!n||!_t&&(n.getAttribute("tyt-tab")+"").indexOf("#tab-")===0&&location.pathname==="/watch"&&(/[\?\&]list=[\w\-\_]+/.test(location.search)?Ie("#tab-list")&&(_t="#tab-list"):/[\?\&]lc=[\w\-\_]+/.test(location.search)&&Ie("#tab-comments")&&(_t="#tab-comments"))}),y.resolve(0).then(()=>{Ml()})}const co=function(){Pn.inc(),T={base:null,new:null,fetched:!1,count:null},Tt=null,J=null},uo=function(){const e=document.documentElement;if(e.setAttribute("sxmq8",e.getAttribute("sxmq8")==="1"?"0":"1"),e.removeAttribute("pnzgu"),console.log("sxmq8 r2",document.documentElement.getAttribute("sxmq8")),Ee=0,me.inc(),ge.reset(),!R.resolved&&(Dt&2)===2)Dt-=2,rl.inject();else if(tt===2){tt=0;let t=document.querySelector("tabview-view-ploader");t&&t.remove()}be.resolved&&(ft=1,be.reset(),(Dt&8)===0&&($t(!1),co()))};function fo(){ft=0;let e=0;function t(){if(!ge.resolved||Qe.comments_section_loaded!==0||T.fetched)return;let o=$t(!0);if(T.new&&!T.fetched){T.new.f()&&(T.fetched=!0,hn());return}if(e++,T.base&&!T.new&&!T.fetched&&T.count===1){let l=fe(T.base.elm),r=l?un(l):null;(e>7||r===Wt)&&T.base.f()&&(T.fetched=!0,hn())}if(!T.fetched){if(e>7){let l=o.length===1?fe(o[0].elm):null,r=l?un(l):null;l&&r!==Wt&&(T.base=null,T.new=o[0],T.new.f(),T.fetched=!0,hn());return}return!0}}async function n(o){let l=420;for(let r=9;--r>0&&!(me.valueOf()!==o||t()!==!0);)await new y(a=>setTimeout(a,l))}let i=me.valueOf();ge.debounce(()=>{i===me.valueOf()&&(Oe&32||(Oe|=32,n(i)))})}const{removeDuplicateInfoFn:Bl,setHiddenStateForDesc:Vl}=(()=>{let e=0;function t(){let s=p.ytdFlexy;if(!s)return;let c=document.fullscreenElement?!1:s.classList.contains("tabview-info-duplicated"),f;f=document.querySelector(".tabview-info-duplicated-checked[flexy] ytd-text-inline-expander#description-inline-expander.ytd-watch-metadata #plain-snippet-text"),f&&W(f,"hidden",c),f=document.querySelector(".tabview-info-duplicated-checked[flexy] ytd-text-inline-expander#description-inline-expander.ytd-watch-metadata #formatted-snippet-text"),f&&W(f,"hidden",c)}function n(){const s=p.ytdFlexy;if(!s)return;let c=!1,f=!1;s.matches(".tabview-info-duplicated[flexy]")&&(c=!!_.call(s,"#description.style-scope.ytd-watch-metadata > #description-inner:only-child"),f=!!_.call(s,"#tab-info ytd-expander #description.ytd-video-secondary-info-renderer")),t(),s.setAttribute("tyt-has",`${c?"A":"a"}${f?"B":"b"}`)}async function i(s,c){s&&c&&(s.setAttribute("tyt-du744",""),c.setAttribute("tyt-du744",""))}async function o(s,c,f){const d=s,u=c;if(d.hasAttribute("tyt-du744")||u.hasAttribute("tyt-du744"))return!0;if(!d||!u||d.hasAttribute("hidden")||u.hasAttribute("hidden"))return!1;const m=typeof crypto=="object"&&typeof crypto.randomUUID=="function"?`${crypto.randomUUID()}`:"",b=typeof String.prototype.replaceAll=="function",S=m&&b;let E=S&&sessionStorage.getItem("js-yt-usernames")||"";{const w=document.querySelectorAll("#owner a.yt-simple-endpoint[href]");let C=null,h=null;for(const M of w){h===null&&M.firstElementChild===null&&(M.textContent||"").length>0&&(h=M.textContent);let $;C===null&&($=/\/(\@[-_a-zA-Z0-9.]{3,30})(\/|$)/.exec(M.getAttribute("href")))&&(C=$[1])}C!==null&&h!==null&&E.indexOf(`
${C}	`)<0&&`${E}
`.indexOf(`	${h}
`)<0&&(E=`
${C}	${h}
${E}`.trim())}const D=[];let re;if(E){do re=crypto.randomUUID();while(E.includes(re));let w=0;const C=new Map;for(const h of E.split(`
`)){if(h.length<4)continue;const M=h.split("	"),$=M[1].replaceAll(" ","");let ae=C.get($);ae||(ae=++w,C.set($,ae)),D.push([M[0],ae]),D.push([$,ae])}C.clear(),D.length>1&&D.sort((h,M)=>M[0].length-h[0].length)}const U=S&&re&&D.length>0?w=>{if(typeof w=="string"){w=w.replaceAll(" ","");for(const C of D){const h=`[[${re}::${C[1]}]]`;w=w.replaceAll(C[0],h)}}return w}:w=>w,ce=new Map,Be=w=>{for(const C of Ue.call(w,"[hidden]")){const h=document.createTreeWalker(C,NodeFilter.SHOW_TEXT,null,null);let M;for(;M=h.nextNode();){const $=M.nodeValue;$&&!$.startsWith("\uF204")&&(ce.set(M,$),M.nodeValue=`\uF204${$.replace(/[\uF204\uF205]/g,"")}\uF205`)}}},wn=(w,C)=>{w instanceof HTMLElement&&Be(w);let h=w.textContent.trim(),M=h.length>0;if(M&&h.includes("\uF204")&&(h=h.replace(/\uF204[^\uF204\uF205]+\uF205/g,""),h=h.replace(/[\uF204\uF205]/g,""),M=h.length>0),M){h=h.replace(/\n[\n\x20]+\n/g,`

`),h=h.replace(/[\u0020\u00A0\u16A0\u180E\u2000-\u200A\u202F\u205F\u3000]/g," "),h=h.replace(/[\u200b\uFEFF]/g,"");let $=64;for(;$-- >0;){const ae=h;h=h.replace(/([\u1000-\uDF77])\x20([\x21-\x7E])/g,"$1$2"),h=h.replace(/([\x21-\x7E])\x20([\u1000-\uDF77])/g,"$1$2"),ae===h&&($=0)}h=U(h),h=h.replace(/[,.]/g," "),h=h.replace(/[#]/g,"#"),h=h.replace(/[*]/g,"*"),h=h.replace(/["'<>\[\]\{\}]/g,'"'),h=h.replace(/[:]/g,":"),h=h.replace(/\s+/g," "),h=h.trim(),h&&C.push(h)}},Le=w=>{if(w.nodeType===Node.ELEMENT_NODE){if(w.nodeName==="STYLE"||w.getAttribute("role")==="button"||w.hasAttribute("hidden"))return!1;if(w.id==="snippet"){let C=!0;for(let h=A(w);h;h=he(h))if(Le(h)!==!1&&h.textContent.trim().length!==0){C=!1;break}if(C)return!1}}else if(w.nodeType!==Node.TEXT_NODE)return!1;return!0},te=async(w,C=[])=>{try{await y.resolve();for(let h=A(w);h;h=he(h))Le(h)!==!1&&(h instanceof HTMLElement&&h.firstElementChild&&!h.nodeName.includes("-")?await te(h,C):wn(h,C),await y.resolve())}catch(h){console.log(h)}return C};ce.clear();const[lt,Et]=await y.all([te(d),te(u)]);if(ce.forEach((w,C)=>{(C.nodeValue||"")===`\uF204${w.replace(/[\uF204\uF205]/g,"")}\uF205`&&(C.nodeValue=w)}),ce.clear(),typeof GM>"u"&&(console.log(7191,lt),console.log(7192,Et),lt.length===Et.length)){let w=lt.length;const C=[];for(let h=0;h<w;h++){let M=lt[h],$=Et[h],ae=M.split(/([\w\-]+)/),rt=$.split(/([\w\-]+)/),mi=Math.min(ae.length,rt.length),At=-1;for(let at=0;at<mi&&ae[at]===rt[at];at++)At=at;At>=0&&(M=ae.slice(At+1).join(""),$=rt.slice(At+1).join("")),C.push([M,$])}console.log(7194,C)}function xn(w,C){const h=new Set(C),M=w.every($=>h.has($));return h.clear(),M}const St=xn(lt,Et);return St&&i(d,u),St}async function l(s){const c="ytd-text-inline-expander#description-inline-expander",f="#tab-info ytd-expander #description",d=s||document.querySelector(c),u=document.querySelector(f);return!d||!u?!1:await o(d,u.closest("ytd-expander")||u,!1)}async function r(){const s=p.ytdFlexy;if(!s)return;const c=[...document.querySelectorAll("ytd-text-inline-expander#description-inline-expander:not([hidden])")].filter(m=>!P.call(m,"[hidden]"));if(c.length!==1)return;const f=c[0];let d=Date.now();e=d,s.classList.toggle("tabview-info-duplicated",!0);let u=!1;try{if(await x(),e!==d)return;let m=!1,b=null;await y.all([...Ue.call(f,'#expand[role="button"]:not([hidden])')].map(S=>y.resolve().then(()=>{b=b||new y(E=>{let D=new MutationObserver(()=>{D.disconnect(),D=null,E()});D.observe(f,{subtree:!0,childList:!0})}),S.click(),m=!0}))),b&&await b.then(),typeof IntersectionObserver<"u"&&await new y(S=>{let E=new IntersectionObserver(()=>{E.disconnect(),E=null,S()});E.observe(f)}),await y.resolve(0),u=await l(f),u===!1&&m&&await y.all([...Ue.call(f,'#collapse[role="button"]:not([hidden])')].map(S=>y.resolve().then(()=>{S.click()})))}catch{s.classList.toggle("tabview-info-duplicated",!1)}if(console.debug("[tyt] Have any details with duplicated information been found?",u?"Yes":"No"),e===d)return{ok:1,infoDuplicated:u}}return{removeDuplicateInfoFn:s=>{async function c(d){let u=270,m=null;const b='#collapse[role="button"]:not([hidden]), #expand[role="button"]:not([hidden])',S=Pi(document.querySelector("ytd-watch-metadata ytd-text-inline-expander#description-inline-expander"),"ytd-watch-metadata"),E=Pt(S,"ytd-text-inline-expander#description-inline-expander.style-scope.ytd-watch-metadata"),D=Pt(E,b);D&&(S.hasAttribute("description-collapsed")&&D.id==="expand"?m=!1:!S.hasAttribute("description-collapsed")&&D.id==="collapse"&&(m=!0)),S&&S.classList.add("tyt-tmp-hide-metainfo");try{for(let U=2;U-- >0&&(await le().then(),me.valueOf()===d);){const ce=await r();if(ce&&ce.ok){const Be=ce.infoDuplicated;if(Be||U===0){const Le=p.ytdFlexy;Le&&(Le.classList.toggle("tabview-info-duplicated",Be),Le.classList.toggle("tabview-info-duplicated-checked",!0),n(),Z(document,"tabview-fix-info-box-tooltip"));break}}await new y(Be=>setTimeout(Be,u))}await y.resolve(0);const re=typeof m=="boolean"?Pt(E,b):null;if(re){const U=S.hasAttribute("description-collapsed"),ce=re.id;(m?U&&ce==="expand":!U&&ce==="collapse")&&re.click()}}catch(re){console.warn(re)}if(S){S.classList.remove("tyt-tmp-hide-metainfo"),await y.resolve(0);const re=_.call(S,"#info-container.style-scope.ytd-watch-metadata")||_.call(S,"#ytd-watch-info-text.style-scope.ytd-watch-metadata")||null;re&&y.resolve(re).then(U=>{U&&sl.bindElement(U)})}}let f=me.valueOf();ge.debounce(()=>{if(f===me.valueOf()&&!document.fullscreenElement){if(!s){if(Oe&1)return;Oe|=1}c(f)}})},setHiddenStateForDesc:t}})();let ei=0;async function mo(e){ei=0,await R.d(),wi&&lo(),mn=new Mt,ro()?mn.resolve():await mn.then(),await Kn(),Bl(e),ei=1}function zl(e){if(!(e instanceof Element))return;const t=p.ytdFlexy;g&&t&&Hn.bindElement(e)&&Hn.observer.check(9)}function ti(e){const t=e||document.querySelector("ytd-live-chat-frame#chat");t&&(zl(t),J&&(On(),e!==null?le().then(On):Q.lockWith(n=>{document.fullscreenElement||Ni(),x().then(n)})))}function jl(){const e=I.layoutStatus;if((e&(L|we))===L){if(e&G)return ee(null),!0;if(e&K)return _e(),!0}return!1}function yo(e){let t=(e||0).target||0,n=document.activeElement||0;t.nodeType===1&&n.nodeType===1&&y.resolve().then(()=>{t.contains(n)&&n.blur()})}async function Wl(e){const t="gM7Cp";let n=_.call(e,`#movie_player video[src]:not([${t}])`);n=n||_.call(e,`#movie_player audio.video-stream.html5-main-video[src]:not([${t}])`),n&&(n.setAttribute(t,""),n.addEventListener("timeupdate",i=>{Ll()},pe),n.addEventListener("ended",i=>{if(q==="watch"){let o=i.target;y.resolve(o).then(l=>{if(q==="watch"){let r=P.call(l,"#player")||P.call(l,"#ytd-player")||l;r.scrollIntoView(!1),r=null}l=null})}},pe))}Y("yt-player-updated",e=>{const t=(e||0).target||0;t.nodeType!==1||t.nodeName.toUpperCase()!=="YTD-PLAYER"||(Wl(t),Nt(()=>{g&&(it(),Qn(),Gn(),ti(null))}))});const Yl=()=>{console.log("d950");const e=`${me.valueOf()}`,t=document.querySelectorAll(`[bsptu="${e}"]`);if(console.log("d951",t.length),!!t.length)for(const n of t){const i=n.nodeName.toLowerCase();let o=i==="yt-dummy-532"?n:null,l=o?fn.get(o):null;if(l&&P.call(l,"#tab-info"))continue;console.log("d952",n);const r=l||(i==="ytd-expander"?n:null);if(r){let a=0;const s=document.querySelector("#tab-info");if(s){if(a=1,!r.hasAttribute("tyt-info-expander-content")){a=2,r.setAttribute("tyt-info-expander-content","");const c=document.createElement("yt-dummy-532");c.setAttribute("tyt-info-expander-placeholder",""),r.replaceWith(c),fn.set(r,c),fn.set(c,r);const f=P.call(c,"[hidden]");f&&(a=3,Xl.observe(f.parentNode,{subtree:!0,childList:!0}))}Ge.call(s,r)}Kn(),console.log("d953",a)}}};let Ee=0;const Ul=()=>{console.log("d945",Ee),!(Oe&2)&&(Oe|=2,console.log("d946",Ee),document.documentElement.removeAttribute("pnzgu"),Yl(),wi&&lo(),ql().then(()=>{tr(),ge.debounce(()=>{Oe&8||(Oe|=8,setTimeout(()=>{fl(),Lo()},420))},me);let e=document.querySelector("#columns.ytd-watch-flexy #secondary.ytd-watch-flexy"),t=Pi(e,"#columns.ytd-watch-flexy");yl(e,t);let n=document.querySelector("#tab-info");zi(n);let i=document.querySelector("#tab-comments");zi(i),document.documentElement.setAttribute("pnzgu","")}).catch(console.warn))};function Gl(e,t){if(t=+t,t>-1&&t>=0)if(e==="tabviewTabsHideController"){Ye=t;let n;n=document.querySelector('[tyt-tab-content="#tab-info"]'),n&&n.classList.toggle("tab-btn-hidden",(Ye&1)===1),n=document.querySelector('[tyt-tab-content="#tab-comments"]'),n&&((Ye&2)===2?n.classList.toggle("tab-btn-hidden",!0):n.classList.toggle("tab-btn-hidden",Ai)),n=document.querySelector('[tyt-tab-content="#tab-videos"]'),n&&n.classList.toggle("tab-btn-hidden",(Ye&4)===4),document.querySelector('[tyt-tab-content^="#"].active.tab-btn-hidden')&&Ie()}else e==="tabviewDefaultTabController"&&(Gt=t,Tn&&Tn())}let yn=new Map;function H(e,t){if(yn.size===0)document.addEventListener("animationstart",n=>{const i=n.animationName;if(!i)return;let o=-1,l=yn.get(i);if(l)l(n);else{let r=i.indexOf("Controller-");if(r>0){let a=r+10;Gl(i.substring(0,a),i.substring(a+1))}}},Ft);else if(yn.has(e))return;yn.set(e,t)}const Xl=new MutationObserver(()=>{Kn()});function Kl(){H("videosDOMAppended",function(d){vo.resolve()}),H("liveChatFrameDOMAppended",d=>{let u=d.target;u&&ti(u)});const e=qe();H("pageLoaderAnimation",d=>{tt=2,ge.resolve(),console.debug("[tyt] pageRendered"),R.debounce(()=>{x().then(()=>{document.dispatchEvent(new CustomEvent("yt-watch-comments-ready"))})},e)});const t=()=>{console.log("d943",Ee),so();let d=me.valueOf();R.debounce(()=>{console.log("d944",Ee),d===me.valueOf()&&Ul()})},n=qe(),i=d=>{ge.debounce(()=>{Ee|=1,setTimeout(()=>{Ee===3&&(Ee|=4,y.resolve().then(t))},8)},n)};H("watchMetaFrameReady1",i),H("watchMetaFrameReady2",i);const o=qe(),l=d=>{const u=d.target;ge.debounce(()=>{Ee|=2,u.isConnected&&u.setAttribute("bsptu",me.valueOf()),setTimeout(()=>{Ee===3&&(Ee|=4,y.resolve().then(t))},8)},o)};H("watchMetaContentReady1",l),H("watchMetaContentReady2",l),H("fixInvisibleInfoBug",d=>d.target.removeAttribute("hidden")),H("commentsHeaderAppended1",to),H("commentsHeaderAppended2",to),H("fixPlaylistLocation1",d=>{const u=d.target;P.call(u,"#tab-list")||(Yn(u),Zn())});const r=d=>{const u=d.target;if(!u||u.nodeType!==1)return;const m=p.ytdFlexy;!g||!m||dn(u,B(u))};H("chatFrameToggleBtnAppended1",r),H("chatFrameToggleBtnAppended2",r),H("epDOMAppended",async d=>{try{let u=d.target,m=document.querySelectorAll('ytd-watch-flexy[flexy][tyt-tab] #panels.ytd-watch-flexy ytd-engagement-panel-section-list-renderer[target-id][visibility="ENGAGEMENT_PANEL_VISIBILITY_EXPANDED"]:not([hidden])');if(m&&m.length>0){if(m.length>1){let b=0;for(const S of m)S!==u&&(Xi(S),b++);b>0&&await y.resolve(0)}ot.mtf_attrEngagementPanel(9,u),y.resolve().then(()=>{Oi.bindElement(u,{attributes:!0,attributeFilter:["visibility"],attributeOldValue:!0}),u.removeEventListener("mouseleave",yo,!1),u.addEventListener("mouseleave",yo,!1)})}}catch{}}),H("playlistRowDOMSelected",d=>{if(!d)return;let u=d.target;if(!u)return;let m=B(u);if(!m||m.id!=="items")return;let b=/\/watch\?v=[^\&]+\&/.exec(location.href||"");if(!b)return;let S=b[0]+"";if(!S||S.length<=10)return;let E=_.call(m,`ytd-playlist-panel-video-renderer a[href*="${S}"]`);if(!E||u.contains(E))return;let D=P.call(E,"ytd-playlist-panel-video-renderer");D&&(u.removeAttribute("selected"),D.setAttribute("selected",""))});let a=!1;H("tabviewSiderAnimation",d=>{a||(a=!0,tn())}),H("tabviewSiderAnimationNone",d=>{a&&(a=!1,tn())}),H("SearchWhileWatchAutocomplete",d=>{let u=d.target;if(u.hasAttribute("tyt-found"))return;u.setAttribute("tyt-found","");let m=document.createElement("div");m.id="suggestions-search-container",u.replaceWith(m),m.appendChild(u),u.addEventListener("tyt-autocomplete-sc-exist",Qi,!1),R.debounce(()=>{u.isConnected&&Z(u,"tabview-fix-autocomplete"),u=null})}),H("rydTooltipAppear",d=>{document.documentElement.classList.add("return-youtube-dislike")}),H("oldYtIconPinAppeared",d=>{let u=d.target,m=document.createElement("template");m.innerHTML=Ve('<svg viewBox="0 0 12 12" preserveAspectRatio="xMidYMid meet" focusable="false" class="style-scope yt-icon" style="pointer-events: none; display: block; width: 100%; height: 100%;"><g class="style-scope yt-icon"><path d="M8,2V1H3v1h1v3.8L3,7h2v2.5L5.5,10L6,9.5V7h2L7,5.8V2H8z M6,6H5V2h1V6z" class="style-scope yt-icon"></path></g></svg>'),u.replaceWith(m.content.firstChild)}),Y("yt-rendererstamper-finished",d=>{if(!g&&be.resolved||!d||!d.target||d.target.nodeType!==1)return;let u=d.target;const m=u.nodeName.toUpperCase();(m==="YTD-PLAYLIST-PANEL-RENDERER"||m==="YTD-COMMENTS-HEADER-RENDERER")&&Nt(()=>{const b=u;u=null,m==="YTD-PLAYLIST-PANEL-RENDERER"?(Yn(b),Zn()):m==="YTD-COMMENTS-HEADER-RENDERER"&&(ft&3)===3&&fo()})}),vi&&H("deferredDuplicatedMetaChecker",()=>{mo()}),Y("yt-page-data-updated",d=>{vi&&ei&&location.pathname==="/watch"&&mo(1),!(!d||!d.target||d.target.nodeType!==1)&&Nt(()=>{g&&(it(),Qn(),ti(null),Zn())})});async function s(d){await Mn.then(),await R.d(),it(),d&&(Gn(),no())}Y("yt-watch-comments-ready",d=>{if(!g&&be.resolved||!d||!d.target||d.target.nodeType!==1)return;const u=d.target.nodeName.toUpperCase();ft=ft|2,s(u==="YTD-WATCH-FLEXY")});function c(d){const{newPageType:u,oldPageType:m}=d;if(u&&m){let b=!1;u=="ytd-watch-flexy"?(b=!0,q="watch"):u=="ytd-browse"&&(q="browse"),document.documentElement.classList.toggle("tabview-normal-player",b)}}window.addEventListener("message",d=>{if(!(!g&&be.resolved)&&d.origin===location.origin){const u=d.data.tabviewData||0;u.eventType==="yt-page-type-changed"&&y.resolve(u.eventDetail||{}).then(c)}},pe);let f=!1;Y("data-changed",d=>{!g&&be.resolved||(((d||0).target||0).nodeName||"").toUpperCase()!=="YTD-THUMBNAIL-OVERLAY-TOGGLE-BUTTON-RENDERER"||f||(f=!0,Z(document,"tabview-fix-popup-refit"))})}function Jl(){let e=document.querySelector("ytd-live-chat-frame iframe#chatframe");if(!e)return null;let t=null;try{t=e.contentDocument}catch{}return!t||t.readyState!="complete"?null:t}function Ql(e){let t=Jl();if(!t)return null;let n=null;try{n=t.querySelector(e)}catch(i){console.log("iframe error",i)}return n}const ni=qe();let ii=new Mt;const ho=function(e){const t=(e||0).target,n=t instanceof HTMLIFrameElement?t:null;!n||n.id!=="chatframe"||k(async()=>{await ii.then(),n.matches("body iframe.style-scope.ytd-live-chat-frame#chatframe")&&await po(n)})};document.addEventListener("load",ho,Ft);let He=0;const gt=new WeakMap,po=async function(e){const t=e;He>1e9&&(He=9);const n=++He;if(gt.set(t,n*2),await R.d(),await Mn.then(),n!==He||(await le().then(),n!==He)||(await ge.d(),n!==He)||t.isConnected!==!0)return;const i=P.call(t,"ytd-live-chat-frame#chat");if(!i||i.hasAttribute("collapsed"))return;We&&console.debug("[tyt.iframe] loaded 10");const o=ni.inc(),l=await new y(a=>{let s=250,c=0;const f=()=>{let d;o!==ni.valueOf()||--s<0?d=!0:i.isConnected===!0&&t.isConnected===!0&&!i.hasAttribute("collapsed")?d=!1:d=!0;let u=null;if(!d){if(HTMLElement.prototype.closest.call(t,"[hidden]")||!HTMLElement.prototype.closest.call(t,"#columns.style-scope.ytd-watch-flexy"))return;try{u=t.contentDocument}catch{}if(!u||!u.body)return}a&&a(u),a=null,c&&clearInterval(c),c=0};f(),a!==null&&(c=setInterval(f,17))}).catch(console.warn);if(n!==He||(We&&console.debug("[tyt.iframe] loaded 11"),o!==ni.valueOf()||!l)||(We&&console.debug("[tyt.iframe] loaded 12"),i.hasAttribute("collapsed")||t.isConnected!==!0)||(l&&(l.readyState==="loading"||!(l.body||0).firstElementChild)&&await new y(a=>setTimeout(a,50)),i.hasAttribute("collapsed")||t.isConnected!==!0)||n!==He)return;We&&console.debug("[tyt.iframe] loaded 13");const r=(l.body||0).firstElementChild;if(r){if(We&&console.debug("[tyt.iframe] loaded 20"),!g||!bt()||!(t instanceof HTMLIFrameElement)||t.isConnected!==!0)return;let a=!1;try{a=t.contentDocument===l}catch{}if(We&&console.debug("[tyt.iframe] loaded 21"),a){let s=P.call(t,"ytd-live-chat-frame#chat");s&&(We&&console.debug("[tyt.iframe] loaded 22"),Z(s,"tabview-chatroom-ready"),gt.set(t,n*2+1))}}else r||(We&&console.debug("[tyt.iframe] loaded 30"),setTimeout(()=>{if(n===He)try{if(i.isConnected&&!i.hasAttribute("collapsed")&&i.contains(t)){const a=t.contentDocument;if(a){const s=a.body;s&&s.firstElementChild===null&&Z(i,"tabview-chat-fix-url-onload-with-empty-body")}}}catch(a){console.warn(a)}},230))},bo=async function(e){const t=e;if(t.isConnected!==!0||!(t instanceof HTMLIFrameElement)||(gt.get(t)||0)%2!==1)return;const n=P.call(t,"ytd-live-chat-frame#chat");if(!n||n.hasAttribute("collapsed")||t.isConnected!==!0)return;let i=0;try{i=t.contentDocument}catch{}(i.body||0).firstElementChild&&(!g||!bt()||Z(n,"tabview-chatroom-ready"))};async function go(){Te&&!de&&Ke&&(Ke=!1,$n())}let vo=new Kt,Ot=0;function wo(){Te&&!de?go():!Te&&de&&typeof IntersectionObserver=="function"&&_o()}function oi(e){let t=null;return e&&typeof e=="string"&&/^\#[a-zA-Z\_\-\+]+$/.test(e)&&document.querySelector(`.tab-btn[tyt-tab-content="${e}"]`)&&(t=e),t}function xo(e){let t;return Gt===1?t="#tab-info":Gt===2?t="#tab-comments":Gt===3?t="#tab-videos":(e=e||xt(),t=e[Ut]),t}function Zl(){const e=document.querySelector("#material-tabs");if(!e||Ei)return;Ei=!0;let t=null;e.addEventListener("click",async function(l){const r=l.target;if((r||0).nodeType!==1||(await le().then(),await R.d(),r.isConnected!==!0))return;(Te||de&&typeof IntersectionObserver=="function")&&x().then(wo);const s=r.getAttribute("tyt-di");s==="q9Kjc"?dr.call(r,l):s==="8rdLQ"&&t&&t.call(r,l)},!0);function n(l){if(!l)return;const r=p.ytdFlexy;r&&(l["font-size-#tab-info"]&&r.style.setProperty("--ut2257-info",l["font-size-#tab-info"]),l["font-size-#tab-comments"]&&r.style.setProperty("--ut2257-comments",l["font-size-#tab-comments"]),l["font-size-#tab-videos"]&&r.style.setProperty("--ut2257-videos",l["font-size-#tab-videos"]),l["font-size-#tab-list"]&&r.style.setProperty("--ut2257-list",l["font-size-#tab-list"]),Z(document,"tabview-zoom-updated"))}t=function(l){l.preventDefault(),l.stopPropagation(),l.stopImmediatePropagation();let r=l.target;if(!r)return;let a=r.classList.contains("font-size-plus")?1:r.classList.contains("font-size-minus")?-1:0,s=P.call(r,"[tyt-tab-content]").getAttribute("tyt-tab-content"),c=xt(),f=`font-size-${s}`;c[f]||(c[f]=1),a<0?c[f]-=.05:a>0&&(c[f]+=.05),c[f]<.1?c[f]=.1:c[f]>10&&(c[f]=10),Co(c),c=xt(),n(c)};function i(l){let r=xo(l);r=r?oi(r):null,r&&(mt.defaultTab=r)}let o=xt();n(o),i(o),Tn=function(){let l=xo();l=l?oi(l):null,l?mt.defaultTab=l:mt.defaultTab=Yt}}function Eo(e){e=oi(e);let t=xt();e?(t[Ut]=e,mt.defaultTab=e):(delete t[Ut],mt.defaultTab=Yt),Co(t)}document.addEventListener("tabview-setMyDefaultTab",function(e){let t=((e||0).detail||0).myDefaultTab;Eo(t)},!1);function So(e){let t=(e||0).target;t instanceof HTMLIFrameElement&&t.id==="chatframe"&&Xn()}async function er(){if(await R.d(),q!=="watch")return;y.resolve().then(so);let e=Date.now();Ot=e;const t=le().then(),n=vo.d(),i=()=>{if(Ot!==e)return-400;if(j!==3)return-200;const c=document.querySelector("ytd-watch-flexy:not([hidden])")||document.querySelector("ytd-watch-flexy");return c?(Ce=et(c),0):(Ce=null,-100)};let o=i();if(o<0)return;let l=g;if(g=!0,await y.all([n,t]),o=i(),o<0){g=l,Ce||(g=!1);return}o=null;const r=fe(Ce);if(!r){Ce=null,g=!1;return}Xn(),document.removeEventListener("load",So,!0),document.addEventListener("load",So,!0);const a=_.call(r,"#related.ytd-watch-flexy");if(!a)return;if(!document.querySelector("#right-tabs")){Hl();let c=document.createElement("template");c.innerHTML=Ve(Rl());let f=c.content.firstElementChild;f!==null&&(cn(f,a),_.call(f,"#material-tabs").addEventListener("mousemove",d=>{d.preventDefault(),d.stopPropagation(),d.stopImmediatePropagation()},!0),Zl(),console.debug("[tyt] #right-tabs inserted")),c.textContent="",c=null}r.hasAttribute("tyt-tab")||r.setAttribute("tyt-tab",""),Wn();let s=!1;(document.querySelector('ytd-watch-flexy[tyt-chat^="+"]')||document.querySelector('ytd-watch-flexy[flexy][tyt-tab] #panels.ytd-watch-flexy ytd-engagement-panel-section-list-renderer[target-id][visibility="ENGAGEMENT_PANEL_VISIBILITY_EXPANDED"]:not([hidden])')||document.querySelector("ytd-watch-flexy ytd-donation-shelf-renderer.ytd-watch-flexy:not([hidden]):not(:empty)"))&&(s=!0),s?ee(null):Ie(),Nn.clear(!0),Rn.clear(!0),sr(),document.documentElement.setAttribute("tyt-deferred",""),be.resolve(),Mn.resolve(),ot.mtf_attrEngagementPanel()}function hn(){const e=p.ytdFlexy;!g||!e||Ae!==2&&(e.setAttribute("tyt-comments","L"),O.log(2909,1))}function vt(e){Qe.comments_section_loaded=e,e===0&&T&&(T.fetched=!1)}function wt(){let e=document.querySelector('.tab-btn[tyt-tab-content="#tab-comments"]');if(e){let t=_.call(e,"span#tyt-cm-count");e.removeAttribute("loaded-comment"),t&&(t.textContent="")}vt(0),O.log(7233,"comments_section_loaded = 0")}function li(){if(O.log(2909,1),!g)return;let e=p.ytdFlexy;if(!e)return;O.log(2909,2);let t=document.querySelector("ytd-comments#comments");if(Ae!==2){if(t&&!t.hasAttribute("hidden"))return}if(O.log(2909,4),Qe.comments_section_loaded===2)return;vt(2),O.log(2909,5);let n=document.querySelector('.tab-btn[tyt-tab-content="#tab-comments"]');if(n){let i=_.call(n,"span#tyt-cm-count");n.removeAttribute("loaded-comment"),n.classList.contains("tab-btn-hidden")||Ui(n),i&&(i.textContent="")}e.setAttribute("tyt-comments","D"),O.log(2909,10)}function tr(){R.d().then(()=>{const e=document.querySelector("#primary.ytd-watch-flexy #below ytd-watch-metadata #info-container.ytd-watch-metadata:first-child")||document.querySelector("#primary.ytd-watch-flexy #below ytd-watch-metadata #ytd-watch-info-text.ytd-watch-metadata:first-child")||null;e&&!e.hasAttribute("tyt-info-toggler")&&(e.setAttribute("tyt-info-toggler",""),Z(e,"tyt-info-toggler"))})}function $e(e,t,n){return t?e|n:e&~n}function Xe(e,t){let n,i,o;switch(t){case"theater":i=Ne(),e=$e(e,i,we);break;case"tyt-chat":n=p.ytdFlexy,o=n.getAttribute("tyt-chat"),o!==null&&o.charAt(0)==="-"?e=$e(e,!0,xe|Se):(e=$e(e,o!==null,xe),e=$e(e,!1,Se));break;case"is-two-columns_":i=ie(),e=$e(e,i,L);break;case"tyt-tab":n=p.ytdFlexy,i=ul(n.getAttribute("tyt-tab")),e=$e(e,i,G);break;case"fullscreen":n=p.ytdFlexy,i=n.hasAttribute("fullscreen"),e=$e(e,i,Pe);break;case"tyt-ep-visible":n=p.ytdFlexy,o=n.getAttribute("tyt-ep-visible"),i=+o>0,e=$e(e,i,X);break;case"tyt-donation-shelf":n=p.ytdFlexy,i=n.hasAttribute("tyt-donation-shelf"),e=$e(e,i,ne);break}return e}function nr(e,t){if(!kn||!e||e.length!==1)return;let n=e[0];if(n.isIntersecting===!0){if(Ze(I.layoutStatus,L|Pe,0)===!1)return;let i=n.target;if(!i)return;let o=!1,l=null;Ze(I.layoutStatus,0,X|ne|K|G)===!1&&(l=P.call(i,"#description.item.style-scope.ytd-watch-metadata"),l&&(kn=!1,o=!0));async function r(a,s){if(s){let d=P.call(a,"#description.item.style-scope.ytd-watch-metadata");d&&d.click()}await x();let c,f=null;try{let d=P.call(a,"#description.item.style-scope.ytd-watch-metadata"),u=d.offsetHeight;c=P.call(d,"#primary-inner");let m=c.offsetHeight;d.setAttribute("userscript-scrollbar-render",""),m>u&&u>0&&m>0&&(f=m-u)}catch{}c&&c.style.setProperty("--tyt-desc-top-h",`${f||0}px`)}r(i,o)}}function ri(){g&&Ze(I.layoutStatus,L,G|X|ne|we|Pe|K)&&Ie()}let ai=!1;const ir=()=>{ai=!1,p.ytdFlexy&&Q.lockWith(e=>{const t=p.ytdFlexy;!t||t.hasAttribute("hidden")||(Ao(),si(jt),e())})},or=(e,t)=>{if(e&&e.length>=1){let s=0;for(const c of e)if(c.attributeName==="hidden"){s=1;break}s&&(ai=!0)}if(!g)return;const n=p.ytdFlexy;if(!n||!e)return;const i=I.layoutStatus;if(i===0)return;let o=i,l=!1,r=0,a=0;if(qn(),!!se.allowChatControl){for(const s of e)o=Xe(o,s.attributeName),s.attributeName==="tyt-chat"?l||(l=!0,(n.getAttribute("tyt-chat")||"").indexOf("chat$live")>=0&&li(),n.hasAttribute("tyt-chat")||(a|=1)):s.attributeName==="tyt-ep-visible"?(+(n.getAttribute("tyt-ep-visible")||0)==0&&+s.oldValue>0&&(a|=2),r===0?r=1:r=-1):s.attributeName==="tyt-donation-shelf"?(n.hasAttribute("tyt-donation-shelf")?(z.lastPanel="#donation-shelf",ee(null)):a|=4,r===0?r=2:r=-1):s.attributeName==="is-extra-wide-video_"&&x().then(on);o=Yi(o),o!==i&&(Ze(o,L,G|we|K)&&(r===1?Ze(o,X|ne,0)&&nt():r===2&&Ze(o,X|ne,0)&&Re()),I.layoutStatus=o),(async()=>(await x(),Q.lockWith(s=>{ri(),s()})))()}},lr=(e,t)=>{x().then(()=>{Q.lockWith(n=>{qn(),nl(),se.allowChatControl&&(si(I.layoutStatus),Wn()),document.fullscreenElement?n():I.layoutStatus&we?(se.allowChatControl?Ni():tl(),x().then(n)):n()})})};function rr(e,t){const n=p.ytdFlexy;if(!g||!n)return;let i=Sn!==e,o=e===1?"chat$live":e===3?"chat$playback":!1,l=!1;if(o){let r=document.querySelector("ytd-live-chat-frame#chat");r?l=r.hasAttribute("collapsed"):l=t==="LIVE_CHAT_DISPLAY_STATE_COLLAPSED"}if(i){Sn=e;let r=o;typeof o=="string"&&(l===!0&&(r="-"+o),l===!1&&(r="+"+o)),W(n,"tyt-chat",r)}return{attr_chatblock:o,attr_chatcollapsed:l,chatTypeChanged:i}}function ar(){const e=p.ytdFlexy;if(!g||!e)return null;let t=null,n=null;const i=document.querySelector("ytd-live-chat-frame#chat");let o=null;if(i){o=Ql("yt-live-chat-renderer #continuations");let l=0;if(o){if(l|=_.call(o,"yt-timed-continuation")?1:0,l|=_.call(o,"yt-live-chat-replay-continuation, yt-player-seek-continuation")?2:0,l==1?t="chat$live":l==2&&(t="chat$playback"),l==1){let a=document.querySelector("span#tyt-cm-count");a&&(a.textContent="")}}else e.hasAttribute("tyt-chat")||(t="");n=!!i.hasAttribute("collapsed")}else t=!1,n=!1;return{attr_chatblock:t,attr_chatcollapsed:n}}const si=e=>{const t=e;e=Xe(e,"theater"),e=Xe(e,"tyt-chat"),e=Xe(e,"is-two-columns_"),e=Xe(e,"tyt-tab"),e=Xe(e,"fullscreen"),e=Xe(e,"tyt-ep-visible"),e=Xe(e,"tyt-donation-shelf"),Yi(e),t!==e&&(I.layoutStatus=e)},Ao=()=>{const e=p.ytdFlexy;if(!e)return;const t=ar();if(t){let{attr_chatblock:n,attr_chatcollapsed:i}=t;n===null&&(n=!1,i=!1);let o=n;typeof o=="string"&&(i===!0&&(o="-"+o),i===!1&&(o="+"+o)),W(e,"tyt-chat",o)}},sr=()=>{const e=p.ytdFlexy;if(!g||!e)return!0;(typeof I.layoutStatus>"u"||!(I.layoutStatus&jt))&&(I.layoutStatus=0),e.hasAttribute("hidden")||Ao();let n=[...Ue.call(e,".tab-btn[tyt-tab-content]")].map(l=>({elm:l,hidden:l.classList.contains("tab-btn-hidden")}));n.length===0?W(e,"tyt-tab",!1):(n=n.filter(l=>l.hidden!==!0),n.length===0&&W(e,"tyt-tab","")),n=null;let i=zn();i&&i.list.length>0?W(e,"tyt-ep-visible",`${i.value}`):W(e,"tyt-ep-visible",!1),si(jt),Nn.bindElement(e,{attributes:!0,attributeFilter:["tyt-chat","theater","is-two-columns_","tyt-tab","fullscreen","tyt-ep-visible","tyt-donation-shelf","hidden","is-extra-wide-video_"],attributeOldValue:!0}),Rn.bindElement(document.body,{attributes:!0,attributeFilter:["data-ytlstm-theater-mode"],attributeOldValue:!0});let o=document.querySelector("ytd-page-manager#page-manager #columns.ytd-watch-flexy");return o&&W(o,"userscript-scrollbar-render",!0),ri(),!1};document.addEventListener("tabview-fix-layout",()=>{ri()},!1);function ee(e){if(!g)return;const t=p.ytdFlexy;if(!t||e&&e.classList.contains("tab-btn-hidden"))return;function n(){e&&(z.lastTab=e.getAttribute("tyt-tab-content"),z.lastPanel=null,document.querySelector(`${z.lastTab}.tab-content-cld tabview-view-tab-expander`)||R.debounce(()=>{let l=document.querySelector("#secondary.ytd-watch-flexy");l&&l.dispatchEvent(new CustomEvent("tabview-hover-slider-restore"))}));const o=e?z.lastTab:"";if(t.setAttribute("tyt-tab",o),o==="#tab-videos"){let l=document.querySelector("#tab-videos yt-chip-cloud-renderer");l&&R.debounce(()=>{l.isConnected&&Z(l,"tyt-resize-chip-cloud"),l=null})}}const i=document.querySelectorAll("#material-tabs a[tyt-tab-content]");for(const o of i){let l=document.querySelector(o.getAttribute("tyt-tab-content"));o&&l&&(o!==e?(o.classList.remove("active"),l.classList.add("tab-content-hidden"),l.hasAttribute("tyt-hidden")||l.setAttribute("tyt-hidden","")):(o.classList.add("active"),l.hasAttribute("tyt-hidden")&&l.removeAttribute("tyt-hidden"),l.classList.remove("tab-content-hidden")))}n()}function xt(){let e=localStorage[Cn];function t(){let i={version:1};return localStorage[Cn]=JSON.stringify(i),i}if(!e)return t();let n=null;try{n=JSON.parse(e)}catch{}return n&&n.version===Si?n:t()}function Co(e){return!e||typeof e!="object"||e.version!==Si?!1:(localStorage[Cn]=JSON.stringify(e),!0)}async function cr(e){await y.resolve(0);let n=await new y(o=>{Q.lockWith(l=>{o(l)})});_t=e.getAttribute("tyt-tab-content");let i=e.classList.contains("tab-btn")&&e.classList.contains("active")&&!e.classList.contains("tab-btn-hidden");O.log(8221,15,i),Vn()?(O.log(8221,16,1),i?(x().then(n),ee(null)):(bt()&&ie()?_e():an()&&ie()?Re():Rt()&&ie()&&nt(),(async()=>(Bn&&(await x(),Wi()),await x(),n()))(),ee(e))):ie()&&!Ne()&&i?(ee(null),jn(),x().then(n)):i?(ee(null),x().then(n)):(bt()&&ie()?_e():an()&&ie()?Re():Rt()&&ie()?nt():ie()&&Ne()&&!Vn()&&sn(),ee(e),(async()=>{await x();let o=document.querySelector("#right-tabs");if(!ie()&&o&&o.offsetTop>0&&e.classList.contains("active")&&o.hasAttribute("tyt-stickybar")){let l=document.querySelector("#material-tabs"),r=l?l.offsetHeight:0;window.scrollTo(0,o.offsetTop-r)}await x(),n()})())}function dr(e){const t=p.ytdFlexy;if(!g||!t)return null;let n=this;if(!n.hasAttribute("tyt-tab-content"))return;let i=e.target;i&&(i.classList.contains("font-size-btn")||(e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation(),cr(n)))}function To(){Te=!1}let Bt=null,pn=!1;async function _o(){if(!Te&&de&&Ke&&typeof IntersectionObserver=="function"){let e=document.querySelector("#player video");if(!e)return;const t=e.getBoundingClientRect();if(!(t.top<0&&t.height>100&&t.bottom<t.height*.25))return;await y.resolve(0);const n=document.documentElement.clientWidth;if(n+320<screen.width&&n>320&&!document.querySelector("#rCbM3")&&(await y.resolve(0),Vi(e,null).then(i=>{i===!0&&(Ke=!1,Te=!0)}),e.removeEventListener("leavepictureinpicture",To,!1),e.addEventListener("leavepictureinpicture",To,!1),!e.hasAttribute("NOL4j"))){e.setAttribute("NOL4j",""),await y.resolve(0);let i=o=>{let l=o[o.length-1];l&&l.isIntersecting===!0?(pn=!0,Te&&!de&&Ke&&pn&&go()):pn=!1};Bt||(Bt=new IntersectionObserver(i,{root:null,rootMargin:"0px",threshold:.25})),Bt.takeRecords(),Bt.disconnect(),Bt.observe(e)}}}function ci(e,t,n,i){if(t===!0){const{width:o,height:l}=n();e.style.setProperty("--tyt-stickybar-w",o+"px"),e.style.setProperty("--tyt-stickybar-h",l+"px");const r=i();r&&(e.style.setProperty("--tyt-stickybar-l",r.left+"px"),e.style.setProperty("--tyt-stickybar-r",r.right+"px")),W(e,"tyt-stickybar",!0),de=!0,!Te&&de&&Ke&&typeof IntersectionObserver=="function"&&x().then(_o)}else t===!1&&(W(e,"tyt-stickybar",!1),de=!1)}const di=async function(){if(!g||q!=="watch")return;if((I.layoutStatus&L)===L){if(de){let m=document.querySelector("#right-tabs");ci(m,!1,null,null)}return}let t=scrollY,n=Date.now();Dn=n,O.log(7891,"scrolling");function i(m){const[b,S]=m;let E=[S+b,t,S-b],D=0;return E[1]<E[2]&&E[2]<E[0]&&(D=1),E[0]>E[1]&&E[1]>E[2]&&(D=2),E[2]<E[0]&&E[0]<E[1]&&(D=3),D}let[o,l,r]=await y.all([y.resolve().then(()=>document.querySelector("#right-tabs")),y.resolve().then(()=>document.querySelector("#right-tabs header")),y.resolve().then(()=>document.querySelector("#masthead-container, #masthead"))]);function a(){o=null,l=null,r=null}if(!o||!l||Dn!==n)return a();let s=await y.all([y.resolve().then(()=>r?r.offsetHeight:0),y.resolve().then(()=>o.offsetTop)]);if(s===null||Dn!==n)return a();const c=i(s);function f(){let m=document.querySelector("tabview-view-pos-thead");if(m){let b=m.getBoundingClientRect();if(b)return{left:b.left,right:document.documentElement.clientWidth-b.right}}return null}let d=c==2||c==3?!0:c==1?!1:null;function u(){return{width:o.offsetWidth,height:l.offsetHeight}}ci(o,d,u,f),a()},ur=async function(e,t,n){if(!g||q!=="watch"||(I.layoutStatus&L)===L)return;let[i,o]=await y.all([y.resolve().then(()=>document.querySelector("#right-tabs")),y.resolve().then(()=>document.querySelector("#right-tabs header"))]);function l(){i=null,o=null}if(!i||!o)return l();function r(){return n}let a=e==2||e==3?!0:e==1?!1:null;function s(){return{width:t||i.offsetWidth,height:o.offsetHeight}}ci(i,a,s,r),l()};function fr(){const e=p.ytdFlexy;if(!e)return;g=!0,O.log(27056);let t=I.layoutStatus;t&(Se|xe);const n=!(t&Se)&&!!(t&xe),i=!!(t&Se)&&!!(t&xe),o=t&L,l=t&we,r=t&G,a=t&Pe,s=t&X,c=t&ne,f=!r&&!n&&!s&&!c;e.getAttribute("tyt-tab")===""&&o&&!l&&f&&!a?Ie():s&&Ue.call(e,'ytd-watch-flexy[flexy][tyt-tab] #panels.ytd-watch-flexy ytd-engagement-panel-section-list-renderer[target-id][visibility="ENGAGEMENT_PANEL_VISIBILITY_EXPANDED"]:not([hidden])').length===0?I.layoutStatus=t&~X:c&&Ue.call(e,"ytd-donation-shelf-renderer.ytd-watch-flexy:not([hidden])").length===0&&(I.layoutStatus=t&~ne)}function mr(e){const t=e,n=((t||0).showHideButton||0).toggleButtonRenderer,i=n?null:((t||0).showButton||0).buttonRenderer;let o=null,l=null,r=null;return!n&&i&&i.text&&typeof i.text.simpleText=="string"?((t.initialDisplayState=="LIVE_CHAT_DISPLAY_STATE_EXPANDED"||t.initialDisplayState=="LIVE_CHAT_DISPLAY_STATE_COLLAPSED")&&(o=t.initialDisplayState),r=i.text.simpleText):n&&n.defaultText&&n.toggledText&&n.defaultText.runs&&n.toggledText.runs&&n.defaultText.runs.length===1&&n.toggledText.runs.length===1&&(t.initialDisplayState=="LIVE_CHAT_DISPLAY_STATE_EXPANDED"?(o=t.initialDisplayState,l=(n.defaultText.runs[0]||0).text,r=(n.toggledText.runs[0]||0).text):t.initialDisplayState=="LIVE_CHAT_DISPLAY_STATE_COLLAPSED"&&(o=t.initialDisplayState,r=(n.defaultText.runs[0]||0).text,l=(n.toggledText.runs[0]||0).text),typeof r=="string"&&typeof l=="string"&&r.length>0&&l.length>0||(r=null,l=null)),t&&!o&&console.log("[tyt] Unable to obtain showHideButton data"),{default_display_state:o,txt_collapse:l,txt_expand:r}}const yr=()=>v?!(v&&v.broadcastBeginAt&&!v.broadcastEndAt&&v.isLiveNow===!1):!0,ui=qe();let Oe=0;function hr(e){if(console.debug("[tyt] newVideoPage"),Oe=0,!p.ytdFlexy)return;Q=new Jt;let n=null,i=null;if(q!=="watch")return;fr();try{n=e.pageData.response.contents.twoColumnWatchNextResults.conversationBar.liveChatRenderer}catch{}n&&n.isReplay===!0&&(i=!0),Tt=((((e||0).pageData||0).playerResponse||0).videoDetails||0).videoId||0;const o=Tt,l=ui.inc(),r=()=>new y(u=>{let m=new MutationObserver(()=>{u&&m&&(m.disconnect(),m.takeRecords(),m=null,u(),u=null)});m&&m.observe(document.documentElement,{attributes:!0,attributeFilter:["sxmq8"]})}),a=r(),s=document.documentElement;s.setAttribute("sxmq8",s.getAttribute("sxmq8")==="1"?"0":"1"),console.log("sxmq8 r3",document.documentElement.getAttribute("sxmq8")),a.then(()=>{const u=r(),m=document.documentElement;m.setAttribute("sxmq8",m.getAttribute("sxmq8")==="1"?"0":"1"),console.log("sxmq8 r4",document.documentElement.getAttribute("sxmq8")),u.then(()=>{if(o!==Tt||l!==ui.valueOf())return;ui.inc();const b=document.querySelector("ytd-live-chat-frame#chat");if(b&&!b.hasAttribute("collapsed")){const S=_.call(b,"body iframe.style-scope.ytd-live-chat-frame#chatframe");S&&y.resolve(S).then(bo)}})});const c=n?i?3:1:0,f=n?n.initialDisplayState:null;n=null,(()=>{O.log(932,1,1);const u=p.ytdFlexy;if(!g||!u||(O.log(932,1,2),q!=="watch"))return;O.log(932,1,3);let m=rr(c,f),{attr_chatblock:b,attr_chatcollapsed:S,chatTypeChanged:E}=m;if(q==="watch"){let D=p.storeLastPanel;D?Bi(D)||(Lt=null,Re()):Lt=null}if(E)if(b=="chat$live"&&yr())O.log(932,4),Ae=2,li();else{const D=document.querySelector('[tyt-tab-content="#tab-comments"].tab-btn-hidden');D?(wt(),O.log(9360,74),rn(D,!0)):vt(0),Ae=0,O.log(7234,"comments_section_loaded = 0"),eo()}else Ae!==2&&(b===!1||b==="chat$playback")&&(wt(),O.log(9360,77),Ae=0,O.log(7235,"comments_section_loaded = 0"),eo());it()})()}function pr(e,t){let n="[placeholder-videos] ytd-watch-next-secondary-results-renderer.style-scope.ytd-watch-flexy",i="[placeholder-videos] tp-yt-paper-spinner#spinner.style-scope.ytd-continuation-item-renderer",o="[placeholder-videos] div#button.style-scope.ytd-continuation-item-renderer",l={};return e&1&&(l.m1=document.querySelector(n),l.m1&&W(l.m1,"is-two-columns",t?"":!1)),e&2&&(l.m2=document.querySelector(i),l.m2&&W(l.m2,"hidden",t?!1:"")),e&4&&(l.m3=document.querySelector(o),l.m3&&W(l.m3,"hidden",t?"":!1)),l}let j=0,v=null;function br(e){v={};try{v.publishDate=e.pageData.playerResponse.microformat.playerMicroformatRenderer.publishDate}catch{}try{v.uploadDate=e.pageData.playerResponse.microformat.playerMicroformatRenderer.uploadDate}catch{}try{v.publishDate2=e.pageData.response.contents.twoColumnWatchNextResults.results.results.contents[0].videoPrimaryInfoRenderer.dateText.simpleText}catch{}typeof v.publishDate2=="string"&&v.publishDate2!==v.publishDate&&(v.publishDate=v.publishDate2,v.uploadDate=null);try{v.broadcastBeginAt=e.pageData.playerResponse.microformat.playerMicroformatRenderer.liveBroadcastDetails.startTimestamp}catch{}try{v.broadcastEndAt=e.pageData.playerResponse.microformat.playerMicroformatRenderer.liveBroadcastDetails.endTimestamp}catch{}try{v.isLiveNow=e.pageData.playerResponse.microformat.playerMicroformatRenderer.liveBroadcastDetails.isLiveNow}catch{}}function gr(e){if((((e||0).target||0).nodeName||"").toUpperCase()!=="YTD-APP")return;const n=e.detail;let i=((n||0).pageData||0).page;if(!i||(q=i,q!=="watch"))return;let o=Dt&8;o&&(Dt-=8,ii.resolve(),document.addEventListener("load",ho,Ft),Kl()),io(),o&&j>=2&&R.debounce(()=>{let s=document.documentElement;if(s.hasAttribute("tabview-loaded"))throw"Tabview Youtube Duplicated";s.setAttribute("tabview-loaded",""),y.resolve(s).then(c=>{j>=2&&(Z(c,"tabview-ce-hack"),c=null)})}),br(n);const l=y.resolve(n).then(s=>{if(j>=2){let c=null;try{c=s.pageData.response.contents.twoColumnWatchNextResults.conversationBar.liveChatRenderer}catch{}J=c?mr(c):null}}).then();let r=p.ytdFlexy;if(r&&r.isConnected===!0&&r.nodeName.toLowerCase()==="ytd-watch-flexy"||(Ce=et(document.querySelector("ytd-watch-flexy:not([hidden])")||document.querySelector("ytd-watch-flexy"))),r=null,!p.ytdFlexy)return;y.resolve(0).then(()=>{const s=p.ytdFlexy;if(j>=2&&tt===0&&s&&s.isConnected===!0){let c=document.createElement("tabview-view-ploader");tt=1,Ge.call(s,c)}else j>=2&&tt===1&&s&&s.isConnected===!0||console.warn(511,[j,tt,!!s])});let a=n;l.then(()=>{const s=p.ytdFlexy;j>=2&&s&&s.classList.toggle("tyt-chat-toggleable",!!J),j>=2&&Nt(()=>{const c=a;a=null,j>=2&&c!==null&&(Gn(),hr(c))})}),ai&&ir()}let bn=new Jt;function fi(e){Ot=0,j!==1&&(j=1,bn.lockWith(t=>{uo(),t()}))}function vr(e){Ot=0,j!==1&&(j=1,bn.lockWith(t=>{uo(),t()})),j===1&&(j=2,q=null,bn.lockWith(t=>{if(q=null,gr(e),q!=="watch"&&(Ce=null,J=null),y.resolve().then(()=>{const n=q==="watch",i=j>=2;n||(Ce=null,J=null),!n&&i&&(io(),wt(),be.reset(),co(),be.resolve()),i&&document.documentElement.classList.toggle("tabview-normal-player",n)}),Me>0){const n=document.querySelector("#movie_player video[src]");let i=!1;n&&n.readyState>n.HAVE_CURRENT_DATA&&n.currentTime>2.2&&(i=!0),i||(ht=203,Me=0,delete document.head.dataset.viTime)}t()}))}function wr(e){Ot=0,j===2&&(j=3,bn.lockWith(t=>{q==="watch"&&er(),t()}))}document.addEventListener("yt-navigate-start",fi,pe),document.addEventListener("yt-navigate-cache",fi,pe),document.addEventListener("yt-navigate-redirect",fi,pe),document.addEventListener("yt-page-data-fetched",vr,pe),document.addEventListener("yt-navigate-finish",wr,pe),Y("yt-page-data-fetched",ue),Y("yt-page-data-updated",ue),Y("yt-player-updated",ue),Y("yt-watch-comments-ready",ue),Y("yt-page-type-changed",ue),Y("data-changed",ue),Y("yt-navigate-finish",ue),Y("yt-navigate-redirect",ue),Y("yt-navigate-error",ue),Y("yt-navigate-start",ue),Y("yt-page-manager-navigate-start",ue),Y("yt-navigate",ue),Y("yt-navigate-cache",ue);function Lo(){g&&q==="watch"&&((I.layoutStatus&Pe)===Pe||((I.layoutStatus&L)===0?x().then(()=>{di(!0)}):on()))}const gn=qe();window.addEventListener("resize",function(e){if(e.isTrusted===!0){let t=gn.inc();y.resolve(0).then(()=>{t===gn.valueOf()&&setTimeout(()=>{t===gn.valueOf()&&(gn.set(0),Lo(),tn())},160)})}},pe),document.addEventListener("tyt-chat-popup",e=>{let t=(e||0).detail;if(!t)return;const{popuped:n}=t;if(typeof n!="boolean")return;let i=p.ytdFlexy;i&&(i.classList.toggle("tyt-chat-popup",n),n===!0?(ln=!0,jn()):(ln=!1,sn()))});let vn=!1;document.addEventListener("keyup",e=>{!e||!e.target||!e.key||vn&&(!e.shiftKey||e.key.indexOf("Shift")==0)&&(vn=!1)}),document.addEventListener("keydown",e=>{if(!(!e||!e.target||!e.key)&&e.shiftKey&&e.key.indexOf("Arrow")==0)try{(vn||!window.getSelection().isCollapsed)&&(e.stopImmediatePropagation(),e.stopPropagation(),vn=!0)}catch{}},!0);let Ke=!1;if(document.addEventListener("click",function(){Ke=!0,Te&&!de&&Ke&&pn&&x().then(wo)}),document.addEventListener("ytd-comments-data-changed",function(e){(e.detail||0).hasData===!1&&wt(),$t(!0),it()},!0),document.addEventListener("ytd-comments-header-changed",function(){const e=$t(!0);e&&e.newFound===!0&&e.length===1&&e[0].isLatest&&e[0].isNew&&ge.resolved&&T.new&&(T.fetched=!1,Qe.comments_section_loaded=0),it()},!0),document.addEventListener("tabview-plugin-loaded",()=>{R.resolve(),$o&&Z(document,"tabview-miniview-browser-enable")},!1),gi()&&typeof GM_registerMenuCommand=="function"){let t=function(){const n={dialogBackgroundColor:"#f6f6f6",dialogBackgroundColorDark:"#23252a",backdropColor:"#b5b5b568",textColor:"#111111",textColorDark:"#f0f3f4",zIndex:6e4,fontSize:"10pt",dialogMinWidth:"32px",dialogMinHeight:"24px"};class i extends VanillaJSDialog{get themeProps(){return n}isDarkTheme(){return document.documentElement.hasAttribute("dark")}onBeforeShow(){const l=this.es;"checkboxSelectionDisplay"in l&&(l.checkboxSelectionDisplay.textContent="");const r=c=>{for(const f of document.getElementsByName("tabview-tab-default"))f.checked=f.value===c};function a(c){if(c){let f=c[Ut];if(!(!f||typeof f!="string"||!/^\#[a-zA-Z\_\-\+]+$/.test(f))){if(document.querySelector(`.tab-btn[tyt-tab-content="${f}"]`))return r(f)}}r(null)}let s=xt();a(s)}onFirstCreation(){const l=this.S;l.widgets.icon=r=>l.ce("i",{className:"vjsd-icon fa-solid fa-"+r}),l.importCSS("https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/fontawesome.min.css#sha512=SgaqKKxJDQ/tAUAAXzvxZz33rmn7leYDYfBP+YoMRSENhf3zJyx3SBASt/OfeQwBHA1nxMis7mM3EV/oYT6Fdw==","https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/solid.min.css#sha512=yDUXOUWwbHH4ggxueDnC5vJv4tmfySpVdIcN1LksGZi8W8EVZv4uKGrQc0pVf66zS7LDhFJM7Zdeow1sw1/8Jw=="),this.themeSetup()}init(){const l=this.S,r=this.es;r.dialog=l.ce("div",{className:"vjsd-dialog"},{__vjsd__:""}),r.dialog.append(r.header=l.ce("div",{className:"vjsd-dialog-header vjsd-hflex"}),r.body=l.ce("div",{className:"vjsd-dialog-body vjsd-gap-2 vjsd-overscroll-none vjsd-vflex"}),r.footer=l.ce("div",{className:"vjsd-dialog-footer vjsd-hflex"})),r.header.append(l.widgets.icon("circle-info",u=>{}),l.widgets.title("Tabview Youtube - Change Default Tab",{className:"vjsd-flex-fill"}),l.widgets.buttonIcon("square-xmark",{"vjsd-clickable":"#dialogXmark"}));const a=()=>{let u=[...document.getElementsByName("tabview-tab-default")].filter(m=>m.checked).map(m=>m.value);console.assert(u.length<=1),r.checkboxSelectionDisplay.textContent=u.length===1?`The default tab will be set to ${u[0]}`:"The default tab will be reset."};r.body.append(l.widgets.labeledRadio("vjsd-checkbox1 vjsd-checkbox-tick","Info",(u,m)=>{m.name="tabview-tab-default",m.value="#tab-info",r.checkbox1=m,m.addEventListener("change",a),u.style.fontSize="200%"}),l.widgets.labeledRadio("vjsd-checkbox1 vjsd-checkbox-tick","Comment",(u,m)=>{m.name="tabview-tab-default",m.value="#tab-comments",r.checkbox2=m,m.addEventListener("change",a),u.style.fontSize="200%"}),l.widgets.labeledRadio("vjsd-checkbox1 vjsd-checkbox-tick","Video",(u,m)=>{m.name="tabview-tab-default",m.value="#tab-videos",r.checkbox3=m,m.addEventListener("change",a),u.style.fontSize="200%"}),r.checkboxSelectionDisplay=l.ce("div",{className:"vjsd-custom-widget"}));const s=()=>{this.dismiss()},c=()=>{r.checkbox1.checked=!1,r.checkbox2.checked=!1,r.checkbox3.checked=!1,a()},f=()=>{let u=null;for(const m of document.getElementsByName("tabview-tab-default"))m.checked&&(u=m.value);u=u||null,console.log(u),Eo(u),this.dismiss()},d=()=>{this.dismiss()};r.footer.append(r.clearButton=l.widgets.button("Clear",{"vjsd-clickable":"#clear"}),l.widgets.space(),l.widgets.button("Cancel",{"vjsd-clickable":"#cancel"}),l.widgets.button("Confirm",{"vjsd-clickable":"#confirm"})),this.clickable("#cancel",d),this.clickable("#clear",c),this.clickable("#confirm",f),this.clickable("#dialogXmark",s),this.backdrop="dismiss",document.body.appendChild(r.dialog)}}return i.setup1(),new i},e=null;GM_registerMenuCommand("Change Default Tab",function(){e=e||t(),e.show()})}H("#tabview-controller",()=>{}),document.documentElement.appendChild(document.createElement("tabview-controller")).id="tabview-tabs-hide-controller",document.documentElement.appendChild(document.createElement("tabview-controller")).id="tabview-default-tab-controller",document.documentElement.setAttribute("plugin-tabview-youtube",`${V}`),document.documentElement.getAttribute("tabview-unwrapjs")&&document.dispatchEvent(new CustomEvent("tabview-plugin-loaded"))}({requestAnimationFrame:typeof webkitRequestAnimationFrame=="function"?webkitRequestAnimationFrame:requestAnimationFrame,cancelAnimationFrame:typeof webkitRequestAnimationFrame=="function"?webkitRequestAnimationFrame:requestAnimationFrame})}(async()=>{"use strict";const Vt=[{id:"tabview-css-content",resTag:"contentCSS"},{id:"tabview-css-chat",resTag:"chatCSS"},{id:"tabview-css-control",resTag:"controlCSS"}],Ve=(async()=>{})().constructor,st=Vt.map(ye=>(ye=ye.resTag,GM_getResourceText(ye)||GM.getResourceText(ye)||"")),oe=await Ve.all(st);document.documentElement===null&&await new Ve(ye=>{let B=new MutationObserver(()=>{!B||document.documentElement===null||(B.disconnect(),B.takeRecords(),B=null,ye())});B.observe(document,{childList:!0,subtree:!0})});const ke=document.head||document.documentElement;let ze=0;for(const ye of Vt){const B=oe[ze++];if(B){const A=document.createElement("style");A.id=ye.id,A.textContent=B,ke.appendChild(A)}}main()})();
