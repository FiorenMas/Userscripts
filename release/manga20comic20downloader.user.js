// ==UserScript==
// @name            manga comic downloader
// @namespace       https://baivong.github.io
// @version         3.4.7
// @icon            https://raw.githubusercontent.com/lelinhtinh/Userscript/master/manga_comic_downloader/icon.png
// @author          Zzbaivong
// @license         MIT; https://baivong.mit-license.org/license.txt
// @match           http://*.truyentranh8.com/*
// @match           https://*.truyentranh8.com/*
// @match           http://*.truyentranh8.net/*
// @match           https://*.truyentranh8.net/*
// @match           http://*.truyentranh8.org/*
// @match           https://*.truyentranh8.org/*
// @match           http://*.truyentranh86.com/*
// @match           https://*.truyentranh86.com/*
// @match           http://*.truyentranh869.com/*
// @match           https://*.truyentranh869.com/*
// @match           https://mangaxy.com/*
// @match           https://*.truyentranh.net/*
// @match           https://*.hamtruyen.com/*
// @match           https://*.hamtruyenmoi.com/*
// @match           https://*.a3manga.com/*
// @match           https://*.a3mnga.com/*
// @match           http://truyentranhtuan.com/*
// @match           https://truyentranhlh.net/*
// @match           https://truyenhay24h.com/*
// @match           https://thichtruyentranh.com/*
// @match           https://lxhentai.com/*
// @match           https://hentaivn.net/*
// @match           https://hentaivn.moe/*
// @match           https://otakusan.net/*
// @match           https://*.ngonphong.com/*
// @match           https://*.nettruyen.com/*
// @match           http://*.nettruyen.com/*
// @match           https://*.nettruyentop.com/*
// @match           http://*.nettruyentop.com/*
// @match           http://*.nettruyenonline.com/*
// @match           https://*.nettruyenonline.com/*
// @match           http://*.nettruyenapp.com/*
// @match           https://*.nettruyenapp.com/*
// @match           http://*.nettruyenpro.com/*
// @match           https://*.nettruyenpro.com/*
// @match           http://*.nettruyengo.com/*
// @match           https://*.nettruyengo.com/*
// @match           https://*.nettruyenmax.com/*
// @match           http://*.nettruyenmoi.com/*
// @match           https://*.nettruyenbb.com/*
// @match           https://*.kingtruyen.com/*
// @match           http://nhattruyen.com/*
// @match           http://nhattruyengo.com/*
// @match           http://*.hamtruyentranh.net/*
// @match           https://ttmanga.com/*
// @match           http://truyen.vnsharing.site/*
// @match           http://*.blogtruyen.com/*
// @match           https://*.blogtruyen.com/*
// @match           https://*.blogtruyenmoi.com/*
// @match           http://*.blogtruyen.vn/*
// @match           https://*.blogtruyen.vn/*
// @match           http://*.blogtruyen.top/*
// @match           https://*.blogtruyen.top/*
// @match           https://truyensieuhay.com/*
// @match           http://truyenqqvn.com/*
// @match           http://truyenqqvn.net/*
// @match           http://truyenqqtop.com/*
// @match           http://truyenqqpro.com/*
// @match           https://hentaicube.net/*
// @match           https://hentaicb.top/*
// @match           http://*.tuthienbao.com/*
// @match           https://vietcomic.net/*
// @match           https://hamtruyentranh.com/*
// @match           https://khotruyentranhz.com/*
// @match           https://truyenvn.com/*
// @match           https://truyenvn.vip/*
// @match           https://truyenvnpro.com/*
// @match           https://*.saytruyen.net/*
// @match           https://*.saytruyen.com/*
// @match           https://*.sayhentai.net/*
// @match           https://cocomic.net/truyen-tranh/*
// @require         https://code.jquery.com/jquery-3.6.0.min.js
// @require         https://unpkg.com/@zip.js/zip.js@2.7.41/dist/zip.min.js
// @require         https://unpkg.com/file-saver@2.0.5/dist/FileSaver.min.js
// @require         https://cdn.jsdelivr.net/npm/web-streams-polyfill@2.0.2/dist/ponyfill.min.js
// @require         https://cdn.jsdelivr.net/npm/streamsaver@2.0.3/StreamSaver.min.js
// @require         https://greasemonkey.github.io/gm4-polyfill/gm4-polyfill.js?v=a834d46
// @require         https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js
// @require         https://cdn.jsdelivr.net/gh/Joe12387/detectIncognito@53bb1cde47a849dd166443a24b92f15432d7c40a/dist/es5/detectIncognito.min.js
// @resource        success https://unpkg.com/facebook-sound-kit@2.0.0/Low_Volume_-20dB/Complete_and_Success/Success_2.m4a
// @resource        error https://unpkg.com/facebook-sound-kit@2.0.0/Low_Volume_-20dB/Errors_and_Cancel/Error_2.m4a
// @noframes
// @connect         *
// @supportURL      https://github.com/lelinhtinh/Userscript/issues
// @run-at          document-start
// @grant           GM_addStyle
// @grant           GM_xmlhttpRequest
// @grant           GM.xmlHttpRequest
// @grant           GM.getResourceUrl
// @grant           GM_getResourceURL
// @grant           GM_registerMenuCommand
// @downloadURL https://raw.githubusercontent.com/FiorenMas/Userscripts/release/release/manga20comic20downloader.user.js
// @updateURL https://raw.githubusercontent.com/FiorenMas/Userscripts/release/release/manga20comic20downloader.meta.js
// ==/UserScript==
window._URL=window.URL||window.webkitURL,jQuery(function(a){var ct="cbz",C=4,st=5,mt=!0,lt=["http://truyentranhtam.net/templates/main/images/gioithieubanbe3.png","http://1.bp.blogspot.com/-U1SdU4_52Xs/WvLvn1OjvHI/AAAAAAAEugM/dLBgVGSeUN0bVy-FoFfIZvrCJ07YQew7wCHMYCw/s0/haybaoloi.png","/public/images/loading.gif","http://truyentranhlh.net/wp-content/uploads/2015/10/lhmanga.png","/Content/Img/1eeef5d2-b936-496d-ba41-df1b21d0166a.jpg","/Content/Img/d79886b3-3699-47b2-bbf4-af6149c2e8fb.jpg","http://st.beeng.net/files/uploads/images/21/c8/21c8d2c3599c485e31f270675bc57e4c.jpeg","00k9jbV.gif"],ut=["proxy.truyen.cloud",".ttmanga.com",".fbcdn.net","mangaqq.net","mangaqq.com","truyenqqvn.net","truyenqqvn.com","truyenqqtop.com","truyenqqpro.com",".upanhmoi.net","qqtaku.com","qqtaku.net","trangshop.net",".beeng.net",".beeng.org","forumnt.com","hoitruyentranh.com","hoihentai.com","i02.hentaivn.net","truyentop1.com","anhnhanh.org","truyenvua.xyz","hamtruyen.vn",".xem-truyen.com"],z={"i8.xem-truyen.com":"https://blogtruyenmoi.com","i.blogtruyen.com":"https://blogtruyen.com","truyen.cloud":"http://www.nettruyen.com","proxy.truyen.cloud":"http://www.nettruyen.com","i.netsnippet.com":"http://www.nettruyen.com/","forumnt.com":"http://www.nettruyen.com/","upload.forumnt.com":"http://www.nettruyen.com/","upload2.forumnt.com":"http://www.nettruyen.com/","upload.upanhmoi.net":"https://upanhmoi.net","upload2.upanhmoi.net":"https://upanhmoi.net","upload3.upanhmoi.net":"https://upanhmoi.net","upload4.upanhmoi.com":"https://upanhmoi.com","upload5.upanhmoi.com":"https://upanhmoi.com","upload6.upanhmoi.com":"https://upanhmoi.com","upload7.upanhmoi.com":"https://upanhmoi.com","upload8.upanhmoi.com":"https://upanhmoi.com","upload9.upanhmoi.com":"https://upanhmoi.com","img1.upanhmoi.net":"https://upanhmoi.net","img2.upanhmoi.net":"https://upanhmoi.net","proxy1.ttmanga.com":"https://ttmanga.com","proxy2.ttmanga.com":"https://ttmanga.com","proxy3.ttmanga.com":"https://ttmanga.com","cdn.lhmanga.com":"https://truyentranhlh.net","cdn1.lhmanga.com":"https://truyentranhlh.net","storage.fshare.vn":"https://truyentranh.net","ocumeo.com":"https://www.a3manga.com/","www.ocumeo.com":"https://www.a3manga.com/","mangaqq.net":"http://truyenqqpro.com/","mangaqq.com":"http://truyenqqpro.com/","truyenqq.net":"http://truyenqqpro.com/","truyenvua.xyz":"http://truyenqqpro.com/","i02.hentaivn.net":"https://hentaivn.net/","i1.hentaivn.net":"https://hentaivn.net/","i.imgur.com":"https://imgur.com/"};window.URL=window._URL;var E,G;mt&&(GM.getResourceUrl("success").then(function(t){E=new Audio(t)}),GM.getResourceUrl("error").then(function(t){G=new Audio(t)}));function pt(t){if(!t.byteLength)return{mime:null,ext:null};var e="",r="",n=new DataView(t,0,5),i=n.getUint8(0,!0),s=n.getUint8(1,!0),c=i.toString(16)+s.toString(16);switch(c){case"8950":e="png",r="image/png";break;case"4749":e="gif",r="image/gif";break;case"ffd8":e="jpg",r="image/jpeg";break;case"424d":e="bmp",r="image/bmp";break;case"5249":e="webp",r="image/webp";break;default:e=null,r=null;break}return{mime:r,ext:e}}var L;function f(t,e){function r(){var m=b.find("#mcd_noty_wrap");m.length&&(m.fadeOut(300,function(){m.remove(),m=[]}),clearTimeout(L))}function n(){L=setTimeout(function(){r()},2e3)}var i=b.find("#mcd_noty_wrap");if(!i.length){var s=a("<div>",{id:"mcd_noty_wrap"}),c=a("<div>",{id:"mcd_noty_content",class:"mcd_"+e,html:t}),u=a("<div>",{id:"mcd_noty_close",html:"&times;"});i=s.append(c).append(u),i.appendTo("body")}i.find("#mcd_noty_content").attr("class","mcd_"+e).html(t),i.fadeIn(300),clearTimeout(L),b.on("click","#mcd_noty_wrap",function(){r()}).on("mouseenter","#mcd_noty_wrap",function(){clearTimeout(L)}).on("mouseleave","#mcd_noty_wrap",n),e!=="warning"&&e!=="success"&&n()}function w(t){return o.link.split(/\s*,\s*/).map(function(e){return e+t}).join(",")}function K(){a(w('[href="'+o.href+'"]')).css({color:"red",textShadow:"0 0 1px red, 0 0 1px red, 0 0 1px red"}),O=!0}function V(){var t=a(w('[href="'+o.href+'"]'));O||t.css({color:"green",textShadow:"0 0 1px green, 0 0 1px green, 0 0 1px green"})}function j(t){t.preventDefault(),t.returnValue=""}function F(){K(),x=!1,window.removeEventListener("beforeunload",j),setTimeout(()=>{l.length||x||!G||G.play()},0)}function N(){f("L\u1ED7i! Kh\xF4ng t\u1EA3i \u0111\u01B0\u1EE3c <strong>"+h+"</strong>","error"),F()}function p(){f("L\u1ED7i! <strong>"+h+"</strong> kh\xF4ng c\xF3 d\u1EEF li\u1EC7u","error"),F()}function B(t){C<1&&(C=1),C>32&&(C=32),S=t.map(function(e){return{url:e,attempt:st}}),k=S.length,rt(),f("B\u1EAFt \u0111\u1EA7u t\u1EA3i <strong>"+h+"</strong>","warning"),window.addEventListener("beforeunload",j)}function Z(){document.title="[\u2026] "+P,f("<strong>"+h+"</strong> \u0111ang l\u1EA5y d\u1EEF li\u1EC7u...","warning"),l=l.filter(function(t){return o.href.indexOf(t)===-1}),a(w('[href="'+o.href+'"]')).css({color:"orange",fontWeight:"bold",fontStyle:"italic",textDecoration:"underline",textShadow:"0 0 1px orange, 0 0 1px orange, 0 0 1px orange"})}function Q(){l=[],a(o.link).each(function(t,e){l[t]=a(e).attr("href")}),o.reverse&&l.reverse()}function Y(){f("Script \u0111\xE3 <strong>s\u1EB5n s\xE0ng</strong> l\xE0m vi\u1EC7c","info"),Q(),b.on("click",o.link,function(t){if(!(!t.ctrlKey&&!t.shiftKey)){t.preventDefault();var e=a(this).attr("href");if(t.ctrlKey&&t.shiftKey)l=l.filter(function(n){return e.indexOf(n)===-1}),a(w('[href="'+e+'"]')).css({color:"gray",fontWeight:"bold",fontStyle:"italic",textDecoration:"line-through",textShadow:"0 0 1px gray, 0 0 1px gray, 0 0 1px gray"});else{I||(l=[],I=!0),l.push(e);var r=t.shiftKey?"violet":"purple";a(w('[href="'+e+'"]')).css({color:r,textDecoration:"overline",textShadow:"0 0 1px "+r+", 0 0 1px "+r+", 0 0 1px "+r})}}}).on("keyup",function(t){(t.key==="Control"||t.key==="Shift")&&(t.preventDefault(),l.length&&I&&(t.key==="Shift"&&(_=!0),U()))})}function U(){x||R||(!I&&!l.length&&Q(),l.length&&(R=!0,a(w('[href$="'+l[0]+'"]')).trigger("contextmenu")))}function X(){_=!0,U()}async function ht(t,e){f("T\u1EA3i ho\xE0n t\u1EA5t <strong>"+e+"</strong>","info");try{const{isPrivate:r}=await detectIncognito();if(r)throw"isPrivate";const n=streamSaver.createWriteStream(e,{size:t.size}),i=t.stream();if(window.WritableStream&&i.pipeTo)return i.pipeTo(n);window.writer=n.getWriter();const s=i.getReader(),c=()=>s.read().then(u=>u.done?window.writer.close():window.writer.write(u.value).then(c));c();return}catch(r){console.warn(r),saveAs(t,e)}}function $(){return h.replace(/\s+/g,"_").replace(/ãƒ»/g,"\xB7").replace(/(^_+|_+$)/,"")}function H(){_||(T=new TransformStream,it=new Response(T.readable).blob(),D=new zip.ZipWriter(T.writable,{zip64:!0}),W=new AbortController,v=W.signal,M=[]),d=0,q=0,k=0,S=[],O=!1,x=!1,R&&(l.length?a(w('[href$="'+l[0]+'"]')).trigger("contextmenu"):(R=!1,I=!1)),setTimeout(()=>{l.length||x||!E||E.play()},0)}async function tt(){f("T\u1EA1o file n\xE9n c\u1EE7a <strong>"+h+"</strong>","warning");try{await Promise.all(M),await D.close();const t=await it;ht(t,$()+"."+ct),V(),window.removeEventListener("beforeunload",j),document.title="[\u21D3] "+P,H()}catch(t){console.error(t),(v.reason==t||v.reason&&v.reason.code==t.code)&&zip.terminateWorkers(),f("L\u1ED7i n\xE9n d\u1EEF li\u1EC7u c\u1EE7a <strong>"+h+"</strong>","error"),F(),document.title="[x] "+P,H()}}function et(t,e,r,n,i){if(S[t].attempt<=0){q++,r(n,i);return}setTimeout(function(){nt(t,e,r),S[t].attempt--},2e3)}function nt(t,e,r){var n=S[t].url,i=("0000"+d).slice(-4),s,c,u={};n.indexOf("//")===0&&(n=location.protocol+n),s=new URL(n),c=s.hostname,z[c]?(u.referer=z[c],u.origin=z[c]):(u.referer=location.origin,u.origin=location.origin),GM.xmlHttpRequest({method:"GET",url:n,responseType:"arraybuffer",headers:u,onload:function(m){var A=pt(m.response).ext;if(A==="gif")return J();!A||m.response.byteLength<100||m.statusText!=="OK"&&m.statusText!==""?et(t,e,r,m,i):(i=i+"."+A,e(m.response,i))},onerror:function(m){et(t,e,r,m,i)}})}function J(){f("\u0110ang t\u1EA3i xu\u1ED1ng <strong>"+q+++"/"+k+"</strong>","warning"),!(q<d)&&(q<k?rt():_?l.length?(V(),H()):(_=!1,tt()):tt())}function rt(){var t=d+C,e="";for(t>k&&(t=k),_&&(e=$()+"/"),d;d<t;d++)nt(d,function(r,n){var i=D.add(e+n,new Response(r).body,{signal:v,onend:J});M.push(i)},function(r,n){M.push(D.add(e+n+"_error.txt",new Blob([r.statusText+`\r
`+r.finalUrl]).stream(),{signal:v,onend:J})),f(r.statusText,"error"),K()})}function ft(t){return lt.some(function(e){return t.indexOf(e)!==-1})}function gt(t){return t.indexOf("//")===0&&(t=location.protocol+t),t.search(/https?:\/\//)!==0&&(t="http://"+t),t}function dt(t){return t.search(/(i\.imgur\.com|\.blogspot\.com|\.fbcdn\.net|storage\.fshare\.vn)/i)!==-1&&t.indexOf("http://")===0&&(t=t.replace(/^http:\/\//,"https://")),t}function wt(t){var e=new DOMParser,r=e.parseFromString("<!doctype html><body>"+t,"text/html");return decodeURIComponent(r.body.textContent)}function yt(t){return t=wt(t),t=t.trim(),t=t.replace(/^.+(&|\?)url=/,""),t=t.replace(/(https?:\/\/)lh(\d)(\.bp\.blogspot\.com)/,"$1$2$3"),t=t.replace(/(https?:\/\/)lh\d\.(googleusercontent|ggpht)\.com/,"$14.bp.blogspot.com"),t=t.replace(/\?.+$/,""),t.indexOf("imgur.com")!==-1?t=t.replace(/(\/)(\w{5}|\w{7})(s|b|t|m|l|h)(\.(jpe?g|png|webp))$/,"$1$2$4"):t.indexOf("blogspot.com")!==-1?(t=t.replace(/\/([^/]+-)?(Ic42)(-[^/]+)?\//,"/$2/"),t=t.replace(/\/(((s|w|h)\d+|(w|h)\d+-(w|h)\d+))?-?(c|d|g)?\/(?=[^/]+$)/,"/"),t+="?imgmax=16383"):t=t.replace(/(\?|&).+/,""),t=encodeURI(t),t=gt(t),t=dt(t),t}function y(t){var e=[];t.length?(a.each(t,function(r,n){n=n.replace(/^[\s\n]+|[\s\n]+$/g,"");var i=ut.some(function(s){return n.indexOf(s)!==-1});if(i){e.push(n);return}if(!(ft(n)||typeof n>"u")&&!/[><"']/.test(n)&&!((n.indexOf(location.origin)===0||n.indexOf("/")===0&&n.indexOf("//")!==0)&&!/^(\.(jpg|png)|webp|jpeg)$/.test(n.slice(-4)))){if(n.indexOf("http")!==0&&n.indexOf("//")!==0)n=location.origin+(n.indexOf("/")===0?"":"/")+n;else if(n.indexOf("http")===0||n.indexOf("//")===0)n=yt(n);else return;e.push(n)}}),B(e)):p()}function ot(t){var e=[];t.each(function(r,n){var i=a(n);e[r]=(o.imgSrc?i.attr(o.imgSrc):i.data("src")||i.data("original"))||i.attr("src")}),y(e)}function xt(t){var e="find";o.filter&&(e="filter");var r=t[e](o.contents).find("img");r.length?ot(r):p()}function bt(t){var e=t.responseText;return o.imgSrc||(e=e.replace(/[\s\n]+src[\s\n]*=[\s\n]*/gi," data-src=")),e=e.replace(/^[^<]*/,""),o.imgSrc,a(e)}function vt(t,e){var r=a(t),n=o.name;o.href=r.attr("href"),h=r.text().trim(),typeof n=="function"?h=n(t,h):typeof n=="string"&&(h=a(n).text().trim()+" "+h),Z(),GM.xmlHttpRequest({method:"GET",url:o.href,onload:function(i){var s=bt(i);typeof e=="function"?e(s):xt(s)},onerror:function(){N()}})}function at(){return x?(f("Ch\u1EC9 \u0111\u01B0\u1EE3c ph\xE9p <strong>t\u1EA3i m\u1ED9t truy\u1EC7n</strong> m\u1ED7i l\u1EA7n","error"),!1):(x=!0,!0)}function g(t){var e=a(o.link);e.length&&(b.on("contextmenu",o.link,function(r){r.preventDefault(),O=!1,at()&&vt(r.currentTarget,t)}),Y())}function kt(){g(function(t){var e=t.find('script:contains("htmlContent")'),r=t.filter('script:contains("htmlContent")');if(!e.length||!r.length)p();else{r=r.text().match(/(CryptoJSAesDecrypt\(.+?(?:(;}|htmlContent\);)))/g);var n=new Function(e.text()+"function "+r[0]+"return "+r[1]);this.CryptoJS=CryptoJS,n.apply(this);var i=n(),s=i.match(/(?<=(data-(lqz53ud|3dn5rc9)="))(.+?)(?=")/g);if(!s){p();return}s=s.map(c=>(c=c.replace(/LqZ53ud|3Dn5rc9/g,"."),c=c.replace(/pPdp7FG|gNa8fuX/g,":"),c=c.replace(/9pyrBcb|hT3k3S6/g,"/"),c)),y(s)}})}function St(){g(function(t){var e=t.find("#read-title").next("script");if(!e.length)p();else{t=e.text().match(/var\s+slides_page_path\s*=\s*(.+?);/)[1],t=JSON.parse(t);var r=1,n,i=[],s=!0,c=t;if(c.length>0?r=2:r=1,s||(r=1),r!=1)n=c;else{n=i;var u,m,A=n.length-1;for(u=0;u<A;u++)for(m=u+1;m<n.length;m++)if(n[m]<n[u]){var Mt=n[m];n[m]=n[u],n[u]=Mt}}y(n)}})}function _t(){g(function(t){t=t.find("#dvContentChap").siblings("script").text(),t=t.match(/GI2017\(([^;]+);/)[1],t=t.split(/[,']+/),a.post("/TH24Service.asmx/GetChapterImages",{PID:t[0],ChapNumber:t[1],cc18:t[2],name:"",s:0}).done(function(e){var r=[];a(e).find("string").each(function(n,i){r[n]=i.textContent.replace(/\.(jpe?g|png)\w*$/,".$1")}),y(r)}).fail(function(){N()})})}function Ct(){g(function(t){t=t.find("#content_read").next("script").text(),t=t.match(/https?:\/\/[^"]+/g),t.length?y(t):p()})}function Tt(){var t=document.querySelector("#inner-listshowchapter");if(t!==null){f("wait a moment...","warning"),setTimeout(()=>{t.scrollIntoView()},0);var e=new MutationObserver(function(r){r.forEach(function(n){n.type==="childList"&&n.target.querySelector(o.link)&&(g(),e.disconnect())})});e.observe(t,{attributes:!1,childList:!0,subtree:!1})}}function qt(){var t=a(o.link);t.length&&(t.on("contextmenu",function(e){if(e.preventDefault(),O=!1,!!at()){var r=a(this);o.href=r.attr("href"),h=a("h1.title").first().attr("title")+" "+r.text().trim(),Z(),GM.xmlHttpRequest({method:"GET",url:o.href,withCredentials:!0,headers:{host:"otakusan.net"},onload:function(){GM.xmlHttpRequest({method:"POST",url:"/Manga/UpdateView",responseType:"json",withCredentials:!0,headers:{host:"otakusan.net","content-length":14,"content-type":"application/x-www-form-urlencoded; charset=UTF-8"},data:"chapId="+o.href.match(/\/(\d+)\/.+$/)[1],onload:function(n){var i=n.response;i.chapid?B(JSON.parse(i.view)):p()}})}})}}),Y())}function Ot(){g(function(t){var e=t.find("#divImage").siblings("script").first().text();if(!/lstImages\.push\("([^"]+)"\)/.test(e))p();else{for(var r=/lstImages\.push\("([^"]+)"\)/gi,n,i=[];n=r.exec(e);)i.push(decodeURIComponent(n[1]));y(i)}})}function It(){function t(e,r){r=r.substring(2,r.length-3);var n=CryptoJS.enc.Utf8.parse(r.toLowerCase()),i=CryptoJS.enc.Utf8.parse("gqLOHUioQ0QjhuvI"),s=CryptoJS.AES.decrypt(e,n,{iv:i,mode:CryptoJS.mode.CBC}),c=s.toString(CryptoJS.enc.Utf8);return c}g(function(e){if(e.find("#wrap_alertvip").length){p();return}var r=e.find(".content-chap-image").find("script:not([type]):first").text();if(r=/\bgetContentchap\('(.+?)','(.+?)'\)/.exec(r),!r){p();return}a.ajax({type:"POST",url:"/Service.asmx/getContentChap",data:'{ sID: "'+r[1]+'",chuc:"'+r[2]+'" }',contentType:"application/json; charset=utf-8",dataType:"json",success:function(n){if(n.Message){p();return}n=JSON.parse(n.d);var i=t(n.des,n.id);i=a(i).filter("img"),ot(i)},error:function(){p()}})})}function At(){g(function(t){var e=t.filter('script:not([src]):contains("Loadimage(i)")');if(!e.length){p();return}if(e=e.text().match(/data\s=\s'(.+?)';/),!e){p();return}e=e[1],e=e.split("|"),y(e)})}var Lt={reverse:!0,link:"",name:"",contents:"",imgSrc:"",filter:!1,init:g},o,h,Ut=location.host,P=document.title,b=a(document),T=new TransformStream,it=new Response(T.readable).blob(),D=new zip.ZipWriter(T.writable,{zip64:!0}),W=new AbortController,v=W.signal,M=[],d=0,q=0,k=0,S=[],l=[],O=!1,x=!1,R=!1,I=!1,_=!1;switch(streamSaver.mitm="https://lelinhtinh.github.io/stream/mitm.html",GM_registerMenuCommand("Download All Chapters",U),GM_registerMenuCommand("Download All To One File",X),b.on("keydown",function(t){t.code==="KeyY"&&t.altKey&&(t.preventDefault(),t.shiftKey?X():U())}),GM_addStyle("#mcd_noty_wrap{background:#fff;position:fixed;z-index:2147483647;right:20px;top:20px;min-width:150px;max-width:100%;padding:15px 25px;border:1px solid #ddd;border-radius:2px;box-shadow:0 0 0 1px rgba(0,0,0,.1),0 1px 10px rgba(0,0,0,.35);cursor:pointer}#mcd_noty_content{color:#444}#mcd_noty_content strong{font-weight:700}#mcd_noty_content.mcd_info strong{color:#2196f3}#mcd_noty_content.mcd_success strong{color:#4caf50}#mcd_noty_content.mcd_warning strong{color:#ffc107}#mcd_noty_content.mcd_error strong{color:#f44336}#mcd_noty_content strong.centered{display:block;text-align:center}#mcd_noty_close{position:absolute;right:0;top:0;font-size:18px;color:#ddd;height:20px;width:20px;line-height:20px;text-align:center}#mcd_noty_wrap:hover #mcd_noty_close{color:#333}"),Ut){case"truyentranh8.com":case"truyentranh8.net":case"truyentranh8.org":case"truyentranh869.com":case"truyentranh86.com":o={link:"#ChapList a",name:function(t){return a(".breadcrumb li:last").text().trim()+" "+a(t).find("span, strong, h2").text().trim()},contents:"#reading-detail"};break;case"mangaxy.com":o={link:"#ChapList a",name:function(t){var e=a("h1.comics-title").text(),r=a(t).find("div.episode-title").text();return`${e} ${r}`},contents:"#reading-detail"};break;case"truyentranh.net":case"www.truyentranh.net":o={reverse:!1,link:".chapter-list-item-box a",name:function(t){return a("h1").text().trim()+" "+a(t).text().trim()},contents:".manga-reading-box"};break;case"hamtruyen.com":case"www.hamtruyen.com":case"hamtruyenmoi.com":o={link:".list-chaps a",name:"h3.story-name",contents:".list-images"};break;case"m.hamtruyen.com":o={link:".list-chap a",name:".tentruyen",contents:"#content_chap"};break;case"a3manga.com":case"www.a3manga.com":case"a3mnga.com":case"www.a3mnga.com":case"www.ngonphong.com":o={link:".chapter-table a.text-capitalize",init:kt};break;case"truyentranhtuan.com":o={link:".chapter-name a",init:St};break;case"truyentranhlh.net":o={link:".list-chapters a",contents:"#chapter-content",name:function(t){return a(".series-name").text().trim()+" "+a(t).find(".chapter-name").text().trim()}};break;case"truyenhay24h.com":o={link:".nano .chapname a",name:".name_sp",init:_t};break;case"thichtruyentranh.com":o={reverse:!1,link:"#listChapterBlock .ul_listchap a",init:Ct};break;case"lxhentai.com":o={link:'[style="max-height: 500px"] a',contents:'[class="text-center"]',name:function(t){return a(".grow.text-lg.ml-1.text-ellipsis.font-semibold:first").text().trim()+" "+a(t).find("span.text-ellipsis").text().trim()}};break;case"hentaivn.net":case"hentaivn.moe":o=[{link:".listing a",name:function(t){var e=a('h1[itemprop="name"]').find("a").text();e=e.split("-")[0].trim();var r=a(t).find(".chuong_t").attr("title");return r=r.split("-")[1].trim(),`${e} ${r}`},contents:"#image",init:Tt},{link:".episodes a",name:'[itemprop="name"] b',contents:"#image"}];break;case"otakusan.net":o={link:".read-chapter a",name:"h1.header",init:qt};break;case"www.nettruyen.com":case"nhattruyen.com":case"nhattruyengo.com":case"www.nettruyenapp.com":case"www.nettruyenpro.com":case"www.nettruyengo.com":case"www.nettruyenmoi.com":case"www.nettruyenmax.com":o={link:"#nt_listchapter .chapter a",name:".title-detail",contents:".reading-detail.box_doc",imgSrc:"data-original"};break;case"www.nettruyentop.com":case"www.nettruyenonline.com":case"www.nettruyenbb.com":case"kingtruyen.com":o={link:"#nt_listchapter .chapter a",name:".title-detail",contents:".readimg,.reading-detail.box_doc"};break;case"www.hamtruyentranh.net":o={link:"#examples a",name:function(t){var e=a(t).clone();return e.find("span").remove(),a(".title-manga").text().trim()+" "+e.text().trim()},contents:".each-page"};break;case"ttmanga.com":o={link:"#list-chapter a",init:Ot};break;case"truyen.vnsharing.site":o={link:"#manga-chaplist a",contents:".read_content"};break;case"blogtruyen.com":case"blogtruyen.vn":case"blogtruyen.top":case"blogtruyenmoi.com":case"www.blogtruyen.com":case"www.blogtruyen.vn":case"www.blogtruyen.top":o={link:"#list-chapters .title a",contents:"#content"};break;case"m.blogtruyen.com":case"m.blogtruyen.vn":case"m.blogtruyen.top":case"m.blogtruyenmoi.com":o={link:".list-chapter a",name:function(t){return a("h1.title").text().trim()+" "+a(t).find("span").text().trim()},contents:".content"};break;case"truyensieuhay.com":o={link:"#chapter-list-flag a",name:"h1",init:It};break;case"truyenqq.com":case"truyenqq.net":case"truyenqqtop.com":case"truyenqqpro.com":o={link:".works-chapter-list a",name:"h1",contents:".chapter_content"};break;case"hentaicube.net":case"hentaicb.top":o={link:".wp-manga-chapter a",name:".post-title",contents:".reading-content",imgSrc:"data-src"};break;case"tuthienbao.com":case"www.tuthienbao.com":o={link:'a[id^="thread_title_"]',contents:".quotecontent"};break;case"vietcomic.net":o={link:'.chapter-list a:not([rel="nofollow"])',name:function(t,e){return a(".manga-info-text h1").text().trim()+" "+e},init:At};break;case"hamtruyentranh.com":o={reverse:!1,link:"#chaps .chapter-title a:not([target])",name:"h1",contents:".table-responsive",imgSrc:"id-source"};break;case"khotruyentranhz.com":o={link:"#chapters-list-content .chapter-list a",name:"h1",contents:".box-chapter-content"};break;case"truyenvn.com":case"truyenvn.vip":case"truyenvnpro.com":o={link:"#chapterList a",name:function(t){return a("h1.name").text().trim()+" "+a(t).find("span:first").text().trim()},contents:".content-text"};break;case"saytruyen.net":case"www.saytruyen.net":case"saytruyen.com":case"www.saytruyen.com":case"sayhentai.net":case"www.sayhentai.net":case"sayhentai.tv":o={link:".main-col .wp-manga-chapter a",name:".post-title h1",contents:"#chapter_content"};break;case"cocomic.net":o={link:".chapter-list .citem a",name:"h1",contents:".chapter-content"};break;default:o={};break}if(Array.isArray(o)){var Dt=/mobi|android|touch|mini/i.test(navigator.userAgent.toLowerCase());o=o[Dt?1:0]}o&&(o=a.extend(Lt,o),o.init())});
