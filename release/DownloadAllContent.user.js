// ==UserScript==
// @name         DownloadAllContent
// @namespace    hoothin
// @version      2.8.3.18
// @author       hoothin
// @match        http://*/*
// @match        https://*/*
// @match        ftp://*/*
// @grant        GM_xmlhttpRequest
// @grant        GM_registerMenuCommand
// @grant        GM_setValue
// @grant        GM_getValue
// @grant        GM_openInTab
// @grant        GM_setClipboard
// @grant        GM_addStyle
// @grant        unsafeWindow
// @license      MIT License
// @compatible        chrome
// @compatible        firefox
// @compatible        opera 未测试
// @compatible        safari 未测试
// @contributionURL https://ko-fi.com/hoothin
// @contributionAmount 1
// @downloadURL https://raw.githubusercontent.com/FiorenMas/Userscripts/release/release/DownloadAllContent.user.js
// @updateURL https://raw.githubusercontent.com/FiorenMas/Userscripts/release/release/DownloadAllContent.meta.js
// ==/UserScript==
if(window.top!=window.self)try{if(window.self.innerWidth<250||window.self.innerHeight<250)return}catch{return}(function(e,n){if(typeof define=="function"&&define.amd)define([],n);else if(typeof exports<"u")n();else{var t={exports:{}};n(),e.FileSaver=t.exports}})(this,function(){"use strict";var e=typeof window=="object"&&window.window===window?window:typeof self=="object"&&self.self===self?self:typeof global=="object"&&global.global===global?global:void 0;function n(c,a){return typeof a>"u"?a={autoBom:!1}:typeof a!="object"&&(console.warn("Deprecated: Expected third argument to be a object"),a={autoBom:!a}),a.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(c.type)?new Blob(["\uFEFF",c],{type:c.type}):c}function t(c,a,m){var u=new XMLHttpRequest;u.open("GET",c),u.responseType="blob",u.onload=function(){i(u.response,a,m)},u.onerror=function(){console.error("could not download file")},u.send()}function o(c){var a=new XMLHttpRequest;a.open("HEAD",c,!1);try{a.send()}catch{}return a.status>=200&&a.status<=299}function r(c){try{c.dispatchEvent(new MouseEvent("click"))}catch{var a=document.createEvent("MouseEvents");a.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),c.dispatchEvent(a)}}var d=e.navigator&&/Macintosh/.test(navigator.userAgent)&&/AppleWebKit/.test(navigator.userAgent)&&!/Safari/.test(navigator.userAgent),i=e.saveAs||(typeof window!="object"||window!==e?function(){}:"download"in HTMLAnchorElement.prototype&&!d?function(a,m,u){var T=e.URL||e.webkitURL,A=document.createElement("a");m=m||a.name||"download",A.download=m,A.rel="noopener",typeof a=="string"?(A.href=a,A.origin!==location.origin?o(A.href)?t(a,m,u):r(A,A.target="_blank"):r(A)):(A.href=T.createObjectURL(a),setTimeout(function(){T.revokeObjectURL(A.href)},4e4),setTimeout(function(){r(A)},0))}:"msSaveOrOpenBlob"in navigator?function(a,m,u){if(m=m||a.name||"download",typeof a=="string")if(o(a))t(a,m,u);else{var T=document.createElement("a");T.href=a,T.target="_blank",setTimeout(function(){r(T)})}else navigator.msSaveOrOpenBlob(n(a,u),m)}:function(a,m,u,T){if(T=T||open("","_blank"),T&&(T.document.title=T.document.body.innerText="downloading..."),typeof a=="string")return t(a,m,u);var A=a.type==="application/octet-stream",R=/constructor/i.test(e.HTMLElement)||e.safari,I=/CriOS\/[\d]+/.test(navigator.userAgent);if((I||A&&R||d)&&typeof FileReader<"u"){var N=new FileReader;N.onloadend=function(){var v=N.result;v=I?v:v.replace(/^data:[^;]*;/,"data:attachment/file;"),T?T.location.href=v:location=v,T=null},N.readAsDataURL(a)}else{var s=e.URL||e.webkitURL,p=s.createObjectURL(a);T?T.location=p:location.href=p,T=null,setTimeout(function(){s.revokeObjectURL(p)},4e4)}});e.saveAs=i.saveAs=i,typeof module<"u"&&(module.exports=i)}),function(){"use strict";var indexReg=/^(\w.*)?PART\b|^Prologue|^(\w.*)?Chapter\s*[\-_]?\d+|分卷|^序$|^序\s*[·言章]|^前\s*言|^附\s*[录錄]|^引\s*[言子]|^摘\s*要|^[楔契]\s*子|^后\s*记|^後\s*記|^附\s*言|^结\s*语|^結\s*語|^尾\s*[声聲]|^最終話|^最终话|^番\s*外|^\d+[\s\.、,，）\-_：:][^\d#\.]|^(\d|\s|\.)*[第（]?\s*[\d〇零一二两三四五六七八九十百千万萬-]+\s*[、）章节節回卷折篇幕集话話]/i,innerNextPage=/^\s*(下一[页頁张張]|next\s*page|次のページ)/i,lang=navigator.appName=="Netscape"?navigator.language:navigator.userLanguage,i18n={},rCats=[],processFunc,nextPageFunc;const AsyncFunction=Object.getPrototypeOf(async function(){}).constructor;var win=typeof unsafeWindow>"u"?window:unsafeWindow;switch(lang){case"zh-CN":case"zh-SG":i18n={fetch:"\u5F00\u59CB\u4E0B\u8F7D\u5C0F\u8BF4",info:`\u6765\u6E90\uFF1A#t#
\u672C\u6587\u662F\u4F7F\u7528\u6020\u60F0\u5C0F\u8BF4\u4E0B\u8F7D\u5668\uFF08DownloadAllContent\uFF09\u4E0B\u8F7D\u7684`,error:"\u8BE5\u6BB5\u5185\u5BB9\u83B7\u53D6\u5931\u8D25",downloading:"\u5DF2\u4E0B\u8F7D\u5B8C\u6210 %s \u6BB5\uFF0C\u5269\u4F59 %s \u6BB5<br>\u6B63\u5728\u4E0B\u8F7D %s",complete:"\u5DF2\u5168\u90E8\u4E0B\u8F7D\u5B8C\u6210\uFF0C\u5171 %s \u6BB5",del:"\u8BBE\u7F6E\u6587\u672C\u5E72\u6270\u7801\u7684CSS\u9009\u62E9\u5668",custom:"\u81EA\u5B9A\u89C4\u5219\u4E0B\u8F7D",customInfo:"\u8F93\u5165\u7F51\u5740\u6216\u8005\u7AE0\u8282CSS\u9009\u62E9\u5668",reSort:"\u6309\u6807\u9898\u540D\u91CD\u65B0\u6392\u5E8F\u7AE0\u8282",reSortUrl:"\u6309\u7F51\u5740\u91CD\u65B0\u6392\u5E8F\u7AE0\u8282",setting:"\u9009\u9879\u53C2\u6570\u8BBE\u7F6E",searchRule:"\u641C\u7D22\u7F51\u7AD9\u89C4\u5219",abort:"\u8DF3\u8FC7\u6B64\u7AE0",save:"\u4FDD\u5B58\u5F53\u524D",saveAsMd:"\u5B58\u4E3A Markdown",saveAsJSON:"\u5B58\u4E3A JSON",downThreadNum:"\u8BBE\u7F6E\u540C\u65F6\u4E0B\u8F7D\u7684\u7EBF\u7A0B\u6570\uFF0C\u8D1F\u6570\u4E3A\u5355\u7EBF\u7A0B\u4E0B\u8F7D\u95F4\u9694",enableTouch:"\u5728\u79FB\u52A8\u7AEF\u6309\u2192\u2193\u2190\u2191\u7684\u65B9\u5411\u6ED1\u52A8\u5C4F\u5E55\u753B\u6B63\u65B9\u5F62\u7ACB\u5373\u5F00\u59CB\u4E0B\u8F7D",customTitle:"\u81EA\u5B9A\u4E49\u7AE0\u8282\u6807\u9898\uFF0C\u8F93\u5165\u5185\u9875\u6587\u5B57\u5BF9\u5E94\u9009\u62E9\u5668",saveUrl:"\u50A8\u5B58 URL",disableAutoStartSave:"\u7981\u7528\u81EA\u52A8\u4FDD\u5B58",maxDlPerMin:"\u6BCF\u5206\u949F\u6700\u5927\u4E0B\u8F7D\u6570",reSortDefault:"\u9ED8\u8BA4\u6309\u9875\u9762\u4E2D\u4F4D\u7F6E\u6392\u5E8F\u7AE0\u8282",reverseOrder:"\u53CD\u8F6C\u7AE0\u8282\u6392\u5E8F",saveBtn:"\u4FDD\u5B58\u8BBE\u7F6E",saveOk:"\u4FDD\u5B58\u6210\u529F",nextPage:"\u55C5\u63A2\u7AE0\u8282\u5185\u5206\u9875",nextPageReg:"\u81EA\u5B9A\u4E49\u5206\u9875\u6B63\u5219",retainImage:"\u4FDD\u7559\u6B63\u6587\u4E2D\u56FE\u7247\u7684\u7F51\u5740",minTxtLength:"\u5F53\u68C0\u6D4B\u5230\u7684\u6B63\u6587\u5B57\u6570\u5C0F\u4E8E\u6B64\u6570\uFF0C\u5219\u5C1D\u8BD5\u91CD\u65B0\u6293\u53D6",showFilterList:"\u4E0B\u8F7D\u524D\u663E\u793A\u7AE0\u8282\u7B5B\u9009\u6392\u5E8F\u7A97\u53E3",ok:"\u786E\u5B9A",close:"\u5173\u95ED",dacSortByPos:"\u6309\u9875\u5185\u4F4D\u7F6E\u6392\u5E8F",dacSortByUrl:"\u6309\u7F51\u5740\u6392\u5E8F",dacSortByName:"\u6309\u7AE0\u8282\u540D\u6392\u5E8F",reverse:"\u53CD\u9009",dacUseIframe:"\u4F7F\u7528 iframe \u540E\u53F0\u52A0\u8F7D\u5185\u5BB9\uFF08\u6162\u901F\uFF09",dacSaveAsZip:"\u4E0B\u8F7D\u4E3A zip",dacSetCustomRule:"\u4FEE\u6539\u89C4\u5219",dacAddUrl:"\u6DFB\u52A0\u7AE0\u8282",prefix:"\u7ED9\u7AE0\u8282\u540D\u79F0\u6DFB\u52A0\u524D\u7F00",dacStartDownload:"\u4E0B\u8F7D\u9009\u4E2D",downloadShortcut:"\u4E0B\u8F7D\u7AE0\u8282\u5FEB\u6377\u952E",downloadSingleShortcut:"\u4E0B\u8F7D\u5355\u9875\u5FEB\u6377\u952E",downloadCustomShortcut:"\u81EA\u5B9A\u4E49\u4E0B\u8F7D\u5FEB\u6377\u952E"};break;case"zh":case"zh-TW":case"zh-HK":i18n={fetch:"\u958B\u59CB\u4E0B\u8F09\u5C0F\u8AAA",info:`\u4F86\u6E90\uFF1A#t#
\u672C\u6587\u662F\u4F7F\u7528\u6020\u60F0\u5C0F\u8AAA\u4E0B\u8F09\u5668\uFF08DownloadAllContent\uFF09\u4E0B\u8F09\u7684`,error:"\u8A72\u6BB5\u5167\u5BB9\u7372\u53D6\u5931\u6557",downloading:"\u5DF2\u4E0B\u8F09\u5B8C\u6210 %s \u6BB5\uFF0C\u5269\u9918 %s \u6BB5<br>\u6B63\u5728\u4E0B\u8F09 %s",complete:"\u5DF2\u5168\u90E8\u4E0B\u8F09\u5B8C\u6210\uFF0C\u5171 %s \u6BB5",del:"\u8A2D\u7F6E\u6587\u672C\u5E72\u64FE\u78BC\u7684CSS\u9078\u64C7\u5668",custom:"\u81EA\u8A02\u898F\u5247\u4E0B\u8F09",customInfo:"\u8F38\u5165\u7DB2\u5740\u6216\u8005\u7AE0\u7BC0CSS\u9078\u64C7\u5668",reSort:"\u6309\u6A19\u984C\u540D\u91CD\u65B0\u6392\u5E8F\u7AE0\u7BC0",reSortUrl:"\u6309\u7DB2\u5740\u91CD\u65B0\u6392\u5E8F\u7AE0\u7BC0",setting:"\u9078\u9805\u53C3\u6578\u8A2D\u5B9A",searchRule:"\u641C\u5C0B\u7DB2\u7AD9\u898F\u5247",abort:"\u8DF3\u904E\u6B64\u7AE0",save:"\u4FDD\u5B58\u7576\u524D",saveAsMd:"\u5B58\u7232 Markdown",saveAsJSON:"\u5B58\u7232 JSON",downThreadNum:"\u8A2D\u7F6E\u540C\u6642\u4E0B\u8F09\u7684\u7DAB\u7A0B\u6578\uFF0C\u8CA0\u6578\u70BA\u55AE\u7DDA\u7A0B\u4E0B\u8F09\u9593\u9694",enableTouch:"\u5728\u884C\u52D5\u7AEF\u6309\u2192\u2193\u2190\u2191\u7684\u65B9\u5411\u6ED1\u52D5\u87A2\u5E55\u756B\u65B9\u7ACB\u5373\u958B\u59CB\u4E0B\u8F09",customTitle:"\u81EA\u8A02\u7AE0\u7BC0\u6A19\u984C\uFF0C\u8F38\u5165\u5167\u9801\u6587\u5B57\u5C0D\u61C9\u9078\u64C7\u5668",saveUrl:"\u5132\u5B58 URL",disableAutoStartSave:"\u7981\u7528\u81EA\u52D5\u4FDD\u5B58",maxDlPerMin:"\u6BCF\u5206\u9418\u6700\u5927\u4E0B\u8F09\u6578",reSortDefault:"\u9810\u8A2D\u4F9D\u9801\u9762\u4E2D\u4F4D\u7F6E\u6392\u5E8F\u7AE0\u7BC0",reverseOrder:"\u53CD\u8F49\u7AE0\u7BC0\u6392\u5E8F",saveBtn:"\u5132\u5B58\u8A2D\u5B9A",saveOk:"\u5132\u5B58\u6210\u529F",nextPage:"\u55C5\u63A2\u7AE0\u7BC0\u5167\u5206\u9801",nextPageReg:"\u81EA\u8A02\u5206\u9801\u6B63\u898F",retainImage:"\u4FDD\u7559\u5167\u6587\u5716\u7247\u7684\u7DB2\u5740",minTxtLength:"\u7576\u5075\u6E2C\u5230\u7684\u6B63\u6587\u5B57\u6578\u5C0F\u65BC\u6B64\u6578\uFF0C\u5247\u5617\u8A66\u91CD\u65B0\u6293\u53D6",showFilterList:"\u4E0B\u8F09\u524D\u986F\u793A\u7AE0\u7BC0\u7BE9\u9078\u6392\u5E8F\u8996\u7A97",ok:"\u78BA\u5B9A",close:"\u95DC\u9589",dacSortByPos:"\u4F9D\u9801\u5167\u4F4D\u7F6E\u6392\u5E8F",dacSortByUrl:"\u4F9D\u7DB2\u5740\u6392\u5E8F",dacSortByName:"\u4F9D\u7AE0\u7BC0\u540D\u6392\u5E8F",reverse:"\u53CD\u9078",dacUseIframe:"\u4F7F\u7528 iframe \u80CC\u666F\u8F09\u5165\u5167\u5BB9\uFF08\u6162\u901F\uFF09",dacSaveAsZip:"\u4E0B\u8F09\u70BA zip",dacSetCustomRule:"\u4FEE\u6539\u898F\u5247",dacAddUrl:"\u65B0\u589E\u7AE0\u7BC0",prefix:"\u70BA\u7AE0\u7BC0\u540D\u7A31\u52A0\u4E0A\u524D\u7DB4",dacStartDownload:"\u4E0B\u8F09\u9078\u53D6",downloadShortcut:"\u4E0B\u8F09\u7AE0\u7BC0\u5FEB\u901F\u9375",downloadSingleShortcut:"\u4E0B\u8F09\u55AE\u9801\u5FEB\u901F\u9375",downloadCustomShortcut:"\u81EA\u8A2D\u4E0B\u8F09\u5FEB\u901F\u9375"};break;case"ar":case"ar-AE":case"ar-BH":case"ar-DZ":case"ar-EG":case"ar-IQ":case"ar-JO":case"ar-KW":case"ar-LB":case"ar-LY":case"ar-MA":case"ar-OM":case"ar-QA":case"ar-SA":case"ar-SY":case"ar-TN":case"ar-YE":i18n={encode:!0,fetch:"%D8%AA%D8%AD%D9%85%D9%8A%D9%84",info:"%D8%A7%D9%84%D9%85%D8%B5%D8%AF%D8%B1:%20#t#%0A%D8%AA%D9%85%20%D8%AA%D9%86%D8%B2%D9%8A%D9%84%20%D8%A7%D9%84%D9%80%20TXT%20%D8%A8%D9%88%D8%A7%D8%B3%D8%B7%D8%A9%20'DownloadAllContent'",error:"%D9%81%D8%B4%D9%84%20%D9%81%D9%8A%20%D8%AA%D8%AD%D9%85%D9%8A%D9%84%20%D8%A7%D9%84%D9%81%D8%B5%D9%84%20%D8%A7%D9%84%D8%AD%D8%A7%D9%84%D9%8A",downloading:"......%25s%20%D8%AA%D8%AD%D9%85%D9%8A%D9%84%3Cbr%3E%D8%B5%D9%81%D8%AD%D8%A7%D8%AA%20%D9%85%D8%AA%D8%A8%D9%82%D9%8A%D8%A9%20%25s%20%D8%B5%D9%81%D8%AD%D8%A7%D8%AA%20%D8%AA%D9%85%20%D8%AA%D8%AD%D9%85%D9%8A%D9%84%D9%87%D8%A7%D8%8C%20%D9%87%D9%86%D8%A7%D9%83%20%25s",complete:"%D8%B5%D9%81%D8%AD%D8%A7%D8%AA%20%D9%81%D9%8A%20%D8%A7%D9%84%D9%85%D8%AC%D9%85%D9%88%D8%B9%20%25s%20%D8%A7%D9%83%D8%AA%D9%85%D9%84!%20%D8%AD%D8%B5%D9%84%D8%AA%20%D8%B9%D9%84%D9%89",del:"%D9%84%D8%AA%D8%AC%D8%A7%D9%87%D9%84%20CSS%20%D8%AA%D8%B9%D9%8A%D9%8A%D9%86%20%D9%85%D8%AD%D8%AF%D8%AF%D8%A7%D8%AA",custom:"%D8%AA%D8%AD%D9%85%D9%8A%D9%84%20%D9%85%D8%AE%D8%B5%D8%B5",customInfo:"%D9%84%D8%B1%D9%88%D8%A7%D8%A8%D8%B7%20%D8%A7%D9%84%D9%81%D8%B5%D9%88%D9%84%20sss%20%D8%A5%D8%AF%D8%AE%D8%A7%D9%84%20%D8%A7%D9%84%D8%B1%D9%88%D8%A7%D8%A8%D8%B7%20%D8%A3%D9%88%20%D9%85%D8%AD%D8%AF%D8%AF%D8%A7%D8%AA",reSort:"%D8%A5%D8%B9%D8%A7%D8%AF%D8%A9%20%D8%A7%D9%84%D8%AA%D8%B1%D8%AA%D9%8A%D8%A8%20%D8%AD%D8%B3%D8%A8%20%D8%A7%D9%84%D8%B9%D9%86%D9%88%D8%A7%D9%86",reSortUrl:"%D8%A5%D8%B9%D8%A7%D8%AF%D8%A9%20%D8%A7%D9%84%D8%AA%D8%B1%D8%AA%D9%8A%D8%A8%20%D8%AD%D8%B3%D8%A8%20%D8%A7%D9%84%D8%B1%D9%88%D8%A7%D8%A8%D8%B7",setting:"%D9%81%D8%AA%D8%AD%20%D8%A7%D9%84%D8%A5%D8%B9%D8%AF%D8%A7%D8%AF%D8%A7%D8%AA",searchRule:"%D9%82%D8%A7%D8%B9%D8%AF%D8%A9%20%D8%A7%D9%84%D8%A8%D8%AD%D8%AB",abort:"%D8%A5%D9%8A%D9%82%D8%A7%D9%81",save:"%D8%AD%D9%81%D8%B8",saveAsMd:"Markdown%20%D8%AD%D9%81%D8%B8%20%D9%83%D9%80",saveAsJSON:"JSON%20%D8%AD%D9%81%D8%B8%20%D9%83%D9%80",downThreadNum:"%D8%AA%D8%B9%D9%8A%D9%8A%D9%86%20%D8%B9%D8%AF%D8%AF%20%D8%A7%D9%84%D8%AE%D9%8A%D9%88%D8%B7%20%D9%84%D9%84%D8%AA%D8%AD%D9%85%D9%8A%D9%84",enableTouch:"On%20the%20mobile%20device,%20slide%20the%20screen%20in%20the%20direction%20of%20%E2%86%92%E2%86%93%E2%86%90%E2%86%91%20to%20draw%20a%20square%20will%20start%20downloading%20immediately",customTitle:"%D8%AA%D8%AE%D8%B5%D9%8A%D8%B5%20%D8%B9%D9%86%D9%88%D8%A7%D9%86%20%D8%A7%D9%84%D9%81%D8%B5%D9%84%D8%8C%20%D8%A5%D8%AF%D8%AE%D8%A7%D9%84%20%D8%A7%D9%84%D9%85%D8%AD%D8%AF%D8%AF%20%D9%81%D9%8A%20%D8%A7%D9%84%D8%B5%D9%81%D8%AD%D8%A9%20%D8%A7%D9%84%D8%AF%D8%A7%D8%AE%D9%84%D9%8A%D8%A9",saveUrl:"%D8%AD%D9%81%D8%B8%20URL",disableAutoStartSave:"%D8%AA%D8%B9%D8%B7%D9%8A%D9%84%20%D8%A7%D9%84%D8%AD%D9%81%D8%B8%20%D8%A7%D9%84%D8%AA%D9%84%D9%82%D8%A7%D8%A6%D9%8A",maxDlPerMin:"%D8%A7%D9%84%D8%AD%D8%AF%20%D8%A7%D9%84%D8%A3%D9%82%D8%B5%D9%89%20%D9%84%D8%B9%D8%AF%D8%AF%20%D8%A7%D9%84%D8%AA%D9%86%D8%B2%D9%8A%D9%84%D8%A7%D8%AA%20%D9%81%D9%8A%20%D8%A7%D9%84%D8%AF%D9%82%D9%8A%D9%82%D8%A9",reSortDefault:"%D8%A7%D9%84%D8%AA%D8%B1%D8%AA%D9%8A%D8%A8%20%D8%A7%D9%84%D8%A7%D9%81%D8%AA%D8%B1%D8%A7%D8%B6%D9%8A%20%D8%AD%D8%B3%D8%A8%20%D8%A7%D9%84%D9%85%D9%88%D9%82%D8%B9%20%D9%81%D9%8A%20%D8%A7%D9%84%D8%B5%D9%81%D8%AD%D8%A9",reverseOrder:"%D8%B9%D9%83%D8%B3%20%D8%AA%D8%B1%D8%AA%D9%8A%D8%A8%20%D8%A7%D9%84%D9%81%D8%B5%D9%88%D9%84",saveBtn:"%D8%AD%D9%81%D8%B8%20%D8%A7%D9%84%D8%A5%D8%B9%D8%AF%D8%A7%D8%AF%D8%A7%D8%AA",saveOk:"%D8%AA%D9%85%20%D8%A7%D9%84%D8%AD%D9%81%D8%B8",nextPage:"%D8%A7%D9%84%D8%AA%D8%AD%D9%82%D9%82%20%D9%85%D9%86%20%D8%A7%D9%84%D8%B5%D9%81%D8%AD%D8%A9%20%D8%A7%D9%84%D8%AA%D8%A7%D9%84%D9%8A%D8%A9%20%D9%81%D9%8A%20%D8%A7%D9%84%D9%81%D8%B5%D9%84",nextPageReg:"%D9%85%D8%AE%D8%B5%D8%B5%20%D9%84%D9%84%D8%B5%D9%81%D8%AD%D8%A9%20%D8%A7%D9%84%D8%AA%D8%A7%D9%84%D9%8A%D8%A9%20RegExp",retainImage:"%D8%A7%D9%84%D8%A7%D8%AD%D8%AA%D9%81%D8%A7%D8%B8%20%D8%A8%D8%B9%D9%86%D9%88%D8%A7%D9%86%20%D8%A7%D9%84%D8%B5%D9%88%D8%B1%D8%A9%20%D8%A5%D8%B0%D8%A7%20%D9%83%D8%A7%D9%86%D8%AA%20%D9%87%D9%86%D8%A7%D9%83%20%D8%B5%D9%88%D8%B1%20%D9%81%D9%8A%20%D8%A7%D9%84%D9%86%D8%B5",minTxtLength:"%D8%A7%D9%84%D9%85%D8%AD%D8%A7%D9%88%D9%84%D8%A9%20%D9%85%D8%B1%D8%A9%20%D8%A3%D8%AE%D8%B1%D9%89%20%D8%B9%D9%86%D8%AF%D9%85%D8%A7%20%D9%8A%D9%83%D9%88%D9%86%20%D8%B7%D9%88%D9%84%20%D8%A7%D9%84%D9%85%D8%AD%D8%AA%D9%88%D9%89%20%D8%A3%D9%82%D9%84%20%D9%85%D9%86%20%D9%87%D8%B0%D8%A7",showFilterList:"%D8%B9%D8%B1%D8%B6%20%D9%86%D8%A7%D9%81%D8%B0%D8%A9%20%D8%A7%D9%84%D8%AA%D8%B5%D9%81%D9%8A%D8%A9%20%D9%88%D8%A7%D9%84%D8%AA%D8%B1%D8%AA%D9%8A%D8%A8%20%D9%82%D8%A8%D9%84%20%D8%A7%D9%84%D8%AA%D8%AD%D9%85%D9%8A%D9%84",ok:"%D9%85%D9%88%D8%A7%D9%81%D9%82",close:"%D8%A5%D8%BA%D9%84%D8%A7%D9%82",dacSortByPos:"%D8%A7%D9%84%D8%AA%D8%B1%D8%AA%D9%8A%D8%A8%20%D8%AD%D8%B3%D8%A8%20%D8%A7%D9%84%D9%85%D9%88%D9%82%D8%B9",dacSortByUrl:"%D8%A7%D9%84%D8%AA%D8%B1%D8%AA%D9%8A%D8%A8%20%D8%AD%D8%B3%D8%A8%20%D8%A7%D9%84%D8%B1%D8%A7%D8%A8%D8%B7",dacSortByName:"%D8%A7%D9%84%D8%AA%D8%B1%D8%AA%D9%8A%D8%A8%20%D8%AD%D8%B3%D8%A8%20%D8%A7%D9%84%D8%A7%D8%B3%D9%85",reverse:"%D8%B9%D9%83%D8%B3%20%D8%A7%D9%84%D8%A7%D8%AE%D8%AA%D9%8A%D8%A7%D8%B1",dacUseIframe:"%D9%84%D8%AA%D8%AD%D9%85%D9%8A%D9%84%20%D8%A7%D9%84%D9%85%D8%AD%D8%AA%D9%88%D9%89%20(%D8%A8%D8%B7%D9%8A%D8%A1)%20iframe%20%D8%A7%D8%B3%D8%AA%D8%AE%D8%AF%D8%A7%D9%85",dacSaveAsZip:"zip%20%D8%AD%D9%81%D8%B8%20%D9%83%D9%80",dacSetCustomRule:"%D8%AA%D8%B9%D8%AF%D9%8A%D9%84%20%D8%A7%D9%84%D9%82%D9%88%D8%A7%D8%B9%D8%AF",dacAddUrl:"%D8%A5%D8%B6%D8%A7%D9%81%D8%A9%20%D9%81%D8%B5%D9%84",prefix:"Prefix%20of%20chapter%20name",dacStartDownload:"%D8%AA%D8%AD%D9%85%D9%8A%D9%84%20%D8%A7%D9%84%D9%85%D8%AD%D8%AF%D8%AF",downloadShortcut:"%D8%AA%D8%AD%D9%85%D9%8A%D9%84%20%D8%A7%D9%84%D9%81%D8%B5%D9%84",downloadSingleShortcut:"%D8%AA%D8%AD%D9%85%D9%8A%D9%84%20%D8%B5%D9%81%D8%AD%D8%A9%20%D9%88%D8%A7%D8%AD%D8%AF%D8%A9",downloadCustomShortcut:"%D8%AA%D8%AD%D9%85%D9%8A%D9%84%20%D9%85%D8%AE%D8%B5%D8%B5"};break;default:i18n={fetch:"Download",info:`Source: #t#
The TXT is downloaded by 'DownloadAllContent'`,error:"Failed in downloading current chapter",downloading:"%s pages are downloaded, there are still %s pages left<br>Downloading %s ......",complete:"Completed! Get %s pages in total",del:"Set css selectors for ignore",custom:"Custom to download",customInfo:"Input urls OR sss selectors for chapter links",reSort:"ReSort by title",reSortUrl:"Resort by URLs",setting:"Open Setting",searchRule:"Search rule",abort:"Abort",save:"Save",saveAsMd:"Save as Markdown",saveAsJSON:"Save as JSON",downThreadNum:"Set threadNum for download, negative means interval of single thread",enableTouch:"On the mobile device, slide the screen in the direction of \u2192\u2193\u2190\u2191 to draw a square will start downloading immediately",customTitle:"Customize the chapter title, enter the selector on inner page",saveUrl:"Save URL",disableAutoStartSave:"Disable auto save",maxDlPerMin:"Maximum number of downloads per minute",reSortDefault:"Default sort by position in the page",reverseOrder:"Reverse chapter ordering",saveBtn:"Save Setting",saveOk:"Save Over",nextPage:"Check next page in chapter",nextPageReg:"Custom RegExp of next page",retainImage:"Keep the URL of image if there are images in the text",minTxtLength:"Try to crawl again when the length of content is less than this",showFilterList:"Show chapter filtering and sorting window before downloading",ok:"OK",close:"Close",dacSortByPos:"Sort by position",dacSortByUrl:"Sort by URL",dacSortByName:"Sort by name",reverse:"Reverse selection",dacUseIframe:"Use iframe to load content (slow)",dacSaveAsZip:"Save as zip",dacSetCustomRule:"Modify rules",dacAddUrl:"Add Chapter",prefix:"Prefix of chapter name",dacStartDownload:"Download selected",downloadShortcut:"Download chapter Shortcut",downloadSingleShortcut:"Download single page Shortcut",downloadCustomShortcut:"Custom download Shortcut"};break}if(i18n.encode)for(let e in i18n)e!="encode"&&(i18n[e]=decodeURI(i18n[e]));var firefox=navigator.userAgent.toLowerCase().indexOf("firefox")!=-1,curRequests=[],useIframe=!1,iframeSandbox=!1,iframeInit=!1,filterListContainer,txtDownContent,txtDownWords,txtDownQuit,dacLinksCon,dacUseIframe,shadowContainer,downTxtShadowContainer;const escapeHTMLPolicy=win.trustedTypes&&win.trustedTypes.createPolicy?win.trustedTypes.createPolicy("dac_default",{createHTML:(e,n)=>e}):null;function createHTML(e){return escapeHTMLPolicy?escapeHTMLPolicy.createHTML(e):e}function str2Num(e){if(e=e.replace(/^番\s*外/,"99999+").replace(/[一①Ⅰ壹]/g,"1").replace(/[二②Ⅱ贰]/g,"2").replace(/[三③Ⅲ叁]/g,"3").replace(/[四④Ⅳ肆]/g,"4").replace(/[五⑤Ⅴ伍]/g,"5").replace(/[六⑥Ⅵ陆]/g,"6").replace(/[七⑦Ⅶ柒]/g,"7").replace(/[八⑧Ⅷ捌]/g,"8").replace(/[九⑨Ⅸ玖]/g,"9").replace(/[十⑩Ⅹ拾]/g,"*10+").replace(/[百佰]/g,"*100+").replace(/[千仟]/g,"*1000+").replace(/[万萬]/g,"*10000+").replace(/\s/g,"").match(/[\d\*\+]+/),!e)return 0;e=e[0];let n=e.match(/(\d*)\*(\d+)/);for(;n;){let o=parseInt(n[1]||1)*parseInt(n[2]);e=e.replace(n[0],o),n=e.match(/(\d+)\*(\d+)/)}let t=e.match(/(\d+)\+(\d+)/);for(;t;){let o=parseInt(t[1])+parseInt(t[2]);e=e.replace(t[0],o),t=e.match(/(\d+)\+(\d+)/)}return parseInt(e)}var dragOverItem,dragFrom,linkDict;function createLinkItem(e){let n=document.createElement("div");n.innerHTML=createHTML(`
                <input type="checkbox" checked>
                <a class="dacLink" draggable="false" target="_blank" href="${e.href}">${e.innerText||"\u{1F4C4}"}</a>
                <span>\u{1F5B1}\uFE0F</span>
            `),n.title=e.innerText,n.setAttribute("draggable","true"),n.addEventListener("dragover",t=>{t.preventDefault()}),n.addEventListener("dragenter",t=>{dragOverItem&&(dragOverItem.style.opacity=""),n.style.opacity=.3,dragOverItem=n}),n.addEventListener("dragstart",t=>{dragFrom=n}),n.addEventListener("drop",t=>{dragFrom&&(t.clientX<n.getBoundingClientRect().left+142?dacLinksCon.insertBefore(dragFrom,n):n.nextElementSibling?dacLinksCon.insertBefore(dragFrom,n.nextElementSibling):dacLinksCon.appendChild(dragFrom),t.preventDefault())}),linkDict[e.href]=n,dacLinksCon.appendChild(n)}var saveAsZip=!0;function filterList(e){if(!GM_getValue("showFilterList")){indexDownload(e);return}if(txtDownContent&&(txtDownContent.style.display="none"),filterListContainer)filterListContainer.style.display="",filterListContainer.classList.remove("customRule"),dacLinksCon.innerHTML=createHTML("");else{document.addEventListener("dragend",s=>{dragOverItem&&(dragOverItem.style.opacity="")},!0),filterListContainer=document.createElement("div"),filterListContainer.id="filterListContainer",filterListContainer.innerHTML=createHTML(`
                <div id="dacFilterBg" style="height: 100%; width: 100%; position: fixed; top: 0; z-index: 2147483646; opacity: 0.3; filter: alpha(opacity=30); background-color: #000;"></div>
                <div id="filterListBody">
                    <div class="dacCustomRule">
                    ${i18n.custom}
                        <textarea id="dacCustomInput"></textarea>
                        <div class="fun">
                            <input id="dacConfirmRule" value="${i18n.ok}" type="button"/>
                            <input id="dacCustomClose" value="${i18n.close}" type="button"/>
                        </div>
                    </div>
                    <div class="sort">
                        <input id="dacSortByPos" value="${i18n.dacSortByPos}" type="button"/>
                        <input id="dacSortByUrl" value="${i18n.dacSortByUrl}" type="button"/>
                        <input id="dacSortByName" value="${i18n.dacSortByName}" type="button"/>
                        <input id="reverse" value="${i18n.reverse}" type="button"/>
                    </div>
                    <div id="dacLinksCon" style="max-height: calc(80vh - 100px); min-height: 100px; display: grid; grid-template-columns: auto auto; width: 100%; overflow: auto; white-space: nowrap;"></div>
                    <p style="margin: 5px; text-align: center; font-size: 14px; height: 20px;"><span><input id="dacUseIframe" type="checkbox"/><label for="dacUseIframe"> ${i18n.dacUseIframe}</label></span> <span style="display:${win.downloadAllContentSaveAsZip?"inline":"none"}"><input id="dacSaveAsZip" type="checkbox" checked="checked"/><label for="dacSaveAsZip"> ${i18n.dacSaveAsZip}</label></span></p>
                    <div class="fun">
                        <input id="dacSetCustomRule" value="${i18n.dacSetCustomRule}" type="button"/>
                        <input id="dacAddUrl" value="${i18n.dacAddUrl}" type="button"/>
                        <input id="dacStartDownload" value="${i18n.dacStartDownload}" type="button"/>
                        <input id="dacLinksClose" value="${i18n.close}" type="button"/>
                    </div>
                </div>`);let n=filterListContainer.querySelector("#dacSortByPos"),t=filterListContainer.querySelector("#dacSortByUrl"),o=filterListContainer.querySelector("#dacSortByName"),r=filterListContainer.querySelector("#reverse"),d=filterListContainer.querySelector("#dacSetCustomRule"),i=filterListContainer.querySelector("#dacCustomInput"),c=filterListContainer.querySelector("#dacConfirmRule"),a=filterListContainer.querySelector("#dacCustomClose"),m=filterListContainer.querySelector("#dacAddUrl"),u=filterListContainer.querySelector("#dacStartDownload"),T=filterListContainer.querySelector("#dacLinksClose"),A=filterListContainer.querySelector("#dacFilterBg"),R=filterListContainer.querySelector("#dacSaveAsZip");dacUseIframe=filterListContainer.querySelector("#dacUseIframe"),R.onchange=s=>{saveAsZip=R.checked},n.onclick=s=>{[].slice.call(dacLinksCon.children)[0].children[1].href!=e[0].href?e.reverse().forEach(v=>{let h=linkDict[v.href];h&&dacLinksCon.insertBefore(h,dacLinksCon.children[0])}):e.forEach(v=>{let h=linkDict[v.href];h&&dacLinksCon.insertBefore(h,dacLinksCon.children[0])})},t.onclick=s=>{let p=[].slice.call(dacLinksCon.children);p.sort((v,h)=>{const k=v.children[1].href.toUpperCase(),M=h.children[1].href.toUpperCase();return k<M?-1:k>M?1:0}),p[0]==dacLinksCon.children[0]&&(p=p.reverse()),p.forEach(v=>{dacLinksCon.appendChild(v)})},o.onclick=s=>{let p=[].slice.call(dacLinksCon.children);p.sort((v,h)=>str2Num(v.innerText)-str2Num(h.innerText)),p[0]==dacLinksCon.children[0]&&(p=p.reverse()),p.forEach(v=>{dacLinksCon.appendChild(v)})},r.onclick=s=>{[].slice.call(dacLinksCon.children).forEach(v=>{v.children[0].checked=!v.children[0].checked})},d.onclick=s=>{filterListContainer.classList.add("customRule"),i.value=GM_getValue("DACrules_"+document.domain)||""},c.onclick=s=>{i.value&&customDown(i.value)},a.onclick=s=>{filterListContainer.classList.remove("customRule")},m.onclick=s=>{let p=window.prompt(i18n.customInfo,"https://xxx.xxx/book-[20-99].html, https://xxx.xxx/book-[01-10].html");if(!p||!/^http|^ftp/.test(p))return;let v=1;[].forEach.call(p.split(","),function(h){var k,M=/\[\d+\-\d+\]/.exec(h);if(M)M=M[0].trim();else{k=document.createElement("a"),k.href=h,k.innerText="Added Url",createLinkItem(k);return}var l=/\[(\d+)/.exec(M)[1].trim(),L=/(\d+)\]/.exec(M)[1].trim(),x=parseInt(l),w=parseInt(L),O=l.length,D=l.charAt(0)=="0";if(!(x>=w))for(var g=x;g<=w;g++){var E=g.toString();if(D)for(;E.length<O;)E="0"+E;var P=h.replace(/\[\d+\-\d+\]/,E).trim();k=document.createElement("a"),k.href=P,k.innerText="Added Url "+v++,createLinkItem(k)}})},u.onclick=s=>{let p=[].slice.call(dacLinksCon.querySelectorAll("input:checked+.dacLink"));useIframe=!!dacUseIframe.checked,indexDownload(p,!0)},T.onclick=s=>{filterListContainer.style.display="none"},A.onclick=s=>{filterListContainer.style.display="none"};let I=GM_addStyle(`
                #filterListContainer * {
                    font-size: 13px;
                    float: initial;
                    background-image: initial;
                    height: fit-content;
                    color: black;
                }
                #filterListContainer.customRule .dacCustomRule {
                    display: flex;
                }
                #filterListContainer .dacCustomRule>textarea {
                    height: 300px;
                    width: 100%;
                    border: 1px #DADADA solid;
                    background: #ededed70;
                    margin: 5px;
                }
                #filterListContainer.customRule .dacCustomRule~* {
                    display: none!important;
                }
                #dacLinksCon>div {
                    padding: 5px 0;
                    display: flex;
                }
                #dacLinksCon>div>a {
                    max-width: 245px;
                    display: inline-block;
                    text-overflow: ellipsis;
                    overflow: hidden;
                }
                #dacLinksCon>div>input {
                    margin-right: 5px;
                }
                #filterListContainer .dacCustomRule {
                    border-radius: 8px;
                    font-weight: bold;
                    font-size: 16px;
                    outline: none;
                    align-items: center;
                    flex-wrap: nowrap;
                    white-space: nowrap;
                    flex-direction: column;
                    display: none;
                }
                #filterListContainer input {
                    border-width: 2px;
                    border-style: outset;
                    border-color: buttonface;
                    border-image: initial;
                    border: 1px #DADADA solid;
                    padding: 5px;
                    border-radius: 8px;
                    font-weight: bold;
                    font-size: 9pt;
                    outline: none;
                    cursor: pointer;
                    line-height: initial;
                    width: initial;
                    min-width: initial;
                    max-width: initial;
                    height: initial;
                    min-height: initial;
                    max-height: initial;
                }
                #dacLinksCon>div:nth-of-type(4n),
                #dacLinksCon>div:nth-of-type(4n+1) {
                    background: #ffffff;
                }
                #dacLinksCon>div:nth-of-type(4n+2),
                #dacLinksCon>div:nth-of-type(4n+3) {
                    background: #f5f5f5;
                }
                #filterListContainer .fun,#filterListContainer .sort {
                    display: flex;
                    justify-content: space-around;
                    flex-wrap: nowrap;
                    width: 100%;
                    height: 28px;
                }
                #filterListContainer input[type=button]:hover {
                    border: 1px #C6C6C6 solid;
                    box-shadow: 1px 1px 1px #EAEAEA;
                    color: #333333;
                    background: #F7F7F7;
                }
                #filterListContainer input[type=button]:active {
                    box-shadow: inset 1px 1px 1px #DFDFDF;
                }
                #filterListBody {
                    padding: 5px;
                    box-sizing: border-box;
                    overflow: hidden;
                    width: 600px;
                    height: auto;
                    max-height: 80vh;
                    min-height: 200px;
                    position: fixed;
                    left: 50%;
                    top: 10%;
                    margin-left: -300px;
                    z-index: 2147483646;
                    background-color: #ffffff;
                    border: 1px solid #afb3b6;
                    border-radius: 10px;
                    opacity: 0.95;
                    filter: alpha(opacity=95);
                    box-shadow: 5px 5px 20px 0px #000;
                }
                @media screen and (max-width: 800px) {
                    #filterListBody {
                        width: 90%;
                        margin-left: -45%;
                    }
                }
            `);dacLinksCon=filterListContainer.querySelector("#dacLinksCon"),shadowContainer=document.createElement("div"),shadowContainer.id="download-all-content",document.body.appendChild(shadowContainer);let N=shadowContainer.attachShadow({mode:"open"});N.appendChild(I),N.appendChild(filterListContainer)}shadowContainer.parentNode&&shadowContainer.parentNode.removeChild(shadowContainer),linkDict={},e.forEach(n=>{createLinkItem(n)}),dacUseIframe.checked=useIframe,document.body.appendChild(shadowContainer)}function initTxtDownDiv(){if(txtDownContent){txtDownContent.style.display="",document.body.appendChild(downTxtShadowContainer);return}txtDownContent=document.createElement("div"),txtDownContent.id="txtDownContent",downTxtShadowContainer=document.createElement("div"),document.body.appendChild(downTxtShadowContainer),downTxtShadowContainer.attachShadow({mode:"open"}).appendChild(txtDownContent),txtDownContent.innerHTML=createHTML(`
            <style>
            #txtDownContent>div{
              font-size:16px;
              color:#333333;
              width:342px;
              height:110px;
              position:fixed;
              left:50%;
              top:50%;
              margin-top:-25px;
              margin-left:-171px;
              z-index:2147483647;
              background-color:#ffffff;
              border:1px solid #afb3b6;
              border-radius:10px;
              opacity:0.95;
              filter:alpha(opacity=95);
              box-shadow:5px 5px 20px 0px #000;
            }
            #txtDownWords{
              position:absolute;
              width:275px;
              height: 90px;
              max-height: 90%;
              border: 1px solid #f3f1f1;
              padding: 8px;
              border-radius: 10px;
              overflow: auto;
            }
            #txtDownQuit{
              width: 30px;height: 30px;border-radius: 30px;position:absolute;right:2px;top:2px;cursor: pointer;background-color:#ff5a5a;
            }
            #txtDownQuit>span{
              height: 30px;line-height: 30px;display:block;color:#FFF;text-align:center;font-size: 12px;font-weight: bold;font-family: arial;background: initial; float: initial;
            }
            #txtDownQuit+div{
              position:absolute;right:0px;bottom:2px;cursor: pointer;max-width:85px;
            }
            #txtDownQuit+div>button{
              background: #008aff;border: 0;padding: 5px;border-radius: 6px;color: white;float: right;margin: 1px;height: 25px;line-height: 16px;cursor: pointer;overflow: hidden;
            }
            </style>
            <div>
                <div id="txtDownWords">
                    Analysing......
                </div>
                <div id="txtDownQuit">
                    <span>\u2573</span>
                </div>
                <div>
                    <button id="abortRequest" style="display:none;">${getI18n("abort")}</button>
                    <button id="tempSaveTxt">${getI18n("save")}</button>
                    <button id="saveAsMd" title="${getI18n("saveAsMd")}">Markdown</button>
                    <button id="saveAsJSON" title="${getI18n("saveAsJSON")}">JSON</button>
                </div>
            </div>`),txtDownWords=txtDownContent.querySelector("#txtDownWords"),txtDownQuit=txtDownContent.querySelector("#txtDownQuit"),txtDownQuit.onclick=function(){txtDownContent.style.display="none"},initTempSave(txtDownContent),win.txtDownWords=txtDownWords}function saveContent(){if(win.downloadAllContentSaveAsZip&&saveAsZip)win.downloadAllContentSaveAsZip(rCats,i18n.info.replace("#t#",location.href),n=>{saveAs(n,document.title.replace(/[\*\/:<>\?\\\|\r\n,]/g,"_")+".zip")});else{var e=new Blob([i18n.info.replace("#t#",location.href)+`\r
\r
`+rCats.join(`\r
\r
`)],{type:"text/plain;charset=utf-8"});saveAs(e,document.title.replace(/[\*\/:<>\?\\\|\r\n,]/g,"_")+".txt")}}function initTempSave(e){var n=e.querySelector("#tempSaveTxt"),t=e.querySelector("#abortRequest"),o=e.querySelector("#saveAsMd"),r=e.querySelector("#saveAsJSON");n.onclick=function(){saveContent(),console.log(curRequests)},t.onclick=function(){let d=curRequests.pop();d&&d[1].abort()},o.onclick=function(){let d=i18n.info.replace("#t#",location.href)+`

---
`+document.title+`
===
`;rCats.forEach(c=>{c=c.replace(`\r
`,`
---`).replace(/(\r\n|\n\r)+/g,`

`).replace(/[\n\r]\t+/g,`
`),d+=`

`+c});var i=new Blob([d],{type:"text/plain;charset=utf-8"});saveAs(i,document.title.replace(/[\*\/:<>\?\\\|\r\n,]/g,"_")+".md")},r.onclick=function(){let d=[];rCats.forEach(c=>{let a=c.split(`\r
`,3),m=GM_getValue("saveUrl"),u={title:a[0].trim(),content:a[1].trim()};m&&(u={title:a[0].trim(),url:a[1].trim(),content:a[2].trim()}),d.push(u)}),d=JSON.stringify(d,null,2);var i=new Blob([d],{type:"text/plain;charset=utf-8"});saveAs(i,document.title.replace(/[\*\/:<>\?\\\|\r\n,]/g,"_")+".json")}}let charset=document.characterSet||document.charset||document.inputEncoding,equiv=document.querySelector('[http-equiv="Content-Type"]'),charsetValid=!0;if(equiv&&equiv.content){let e=equiv.content.match(/charset\=([^;]+)/);e?e[1].replace("-","").toLowerCase()!=charset.replace("-","").toLowerCase()&&(charsetValid=!1):charsetValid=!1}else charsetValid=!1;var iframePool=[];function indexDownload(e,n){if(e.length<1)return;initTxtDownDiv(),n||(GM_getValue("contentSort")&&e.sort((l,L)=>str2Num(l.innerText)-str2Num(L.innerText)),GM_getValue("contentSortUrl")&&e.sort((l,L)=>{const x=l.href.toUpperCase(),w=L.href.toUpperCase();return x<w?-1:x>w?1:0}),GM_getValue("reverse")&&(e=e.reverse())),rCats=[];const t=6e4;var o=GM_getValue("minTxtLength")||100,r=GM_getValue("customTitle"),d=GM_getValue("prefix"),i=!!GM_getValue("disableNextPage"),c=GM_getValue("nextPageReg"),a=GM_getValue("maxDlPerMin")||0,m=0;if(c)try{innerNextPage=new RegExp(c)}catch(l){console.warn(l)}function u(l,L,x){if(r)try{let w=l.querySelector(r);w&&w.innerText&&(L.innerText=w.innerText)}catch(w){console.warn(w)}d&&(L.innerText=d.replace(/\$i/g,++x)+L.innerText)}function T(){if(iframePool&&iframePool.length)return iframePool.shift();let l=document.createElement("iframe");return l.name="pagetual-iframe",l.width="100%",l.height="1000",l.frameBorder="0",l.style.cssText="margin:0!important;padding:0!important;visibility:hidden!important;flex:0;opacity:0!important;pointer-events:none!important;position:fixed;top:0px;left:0px;z-index:-2147483647;",l}var A=[],R=0,I=0,N=function(l){if(I>=e.length)return;if(a)if(m===-1){setTimeout(()=>{N(l)},t);return}else if(m>=a){m=-1,setTimeout(()=>{m=0,N(l)},t);return}else m++;let L=R,x=e[L],w=(D,g)=>{D&&D.cloneNode&&(D=D.cloneNode(!0));let E=0,P=0;function q(C){return C||(C=charset),GM_xmlhttpRequest({method:"GET",url:D.href,headers:{referer:D.href,"Content-Type":"text/html;charset="+C},timeout:1e4,overrideMimeType:"text/html;charset="+C,onload:async function(F){let _=s(F.responseText);if(charsetValid){let S=_.querySelector('[http-equiv="Content-Type"]');if(S&&S.content){let y=S.content.match(/charset\=([^;]+)/);if(y&&y[1].replace("-","").toLowerCase()!=C.replace("-","").toLowerCase())return charset=y[1],q(charset)}}R++,I++,/^{/.test(F.responseText)&&(_.json=()=>{try{return JSON.parse(F.responseText)}catch{}return{}});let G=_.querySelector("base"),f=!i&&!processFunc&&await checkNextPage(_,G?G.href:D.href);if(f&&(f.length||(f=[f]),f.forEach(S=>{for(var y=!1,b=0;b<e.length;b++)if(e[b].href==S.href){y=!0;break}if(!y){S.innerText=D.innerText+"	>>",e.push(S);let U=g;for(let K=0;K<A.length;K++){let H=A[K],W=!1;if(H){for(let $=0;$<H.length;$++)if(H[$]==g){U=K,W=!0;break}}if(W)break}A[U]||(A[U]=[]),A[U].push(e.length-1)}})),F.status>=400?console.warn("error:",`status: ${F.status} from: ${D.href}`):console.log(F.status),!h(g,D,_,F.status>=400?` status: ${F.status} from: ${D.href} `:"",P<5)&&P++<5){R--,I--,setTimeout(()=>{q()},Math.random()*500+P*1e3);return}l?setTimeout(()=>{N(l)},l):N()},onerror:function(F){if(console.warn("error:",F,D.href),E++<5){setTimeout(()=>{q()},Math.random()*500+E*1e3);return}R++,I++,h(g,D,null,` NETWORK ERROR: ${F.response||F.responseText} from: ${D.href} `),l?setTimeout(()=>{N(l)},l):N()},ontimeout:function(F){if(console.warn("timeout: times="+(E+1)+" url="+D.href),E++<5){setTimeout(()=>{q()},Math.random()*500+E*1e3);return}R++,I++,h(g,D,null,` TIMEOUT: ${D.href} `),l?setTimeout(()=>{N(l)},l):N()}})}if(useIframe){let C=T(),F=!1,_=0,G,f=S=>{C.src=S,clearTimeout(G),G=setTimeout(()=>{C.src=S},2e4)};C.sandbox=iframeSandbox||"allow-same-origin allow-scripts allow-popups allow-forms",C.addEventListener("load",S=>{if(S.data!="pagetual-iframe:DOMLoaded"&&S.type!="load"||F)return;F=!0,clearTimeout(G);async function y(){try{let b=C.contentDocument||C.contentWindow.document;if(!b||!b.body){setTimeout(()=>{y()},1e3);return}if(b.body.scrollTop=9999999,b.documentElement.scrollTop=9999999,!processFunc&&P++>5&&_++<2){f(C.src),P=0,F=!1;return}let U=b.querySelector("base"),V=!i&&!processFunc&&await checkNextPage(b,U?U.href:D.href);if(V&&(V.length||(V=[V]),V.forEach(H=>{for(var W=!1,$=0;$<e.length;$++)if(e[$].href==H.href){W=!0;break}if(!W){H.innerText=D.innerText+"	>>",e.push(H);let z=g;for(let Z=0;Z<A.length;Z++){let J=A[Z],Y=!1;if(J){for(let X=0;X<J.length;X++)if(J[X]==g){z=Z,Y=!0;break}}if(Y)break}A[z]||(A[z]=[]),A[z].push(e.length-1)}})),R++,I++,!h(g,D,b,"",_<2)){R--,I--,setTimeout(()=>{y()},1e3);return}l?setTimeout(()=>{N(l)},l):N()}catch{console.debug("Stop as cors")}if(C&&C.parentNode){try{C.src="about:blank"}catch(b){console.error("Error clearing iframe src:",b)}C.parentNode.removeChild(C),iframePool.push(C)}}setTimeout(()=>{y()},500)},!1);let B=setInterval(()=>{let S;try{S=C.contentDocument||C.contentWindow&&C.contentWindow.document}catch{clearInterval(B);return}if(S)try{Function("win","iframe",'"use strict";'+(iframeInit||"win.self=win.top;"))(C.contentWindow,C),clearInterval(B)}catch(y){console.debug(y)}},50);return f(D.href),document.body.appendChild(C),[g,null,D.href]}else return[g,q(),D.href]};if(!x){let D=setInterval(function(){I>=e.length&&clearInterval(D),x=e[L],x&&(clearInterval(D),w(x,L))},1e3);return null}let O=w(x,L);return O&&curRequests.push(O),O};function s(l){var L=null;try{L=document.implementation.createHTMLDocument(""),L.documentElement.innerHTML=l}catch{console.log("parse error")}return L}function p(){var l=[],L=0,x,w;for(x=0;x<A.length;x++){var O=A[x];if(O)for(w=0;w<O.length;w++){var D=O[w],g=rCats[D];rCats[D]=null,l[x]||(l[x]=[]),l[x].push(g)}}for(x=l.length-1;x>=0;x--){let E=l[x];if(E)for(w=E.length-1;w>=0;w--)rCats.splice(x+1,0,E[w])}rCats=rCats.filter(function(E){return E!=null})}var v;function h(l,L,x,w,O){let D=E=>{u(x,L,l);let P="";GM_getValue("saveUrl")&&(P=L.href+`\r
`),rCats[l]=L.innerText.replace(/[\r\n\t]/g,"")+`\r
`+P+(w||"")+E.replace(/\s*$/,""),curRequests=curRequests.filter(function(C){return C[0]!=l}),txtDownContent.style.display="block",txtDownWords.innerHTML=getI18n("downloading",[I,e.length-I,L.innerText]),I==e.length&&(v&&clearTimeout(v),v=setTimeout(()=>{if(I==e.length){txtDownWords.innerHTML=getI18n("complete",[I]),p();var C=GM_getValue("disableAutoStartSave");C||saveContent()}},3e3))},g=getPageContent(x,E=>{D(E)},L.href);if(g!==!1){if(O&&g&&g.replace(/\s/g,"").length<o)return!1;D(g)}return!0}var k=parseInt(GM_getValue("downThreadNum"));if(k=k||20,useIframe&&k>5&&(k=5),k>0)for(var M=0;M<k&&(N(),!(R>=e.length-1||R>=k-1));M++)R++;else N(-k*1e3)}function canonicalUri(e,n){if(!e)return"";if(e.charAt(0)=="#")return n+e;if(e.charAt(0)=="?")return n.replace(/^([^\?#]+).*/,"$1"+e);let t=location.protocol+"//"+location.host,o=n||t;o=o.replace(/(\?|#).*/,""),/https?:\/\/[^\/]+$/.test(o)&&(o=o+"/"),o.indexOf("http")!==0&&(o=t+o);for(var r=/^[^\?#]*\//.exec(o)[0],d=/^\w+\:\/\/\/?[^\/]+/.exec(r)[0],i=/^\w+\:\/\//;e.indexOf("../")===0;)e=e.substr(3),r=r.replace(/\/[^\/]+\/$/,"/");return e=e.replace(/\.\//,""),/^\/\/\/?/.test(e)&&(e=location.protocol+e),i.test(e)?e:(e.charAt(0)=="/"?d:r)+e}async function checkNextPage(e,n){let t=null;if(nextPageFunc)t=await nextPageFunc(e,n),t&&t.length===0&&(t=null);else{let r=e.querySelectorAll("a");for(var o=0;o<r.length;o++){let d=r[o];if(innerNextPage.test(d.innerText)&&d.href&&!/javascript:|#/.test(d.href)){let i=canonicalUri(d.getAttribute("href"),n||location.href);if(i!=location.href){t=d,t.href=i;break}}}}return t}function textNodesUnder(e){for(var n,t=[],o=document.createTreeWalker(e,NodeFilter.SHOW_TEXT,null,!1);n=o.nextNode();)t.push(n);return t}function getPageContent(e,n,t){if(!e)return i18n.error;if(e.body&&!e.body.children.length)return e.body.innerText;if(processFunc)return processFunc(e,n,t);[].forEach.call(e.querySelectorAll("span,div,ul"),function(s){var p=e.defaultView?e.defaultView.getComputedStyle(s):s.style;p&&(p.display=="none"||s.nodeName=="SPAN"&&p.fontSize=="0px")&&(s.innerHTML="")});var o,r,d,i="",c=(e.body?e.body:e).cloneNode(!0);c.innerHTML=c.innerHTML.replace(/\<\!\-\-((.|[\n|\r|\r\n])*?)\-\-\>/g,""),[].forEach.call(c.querySelectorAll("font.jammer"),function(s){s.innerHTML=""});var a=GM_getValue("selectors");a&&[].forEach.call(c.querySelectorAll(a),function(s){s.innerHTML=""}),[].forEach.call(c.querySelectorAll("script,style,link,noscript,iframe"),function(s){s&&s.parentNode&&s.parentNode.removeChild(s)});var m=s=>/^(I|STRONG|B|FONT|P|DL|DD|H\d)$/.test(s.nodeName)&&s.children.length<=1,u,T=c.querySelectorAll("span,div,article,p,td,pre"),A=0;for(o=0;o<T.length;o++){let s=T[o],p=!1,v=!0,h,k=0;if(!/footer/.test(s.className)){for(r=s.childNodes.length-1;r>=0;r--)h=s.childNodes[r],h.nodeType==3?/^\s*$/.test(h.data)?h.innerHTML="":p=!0:(/^(I|A|STRONG|B|FONT|P|DL|DD|H\d)$/.test(h.nodeName)||h.nodeType==1&&h.children.length==1&&/^(I|A|STRONG|B|FONT|P|DL|DD|H\d)$/.test(h.children[0].nodeName))&&(p=!0);for(r=s.childNodes.length-1;r>=0;r--)h=s.childNodes[r],h.nodeType==1&&!/^(I|A|STRONG|B|FONT|BR)$/.test(h.nodeName)&&/^[\s\-\_\?\>\|]*$/.test(h.innerHTML)&&(h.innerHTML="");if(s.childNodes.length>1){let M=0;for(r=0;r<s.childNodes.length;r++)if(h=s.childNodes[r],h.nodeType==1){for(h.innerText&&h.innerText.length<50&&indexReg.test(h.innerText)&&M++,d=0;d<h.childNodes.length;d++){var R=h.childNodes[d];if(R.nodeType!=3&&!/^(I|A|STRONG|B|FONT|BR)$/.test(R.nodeName)){v=!1;break}}if(!v)break}if(M>=5)continue}else v=!1;if(!(!v&&!p)){{if(c==document&&s.offsetWidth<=0&&s.offsetHeight<=0)continue;[].forEach.call(s.childNodes,function(M){M.nodeType==3?k+=M.data.trim().length:(m(M)||M.nodeType==1&&M.children.length==1&&m(M.children[0]))&&(k+=firefox?M.textContent.trim().length:M.innerText.trim().length)})}k>A&&(A=k,u=s)}}}if(!u)return i18n.error+" : NO TEXT CONTENT";var I=!!GM_getValue("retainImage");function N(){var s=c.querySelectorAll(u.nodeName);function p(l,L){[].forEach.call(l.querySelectorAll("a[href]"),D=>{D.parentNode&&D.parentNode.removeChild(D)}),I&&[].forEach.call(l.querySelectorAll("img[src]"),D=>{let g=document.createTextNode(`![img](${canonicalUri(D.getAttribute("src"),t||location.href)})`);D.parentNode.replaceChild(g,D)});let x=l.childNodes,w=`\r
`,O=!1;for(let D=0;D<x.length;D++){let g=x[D];g.nodeType==3&&g.data&&!/^[\s\-\_\?\>\|]*$/.test(g.data)&&(O=!0),g.innerHTML&&(g.innerHTML=g.innerHTML.replace(/\<\s*br\s*\>/gi,`\r
`).replace(/\n+/gi,`
`).replace(/\r+/gi,"\r"));let E=g.textContent;if(E){if(!E.trim())continue;w+=E.replace(/[\uFEFF\xA0 ]+/g," ").replace(/([^\r]|^)\n([^\r]|$)/gi,`$1\r
$2`)}(g.nodeType!=3&&!/^(I|A|STRONG|B|FONT|IMG)$/.test(g.nodeName)||g.nextSibling&&/^P$/.test(g.nextSibling.nodeName))&&(w+=`\r
`)}(O||L||l==u)&&(i+=w+`\r
`)}var v=[];for(o=0;o<s.length;o++){var h=s[o];if(getDepth(h)==getDepth(u)){if(u.className!=h.className)continue;v.push(h)}}var k=A>>2,M=v.length<=3;v.forEach(l=>{M&&l.innerText.length<k||(u.className&&u.className==l.className||u.parentNode==l.parentNode?p(l,!0):p(l,!1))}),i=i.replace(/[\n\r]+/g,`
\r`)}if(N(),i.length<100){let s=c.querySelectorAll("article,.content,#content");s&&s.length==1&&(u=s[0],A=u.innerText.length,A>100&&(i="",N()))}return i}function getI18n(e,n){var t=i18n[e];return n&&n.length>0&&n.forEach(function(o){t=t.replace(/%s/,o)}),t}function getDepth(e){for(var n=e,t=0;n.parentNode;)n=n.parentNode,t++;return t}async function sleep(e){await new Promise(n=>{setTimeout(()=>{n()},e)})}async function fetch(e){e=e===!0,processFunc=null,initTxtDownDiv();var n=document.body.querySelectorAll("a"),t=[];txtDownWords.innerHTML=`Analysing ( 1/${n.length} )......`,txtDownContent.style.pointerEvents="none";for(var o=0;o<n.length;o++){o%100==0&&await sleep(1),txtDownWords.innerHTML=`Analysing ( ${o+1}/${n.length} )......`;var r=n[o],d=!1;if(r.dataset.href&&(!r.href||r.href.indexOf("javascript")!=-1)&&(r.href=r.dataset.href),r.href!=location.href){for(var i=0;i<t.length;i++)if(t[i].href==r.href){r=t[i],t.splice(i,1),t.push(r),d=!0;break}!d&&r.href&&/^http/i.test(r.href)&&(r.innerText.trim()!=""&&indexReg.test(r.innerText.trim())||/chapter[\-_]?\d/.test(r.href))&&t.push(r)}}if(txtDownContent.style.display="none",txtDownContent.style.pointerEvents="",txtDownWords.innerHTML="Analysing......",t.length>2&&!e)useIframe=!1,filterList(t);else{var c=new Blob([i18n.info.replace("#t#",location.href)+`\r
\r
`+document.title+`\r
\r
`+getPageContent(document)],{type:"text/plain;charset=utf-8"});saveAs(c,document.title+".txt")}}function customDown(urls){if(processFunc=null,useIframe=!1,urls){urls=decodeURIComponent(urls.replace(/%/g,"%25")),GM_setValue("DACrules_"+document.domain,urls);var processEles=[];let urlsArr=urls.split("@@"),eles=[];if(/^http|^ftp/.test(urlsArr[0]))[].forEach.call(urlsArr[0].split(","),function(e){var n,t=/\[\d+\-\d+\]/.exec(e);if(t)t=t[0].trim();else{n=document.createElement("a"),n.href=e,n.innerText="Added Url",processEles.push(n);return}var o=/\[(\d+)/.exec(t)[1].trim(),r=/(\d+)\]/.exec(t)[1].trim(),d=parseInt(o),i=parseInt(r),c=o.length,a=o.charAt(0)=="0";if(!(d>=i))for(var m=d;m<=i;m++){var u=m.toString();if(a)for(;u.length<c;)u="0"+u;var T=e.replace(/\[\d+\-\d+\]/,u).trim();n=document.createElement("a"),n.href=T,n.innerText="Added Url "+processEles.length.toString(),processEles.push(n)}});else{let n=function(t){let o=!1;for(var r=0;r<processEles.length;r++)if(processEles[r].href==t.href){processEles.splice(r,1),processEles.push(t),o=!0;break}(!t.href||t.href.indexOf("javascript")!=-1)&&t.dataset.href&&(t.href=t.dataset.href),!o&&t.href&&/^http/i.test(t.href)&&processEles.push(t.cloneNode(1))},e=urlsArr[0].split(">>");try{eles=document.querySelectorAll(e[0]),eles=[].filter.call(eles,t=>t.nodeName=="BODY"||!!t.offsetParent&&getComputedStyle(t).display!=="none")}catch{}if(eles.length==0){eles=[];var eleTxts=urlsArr[0].split(/(?<=[^\\])[,，]/),exmpEles=[],excludeTxts={};[].forEach.call(document.querySelectorAll("a"),function(t){t.offsetParent&&eleTxts.forEach(o=>{var r=o.split("!");t.innerText.indexOf(r[0])!=-1&&(exmpEles.push(t),excludeTxts[t]=r.splice(1))})}),exmpEles.forEach(t=>{var o="a",r=t.parentNode,d=excludeTxts[t];for(t.className&&(o+="."+CSS.escape(t.className.replace(/\s+/g,".")).replace(/\\\./g,"."));r&&r.nodeName!="BODY";)o=r.nodeName+">"+o,r=r.parentNode;o="body>"+o,[].forEach.call(document.querySelectorAll(o),function(i){if(i.offsetParent){var c=!1;for(var a in d)if(i.innerText.indexOf(d[a])!=-1){c=!0;break}!c&&eles.indexOf(i)==-1&&eles.push(i)}})})}[].forEach.call(eles,function(t){if(e[1]){t=Function("item",e[1])(t);let o;Array.isArray(t)?o=t:o=[t],o.forEach(r=>{if(!(!r||!r.href)){if(!r.nodeName||r.nodeName!="A"){let d=r.href,i=r.innerText;r=document.createElement("a"),r.href=d,r.innerText=i}n(r)}})}else n(t)})}urlsArr[1]&&processEles.forEach(e=>{e.href=e.href.replace(new RegExp(urlsArr[1]),urlsArr[2])});var retainImage=!!GM_getValue("retainImage"),evalCode=urlsArr[3];if(evalCode){if(evalCode=evalCode.trim(),/^iframe:/.test(evalCode))for(evalCode=evalCode.replace("iframe:",""),useIframe=!0,iframeSandbox=!1,iframeInit=!1;/^(sandbox|init):/.test(evalCode);)iframeSandbox=evalCode.match(/^sandbox:\{(.*?)\}/),iframeSandbox&&(evalCode=evalCode.replace(iframeSandbox[0],""),iframeSandbox=iframeSandbox[1]),iframeInit=evalCode.match(/^init:\{(.*?)\}/),iframeInit&&(evalCode=evalCode.replace(iframeInit[0],""),iframeInit=iframeInit[1]);let e=evalCode.match(/^charset:{(.+?)}/);e&&(charset=e[1],evalCode=evalCode.replace(e[0],""));let n=evalCode.match(/^next:(\{+)/);if(n){let t=n[1].length;if(n=evalCode.match(new RegExp(`^next:\\{{${t}}(.*?)\\}{${t}}`)),n){let o=n[1];evalCode=evalCode.replace(n[0],""),nextPageFunc=async(r,d)=>{let i;if(/\breturn\b/.test(o))i=await new AsyncFunction("doc","url",'"use strict";'+o)(r,d);else try{i=r.querySelectorAll(o),i&&i.length?[].forEach.call(i,c=>{c.href=canonicalUri(c.getAttribute("href"),d||location.href)}):i=null}catch{}return i}}}}evalCode?processFunc=(data,cb,url)=>{let doc=data;if(evalCode.indexOf("return ")==-1)if(evalCode.indexOf("@")==0){let e="";var selectors=GM_getValue("selectors");return selectors&&[].forEach.call(data.querySelectorAll(selectors),function(n){n.innerHTML=""}),[].forEach.call(data.querySelectorAll("script,style,link,noscript,iframe"),function(n){n&&n.parentNode&&n.parentNode.removeChild(n)}),retainImage&&[].forEach.call(data.querySelectorAll("img[src]"),n=>{let t=`![img](${canonicalUri(n.getAttribute("src"),location.href)})`,o=document.createTextNode(t);n.parentNode.replaceChild(o,n)}),[].forEach.call(data.querySelectorAll(evalCode.slice(1)),n=>{[].forEach.call(n.childNodes,t=>{t.innerHTML&&(t.innerHTML=t.innerHTML.replace(/\<\s*br\s*\>/gi,`\r
`).replace(/\n+/gi,`
`).replace(/\r+/gi,"\r")),t.textContent&&(e+=t.textContent.replace(/ +/g," ").replace(/([^\r]|^)\n([^\r]|$)/gi,`$1\r
$2`)+`\r
`)}),e+=`\r
`}),e}else return eval(evalCode);else return Function("data","doc","cb","url",evalCode)(data,doc,cb,url)}:win.dacProcess&&(processFunc=win.dacProcess),filterList(processEles)}}const configPage="https://hoothin.github.io/UserScripts/DownloadAllContent/",copySvg='<svg aria-hidden="true" height="16" viewBox="0 0 16 16" version="1.1" width="16" data-view-component="true" style="transition: all ease 0.5s;top: 5px;right: 5px;position: absolute;cursor: pointer;"><title>Copy</title><path d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 0 1 0 1.5h-1.5a.25.25 0 0 0-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 0 0 .25-.25v-1.5a.75.75 0 0 1 1.5 0v1.5A1.75 1.75 0 0 1 9.25 16h-7.5A1.75 1.75 0 0 1 0 14.25Z"></path><path d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0 1 14.25 11h-7.5A1.75 1.75 0 0 1 5 9.25Zm1.75-.25a.25.25 0 0 0-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 0 0 .25-.25v-7.5a.25.25 0 0 0-.25-.25Z"></path></svg>';function searchRule(){GM_openInTab(configPage+"#@"+location.hostname,{active:!0})}var downloadShortcut=GM_getValue("downloadShortcut")||{ctrlKey:!0,shiftKey:!1,altKey:!1,metaKey:!1,key:"F9"},downloadSingleShortcut=GM_getValue("downloadSingleShortcut")||{ctrlKey:!0,shiftKey:!0,altKey:!1,metaKey:!1,key:"F9"},downloadCustomShortcut=GM_getValue("downloadCustomShortcut")||{ctrlKey:!0,shiftKey:!1,altKey:!0,metaKey:!1,key:"F9"},enableTouch=GM_getValue("enableTouch");if(enableTouch){let o=function(r){let d=r.changedTouches[0].clientX,i=r.changedTouches[0].clientY,c=d-lastX,a=i-lastY;if(c*c+a*a>256){lastX=d,lastY=i;let u="",T=Math.abs(a/c);T>2?a>0?u="\u2193":u="\u2191":T<.5&&(c>0?u="\u2192":u="\u2190"),u&&lastSign!=u&&(signs+=u,lastSign=u)}};var lastX,lastY,signs,lastSign;document.addEventListener("touchstart",function(r){lastX=r.changedTouches[0].clientX,lastY=r.changedTouches[0].clientY,lastSign=signs="",document.addEventListener("touchmove",o,!1)},!1),document.addEventListener("touchend",function(r){document.removeEventListener("touchmove",o,!1),signs=="\u2192\u2193\u2190\u2191"&&(r.stopPropagation(),r.preventDefault(),startCustom())},!1)}if(location.origin+location.pathname==configPage){let r=function(){clearTimeout(o),o=setTimeout(()=>{let f=t.value,B=[],S=[];if(f)for(let y=0;y<n.children.length;y++){let b=n.children[y];b.firstChild.href.indexOf(f)==-1?S.push(b):B.push(b)}else S=n.children;if(B.length){for(let y=0;y<S.length;y++){let b=S[y];b.style.display="none"}for(let y=0;y<B.length;y++){let b=B[y];b.style.display=""}}else for(let y=0;y<S.length;y++){let b=S[y];b.style.display=""}},500)},a=function(f,B,S){S||(S="input");let y=document.createElement("div"),b=document.createElement("input"),U=document.createElement("b");if(b.type=S,b.value=B,b.checked=B,U.style.margin="0px 10px 0px 0px",S=="radio"){let V=document.createElement("label");V.innerText=f,c++,b.id="radio"+c,V.setAttribute("for",b.id),U.appendChild(V)}else S=="input"&&(b.style.flexGrow="1"),U.innerText=f;return y.style.margin="10px 0",y.style.display="flex",y.style.alignItems="center",y.appendChild(U),y.appendChild(b),i.parentNode.insertBefore(y,i),b},m=function(f){let B=[];return f.ctrlKey&&B.push("Ctrl"),f.shiftKey&&B.push("Shift"),f.altKey&&B.push("Alt"),f.metaKey&&B.push("Meta"),B.push(f.key),B.join(" + ")},u=function(f){if(!f)return"";let B={ctrlKey:!1,shiftKey:!1,altKey:!1,metaKey:!1,key:""};return f.split(" + ").forEach(S=>{switch(S){case"Ctrl":B.ctrlKey=!0;break;case"Shift":B.shiftKey=!0;break;case"Alt":B.altKey=!0;break;case"Meta":B.metaKey=!0;break;default:B.key=S;break}}),B},e=document.getElementById("example");if(!e)return;e=e.parentNode;let n=e.nextElementSibling.nextElementSibling,t=document.createElement("input"),o;if(t.style.margin="10px",t.style.width="100%",t.placeholder=i18n.searchRule,t.addEventListener("input",function(f){r()}),location.hash){let f=location.hash.slice(1);f.indexOf("@")==0&&(setTimeout(()=>{e.scrollIntoView()},500),t.value=f.slice(1),r())}[].forEach.call(n.querySelectorAll("div.highlight"),f=>{f.style.position="relative",f.innerHTML=f.innerHTML+copySvg;let B=f.children[1];B.addEventListener("click",function(S){GM_setClipboard(f.children[0].innerText),B.style.opacity=0,setTimeout(()=>{B.style.opacity=1},1e3)})}),e.parentNode.insertBefore(t,n);let d=document.querySelector("[alt='donate']");if(!d)return;let i=d.parentNode.nextElementSibling,c=0,T=a(i18n.showFilterList,!!GM_getValue("showFilterList"),"checkbox"),A=a(i18n.downloadShortcut,m(downloadShortcut)||""),R=a(i18n.downloadSingleShortcut,m(downloadSingleShortcut)||""),I=a(i18n.downloadCustomShortcut,m(downloadCustomShortcut)||"");A.setAttribute("readonly","true"),R.setAttribute("readonly","true"),I.setAttribute("readonly","true"),A.style.cursor="cell",R.style.cursor="cell",I.style.cursor="cell";let N=f=>{f.key&&(f.key=="Backspace"?f.target.value="":f.key!="Control"&&f.key!="Shift"&&f.key!="Alt"&&f.key!="Meta"&&(f.target.value=m(f))),f.preventDefault(),f.stopPropagation()};A.addEventListener("keydown",N),R.addEventListener("keydown",N),I.addEventListener("keydown",N);let s=a(i18n.enableTouch,!!enableTouch,"checkbox"),p=a(i18n.del,GM_getValue("selectors")||"");p.setAttribute("placeHolder",".mask,.ksam");let v=a(i18n.downThreadNum,GM_getValue("downThreadNum")||"20","number"),h=a(i18n.maxDlPerMin,GM_getValue("maxDlPerMin")||"0","number"),k=a(i18n.customTitle,GM_getValue("customTitle")||""),M=a(i18n.saveUrl,!!GM_getValue("saveUrl"),"checkbox"),l=a(i18n.disableAutoStartSave,!!GM_getValue("disableAutoStartSave"),"checkbox");k.setAttribute("placeHolder","title");let L=a(i18n.minTxtLength,GM_getValue("minTxtLength")||"100","number"),x=GM_getValue("contentSortUrl")||!1,w=GM_getValue("contentSort")||!1,O=a(i18n.reSortDefault,!x&&!w,"radio"),D=a(i18n.reSortUrl,x||!1,"radio"),g=a(i18n.reSort,w||!1,"radio");O.name="sort",D.name="sort",g.name="sort";let E=a(i18n.reverseOrder,!!GM_getValue("reverse"),"checkbox"),P=a(i18n.prefix,GM_getValue("prefix")||""),q=!!GM_getValue("disableNextPage"),C=a(i18n.nextPage,!q,"checkbox"),F=a(i18n.nextPageReg,GM_getValue("nextPageReg")||""),_=a(i18n.retainImage,!!GM_getValue("retainImage"),"checkbox");P.setAttribute("placeHolder","\u7B2C $i \u7AE0\uFF1A"),F.setAttribute("placeHolder","^\\s*(\u4E0B\u4E00[\u9875\u9801\u5F20\u5F35]|next\\s*page|\u6B21\u306E\u30DA\u30FC\u30B8)"),q&&(F.parentNode.style.display="none"),C.onclick=f=>{F.parentNode.style.display=C.checked?"flex":"none"};let G=document.createElement("button");G.innerText=i18n.saveBtn,G.style.margin="0 0 20px 0",i.parentNode.insertBefore(G,i),G.onclick=f=>{GM_setValue("selectors",p.value||""),GM_setValue("downThreadNum",parseInt(v.value||20)),GM_setValue("maxDlPerMin",parseInt(h.value||20)),GM_setValue("minTxtLength",parseInt(L.value||100)),GM_setValue("customTitle",k.value||""),GM_setValue("disableAutoStartSave",l.checked),GM_setValue("saveUrl",M.checked),D.checked?(GM_setValue("contentSortUrl",!0),GM_setValue("contentSort",!1)):g.checked?(GM_setValue("contentSortUrl",!1),GM_setValue("contentSort",!0)):(GM_setValue("contentSortUrl",!1),GM_setValue("contentSort",!1)),GM_setValue("reverse",E.checked),GM_setValue("enableTouch",s.checked),GM_setValue("retainImage",_.checked),GM_setValue("showFilterList",T.checked),GM_setValue("disableNextPage",!C.checked),GM_setValue("nextPageReg",F.value||""),GM_setValue("prefix",P.value||""),GM_setValue("downloadShortcut",u(A.value)||""),GM_setValue("downloadSingleShortcut",u(R.value)||""),GM_setValue("downloadCustomShortcut",u(I.value)||""),alert(i18n.saveOk)};return}function setDel(){GM_openInTab(configPage+"#\u64CD\u4F5C\u8AAA\u660E",{active:!0})}function checkKey(e,n){return e.ctrlKey==n.ctrlKey&&e.shiftKey==n.shiftKey&&e.altKey==n.altKey&&e.metaKey==n.metaKey&&e.key==n.key}function startCustom(){var e=GM_getValue("DACrules_"+document.domain),n=window.prompt(i18n.customInfo+`:
https://xxx.xxx/book-[20-99].html, https://xxx.xxx/book-[01-10].html`,e||"");n&&customDown(n)}document.addEventListener("keydown",function(e){checkKey(downloadCustomShortcut,e)?startCustom():checkKey(downloadSingleShortcut,e)?fetch(!0):checkKey(downloadShortcut,e)&&fetch(!1)}),GM_registerMenuCommand(i18n.custom,()=>{startCustom()}),GM_registerMenuCommand(i18n.fetch,fetch),GM_registerMenuCommand(i18n.setting,setDel),GM_registerMenuCommand(i18n.searchRule,searchRule)}();
