// ==UserScript==
// @name         youtube-adb
// @namespace    https://github.com/iamfugui/youtube-adb
// @version      6.21
// @match        *://*.youtube.com/*
// @exclude      *://accounts.youtube.com/*
// @exclude      *://www.youtube.com/live_chat_replay*
// @exclude      *://www.youtube.com/persist_identity*
// @icon         https://www.google.com/s2/favicons?sz=64&domain=YouTube.com
// @grant        none
// @license MIT
// @downloadURL https://raw.githubusercontent.com/FiorenMas/Userscripts/release/release/YouTubeE58EBBE5B9BFE5918A.user.js
// @updateURL https://raw.githubusercontent.com/FiorenMas/Userscripts/release/release/YouTubeE58EBBE5B9BFE5918A.meta.js
// ==/UserScript==
(function(){let d;const s=["#masthead-ad","ytd-rich-item-renderer.style-scope.ytd-rich-grid-row #content:has(.ytd-display-ad-renderer)",".video-ads.ytp-ad-module","tp-yt-paper-dialog:has(yt-mealbar-promo-renderer)",'ytd-engagement-panel-section-list-renderer[target-id="engagement-panel-ads"]',"#related #player-ads","#related ytd-ad-slot-renderer","ytd-ad-slot-renderer","yt-mealbar-promo-renderer",'ytd-popup-container:has(a[href="/premium"])',"ad-slot-renderer","ytm-companion-ad-renderer"];window.dev=!1;function m(e){let t=e.getFullYear(),o=(e.getMonth()+1).toString().padStart(2,"0"),n=e.getDate().toString().padStart(2,"0"),a=e.getHours().toString().padStart(2,"0"),E=e.getMinutes().toString().padStart(2,"0"),A=e.getSeconds().toString().padStart(2,"0");return`${t}-${o}-${n} ${a}:${E}:${A}`}function r(e){if(!window.dev)return!1;console.log(window.location.href),console.log(`${m(new Date)}  ${e}`)}function p(e){let t=document.createElement("style");t.id=e,(document.head||document.body).appendChild(t)}function y(e){return document.getElementById(e)}function i(e){return y(e)?!0:(p(e),!1)}function f(e){if(i(e))return r("\u5C4F\u853D\u9875\u9762\u5E7F\u544A\u8282\u70B9\u5DF2\u751F\u6210"),!1;let t=document.createElement("style");(document.head||document.body).appendChild(t),t.appendChild(document.createTextNode(h(s))),r("\u751F\u6210\u5C4F\u853D\u9875\u9762\u5E7F\u544A\u8282\u70B9\u6210\u529F")}function h(e){return e.forEach((t,o)=>{e[o]=`${t}{display:none!important}`}),e.join(" ")}function g(){let e=new Touch({identifier:Date.now(),target:this,clientX:12,clientY:34,radiusX:56,radiusY:78,rotationAngle:0,force:1}),t=new TouchEvent("touchstart",{bubbles:!0,cancelable:!0,view:window,touches:[e],targetTouches:[e],changedTouches:[e]});this.dispatchEvent(t);let o=new TouchEvent("touchend",{bubbles:!0,cancelable:!0,view:window,touches:[],targetTouches:[],changedTouches:[e]});this.dispatchEvent(o)}function v(){d=document.querySelector(".ad-showing video")||document.querySelector("video")}function b(){d.paused&&d.currentTime<1&&(d.play(),r("\u81EA\u52A8\u64AD\u653E\u89C6\u9891"))}function w(){const t=[...document.querySelectorAll("ytd-popup-container")].filter(a=>a.querySelector('a[href="/premium"]'));t.length>0&&(t.forEach(a=>a.remove()),r("\u79FB\u9664YT\u62E6\u622A\u5668"));const o=document.querySelectorAll("tp-yt-iron-overlay-backdrop"),n=Array.from(o).find(a=>a.style.zIndex==="2201");n&&(n.className="",n.removeAttribute("opened"),r("\u5173\u95ED\u906E\u7F69\u5C42"))}function c(e,t){const o=document.querySelector(".ytp-ad-skip-button")||document.querySelector(".ytp-skip-ad-button")||document.querySelector(".ytp-ad-skip-button-modern"),n=document.querySelector(".video-ads.ytp-ad-module .ytp-ad-player-overlay")||document.querySelector(".ytp-ad-button-icon");if((o||n)&&window.location.href.indexOf("https://m.youtube.com/")===-1&&(d.muted=!0),o){if(setTimeout(c,.5*1e3),d.currentTime>.5){d.currentTime=d.duration,r("\u7279\u6B8A\u8D26\u53F7\u8DF3\u8FC7\u6309\u94AE\u5E7F\u544A");return}o.click(),g.call(o),r("\u6309\u94AE\u8DF3\u8FC7\u5E7F\u544A")}else n&&(d.currentTime=d.duration,r("\u5F3A\u5236\u7ED3\u675F\u4E86\u8BE5\u5E7F\u544A"))}function T(e){if(i(e))return r("\u53BB\u9664\u64AD\u653E\u4E2D\u7684\u5E7F\u544A\u529F\u80FD\u5DF2\u5728\u8FD0\u884C"),!1;const t=document.body,o={childList:!0,subtree:!0};new MutationObserver(()=>{v(),w(),c(),b()}).observe(t,o),r("\u8FD0\u884C\u53BB\u9664\u64AD\u653E\u4E2D\u7684\u5E7F\u544A\u529F\u80FD\u6210\u529F")}function u(){f("removeADHTMLElement"),T("removePlayerAD")}document.readyState==="loading"?(document.addEventListener("DOMContentLoaded",u),r("YouTube\u53BB\u5E7F\u544A\u811A\u672C\u5373\u5C06\u8C03\u7528:")):(u(),r("YouTube\u53BB\u5E7F\u544A\u811A\u672C\u5FEB\u901F\u8C03\u7528:"));let l=()=>{const e=document.body.querySelector("video.html5-main-video");e&&e.paused&&(console.log("resume video"),e.play())},S=e=>{const t=e.querySelector(".ytd-popup-container > .ytd-popup-container > .ytd-enforcement-message-view-model");if(t){t.parentNode.remove(),console.log("remove popup",t);const n=document.getElementsByTagName("tp-yt-iron-overlay-backdrop");for(var o=(n||[]).length;o--;)n[o].remove();l()}e.tagName.toLowerCase()==="tp-yt-iron-overlay-backdrop"&&(e.remove(),l(),console.log("remove backdrop",e))};new MutationObserver(e=>e.forEach(t=>{t.type==="childList"&&Array.from(t.addedNodes).filter(o=>o.nodeType===1).map(o=>S(o))})).observe(document.body,{childList:!0,subtree:!0})})();
