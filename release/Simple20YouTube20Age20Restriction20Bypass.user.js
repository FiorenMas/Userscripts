// ==UserScript==
// @name            Simple YouTube Age Restriction Bypass
// @icon            https://github.com/zerodytrash/Simple-YouTube-Age-Restriction-Bypass/raw/v2.5.4/src/extension/icon/icon_64.png
// @version         2.5.10
// @author          Zerody (https://github.com/zerodytrash)
// @namespace       https://github.com/zerodytrash/Simple-YouTube-Age-Restriction-Bypass/
// @supportURL      https://github.com/zerodytrash/Simple-YouTube-Age-Restriction-Bypass/issues
// @license         MIT
// @match           https://www.youtube.com/*
// @match           https://www.youtube-nocookie.com/*
// @match           https://m.youtube.com/*
// @match           https://music.youtube.com/*
// @grant           none
// @run-at          document-start
// @compatible      chrome
// @compatible      firefox
// @compatible      opera
// @compatible      edge
// @compatible      safari
// @downloadURL https://raw.githubusercontent.com/FiorenMas/Userscripts/release/release/Simple20YouTube20Age20Restriction20Bypass.user.js
// @updateURL https://raw.githubusercontent.com/FiorenMas/Userscripts/release/release/Simple20YouTube20Age20Restriction20Bypass.meta.js
// ==/UserScript==
(function re(se){if(this!==window&&!se){window.eval("("+re.toString()+")(true);");return}const ce=["AGE_VERIFICATION_REQUIRED","AGE_CHECK_REQUIRED","CONTENT_CHECK_REQUIRED","LOGIN_REQUIRED"],ue=["OK","LIVE_STREAM_OFFLINE"],le="https://youtube-proxy.zerody.one",ae="https://ny.4everproxy.com";let de=!0,fe=!0,pe=!0;const Ee=["Authorization","X-Goog-AuthUser","X-Origin"],me=[32,48,56,68,72,84,88];var a=window[Symbol()]={UNLOCKABLE_PLAYABILITY_STATUSES:ce,VALID_PLAYABILITY_STATUSES:ue,ACCOUNT_PROXY_SERVER_HOST:le,VIDEO_PROXY_SERVER_HOST:ae,ENABLE_UNLOCK_CONFIRMATION_EMBED:de,ENABLE_UNLOCK_NOTIFICATION:fe,SKIP_CONTENT_WARNINGS:pe,GOOGLE_AUTH_HEADER_NAMES:Ee,BLURRED_THUMBNAIL_SQP_LENGTHS:me};function ve(e){return e.host.includes(".googlevideo.com")}function he(e,t){const n=new URLSearchParams(e.search),o=n.get("gcr"),i=n.get("id")===t;return o&&i}const y=window.JSON.parse,Re=window.XMLHttpRequest.prototype.open,g=window.location.host!=="m.youtube.com",k=window.location.host==="music.youtube.com",p=window.location.pathname.indexOf("/embed/")===0,T=window.location.search.includes("unlock_confirmed");class U{constructor(){return Object.assign(new Promise((t,n)=>{this.resolve=t,this.reject=n}),this)}}if(window.trustedTypes&&trustedTypes.createPolicy&&!trustedTypes.defaultPolicy){const e=t=>t;trustedTypes.createPolicy("default",{createHTML:e,createScriptURL:e,createScript:e})}function B(e,t){const n=document.createElement(e);return t&&Object.assign(n,t),n}function v(e){return e!==null&&typeof e=="object"}function V(e,t){var n=[];return t.every(o=>typeof e[o]<"u")&&n.push(e),Object.keys(e).forEach(o=>{e[o]&&typeof e[o]=="object"&&n.push(...V(e[o],t))}),n}function ye(){if(document.readyState==="complete")return Promise.resolve();const e=new U;return window.addEventListener("load",e.resolve,{once:!0}),e}function h(e){return y(JSON.stringify(e))}function l(e){var t;return(t=window.ytcfg)===null||t===void 0?void 0:t.get(e)}function ge(){return l("STS")||(e=>{const t=(e=document.querySelector('script[src*="/base.js"]'))===null||e===void 0?void 0:e.src;if(!t)return;const n=new XMLHttpRequest;return n.open("GET",t,!1),n.send(null),parseInt(n.responseText.match(/signatureTimestamp:([0-9]*)/)[1])})()}function M(){return typeof l("LOGGED_IN")=="boolean"?l("LOGGED_IN"):typeof l("DELEGATED_SESSION_ID")=="string"||parseInt(l("SESSION_INDEX"))>=0}function Se(e){if(window.location.href.includes(e)){var t;const n=new URLSearchParams(window.location.search),o=(t=n.get("t")||n.get("start")||n.get("time_continue"))===null||t===void 0?void 0:t.replace("s","");if(o&&!isNaN(o))return parseInt(o)}return 0}function Ne(e){const t=new URLSearchParams(window.location.search);for(const n in e)t.set(n,e[n]);window.location.search=t}function we(e,t){const n=new U,o=setInterval(()=>{const i=document.querySelector(e);i&&(clearInterval(o),n.resolve(i))},100);return setTimeout(()=>{clearInterval(o),n.reject()},t),n}function G(e){var t;return!(e!=null&&e.contents)||!(e!=null&&(t=e.currentVideoEndpoint)!==null&&t!==void 0&&(t=t.watchEndpoint)!==null&&t!==void 0&&t.videoId)?!1:!!e.contents.twoColumnWatchNextResults||!!e.contents.singleColumnWatchNextResults}function S(e){var t,n;if(g){var o;return!((o=e.contents)===null||o===void 0||(o=o.twoColumnWatchNextResults)===null||o===void 0||(o=o.secondaryResults)===null||o===void 0||(o=o.secondaryResults)===null||o===void 0?void 0:o.results)}const i=(t=e.contents)===null||t===void 0||(t=t.singleColumnWatchNextResults)===null||t===void 0||(t=t.results)===null||t===void 0||(t=t.results)===null||t===void 0?void 0:t.contents;return typeof(i==null||(n=i.find(s=>{var u;return((u=s.itemSectionRenderer)===null||u===void 0?void 0:u.targetId)==="watch-next-feed"}))===null||n===void 0?void 0:n.itemSectionRenderer)!="object"}function Te(e){return e?.videoDetails&&e?.playabilityStatus}function _e(e){return typeof e?.previewPlayabilityStatus=="object"}function H(e){var t;return e!=null&&e.status?e.desktopLegacyAgeGateReason||a.UNLOCKABLE_PLAYABILITY_STATUSES.includes(e.status)?!0:p&&((t=e.errorScreen)===null||t===void 0||(t=t.playerErrorMessageRenderer)===null||t===void 0||(t=t.reason)===null||t===void 0||(t=t.runs)===null||t===void 0||(t=t.find(n=>n.navigationEndpoint))===null||t===void 0||(t=t.navigationEndpoint)===null||t===void 0||(t=t.urlEndpoint)===null||t===void 0||(t=t.url)===null||t===void 0?void 0:t.includes("/2802167")):!1}function Ce(e){var t,n,o;return typeof(e==null||(t=e.contents)===null||t===void 0?void 0:t.twoColumnSearchResultsRenderer)=="object"||(e==null||(n=e.contents)===null||n===void 0||(n=n.sectionListRenderer)===null||n===void 0?void 0:n.targetId)==="search-feed"||(e==null||(o=e.onResponseReceivedCommands)===null||o===void 0||(o=o.find(i=>i.appendContinuationItemsAction))===null||o===void 0||(o=o.appendContinuationItemsAction)===null||o===void 0?void 0:o.targetId)==="search-feed"}function Y(e,t,n){if(!e||typeof e[t]!="function")return;let o=e[t];e[t]=function(){try{n(arguments)}catch{}o.apply(this,arguments)}}const $="%cSimple-YouTube-Age-Restriction-Bypass:",W="background-color: #1e5c85; color: #fff; font-size: 1.2em;",Ie="\u{1F41E} You can report bugs at: https://github.com/zerodytrash/Simple-YouTube-Age-Restriction-Bypass/issues";function f(e,t){console.error($,W,t,e,Oe(),`

`,Ie),window.SYARB_CONFIG&&window.dispatchEvent(new CustomEvent("SYARB_LOG_ERROR",{detail:{message:(t?t+"; ":"")+(e&&e.message?e.message:""),stack:e&&e.stack?e.stack:null}}))}function E(e){console.info($,W,e),window.SYARB_CONFIG&&window.dispatchEvent(new CustomEvent("SYARB_LOG_INFO",{detail:{message:e}}))}function Oe(){try{return`InnertubeConfig: innertubeApiKey: ${l("INNERTUBE_API_KEY")} innertubeClientName: ${l("INNERTUBE_CLIENT_NAME")} innertubeClientVersion: ${l("INNERTUBE_CLIENT_VERSION")} loggedIn: ${l("LOGGED_IN")} `}catch(e){return`Failed to access config: ${e}`}}function Ae(e){xe("playerResponse",(t,n)=>(E(`playerResponse property set, contains sidebar: ${!!t.response}`),v(t.response)&&e(t.response),n.unlocked=!1,e(n),n.unlocked?h(n):n)),window.addEventListener("DOMContentLoaded",()=>{v(window.ytInitialData)&&e(window.ytInitialData)})}function xe(e,t){var n;const o="__SYARB_"+e,{get:i,set:r}=(n=Object.getOwnPropertyDescriptor(Object.prototype,e))!==null&&n!==void 0?n:{set(s){this[o]=s},get(){return this[o]}};Object.defineProperty(Object.prototype,e,{set(s){r.call(this,v(s)?t(this,s):s)},get(){return i.call(this)},configurable:!0})}function be(e){window.JSON.parse=function(){const t=y.apply(this,arguments);return v(t)?e(t):t}}function Pe(e){typeof window.Request=="function"&&(window.Request=new Proxy(window.Request,{construct(t,n){let[o,i]=n;try{if(typeof o=="string"&&(o.indexOf("/")===0&&(o=window.location.origin+o),o.indexOf("https://")!==-1)){const r=e(o,i);r&&(n[0]=r)}}catch(r){f(r,"Failed to intercept Request()")}return Reflect.construct(t,n)}}))}function Le(e){XMLHttpRequest.prototype.open=function(...t){let[n,o]=t;try{if(typeof o=="string"&&(o.indexOf("/")===0&&(o=window.location.origin+o),o.indexOf("https://")!==-1)){const i=e(n,o,this);i&&(t[1]=i)}}catch(i){f(i,"Failed to intercept XMLHttpRequest.open()")}Re.apply(this,t)}}const F="SYARB_";function K(e,t){localStorage.setItem(F+e,JSON.stringify(t))}function ke(e){try{return JSON.parse(localStorage.getItem(F+e))}catch{return null}}function Ue(e,t){return q("v1/player",e,t)}function Be(e,t){return q("v1/next",e,t)}function q(e,t,n){const o=new XMLHttpRequest;return o.open("POST",`/youtubei/${e}?key=${l("INNERTUBE_API_KEY")}&prettyPrint=false`,!1),n&&M()&&(o.withCredentials=!0,a.GOOGLE_AUTH_HEADER_NAMES.forEach(i=>{o.setRequestHeader(i,ke(i))})),o.send(JSON.stringify(t)),y(o.responseText)}var N={getPlayer:Ue,getNext:Be};let w={};function Ve(e){return a.VIDEO_PROXY_SERVER_HOST+"/direct/"+btoa(e.toString())}function Me(e){return!w[e.videoId]&&!k&&!p&&(e.includeNext=1),D("getPlayer",e)}function Ge(e){return w[e.videoId]?w[e.videoId]:D("getNext",e)}function D(e,t){const n=new URLSearchParams(t),o=`${a.ACCOUNT_PROXY_SERVER_HOST}/${e}?${n}&client=js`;try{const i=new XMLHttpRequest;i.open("GET",o,!1),i.send(null);const r=y(i.responseText);return r.proxied=!0,r.nextResponse&&(w[t.videoId]=r.nextResponse,delete r.nextResponse),r}catch(i){return f(i,"Proxy API Error"),{errorMessage:"Proxy Connection failed"}}}var _={getPlayer:Me,getNext:Ge,getGoogleVideoUrl:Ve};function He(e,t){var n;const o=l("INNERTUBE_CLIENT_NAME")||"WEB",i=l("INNERTUBE_CLIENT_VERSION")||"2.20220203.04.00",r=l("HL"),s=(n=l("INNERTUBE_CONTEXT").client.userInterfaceTheme)!==null&&n!==void 0?n:document.documentElement.hasAttribute("dark")?"USER_INTERFACE_THEME_DARK":"USER_INTERFACE_THEME_LIGHT";return[{name:"Content Warning Bypass",skip:!t||!t.includes("CHECK_REQUIRED"),optionalAuth:!0,payload:{context:{client:{clientName:o,clientVersion:i,hl:r,userInterfaceTheme:s}},videoId:e,racyCheckOk:!0,contentCheckOk:!0},endpoint:N},{name:"Account Proxy",payload:{videoId:e,clientName:o,clientVersion:i,hl:r,userInterfaceTheme:s,isEmbed:+p,isConfirmed:+T},endpoint:_}]}function Ye(e,t){const n=l("INNERTUBE_CLIENT_NAME")||"WEB",o=l("INNERTUBE_CLIENT_VERSION")||"2.20220203.04.00",i=ge(),r=Se(e),s=l("HL");return[{name:"Content Warning Bypass",skip:!t||!t.includes("CHECK_REQUIRED"),optionalAuth:!0,payload:{context:{client:{clientName:n,clientVersion:o,hl:s}},playbackContext:{contentPlaybackContext:{signatureTimestamp:i}},videoId:e,startTimeSecs:r,racyCheckOk:!0,contentCheckOk:!0},endpoint:N},{name:"TV Embedded Player",requiresAuth:!1,payload:{context:{client:{clientName:"TVHTML5_SIMPLY_EMBEDDED_PLAYER",clientVersion:"2.0",clientScreen:"WATCH",hl:s},thirdParty:{embedUrl:"https://www.youtube.com/"}},playbackContext:{contentPlaybackContext:{signatureTimestamp:i}},videoId:e,startTimeSecs:r,racyCheckOk:!0,contentCheckOk:!0},endpoint:N},{name:"Creator + Auth",requiresAuth:!0,payload:{context:{client:{clientName:"WEB_CREATOR",clientVersion:"1.20210909.07.00",hl:s}},playbackContext:{contentPlaybackContext:{signatureTimestamp:i}},videoId:e,startTimeSecs:r,racyCheckOk:!0,contentCheckOk:!0},endpoint:N},{name:"Account Proxy",payload:{videoId:e,reason:t,clientName:n,clientVersion:o,signatureTimestamp:i,startTimeSecs:r,hl:s,isEmbed:+p,isConfirmed:+T},endpoint:_}]}var $e=`<div style="margin-top: 15px !important; padding: 3px 10px 3px 10px; margin: 0px auto; background-color: #4d4d4d; width: fit-content; font-size: 1.2em; text-transform: uppercase; border-radius: 3px; cursor: pointer;">
    <div class="button-text"></div>
</div>`;let m={};async function We(e,t,n,o){const i=await we(".ytp-error",2e3),r=B("div",{class:"button-container",innerHTML:$e});r.getElementsByClassName("button-text")[0].innerText=t,typeof o=="function"&&r.addEventListener("click",o),!(m[e]&&m[e].isConnected)&&(m[e]=r,i.append(r))}function Fe(e){m[e]&&m[e].isConnected&&m[e].remove()}const X="confirmButton",Ke="Click to unlock";function qe(){return!T&&p&&a.ENABLE_UNLOCK_CONFIRMATION_EMBED}function De(){We(X,Ke,null,()=>{Fe(X),Xe()})}function Xe(){Ne({unlock_confirmed:1,autoplay:1})}var je=`<tp-yt-paper-toast></tp-yt-paper-toast>
`,Qe=`<c3-toast>
    <ytm-notification-action-renderer>
        <div class="notification-action-response-text"></div>
    </ytm-notification-action-renderer>
</c3-toast>
`;const C=B("div",{id:"toast-container",innerHTML:g?je:Qe}),d=C.querySelector(":scope > *");k&&(d.style["margin-bottom"]="85px"),g||(d.nMessage=d.querySelector(".notification-action-response-text"),d.show=e=>{d.nMessage.innerText=e,d.setAttribute("dir","in"),setTimeout(()=>{d.setAttribute("dir","out")},d.duration+225)});async function Je(e,t=5){a.ENABLE_UNLOCK_NOTIFICATION&&(p||(await ye(),document.visibilityState!=="hidden"&&(C.isConnected||document.documentElement.append(C),d.duration=t*1e3,d.show(e))))}var I={show:Je};const O={success:"Age-restricted video successfully unlocked!",fail:"Unable to unlock this video \u{1F641} - More information in the developer console"};let j=null,Q=null,J,A={};function ze(){var e;return(e=J)===null||e===void 0?void 0:e.get("id")}function z(e){var t,n,o,i,r;if(qe()){E("Unlock confirmation required."),De();return}const s=((t=e.videoDetails)===null||t===void 0?void 0:t.videoId)||l("PLAYER_VARS").video_id,u=((n=e.playabilityStatus)===null||n===void 0?void 0:n.status)||((o=e.previewPlayabilityStatus)===null||o===void 0?void 0:o.status);if(!a.SKIP_CONTENT_WARNINGS&&u.includes("CHECK_REQUIRED")){E(`SKIP_CONTENT_WARNINGS disabled and ${u} status detected.`);return}j=s,Q=u;const c=Ze(s,u);if(c.errorMessage)throw I.show(`${O.fail} (ProxyError)`,10),new Error(`Player Unlock Failed, Proxy Error Message: ${c.errorMessage}`);if(!a.VALID_PLAYABILITY_STATUSES.includes((i=c.playabilityStatus)===null||i===void 0?void 0:i.status)){var R;throw I.show(`${O.fail} (PlayabilityError)`,10),new Error(`Player Unlock Failed, playabilityStatus: ${(R=c.playabilityStatus)===null||R===void 0?void 0:R.status}`)}if(c.proxied&&(r=c.streamingData)!==null&&r!==void 0&&r.adaptiveFormats){var b,P;const oe=(b=c.streamingData.adaptiveFormats.find(L=>L.signatureCipher))===null||b===void 0?void 0:b.signatureCipher,ie=oe?new URLSearchParams(oe).get("url"):(P=c.streamingData.adaptiveFormats.find(L=>L.url))===null||P===void 0?void 0:P.url;J=ie?new URLSearchParams(new window.URL(ie).search):null}e.previewPlayabilityStatus&&(e.previewPlayabilityStatus=c.playabilityStatus),Object.assign(e,c),e.unlocked=!0,I.show(O.success)}function Ze(e,t){if(A.videoId===e)return h(A);const n=Ye(e,t);let o={};return n.every((i,r)=>{var s;if(i.skip||i.requiresAuth&&!M())return!0;E(`Trying Player Unlock Method #${r+1} (${i.name})`);try{o=i.endpoint.getPlayer(i.payload,i.requiresAuth||i.optionalAuth)}catch(R){f(R,`Player Unlock Method ${r+1} failed with exception`)}const u=a.VALID_PLAYABILITY_STATUSES.includes((s=o)===null||s===void 0||(s=s.playabilityStatus)===null||s===void 0?void 0:s.status);if(u){var c;(!o.trackingParams||!((c=o.responseContext)!==null&&c!==void 0&&(c=c.mainAppWebResponseContext)!==null&&c!==void 0&&c.trackingParam))&&(o.trackingParams="CAAQu2kiEwjor8uHyOL_AhWOvd4KHavXCKw=",o.responseContext={mainAppWebResponseContext:{trackingParam:"kx_fmPxhoPZRzgL8kzOwANUdQh8ZwHTREkw2UqmBAwpBYrzRgkuMsNLBwOcCE59TDtslLKPQ-SS"}}),i.payload.startTimeSecs&&i.name==="Account Proxy"&&(o.playerConfig={playbackStartConfig:{startSeconds:i.payload.startTimeSecs}})}return!u}),A={videoId:e,...h(o)},o}let x={};function Z(e){const t=e.currentVideoEndpoint.watchEndpoint.videoId;if(!t)throw new Error("Missing videoId in nextResponse");if(t!==j)return;const n=et(t);if(S(n))throw new Error("Sidebar Unlock Failed");tt(e,n)}function et(e){if(x.videoId===e)return h(x);const t=He(e,Q);let n={};return t.every((o,i)=>{if(o.skip)return!0;E(`Trying Next Unlock Method #${i+1} (${o.name})`);try{n=o.endpoint.getNext(o.payload,o.optionalAuth)}catch(r){f(r,`Next Unlock Method ${i+1} failed with exception`)}return S(n)}),x={videoId:e,...h(n)},n}function tt(e,t){var n;if(g){e.contents.twoColumnWatchNextResults.secondaryResults=t.contents.twoColumnWatchNextResults.secondaryResults;const s=e.contents.twoColumnWatchNextResults.results.results.contents.find(c=>c.videoSecondaryInfoRenderer).videoSecondaryInfoRenderer,u=t.contents.twoColumnWatchNextResults.results.results.contents.find(c=>c.videoSecondaryInfoRenderer).videoSecondaryInfoRenderer;u.description?s.description=u.description:u.attributedDescription&&(s.attributedDescription=u.attributedDescription);return}const o=(n=t.contents)===null||n===void 0||(n=n.singleColumnWatchNextResults)===null||n===void 0||(n=n.results)===null||n===void 0||(n=n.results)===null||n===void 0||(n=n.contents)===null||n===void 0?void 0:n.find(s=>{var u;return((u=s.itemSectionRenderer)===null||u===void 0?void 0:u.targetId)==="watch-next-feed"});o&&e.contents.singleColumnWatchNextResults.results.results.contents.push(o);const i=e.engagementPanels.find(s=>s.engagementPanelSectionListRenderer).engagementPanelSectionListRenderer.content.structuredDescriptionContentRenderer.items.find(s=>s.expandableVideoDescriptionBodyRenderer),r=t.engagementPanels.find(s=>s.engagementPanelSectionListRenderer).engagementPanelSectionListRenderer.content.structuredDescriptionContentRenderer.items.find(s=>s.expandableVideoDescriptionBodyRenderer);r.expandableVideoDescriptionBodyRenderer&&(i.expandableVideoDescriptionBodyRenderer=r.expandableVideoDescriptionBodyRenderer)}function nt(e,t,n){const o=new URL(t);let i=ee(o);if(i)return Object.defineProperty(n,"withCredentials",{set:()=>{},get:()=>!1}),i.toString();o.pathname.indexOf("/youtubei/")===0&&Y(n,"setRequestHeader",([r,s])=>{a.GOOGLE_AUTH_HEADER_NAMES.includes(r)&&K(r,s)}),a.SKIP_CONTENT_WARNINGS&&e==="POST"&&["/youtubei/v1/player","/youtubei/v1/next"].includes(o.pathname)&&Y(n,"send",r=>{typeof r[0]=="string"&&(r[0]=te(r[0]))})}function ot(e,t){const n=new URL(e),o=ee(n);if(o)return t.credentials&&(t.credentials="omit"),o.toString();if(n.pathname.indexOf("/youtubei/")===0&&v(t.headers))for(let i in t.headers)a.GOOGLE_AUTH_HEADER_NAMES.includes(i)&&K(i,t.headers[i]);a.SKIP_CONTENT_WARNINGS&&["/youtubei/v1/player","/youtubei/v1/next"].includes(n.pathname)&&(t.body=te(t.body))}function ee(e){if(a.VIDEO_PROXY_SERVER_HOST&&ve(e)&&he(e,ze()))return _.getGoogleVideoUrl(e)}function te(e){try{let t=JSON.parse(e);if(t.videoId)return t.contentCheckOk=!0,t.racyCheckOk=!0,JSON.stringify(t)}catch{}return e}function it(e){const t=V(e,["url","height"]);let n=0;for(const o of t)rt(o)&&(n++,o.url=o.url.split("?")[0]);E(n+"/"+t.length+" thumbnails detected as blurred.")}function rt(e){if(!(e.url.indexOf("?sqp=")!==-1))return!1;const n=new URL(e.url).searchParams.get("sqp").length;return a.BLURRED_THUMBNAIL_SQP_LENGTHS.includes(n)}try{Ae(ne),be(ne),Le(nt),Pe(ot)}catch(e){f(e,"Error while attaching data interceptors")}function ne(e){try{(Te(e)&&H(e.playabilityStatus)||_e(e)&&H(e.previewPlayabilityStatus))&&z(e)}catch(t){f(t,"Video unlock failed")}try{G(e)&&S(e)&&Z(e),G(e.response)&&S(e.response)&&Z(e.response)}catch(t){f(t,"Sidebar unlock failed")}try{Ce(e)&&it(e)}catch(t){f(t,"Thumbnail unlock failed")}return e}})();
