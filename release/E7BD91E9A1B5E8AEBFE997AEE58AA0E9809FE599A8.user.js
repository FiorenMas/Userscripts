// ==UserScript==
// @name         网页访问加速器
// @name:en      Web Access Accelerator
// @namespace    https://github.com/xxxily
// @version      1.0.0
// @author       ankvps
// @icon         https://lh3.googleusercontent.com/5b2IeKOldW9hxPQaV7oyRfdAgN2V7Ot1bGcpE4QT5Uq4yt7yNtdgh0ABq4NCEwvsDdEU4HWKVXwUjYuem2JyJ_JrSu8=w128-h128-e365-rj-sc0x00ffffff
// @match        *://*/*
// @grant        none
// @license      Apache License 2.0
// @run-at       document-start
// @downloadURL https://raw.githubusercontent.com/FiorenMas/Userscripts/release/release/E7BD91E9A1B5E8AEBFE997AEE58AA0E9809FE599A8.user.js
// @updateURL https://raw.githubusercontent.com/FiorenMas/Userscripts/release/release/E7BD91E9A1B5E8AEBFE997AEE58AA0E9809FE599A8.meta.js
// ==/UserScript==
(function(l){l&&(l.name="quicklink-user-script")})();function e(l){return new Promise(function(m,g,d){(d=new XMLHttpRequest).open("GET",l,d.withCredentials=!0),d.onload=function(){d.status===200?m():g()},d.send()})}var n,r=(n=document.createElement("link")).relList&&n.relList.supports&&n.relList.supports("prefetch")?function(l){return new Promise(function(m,g,d){(d=document.createElement("link")).rel="prefetch",d.href=l,d.onload=m,d.onerror=g,document.head.appendChild(d)})}:e,t=window.requestIdleCallback||function(l){var m=Date.now();return setTimeout(function(){l({didTimeout:!1,timeRemaining:function(){return Math.max(0,50-(Date.now()-m))}})},1)},o=new Set,i=new Set,c=!1;function a(l){if(l){if(l.saveData)return new Error("Save-Data is enabled");if(/2g/.test(l.effectiveType))return new Error("network conditions are poor")}return!0}function u(l){if(l||(l={}),window.IntersectionObserver){var m=function(E){E=E||1;var p=[],w=0;function h(){w<E&&p.length>0&&(p.shift()(),w++)}return[function(P){p.push(P)>1||h()},function(){w--,h()}]}(l.throttle||1/0),g=m[0],d=m[1],b=l.limit||1/0,v=l.origins||[location.hostname],y=l.ignores||[],j=l.delay||0,k=[],L=l.timeoutFn||t,x=typeof l.hrefFn=="function"&&l.hrefFn,q=l.prerender||!1;c=l.prerenderAndPrefetch||!1;var S=new IntersectionObserver(function(E){E.forEach(function(p){if(p.isIntersecting)k.push((p=p.target).href),function(h,P){P?setTimeout(h,P):h()}(function(){k.indexOf(p.href)!==-1&&(S.unobserve(p),(c||q)&&i.size<1?f(x?x(p):p.href).catch(function(h){if(!l.onError)throw h;l.onError(h)}):o.size<b&&!q&&g(function(){s(x?x(p):p.href,l.priority).then(d).catch(function(h){d(),l.onError&&l.onError(h)})}))},j);else{var w=k.indexOf((p=p.target).href);w>-1&&k.splice(w)}})},{threshold:l.threshold||0});return L(function(){(l.el||document).querySelectorAll("a").forEach(function(E){v.length&&!v.includes(E.hostname)||function p(w,h){return Array.isArray(h)?h.some(function(P){return p(w,P)}):(h.test||h).call(h,w.href,w)}(E,y)||S.observe(E)})},{timeout:l.timeout||2e3}),function(){o.clear(),S.disconnect()}}}function s(l,m,g){var d=a(navigator.connection);return d instanceof Error?Promise.reject(new Error("Cannot prefetch, "+d.message)):(i.size>0&&!c&&console.warn("[Warning] You are using both prefetching and prerendering on the same document"),Promise.all([].concat(l).map(function(b){if(!o.has(b))return o.add(b),(m?function(v){return window.fetch?fetch(v,{credentials:"include"}):e(v)}:r)(new URL(b,location.href).toString())})))}function f(l,m){var g=a(navigator.connection);if(g instanceof Error)return Promise.reject(new Error("Cannot prerender, "+g.message));if(!HTMLScriptElement.supports("speculationrules"))return s(l),Promise.reject(new Error("This browser does not support the speculation rules API. Falling back to prefetch."));if(document.querySelector('script[type="speculationrules"]'))return Promise.reject(new Error("Speculation Rules is already defined and cannot be altered."));for(var d=0,b=[].concat(l);d<b.length;d+=1){var v=b[d];if(window.location.origin!==new URL(v,window.location.href).origin)return Promise.reject(new Error("Only same origin URLs are allowed: "+v));i.add(v)}o.size>0&&!c&&console.warn("[Warning] You are using both prefetching and prerendering on the same document");var y=function(j){var k=document.createElement("script");k.type="speculationrules",k.text='{"prerender":[{"source": "list","urls": ["'+Array.from(j).join('","')+'"]}]}';try{document.head.appendChild(k)}catch(L){return L}return!0}(i);return y===!0?Promise.resolve():Promise.reject(y)}const console$1=window.console,quicklink={listen:u,prefetch:s,prerender:f},ignoresRules={urlPaths:"api, logout, signout, exit, quit, login, logoff, subscribe, subscription, doubleclick, bit.ly, signin, signup, apk, release, amazon, google, shopping, checkout, shop, cart, ads, ticket, captcha",fileExtensions:".zip, .pdf, .mp4, .webm, .mp3, .mov, .rar, .apk, .tar, .doc, .docx, .xls, .xlsx, .ppt, .pptx",urlProtocols:"http:, tel:, mailto:, javascript:, market:"};Object.keys(ignoresRules).forEach(l=>{const m=ignoresRules[l].split(",");ignoresRules[l]=m.map(g=>g.trim())});function ignoreFunc(l,m){const g=ignoresRules.urlPaths.some(d=>l.includes(`/${d}/`))||ignoresRules.fileExtensions.some(d=>l.includes(d))||ignoresRules.urlProtocols.some(d=>l.startsWith(d));return g&&console$1.log("[Quicklink][Ignore]",l),g}window.addEventListener("load",()=>{quicklink.listen({ignores:[ignoreFunc]})});
