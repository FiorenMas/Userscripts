// ==UserScript==
// @name               跟踪链接净化
// @name:en            Clean Tracking URLs
// @namespace          https://github.com/cilxe/JavaScriptProjects
// @author             cilxe
// @version            0.7.8
// @match              *://*/*
// @exclude            /^https?:\/\/([a-z0-9-.]{0,52})(hdslb.com|csdnimg.cn)\/.*$/
// @run-at             document-start
// @grant              GM_registerMenuCommand
// @grant              GM_getValue
// @grant              GM_setValue
// @icon               data:image/png;base64,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
// @license            MIT
// @downloadURL https://raw.githubusercontent.com/FiorenMas/Userscripts/release/release/E8B79FE8B8AAE993BEE68EA5E58780E58C96.user.js
// @updateURL https://raw.githubusercontent.com/FiorenMas/Userscripts/release/release/E8B79FE8B8AAE993BEE68EA5E58780E58C96.meta.js
// ==/UserScript==
(()=>{const _={fast:600,normal:1e3,slow:3e3},o=document,c=window.location.hostname,C=window.location.href,L=window.location.pathname;let k=0,q=!1;const T=/[a-z0-9-]{1,128}\.[a-z]{2,15}$/,j="^(spm|from_|ref_|track|trk|share_|embeds_|refer_)|_from$|scm|referrer";let g=new RegExp(j);const m=["spm","mkt","src","from","source","alias","vd_source","brand","curator_clanid","snr","redir","sprefix","utm_id","utm_content","utm_source","utm_medium","utm_sources","utm_term","utm_campaign","utm_referrer","utm_keyword","ref","feature"],b=["vd_source","hotRank","launch_id","popular_rank","session_id","business","sort_field","is_room_feed","visit_id","is_live_full_webview","is_live_webview","vt","theme","noReffer","timestamp","unique_k","hasBack","noTitleBar","plat_id","is_preview","buvid","up_id","is_story_h5","hybrid_set_header","lottery_id","seid","-Abrowser","from","pagefrom","schema","preUrl","jumpLinkType","referfrom","spm_id","plat_id","p2p_type","broadcast_type","event_source_type"],A=/^(utm_|share_|spm|from_)|(From|_from|source)$/,v=["rsv_idx","hisfilter","rsf","rsv_pq","rsv_t","qid","rsv_dl","oq","gpc","usm","tfflag","bs","rqlang","tn","sc_us","wfr","fenlei","platform","rqid","base_query","entry","qbl","for","from","topic_pn","rsp","rs_src","f","rsv_page","dyTabStr","ct","lm","site","sites","fr","cl","bsst","lid","rsv_spt","rsv_bp","src","sfrom","refer","zp_fr","channel","p_from","n_type","eqid","_at_","sa","pd","source","tag_key","uname","uid","fromModule","lemmaFrom","structureId","structureClickId","ie","structureItemId","xzhid","rsv_enter","rsv_btype","prefixsug","client_type","task","locate","page","type","is_new_user","frwh","obj_id","fid","fname","_t","topic_name","frs","share_from","tpl","u","tb_mod","tb_fr","share","sfc","idfrom","client_version","st","qq-pf-to","unique","is_video","_wkts_","ai","ck","shh","utm_source","utm_medium","utm_term","utm_campaign","utm_content","utm_id"],G=["rsv_idx","hisfilter","source","aid","enter_from","focus_method","previous_page","extra_params","gid","enter_method","is_from_webapp","sender_device","web_id"],M=m.concat(["ops_request_misc","request_id","biz_id","ydreferer","usp"]),F=["spm","scm","from","s","playMode","client_id"],Y="(alibaba|alibabagroup|aliyun|alimama|aliexpress|taobao|tmall|1688|jiyoujia|fliggy).(com|hk|cn)$|(lazada|trendyol).[a-z.]{2,15}$",$=new RegExp(Y),x=["spm","acm","scm","scene","from","pvid","pvid2"],V="^(utm_|spm_|from_|ref|track|wh_|wx_)",R=new RegExp(V),X=["content-id","qid","crid","isAmazonFulfilled","sbo","plattr","sprefix","ld","_encoding","ie","ds"],H="_ref|^(utm_|ref|pd_rd_|pf_rd_|track|sc_)",D=new RegExp(H,"i"),B=m.concat(["embeds_referring_euri","embeds_euri","source_ve_path","feature","embeds_referring_origin","redir_token","pp","origin","ab_channel","enablejsapi","widgetid"]),K=!0;(()=>{const a=window.history.pushState,t=window.history.replaceState;window.history.pushState=function(...n){const r=a.apply(this,n);return window.dispatchEvent(new Event("pushstate")),window.dispatchEvent(new Event("urlchange")),r},window.history.replaceState=function(...n){const r=t.apply(this,n);return window.dispatchEvent(new Event("replacestate")),window.dispatchEvent(new Event("urlchange")),r}})();function y(a){const t=new URL(window.location.href),i=t.searchParams;a.forEach(n=>{i.has(n)&&i.delete(n)}),Array.from(i.keys()).forEach(n=>{g.test(n)&&i.delete(n)}),t.href!==window.location.href&&window.history.replaceState({},"Restore",t.href)}let u;switch(!0){case $.test(c):u=a=>{const t=o.getElementsByTagName("a");for(let n=0;n<t.length;n+=1)if(T.test(t[n].hostname)){const r=new URL(t[n].href),s=r.searchParams;s.has("q")&&s.set("q",t[n].innerText),a.forEach(e=>{s.has(e)&&s.delete(e)}),Array.from(s.keys()).forEach(e=>{R.test(e)&&s.delete(e)}),t[n].href!==r.href&&(t[n].href=r.href)}const i=o.getElementsByTagName("area");for(let n=0;n<i.length;n+=1)if(T.test(i[n].hostname)){const r=new URL(i[n].href),s=r.searchParams;s.has("q")&&s.set("q",i[n].innerText),a.forEach(e=>{s.has(e)&&s.delete(e)}),Array.from(s.keys()).forEach(e=>{R.test(e)&&s.delete(e)}),i[n].href!==r.href&&(i[n].href=r.href)}};break;case/baidu.com$/.test(c):u=a=>{const t=o.getElementsByTagName("a");for(let i=0;i<t.length;i+=1)if(T.test(t[i].hostname)){const n=new URL(t[i].href),r=n.searchParams;t[i].hostname==="passport.baidu.com"&&a.includes("u")&&a.splice(a.indexOf("u"),1),t[i].innerText==="\u5E94\u7528\u4E2D\u5FC3"&&r.set("kw",t[i].innerText),a.forEach(s=>{r.has(s)&&r.delete(s)}),n.href!==t[i].href&&(t[i].href=n.href)}};break;case/(bilibili|biligame)\.com$/.test(c):u=a=>{const t=o.getElementsByTagName("a");for(let i=0;i<t.length;i+=1){if(T.test(t[i].hostname)){t[i].removeAttribute("data-mod"),t[i].removeAttribute("data-spmid"),t[i].removeAttribute("data-idx"),t[i].removeAttribute("data-target-url");const r=new URL(t[i].href),s=r.searchParams;a.forEach(e=>{s.has(e)&&s.delete(e)}),Array.from(s.keys()).forEach(e=>{A.test(e)&&s.delete(e)}),t[i].href!==r.href&&(t[i].href=r.href)}const n=t[i].getAttribute("data-url");if(/^(https?:\/\/|\/\/)[a-zA-Z0-9-.]{1,128}\.[a-z]{2,15}/.test(n)){let r;n.startsWith("//")?r=new URL(`https:${n}`):r=new URL(n);const s=r.searchParams;if(r.hostname.endsWith("bilibili.com"))Array.from(s.keys()).forEach(e=>{A.test(e)&&s.delete(e)}),a.forEach(e=>{s.has(e)&&s.delete(e)});else{const e=g;Array.from(s.keys()).forEach(l=>{e.test(l)&&s.delete(l)}),m.forEach(l=>{s.has(l)&&s.delete(l)})}t[i].href=r.href,t[i].classList.remove("jump-link"),t[i].target="_blank",t[i].innerText.startsWith(r.href)&&(t[i].innerText=r.href)}}};break;case/amazon\.[a-z.]{2,15}$/.test(c):u=a=>{const t=o.getElementsByTagName("a");for(let i=0;i<t.length;i+=1){if(T.test(t[i].hostname)){const n=new URL(t[i].href),r=n.searchParams;a.forEach(s=>{r.has(s)&&r.delete(s)}),Array.from(r.keys()).forEach(s=>{D.test(s)&&r.delete(s)}),t[i].href!==n.href&&(t[i].href=n.href)}/amazon\.[a-z.]{2,15}$/.test(t[i].hostname)&&t[i].pathname.includes("/ref")&&(t[i].pathname=t[i].pathname.substring(t[i].pathname.indexOf("/ref"),1))}};break;case/google\.[a-z.]{2,15}$|about.google$/.test(c):u=a=>{const t=o.getElementsByTagName("a"),i=g;for(let n=0;n<t.length;n+=1)if(T.test(t[n].hostname)){const r=new URL(t[n].href),s=r.searchParams;if(a.forEach(e=>{s.has(e)&&s.delete(e)}),Array.from(s.keys()).forEach(e=>{i.test(e)&&s.delete(e)}),t[n].href!==r.href&&(t[n].href=r.href),/utm_/.test(r.hash)){const e=r.hash.substring(1).split("&");e.forEach((l,p)=>{/^utm_/.test(l)&&e.splice(p,8)}),t[n].hash=`#${e.toString().replaceAll(",","&")}`}}};break;default:u=a=>{const t=o.getElementsByTagName("a"),i=g;for(let n=0;n<t.length;n+=1)if(T.test(t[n].hostname)){const r=new URL(t[n].href),s=r.searchParams;a.forEach(e=>{s.has(e)&&s.delete(e)}),Array.from(s.keys()).forEach(e=>{i.test(e)&&s.delete(e)}),t[n].href!==r.href&&(t[n].href=r.href)}};break}function E(a,t){const i=setTimeout(()=>{y(a),u(a),clearTimeout(i)},t)}function I(a,t){const i=setTimeout(()=>{const n=()=>{u(a)},r=d=>{d.stopImmediatePropagation(),u(a)},s=()=>{E(a,0)},e=o.getElementsByTagName("div");for(let d=0;d<e.length;d+=1)e[d].className&&(e[d].removeEventListener("click",s),e[d].addEventListener("click",s),e[d].removeEventListener("auxclick",r),e[d].addEventListener("auxclick",r),e[d].removeEventListener("mousedown",n),e[d].addEventListener("mousedown",n),e[d].removeEventListener("keydown",n),e[d].addEventListener("keydown",n));const l=o.getElementsByTagName("button");for(let d=0;d<l.length;d+=1)l[d].className&&(l[d].removeEventListener("click",s),l[d].addEventListener("click",s));const p=o.getElementsByTagName("a");for(let d=0;d<p.length;d+=1)T.test(p[d].hostname)&&(p[d].removeEventListener("keyup",r),p[d].addEventListener("keyup",r),p[d].removeEventListener("click",n),p[d].addEventListener("click",n),p[d].removeEventListener("auxclick",n),p[d].addEventListener("auxclick",n),p[d].removeEventListener("contextmenu",r),p[d].ontouchstart===void 0&&p[d].addEventListener("contextmenu",r));clearTimeout(i)},t)}function W(a){y(a),u(a);let t=0,i=0;o.addEventListener("pointermove",n=>{(Math.abs(n.clientX-t)>20||Math.abs(n.clientY-i)>20)&&(u(a),t=n.clientX,i=n.clientY)}),o.addEventListener("DOMContentLoaded",()=>{I(a,0)})}function J(a,t,i,n){const r=setInterval(()=>{a.forEach(s=>{document.querySelector(s)&&(n?document.querySelector(s).remove():document.querySelector(s).style.visibility="hidden")})},t);document.addEventListener("DOMContentLoaded",()=>{const s=setTimeout(()=>{clearInterval(r),clearTimeout(s)},i)})}function ue(a,t,i,n){const r=setInterval(()=>{a.forEach(s=>{const e=document.querySelectorAll(s)[t];e&&e.click()})},i);document.addEventListener("DOMContentLoaded",()=>{const s=setTimeout(()=>{clearInterval(r),clearTimeout(s)},n)})}function O(a,t,i,n){o.addEventListener("DOMContentLoaded",()=>{const r=new MutationObserver(s=>{s.forEach(e=>{e.addedNodes.forEach(l=>{document.querySelector(a)&&l.querySelector(t)&&!q&&(console.info("Auto Cloesd!"),l.querySelector(t).click())})})});if(r.observe(o,{childList:!0,subtree:!0}),q){const s=setTimeout(()=>{i.addEventListener("click",()=>{q=!0,r.disconnect()}),clearTimeout(s)},_.normal*2)}else{const s=setTimeout(()=>{q=!0,r.disconnect(),clearTimeout(s)},n)}})}function Z(){switch(!0){case/google\.[a-z.]{2,15}$|(about|wellbeing).google/.test(c):m.push("device","pcampaignid","subid","hl","fg","ved","ei","prev","sig","sca_esv","visit_id","dest_src");break;case c.endsWith("facebook.com"):m.push("privacy_mutation_token","ars","helpref","search_session_id","entry_point","campaign_id","nav_source","placement","privacy_source","__cft__[0]","__tn__");break;case/(twitter|x)\.com$/.test(c):m.push("screen_name");break;case c.endsWith("reddit.com"):m.push("embed_host_url","actionSource","shreddit"),g=/^(utm_|spm_|from_|ref|track|trk|experiment_d2x_|experiment_mweb)/;break;case c.endsWith("linkedin.com"):m.push("original_referer","origin","upsellOrderOrigin","lipi","desktopBackground","profileFormEntryPoint","entityUrn","veh","miniCompanyUrn","courseSlug","upsellTrk","upsellTrackingId","contextUrn","ct","pt","refId","position"),document.addEventListener("DOMContentLoaded",()=>{I(m,8500),E(m,_.normal*2)});break;case c.endsWith("dzen.ru"):m.push("lang","country_code","rid","clid","stid","issue_tld","parent_rid","persistent_id","story","t","utr","place","secdata","integration","feed_exp","force_common_feed","feed_filter_type","feed_filter_source");break;case c.endsWith("vk.com"):m.push("scheme","initial_stats_info");break;case/(microsoft|bing|xbox|skype|office|microsoft365)\.com$/.test(c):m.push("ocid","OCID","ICID","icid","CLCID","clcid","es","response_mode","exp","form","FORM","xr","cat0","culture","country","WT.mc_id","uiflavor","activetab","fl","client_id","wreply","cobrandid","deeplink","referrer","mode","pos");break;case/msn.(com|cn)$/.test(c):m.push("ocid","cvid","ei",".cn","fullscreen");break;case/bestbuy\.(com|ca)$/.test(c):m.push("id","ar","cmp","loc","irgwc","mpid","irclickid","intlreferer","intl","browsedCategory","qp","type","usc","iht","ks","sc","_dyncharset","icmp"),g=/^(utm_|nrtv_|subId)/;break;case c.endsWith("github.com"):m.push("ref_cta","ref_loc","ref_page");break;case c.endsWith("stackoverflow.com"):g=/^(utm_|spm_|from_|ref|track|trk|so_)/;break;case c.endsWith("pixiv.net"):m.push("provider");break;case c.endsWith("music.apple.com"):m.push("at","ct","itscg","itsct");break;case c.endsWith("zhihu.com"):m.push("search_source","hybrid_search_source","hybrid_search_extra","utm_psn"),O(".Modal-content",".Modal-closeButton",o.querySelector(".AppHeader-profile button"),2e3);break;case/(163|126|yeah)\.(com|net)$/.test(c):m.push("scene","session_id","fromDlpro","dltype");break;case c.endsWith("weibo.com"):m.push("mark_id","entry","_rand","sudaref","refer","band_rank","gid","ua");break;case c.endsWith("qq.com"):m.push("ADTAG","fromSource");break;case/ebay\.[a-z.]{2,15}$/.test(c):m.push("_trkparms","_trksid","ssPageName","amdata","mc","hash","epid","var","_ssn","store_name","requested","itmprp","itmmeta");break;case c.endsWith("jd.com"):m.splice(m.indexOf("utm_campaign"),1),m.push("gx","ad_od","needRecommendFlag","uabt","d","_fd","pvid","jxsid","csid","ss_projid","scan_orig","ss_expid","ss_sexpid","ss_ruleid","ss_sruleid","ss_symbol","ss_mtest","sceneval"),g=/^(track|wxa_|spm_|from_)/;break;case c.endsWith("yangkeduo.com"):m.push("gx","ad_od","needRecommendFlag","uabt","d","pxq_secret_key","cpsSignjb_act","launch_pdd","customParameters","duoduo_type","goods_sign"),g=/^(track|from_|utm_|_oak_|_wv|_x_)/;break;case/(hoyolab|hoyoverse|mihoyo|miyoushe|mihoyogift)\.com$/.test(c):m.push("game_version","visit_device","device_type","plat_type"),g=/^(track|utm|spm_|from_|hyl_|bbs_|mhy_)|_from$/,(()=>{const t=document.createElement("style");t.innerText+="body{overflow: auto !important}",o.addEventListener("DOMContentLoaded",()=>{document.head.append(t)})})(),W(m);break;case c.endsWith("douban.com"):m.push("target_user_id","dcs","dcm","dt_time_source","channel","fullscreen","autorotate","hidenav");break;case/(imdb|boxofficemojo)\.com$/.test(c):m.push("rf","imdbPageAction","u","tag"),g=D;break;case c.endsWith("gitee.com"):(()=>{const t=setInterval(()=>{o.querySelector(".menu.transition.visible")&&(o.querySelector(".menu.transition.visible").style="display: none !important;")},50);document.addEventListener("DOMContentLoaded",()=>{const i=setTimeout(()=>{clearInterval(t),clearTimeout(i)},3e3)})})();break;case c.endsWith("xda-developers.com"):m.push("tag","ascsubtag","asc_refurl","asc_campaign","newsletter_popup");break;case c.endsWith("cctv.com"):m.push("toc_style_id");break;case c.endsWith("fiverr.com"):m.push("pckg_id","funnel","context_type","context_alg","imp_id","pos","seller_online","context");break;case c.endsWith("newegg.com"):m.push("cm_sp","nextpage");break;case c.endsWith("theverge.com"):m.push("u1","tag","ascsubtag","subId1","subId2","subId3");break;case c.endsWith("bluestacks.com"):m.push("platform","client_uuid","app_pkg","platform_cloud","preferred_lang","gaCookie","gclid","clickid","msclkid","affiliateId","offerId","transaction_id","aff_sub","first_landing_page","user_id","incompatible","bluestacks_version","referrer","download_page_referrer"),g=/^device_|(_version|utm_campaign)$/;break;case c.endsWith("xiaohongshu.com"):O(".login-container",".close-button",o.querySelector(".login-btn"),3700);break;case c.endsWith("nicovideo.jp"):m.push("cmnhd_ref","device","site","pos");break;default:break}const a=m;return y(a),u(a),document.addEventListener("DOMContentLoaded",()=>{I(a,1200),E(a,1e3),E(a,7e3)}),window.onscroll=()=>{const t=o.documentElement.scrollTop;t-k>120&&(u(a),k=t)},a}function Q(){const a=o.getElementsByTagName("meta");for(let t=0;t<a.length;t+=1)a[t].name==="spm_prefix"&&a[t].remove()}function z(a){const t=setTimeout(()=>{let i=0;do{const s=o.getElementsByTagName("a");for(let e=0;e<s.length;e+=1)s[e].hostname.endsWith("cm.bilibili.com")&&s[e].parentNode.removeChild(s[e]);i+=1}while(i<2);const n=o.getElementsByClassName("bili-video-card");for(let s=0;s<n.length;s+=1)n[s].getAttribute("data-report").includes("tianma.")&&n[s].setAttribute("data-report","0");const r=o.getElementsByClassName("right-entry-item")||o.getElementsByClassName("item");if(r[0]&&r[0].innerText.includes("\u767B\u5F55")){J([".lt-row",".bili-login-card",".bili-mini-mask",".is-bottom",".v-popover-content",".unlogin-popover"],30,6e3,!1);const s=r[0].getElementsByTagName("span")[0];/登录/.test(r[0].innerText)&&s&&(s.outerHTML='<a href="https://passport.bilibili.com/login" target="_blank" onmouseup="cleanLinks(bilibiliParams)">\u767B\u5F55</a>')}clearTimeout(t),o.getElementById("right-bottom-banner").remove()},a)}function P(){const a=e=>{e.stopImmediatePropagation()};function t(){const e=o.getElementsByTagName("a");for(let l=0;l<e.length;l+=1)if(e[l].getAttribute("data-video-time")===null&&T.test(e[l].hostname)){const p=e[l].classList.contains("jump-link"),d=e[l].classList.contains("video-time")||e[l].classList.contains("video");p&&d||(c.endsWith("bilibili.com")&&(e[l].removeEventListener("click",a),e[l].addEventListener("click",a)),e[l].removeEventListener("contextmenu",a),e[l].ontouchstart===void 0&&e[l].addEventListener("contextmenu",a),e[l].removeEventListener("pointerdown",a),e[l].addEventListener("pointerdown",a))}}t();function i(e){const l=setTimeout(()=>{u(b),z(0),t(),clearTimeout(l)},e)}const n=()=>{i(_.fast)},r=o.getElementsByTagName("button");for(let e=0;e<r.length;e+=1)r[e].className&&(r[e].removeEventListener("click",n),r[e].addEventListener("click",n));const s=o.getElementsByTagName("li");for(let e=0;e<s.length;e+=1)s[e].className&&!s[e].classList.contains("context-sub-menu-item")&&(s[e].removeEventListener("click",n),s[e].addEventListener("click",n));C.startsWith("https://live.bilibili.com/blackboard/dropdown")&&document.addEventListener("DOMContentLoaded",()=>{document.addEventListener("click",e=>{e.stopPropagation()},!0)})}function N(a){y(b);const t=setTimeout(()=>{P(),clearTimeout(t)},a)}function ee(){let a=0,t=0;/live.bilibili.com$/.test(c)||/^https?:\/\/(www|m).bilibili\.com\/(video|bangumi)/.test(C)?window.onpointermove=i=>{i.clientY<200&&(u(b),P())}:window.onpointermove=i=>{(Math.abs(i.clientX-a)>20||Math.abs(i.clientY-t)>20)&&(u(b),P(),a=i.clientX,t=i.clientY)}}function te(){window.onscroll=()=>{const a=o.documentElement.scrollTop;a-k>120&&(u(b),z(0),P(),k=a)}}function se(){function a(){const i=o.getElementsByClassName("suggest-item"),n=()=>{N(_.fast)};if(i)for(let e=0;e<i.length;e+=1)i[e].addEventListener("click",n,!0);const r=o.getElementsByClassName("trending-item");if(r)for(let e=0;e<r.length;e+=1)r[e].addEventListener("click",n,!0);const s=o.getElementsByClassName("history-item");if(s)for(let e=0;e<s.length;e+=1)s[e].addEventListener("click",n,!0)}const t=()=>{const i=setTimeout(()=>{a(),clearTimeout(i)},_.fast)};o.querySelector(".search-input-el")&&o.querySelector(".search-input-el").addEventListener("click",t,!0),o.querySelector(".clear-icon")&&o.querySelector(".clear-icon").addEventListener("click",t,!0)}function ie(){se();const a=o.getElementsByClassName("vui_pagenation--btn");if(a)for(let t=0;t<a.length;t+=1)a[t].addEventListener("click",()=>{N(_.fast)},!0);N(_.normal),E(b,_.slow-600)}function ne(){u(b),o.addEventListener("DOMContentLoaded",()=>{o.querySelector(".rec-footer")&&o.querySelector(".rec-footer").addEventListener("click",()=>{E(b,_.fast),N(b,_.fast)},!0);let a,t,i;/^\/video\//.test(L)?(a="#arc_toolbar_report",i="share-btn-outer",t="share-btn-inner"):/^\/bangumi\//.test(L)&&(a=".toolbar",i="share-container-id",t="link_copy");let n;const r=new URL(window.location.href),s=()=>{navigator.clipboard.writeText(C)};o.querySelector(a)&&o.querySelector(a).addEventListener("pointermove",()=>{o.getElementById(i)&&(o.getElementById(i).removeEventListener("click",s),o.getElementById(i).addEventListener("click",s),o.getElementById(t).addEventListener("click",e=>{e.stopImmediatePropagation(),o.getElementById(t).innerText.includes("\u7CBE\u51C6")?(L.indexOf("/video/")===0?n=o.querySelector("video")||o.querySelector("bwp-video"):L.indexOf("/bangumi/")===0&&(n=o.getElementsByTagName("video")[1]||o.querySelector("bwp-video")),r.searchParams.set("t",n.currentTime.toFixed(2)),navigator.clipboard.writeText(r.toString())):navigator.clipboard.writeText(C)}))})})}function ae(a){const t=s=>{s&&o.getElementById("anchor-guest-box-id")?o.getElementById("anchor-guest-box-id").style.display="none":s||(o.getElementById("anchor-guest-box-id").style.display="");const e=o.getElementsByTagName("iframe");for(let l=0;l<e.length;l+=1)e[l].src.includes("live-lottery")&&(s?e[l].style.visibility="hidden":e[l].style.visibility="")},i=setTimeout(()=>{const s=o.getElementsByClassName("tabs__tag-item");if(s)for(let l=0;l<s.length;l+=1)s[l].addEventListener("click",()=>{E(b,_.fast)},!0);const e=o.getElementsByClassName("tab-item");if(e)for(let l=0;l<e.length;l+=1)e[l].addEventListener("click",()=>{P(),E(b,_.fast)},!0);clearTimeout(i)},a),n=setInterval(t(K),_.normal*2),r=setTimeout(()=>{clearInterval(n),clearTimeout(r)},_.slow+3e3*300)}function re(){c.endsWith("news.baidu.com")&&v.push("toc_style_id","share_to","track_id"),y(v);function a(){const s=document.getElementsByClassName("EC_result");if(s)for(let e=0;e<s.length;e+=1)s[e].remove()}c.endsWith("tieba.baidu.com")&&v.includes("ie")&&v.splice(v.indexOf("ie"),1);function t(s){u(v);const e=o.getElementsByTagName("a");for(let l=0;l<e.length;l+=1)T.test(e[l].hostname)&&(e[l].hostname.endsWith("zhidao.baidu.com")&&e[l].pathname==="/q"&&(e[l].pathname="/search"),e[l].href=e[l].href.replace("from=",""));if(o.querySelector("area")){const l=new URL(o.querySelector("area").href),p=l.searchParams;s.forEach(d=>{p.has(d)&&p.delete(d)}),o.querySelector("area").href=l.href}}function i(){o.addEventListener("DOMContentLoaded",()=>{const s=o.getElementsByTagName("a");for(let e=0;e<s.length;e+=1)s[e].href!==""&&s[e].addEventListener("click",()=>{t(v)},!0)})}t(v),i(),L==="/s"&&a(),window.onscroll=()=>{const s=o.documentElement.scrollTop;s-k>120&&(u(v),k=s),L==="/s"&&a()};let n=0,r=0;window.onpointermove=s=>{(Math.abs(s.clientX-n)>20||Math.abs(s.clientY-r)>20)&&(u(v),n=s.clientX,r=s.clientY)}}function oe(){y(M),E(M,_.normal);function a(){const t=o.getElementsByTagName("a");for(let i=0;i<t.length;i+=1)t[i].hostname&&t[i].addEventListener("click",n=>{n.stopImmediatePropagation()})}window.onpointermove=t=>{(t.clientY<170||t.clientY>450)&&(u(M),a())},window.onscroll=()=>{const t=o.documentElement.scrollTop;t-k>120&&(u(M),a(),k=t)}}function ce(){switch(!0){case/(taobao|tmall).(com|hk)$/.test(c):x.push("scm2","stats_click","initiative_id","source","suggest","suggest_query","iconType","traceId","relationId","union_lens","ref","ali_trackid","ak","detailSharePosition","topOfferIds","sp_abtk","search_condition","industryCatId","tbSocialPopKey","bxsign","utparam","eurl","itemIds","country","epid","user_number_id","rootPageId","lwfrom","disableNav","es","rand","_lgt_","x5referer","status_bar_transparent","tracelog");break;case c.endsWith("fliggy.com"):x.push("ad_id","am_id","cm_id","pm_id","_k");break;case c.endsWith("1688.com"):x.push("scm2","topOfferIds","__pageId__","resourceId","offerId","offerIds","object_id","udsPoolId","resultType","cms_id","pha_html","__existtitle__","object_type","delivery_pool_id","delivery_pool_type","ilike_session","tracelog","clickid","sessionid","cosite","_p_isad","exp","rootPageId","lwfrom","disableNav","es","hpageId");break;case/(lazada|trendyol).[a-z.]{2-10}/.test(c):x.push("shareUniqueId","clickTrackInfo","data_prefetch","at_iframe","prefetch_replace","wc");break;default:break}y(x),E(x,_.slow),o.addEventListener("DOMContentLoaded",()=>{I(x,_.fast)}),window.onscroll=()=>{const a=o.documentElement.scrollTop;a-k>120&&(u(x),I(x,0),k=a)}}function le(){function a(t){setTimeout(()=>{const i=document.getElementsByClassName("yt-core-attributed-string--link-inherit-color");for(let n=0;n<i.length;n+=1)i[n].addEventListener("click",r=>{r.stopPropagation()},!0)},t)}y(B),u(B),o.addEventListener("DOMContentLoaded",()=>{E(B,_.slow),I(B,0),a(_.normal*2)}),o.addEventListener("contextmenu",()=>{u(B),L==="/results"&&o.addEventListener("pointerenter",i=>{i.stopPropagation(),u(B)},!0),window.onscroll=()=>{const i=o.documentElement.scrollTop;i-k>120&&(u(B),a(0),k=i)};const t=new URL("https://youtube.com/watch");if(new URL(C).searchParams.has("list")&&t.searchParams.set("list",new URL(C).searchParams.get("list")),L.startsWith("/watch")){t.searchParams.set("v",new URL(C).searchParams.get("v"));const i=o.getElementsByClassName("ytp-contextmenu")[0].getElementsByClassName("ytp-menuitem");i[1].addEventListener("click",()=>{navigator.clipboard.writeText(t.href)}),i[2].addEventListener("click",()=>{t.searchParams.set("t",o.getElementsByTagName("video")[0].currentTime.toFixed(0)),navigator.clipboard.writeText(t.href)})}if(L.startsWith("/embed")){t.searchParams.set("v",L.replace("/embed/",""));const i=o.getElementsByClassName("ytp-contextmenu")[0].getElementsByClassName("ytp-menuitem");i[2].addEventListener("click",()=>{navigator.clipboard.writeText(t.href)}),i[3].addEventListener("click",()=>{t.searchParams.set("t",o.getElementsByTagName("video")[0].currentTime.toFixed(0)),navigator.clipboard.writeText(t.href)})}})}(()=>{let a,t,i,n,r,s,e,l;switch(navigator.language){case"zh-CN":a="\u624B\u52A8\u6E05\u7406\u94FE\u63A5",t="\u6DFB\u52A0\u81EA\u5B9A\u4E49\u53C2\u6570\uFF08\u534A\u89D2\u82F1\u6587\u6A21\u5F0F\uFF09",i="\u8BF7\u8F93\u5165\u5355\u4E2A\u6307\u5B9A\u7684\u53C2\u6570\uFF08\u4EC5\u652F\u6301\u5B57\u6BCD\uFF0C\u6570\u5B57\uFF0C\u4E0B\u5212\u7EBF\uFF0C\u77ED\u7834\u6298\u53F7(-)\u4E0E\u4EFB\u610F\u7C7B\u578B\u7684\u62EC\u53F7\uFF09",n="\u65E0\u6548\u7684\u53C2\u6570\u683C\u5F0F ",r="\u79FB\u9664\u4E00\u4E2A\u624B\u52A8\u6DFB\u52A0\u7684\u53C2\u6570\uFF08\u9875\u9762\u5237\u65B0\u540E\u751F\u6548\uFF09",s="\u65E0\u6B64\u53C2\u6570",e=`\u5DF2\u6DFB\u52A0\u7684\u81EA\u5B9A\u4E49\u53C2\u6570

`,l="\u6682\u672A\u6DFB\u52A0\u4EFB\u4F55\u7684\u81EA\u5B9A\u4E49\u53C2\u6570";break;case"zh-TW":a="\u624B\u52D5\u6E05\u7406\u93C8\u63A5",t="\u6DFB\u52A0\u81EA\u5B9A\u7FA9\u53C2\u6570\uFF08\u534A\u89D2\u82F1\u6587\u6A21\u5F0F\uFF09",i="\u8ACB\u8F38\u5165\u55AE\u500B\u6307\u5B9A\u7684\u53C3\u6578\uFF08\u50C5\u652F\u6301\u5B57\u6BCD\uFF0C\u6578\u5B57\uFF0C\u4E0B\u5283\u7DDA\uFF0C\u77ED\u7834\u6298\u865F(-)\u8207\u4EFB\u610F\u985E\u578B\u7684\u62EC\u865F\uFF09",n="\u7121\u6548\u7684\u53C3\u6578\u683C\u5F0F ",r="\u79FB\u9664\u4E00\u500B\u624B\u52D5\u6DFB\u52A0\u7684\u53C3\u6578\uFF08\u9801\u9762\u5237\u65B0\u5F8C\u751F\u6548\uFF09",s="\u7121\u6B64\u53C3\u6578",e=`\u5DF2\u6DFB\u52A0\u7684\u81EA\u5B9A\u7FA9\u53C3\u6578

`,l="\u66AB\u672A\u6DFB\u52A0\u4EFB\u4F55\u7684\u81EA\u5B9A\u7FA9\u53C3\u6578";break;default:a="Retry link cleaning",t="Add a custom parameter (English Mode)",i=`Please enter a single parameter below 
(only support letters, numbers, underscore, en-dash and all types of brackets):`,n="Not a valid parameter format ",r="Remove a custom parameter (Effect after refresh)",s="No such parameter.",e=`Get all custom added params:

`,l="No added custom parameters now!";break}function p(h,w){if(/^[a-zA-Z0-9()[\]{}<>_-]*$/.test(h)){let S;GM_getValue(c)?S=GM_getValue(c):S=[],h&&(S.push(h),GM_setValue(c,S)),S.forEach(U=>{w.includes(U)||w.push(U)})}else alert(n)}function d(){let h;return GM_getValue(c)?h=GM_getValue(c):h=[],h}function de(h){if(h!=null){let w;GM_getValue(c)?w=GM_getValue(c):w=[],w.includes(h)?(w=w.filter(S=>S!==h),GM_setValue(c,w)):alert(s)}}let f;switch(!0){case c.endsWith("youtube.com"):f=B,le(f);break;case c.endsWith("baidu.com"):f=v,re(),u(v);break;case/amazon\.[a-z.]{2,15}$/.test(c):f=X,g=D,W(f,g);break;case/(bilibili|biligame)\.com$/.test(c):f=b,g=A,y(b),u(b),P(),c.endsWith("www.bilibili.com")&&ne(),c.endsWith("search.bilibili.com")&&ie(),c.endsWith("live.bilibili.com")&&ae(_.normal),o.addEventListener("DOMContentLoaded",()=>{te(),ee(),Q(),N(1e3)});break;case $.test(c):f=x,g=R,ce();break;case c.endsWith("csdn.net"):f=M,oe();break;case/(youku|tudou)\.com$/.test(c):f=F,g=R,W(f);break;case/(tiktok|douyin)\.com$/.test(c):f=G,W(f);break;default:f=Z();break}p("",f);function me(){const h=d(f);h.length>0?alert(e+h.join(", ")):alert(l)}GM_registerMenuCommand(a,()=>{y(f),u(f),console.log(v)},"C"),GM_registerMenuCommand(t,()=>{p(prompt(i,""),f)}),GM_registerMenuCommand(r,()=>{const h=d(f);if(h.length>0){const w=prompt(`${e+h.join(", ")}`,"");de(w)}else alert(l)}),GM_registerMenuCommand(e,me),window.addEventListener("urlchange",()=>{y(f),u(f),I(f,0)}),window.addEventListener("keydown",h=>{h.key==="X"&&h.altKey&&h.shiftKey&&(y(f),u(f),c.includes("bilibili.com")&&z(0))})})()})();
