// ==UserScript==
// @name                Pixiv Previewer
// @namespace           https://github.com/Ocrosoft/PixivPreviewer
// @version             3.7.44
// @author              Ocrosoft
// @match               *://www.pixiv.net/*
// @grant               unsafeWindow
// @grant               GM.xmlHttpRequest
// @grant               GM_xmlhttpRequest
// @license             GPLv3
// @icon                https://t0.gstatic.com/faviconV2?client=SOCIAL&type=FAVICON&fallback_opts=TYPE,SIZE,URL&size=32&url=https://www.pixiv.net
// @icon64              https://t0.gstatic.com/faviconV2?client=SOCIAL&type=FAVICON&fallback_opts=TYPE,SIZE,URL&size=64&url=https://www.pixiv.net
// @require             https://update.greasyfork.org/scripts/515994/1478507/gh_2215_make_GM_xhr_more_parallel_again.js
// @require             https://openuserjs.org/src/libs/sizzle/GM_config.js
// @downloadURL https://raw.githubusercontent.com/FiorenMas/Userscripts/release/release/Pixiv20Previewer.user.js
// @updateURL https://raw.githubusercontent.com/FiorenMas/Userscripts/release/release/Pixiv20Previewer.meta.js
// ==/UserScript==
function ILog(){this.prefix="",this.v=function(t){e<=this.LogLevel.Verbose&&console.log(this.prefix+t)},this.i=function(t){e<=this.LogLevel.Info&&console.info(this.prefix+t)},this.w=function(t){e<=this.LogLevel.Warning&&console.warn(this.prefix+t)},this.e=function(t){e<=this.LogLevel.Error&&console.error(this.prefix+t)},this.d=function(t){e<=this.LogLevel.Verbose&&console.log(t)},this.setLogLevel=function(t){e=t},this.LogLevel={Verbose:0,Info:1,Warning:2,Error:3};let e=this.LogLevel.Warning}var iLog=new ILog,GM__xmlHttpRequest;typeof GM_xmlhttpRequest<"u"?GM__xmlHttpRequest=GM_xmlhttpRequest:GM__xmlHttpRequest=GM.xmlHttpRequest;function base64ArrayBuffer(e,t,n){for(var r="",i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",d=new Uint8Array(e),u=n%3,v=t+n-u,x,M,F,m,b,y=t;y<v;y=y+3)b=d[y]<<16|d[y+1]<<8|d[y+2],x=(b&16515072)>>18,M=(b&258048)>>12,F=(b&4032)>>6,m=b&63,r+=i[x]+i[M]+i[F]+i[m];return u==1?(b=d[v],x=(b&252)>>2,M=(b&3)<<4,r+=i[x]+i[M]+"=="):u==2&&(b=d[v]<<8|d[v+1],x=(b&64512)>>10,M=(b&1008)>>4,F=(b&15)<<2,r+=i[x]+i[M]+i[F]+"="),r}function ZipImagePlayer(e){this.op=e,this._URL=window.URL||window.webkitURL||window.MozURL||window.MSURL,this._Blob=window.Blob||window.WebKitBlob||window.MozBlob||window.MSBlob,this._BlobBuilder=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder,this._Uint8Array=window.Uint8Array||window.WebKitUint8Array||window.MozUint8Array||window.MSUint8Array,this._DataView=window.DataView||window.WebKitDataView||window.MozDataView||window.MSDataView,this._ArrayBuffer=window.ArrayBuffer||window.WebKitArrayBuffer||window.MozArrayBuffer||window.MSArrayBuffer,this._maxLoadAhead=0,this._URL||(this._debugLog("No URL support! Will use slower data: URLs."),this._maxLoadAhead=10),this._Blob||this._error("No Blob support"),this._Uint8Array||this._error("No Uint8Array support"),this._DataView||this._error("No DataView support"),this._ArrayBuffer||this._error("No ArrayBuffer support"),this._isSafari=Object.prototype.toString.call(window.HTMLElement).indexOf("Constructor")>0,this._loadingState=0,this._dead=!1,this._context=e.canvas.getContext("2d"),this._files={},this._frameCount=this.op.metadata.frames.length,this._debugLog("Frame count: "+this._frameCount),this._frame=0,this._loadFrame=0,this._frameImages=[],this._paused=!1,this._loadTimer=null,this._startLoad(),this.op.autoStart?this.play():this._paused=!0}ZipImagePlayer.prototype={_trailerBytes:3e4,_failed:!1,_mkerr:function(e){var t=this;return function(){t._error(e)}},_error:function(e){throw this._failed=!0,Error("ZipImagePlayer error: "+e)},_debugLog:function(e){this.op.debug&&console.log(e)},_load:function(e,t,n){var r=this,i=new XMLHttpRequest;if(i.addEventListener("load",function(u){r._dead||(r._debugLog("Load: "+e+" "+t+" status="+i.status),i.status==200?(r._debugLog("Range disabled or unsupported, complete load"),e=0,t=i.response.byteLength,r._len=t,r._buf=i.response,r._bytes=new r._Uint8Array(r._buf)):(i.status!=206&&r._error("Unexpected HTTP status "+i.status),i.response.byteLength!=t&&r._error("Unexpected length "+i.response.byteLength+" (expected "+t+")"),r._bytes.set(new r._Uint8Array(i.response),e)),n&&n.apply(r,[e,t]))},!1),i.addEventListener("error",this._mkerr("Fetch failed"),!1),i.open("GET",this.op.source),i.responseType="arraybuffer",e!=null&&t!=null){var d=e+t;i.setRequestHeader("Range","bytes="+e+"-"+(d-1)),this._isSafari&&(i.setRequestHeader("Cache-control","no-cache"),i.setRequestHeader("If-None-Match",Math.random().toString()))}i.send()},_startLoad:function(){var e=this;if(!this.op.source){this._loadNextFrame();return}$.ajax({url:this.op.source,type:"HEAD"}).done(function(t,n,r){if(!e._dead){e._pHead=0,e._pNextHead=0,e._pFetch=0;var i=parseInt(r.getResponseHeader("Content-Length"));if(!i){e._debugLog("HEAD request failed: invalid file length."),e._debugLog("Falling back to full file mode."),e._load(null,null,function(u,v){e._pTail=0,e._pHead=v,e._findCentralDirectory()});return}e._debugLog("Len: "+i),e._len=i,e._buf=new e._ArrayBuffer(i),e._bytes=new e._Uint8Array(e._buf);var d=i-e._trailerBytes;d<0&&(d=0),e._pTail=i,e._load(d,i-d,function(u,v){e._pTail=u,e._findCentralDirectory()})}}).fail(this._mkerr("Length fetch failed"))},_findCentralDirectory:function(){var e=new this._DataView(this._buf,this._len-22,22);e.getUint32(0,!0)!=101010256&&this._error("End of Central Directory signature not found");var t=e.getUint16(10,!0),n=e.getUint32(12,!0),r=e.getUint32(16,!0);r<this._pTail?this._load(r,this._pTail-r,function(){this._pTail=r,this._readCentralDirectory(r,n,t)}):this._readCentralDirectory(r,n,t)},_readCentralDirectory:function(e,t,n){for(var r=new this._DataView(this._buf,e,t),i=0,d=0;d<n;d++){r.getUint32(i,!0)!=33639248&&this._error("Invalid Central Directory signature");var u=r.getUint16(i+10,!0),v=r.getUint32(i+24,!0),x=r.getUint16(i+28,!0),M=r.getUint16(i+30,!0),F=r.getUint16(i+32,!0),m=r.getUint32(i+42,!0);u!=0&&this._error("Unsupported compression method"),i+=46;for(var b=new this._Uint8Array(this._buf,e+i,x),y="",k=0;k<x;k++)y+=String.fromCharCode(b[k]);i+=x+M+F,this._files[y]={off:m,len:v}}this._pHead>=this._pTail?(this._pHead=this._len,$(this).triggerHandler("loadProgress",[this._pHead/this._len]),this._loadNextFrame()):(this._loadNextChunk(),this._loadNextChunk())},_loadNextChunk:function(){if(!(this._pFetch>=this._pTail)){var e=this._pFetch,t=this.op.chunkSize;this._pFetch+t>this._pTail&&(t=this._pTail-this._pFetch),this._pFetch+=t,this._load(e,t,function(){e==this._pHead?(this._pNextHead?(this._pHead=this._pNextHead,this._pNextHead=0):this._pHead=e+t,this._pHead>=this._pTail&&(this._pHead=this._len),$(this).triggerHandler("loadProgress",[this._pHead/this._len]),this._loadTimer||this._loadNextFrame()):this._pNextHead=e+t,this._loadNextChunk()})}},_fileDataStart:function(e){var t=new DataView(this._buf,e,30),n=t.getUint16(26,!0),r=t.getUint16(28,!0);return e+30+n+r},_isFileAvailable:function(e){var t=this._files[e];return t||this._error("File "+e+" not found in ZIP"),this._pHead<t.off+30?!1:this._pHead>=this._fileDataStart(t.off)+t.len},_loadNextFrame:function(){if(!this._dead){var e=this._loadFrame;if(!(e>=this._frameCount)){var t=this.op.metadata.frames[e];if(!this.op.source){this._loadFrame+=1,this._loadImage(e,t.file,!1);return}if(this._isFileAvailable(t.file)){this._loadFrame+=1;var n=this._fileDataStart(this._files[t.file].off),r=n+this._files[t.file].len,i,d=this.op.metadata.mime_type||"image/png";if(this._URL){var u;if(this._buf.slice)u=this._buf.slice(n,r);else{u=new this._ArrayBuffer(this._files[t.file].len);var v=new this._Uint8Array(u);v.set(this._bytes.subarray(n,r))}var x;try{x=new this._Blob([u],{type:d})}catch(F){this._debugLog("Blob constructor failed. Trying BlobBuilder... ("+F.message+")");var M=new this._BlobBuilder;M.append(u),x=M.getBlob()}i=this._URL.createObjectURL(x),this._loadImage(e,i,!0)}else i="data:"+d+";base64,"+base64ArrayBuffer(this._buf,n,r-n),this._loadImage(e,i,!1)}}}},_loadImage:function(e,t,n){var r=this,i=new Image,d=this.op.metadata.frames[e];i.addEventListener("load",function(){r._debugLog("Loaded "+d.file+" to frame "+e),n&&r._URL.revokeObjectURL(t),!r._dead&&(r._frameImages[e]=i,$(r).triggerHandler("frameLoaded",e),r._loadingState==0&&r._displayFrame.apply(r),e>=r._frameCount-1?(r._setLoadingState(2),r._buf=null,r._bytes=null):!r._maxLoadAhead||e-r._frame<r._maxLoadAhead?r._loadNextFrame():r._loadTimer||(r._loadTimer=setTimeout(function(){r._loadTimer=null,r._loadNextFrame()},200)))}),i.src=t},_setLoadingState:function(e){this._loadingState!=e&&(this._loadingState=e,$(this).triggerHandler("loadingStateChanged",[e]))},_displayFrame:function(){if(!this._dead){var e=this,t=this.op.metadata.frames[this._frame];this._debugLog("Displaying frame: "+this._frame+" "+t.file);var n=this._frameImages[this._frame];if(!n){this._debugLog("Image not available!"),this._setLoadingState(0);return}this._loadingState!=2&&this._setLoadingState(1),this.op.autosize&&(this._context.canvas.width!=n.width||this._context.canvas.height!=n.height)&&(this._context.canvas.width=n.width,this._context.canvas.height=n.height),this._context.clearRect(0,0,this.op.canvas.width,this.op.canvas.height),this._context.drawImage(n,0,0),$(this).triggerHandler("frame",this._frame),this._paused||(this._timer=setTimeout(function(){e._timer=null,e._nextFrame.apply(e)},t.delay))}},_nextFrame:function(e){if(this._frame>=this._frameCount-1)if(this.op.loop)this._frame=0;else{this.pause();return}else this._frame+=1;this._displayFrame()},play:function(){this._dead||this._paused&&($(this).triggerHandler("play",[this._frame]),this._paused=!1,this._displayFrame())},pause:function(){this._dead||this._paused||(this._timer&&clearTimeout(this._timer),this._paused=!0,$(this).triggerHandler("pause",[this._frame]))},rewind:function(){this._dead||(this._frame=0,this._timer&&clearTimeout(this._timer),this._displayFrame())},stop:function(){this._debugLog("Stopped!"),this._dead=!0,this._timer&&clearTimeout(this._timer),this._loadTimer&&clearTimeout(this._loadTimer),this._frameImages=null,this._buf=null,this._bytes=null,$(this).triggerHandler("stop")},getCurrentFrame:function(){return this._frame},getLoadedFrames:function(){return this._frameImages.length},getFrameCount:function(){return this._frameCount},hasError:function(){return this._failed}};var checkJQuery=function(){let e=["http://code.jquery.com/jquery-2.1.4.min.js","https://ajax.aspnetcdn.com/ajax/jquery/jquery-2.1.4.min.js","https://ajax.googleapis.com/ajax/libs/jquery/2.1.4/jquery.min.js","https://cdn.staticfile.org/jquery/2.1.4/jquery.min.js","https://apps.bdimg.com/libs/jquery/2.1.4/jquery.min.js"];function t(){try{let d=unsafeWindow;return d.jQuery&&!d.$&&(d.$=d.jQuery),$(),!0}catch{return!1}}function n(d){let u=document.createElement("script");return u.src=d,document.head.appendChild(u),u}function r(d){let u=location.href.indexOf("https://")!=-1,v=d.indexOf("https://")!=-1;return u&&!v?d.replace("http://","https://"):!u&&v?d.replace("https://","http://"):d}function i(d,u){if(d>=e.length){iLog.e("\u65E0\u6CD5\u52A0\u8F7D JQuery\uFF0C\u6B63\u5728\u9000\u51FA\u3002"),u(!1);return}let v=r(e[d]);iLog.i("\u5C1D\u8BD5\u7B2C "+(d+1)+" \u4E2A JQuery CDN\uFF1A"+v+"\u3002");let x=n(v);setTimeout(function(){t()?(iLog.i("\u5DF2\u52A0\u8F7D JQuery\u3002"),u(!0)):(iLog.w("\u65E0\u6CD5\u8BBF\u95EE\u3002"),x.remove(),i(d+1,u))},100)}return new Promise(function(d){t()?(iLog.i("\u5DF2\u52A0\u8F7D jQuery\u3002"),d(!0)):(iLog.i("\u672A\u53D1\u73B0 JQuery\uFF0C\u5C1D\u8BD5\u52A0\u8F7D\u3002"),i(0,d))})};let Lang={auto:-1,zh_CN:0,en_US:1,ru_RU:2,ja_JP:3},Texts={};Texts[Lang.zh_CN]={install_title:"\u6B22\u8FCE\u4F7F\u7528 PixivPreviewer",install_body:'<div style="position: absolute;left: 50%;top: 30%;font-size: 20px; color: white;transform:translate(-50%,0);"><p style="text-indent: 2em;">\u6B22\u8FCE\u53CD\u9988\u95EE\u9898\u548C\u63D0\u51FA\u5EFA\u8BAE\uFF01 \u261E<a style="color: green;" href="https://greasyfork.org/zh-CN/scripts/30766-pixiv-previewer/feedback" target="_blank">\u53CD\u9988\u9875\u9762</a></p><br><p style="text-indent: 2em;">\u5982\u679C\u60A8\u662F\u7B2C\u4E00\u6B21\u4F7F\u7528\uFF0C\u63A8\u8350\u5230 \u261E<a style="color: green;" href="https://greasyfork.org/zh-CN/scripts/30766-pixiv-previewer" target="_blank">\u8BE6\u60C5\u9875</a> \u67E5\u770B\u811A\u672C\u4ECB\u7ECD\u3002</p></div>',upgrade_body:'<h3>\u65B0\u7684\u8BBE\u7F6E\u83DC\u5355!</h3>&nbsp&nbsp<p style="text-indent: 2em;">\u611F\u8C22\u5404\u4F4D\u4F7F\u7528 Pixiv Previewer,\u672C\u6B21\u66F4\u65B0\u8C03\u6574\u4E86\u8BBE\u7F6E\u83DC\u5355\u7684\u89C6\u89C9\u6548\u679C,\u6B22\u8FCE\u53CD\u9988\u95EE\u9898\u548C\u63D0\u51FA\u5EFA\u8BAE! \u261E<a style="color: green;" href="https://greasyfork.org/zh-CN/scripts/30766-pixiv-previewer/feedback" target="_blank">\u53CD\u9988\u9875\u9762</a></p>',setting_settingSection:"\u8BBE\u7F6E",setting_language:"\u8BED\u8A00",setting_preview:"\u9884\u89C8",setting_animePreview:"\u52A8\u56FE\u9884\u89C8",setting_sortSection:"\u6392\u5E8F",setting_sort:"\u6392\u5E8F\uFF08\u4EC5\u641C\u7D22\u9875\u751F\u6548\uFF09",setting_anime:"\u52A8\u56FE\u4E0B\u8F7D\uFF08\u52A8\u56FE\u9884\u89C8\u53CA\u8BE6\u60C5\u9875\u751F\u6548\uFF09",setting_origin:"\u9884\u89C8\u65F6\u4F18\u5148\u663E\u793A\u539F\u56FE\uFF08\u6162\uFF09",setting_previewDelay:"\u5EF6\u8FDF\u663E\u793A\u9884\u89C8\u56FE\uFF08\u6BEB\u79D2\uFF09",setting_previewByKey:"\u4F7F\u7528\u6309\u952E\u63A7\u5236\u9884\u89C8\u56FE\u5C55\u793A\uFF08Ctrl\uFF09",setting_previewByKeyHelp:"\u5F00\u542F\u540E\u9F20\u6807\u79FB\u52A8\u5230\u56FE\u7247\u4E0A\u4E0D\u518D\u5C55\u793A\u9884\u89C8\u56FE\uFF0C\u6309\u4E0BCtrl\u952E\u624D\u5C55\u793A\uFF0C\u540C\u65F6\u201C\u5EF6\u8FDF\u663E\u793A\u9884\u89C8\u201D\u8BBE\u7F6E\u9879\u4E0D\u751F\u6548\u3002",setting_maxPage:"\u6BCF\u6B21\u6392\u5E8F\u65F6\u7EDF\u8BA1\u7684\u6700\u5927\u9875\u6570",setting_hideWork:"\u9690\u85CF\u6536\u85CF\u6570\u5C11\u4E8E\u8BBE\u5B9A\u503C\u7684\u4F5C\u54C1",setting_hideAiWork:"\u9690\u85CF AI \u751F\u6210\u4F5C\u54C1",setting_hideFav:"\u6392\u5E8F\u65F6\u9690\u85CF\u5DF2\u6536\u85CF\u7684\u4F5C\u54C1",setting_hideFollowed:"\u6392\u5E8F\u65F6\u9690\u85CF\u5DF2\u5173\u6CE8\u753B\u5E08\u4F5C\u54C1",setting_hideByTag:"\u6392\u5E8F\u65F6\u9690\u85CF\u6307\u5B9A\u6807\u7B7E\u7684\u4F5C\u54C1",setting_hideByTagPlaceholder:'\u8F93\u5165\u6807\u7B7E\u540D\uFF0C\u5982 "tag1|tag2"\uFF0C\u652F\u6301\u6B63\u5219',setting_clearFollowingCache:"\u6E05\u9664\u7F13\u5B58",setting_clearFollowingCacheHelp:"\u5173\u6CE8\u753B\u5E08\u4FE1\u606F\u4F1A\u5728\u672C\u5730\u4FDD\u5B58\u4E00\u5929\uFF0C\u5982\u679C\u5E0C\u671B\u7ACB\u5373\u66F4\u65B0\uFF0C\u8BF7\u70B9\u51FB\u6E05\u9664\u7F13\u5B58",setting_followingCacheCleared:"\u5DF2\u6E05\u9664\u7F13\u5B58\uFF0C\u8BF7\u5237\u65B0\u9875\u9762\u3002",setting_blank:"\u4F7F\u7528\u65B0\u6807\u7B7E\u9875\u6253\u5F00\u4F5C\u54C1\u8BE6\u60C5\u9875",setting_turnPage:"\u4F7F\u7528\u952E\u76D8\u2190\u2192\u8FDB\u884C\u7FFB\u9875\uFF08\u6392\u5E8F\u540E\u7684\u641C\u7D22\u9875\uFF09",setting_save:"\u4FDD\u5B58\u8BBE\u7F6E",setting_reset:"\u91CD\u7F6E\u811A\u672C",setting_resetHint:"\u8FD9\u4F1A\u5220\u9664\u6240\u6709\u8BBE\u7F6E\uFF0C\u76F8\u5F53\u4E8E\u91CD\u65B0\u5B89\u88C5\u811A\u672C\uFF0C\u786E\u5B9A\u8981\u91CD\u7F6E\u5417\uFF1F",setting_novelSort:"\u5C0F\u8BF4\u6392\u5E8F",setting_novelMaxPage:"\u5C0F\u8BF4\u6392\u5E8F\u65F6\u7EDF\u8BA1\u7684\u6700\u5927\u9875\u6570",setting_novelHideWork:"\u9690\u85CF\u6536\u85CF\u6570\u5C11\u4E8E\u8BBE\u5B9A\u503C\u7684\u4F5C\u54C1",setting_novelHideFav:"\u6392\u5E8F\u65F6\u9690\u85CF\u5DF2\u6536\u85CF\u7684\u4F5C\u54C1",setting_previewFullScreen:"\u5168\u5C4F\u9884\u89C8",setting_scrollLockWhenPreview:"\u9884\u89C8\u65F6\u963B\u6B62\u9875\u9762\u6EDA\u52A8",setting_logLevel:"\u65E5\u5FD7\u7B49\u7EA7",setting_novelSection:"\u5C0F\u8BF4\u6392\u5E8F",setting_close:"\u5173\u95ED",setting_maxXhr:"\u6536\u85CF\u6570\u5E76\u53D1\uFF08\u63A8\u8350 64\uFF09",setting_hideByCountLessThan:"\u9690\u85CF\u56FE\u7247\u5F20\u6570\u5C11\u4E8E\u8BBE\u5B9A\u503C\u7684\u4F5C\u54C1",setting_hideByCountMoreThan:"\u9690\u85CF\u56FE\u7247\u5F20\u6570\u591A\u4E8E\u8BBE\u5B9A\u503C\u7684\u4F5C\u54C1",sort_noWork:"\u6CA1\u6709\u53EF\u4EE5\u663E\u793A\u7684\u4F5C\u54C1\uFF08\u9690\u85CF\u4E86 %1 \u4E2A\u4F5C\u54C1\uFF09",sort_getWorks:"\u6B63\u5728\u83B7\u53D6\u7B2C%1/%2\u9875\u4F5C\u54C1",sort_getBookmarkCount:"\u83B7\u53D6\u6536\u85CF\u6570\uFF1A%1/%2",sort_getPublicFollowing:"\u83B7\u53D6\u516C\u5F00\u5173\u6CE8\u753B\u5E08",sort_getPrivateFollowing:"\u83B7\u53D6\u79C1\u6709\u5173\u6CE8\u753B\u5E08",sort_filtering:"\u8FC7\u6EE4%1\u6536\u85CF\u91CF\u4F4E\u4E8E%2\u7684\u4F5C\u54C1",sort_filteringHideFavorite:"\u5DF2\u6536\u85CF\u548C",sort_fullSizeThumb:"\u5168\u5C3A\u5BF8\u7F29\u7565\u56FE\uFF08\u641C\u7D22\u9875\u3001\u7528\u6237\u9875\uFF09",nsort_getWorks:"\u6B63\u5728\u83B7\u53D6\u7B2C1%/2%\u9875\u4F5C\u54C1",nsort_sorting:"\u6B63\u5728\u6309\u6536\u85CF\u91CF\u6392\u5E8F",nsort_hideFav:"\u6392\u5E8F\u65F6\u9690\u85CF\u5DF2\u6536\u85CF\u7684\u4F5C\u54C1",nsort_hideFollowed:"\u6392\u5E8F\u65F6\u9690\u85CF\u5DF2\u5173\u6CE8\u4F5C\u8005\u4F5C\u54C1",text_sort:"\u6392\u5E8F"},Texts[Lang.en_US]={install_title:"Welcome to PixivPreviewer",install_body:'<div style="position: absolute;left: 50%;top: 30%;font-size: 20px; color: white;transform:translate(-50%,0);"><p style="text-indent: 2em;">Feedback questions and suggestions are welcome! \u261E<a style="color: green;" href="https://greasyfork.org/zh-CN/scripts/30766-pixiv-previewer/feedback" target="_blank">Feedback Page</a></p><br><p style="text-indent: 2em;">If you are using it for the first time, it is recommended to go to the \u261E<a style="color: green;" href="https://greasyfork.org/zh-CN/scripts/30766-pixiv-previewer" target="_blank">Details Page</a> to see the script introduction.</p></div>',upgrade_body:'<h3>New settings menu!</h3>&nbsp&nbsp<p style="text-indent: 2em;">Thanks to all Pixiv Previewer users, this update adjusts the visual effect of the settings menu, and feedback questions and suggestions are welcome! \u261E<a style="color: green;" href="https://greasyfork.org/zh-CN/scripts/30766-pixiv-previewer/feedback" target="_blank">Feedback Page</a></p>',setting_settingSection:"Settings",setting_language:"Language",setting_preview:"Preview",setting_animePreview:"Animation preview",setting_sortSection:"Sorting",setting_sort:"Sorting (Search page)",setting_anime:"Animation download (Preview and Artwork page)",setting_origin:"Display original image when preview (slow)",setting_previewDelay:"Delay of display preview image(Million seconds)",setting_previewByKey:"Use keys to control the preview image display (Ctrl)",setting_previewByKeyHelp:'After enabling it, move the mouse to the picture and no longer display the preview image. Press the Ctrl key to display it, and the "Delayed Display Preview" setting item does not take effect.',setting_maxPage:"Maximum number of pages counted per sort",setting_hideWork:"Hide works with bookmark count less than set value",setting_hideAiWork:"Hide AI works",setting_hideFav:"Hide favorites when sorting",setting_hideFollowed:"Hide artworks of followed artists when sorting",setting_hideByTag:"Hide artworks by tag",setting_hideByTagPlaceholder:'Input tag name, e.g. "tag1|tag2", regular expressions supported',setting_clearFollowingCache:"Clear Cache",setting_clearFollowingCacheHelp:"The folloing artists info. will be saved locally for one day, if you want to update immediately, please click this to clear cache",setting_followingCacheCleared:"Success, please refresh the page.",setting_blank:"Open works' details page in new tab",setting_turnPage:"Use \u2190 \u2192 to turn pages (Search page)",setting_save:"Save",setting_reset:"Reset",setting_resetHint:"This will delete all settings and set it to default. Are you sure?",setting_novelSort:"Sorting (Novel)",setting_novelMaxPage:"Maximum number of pages counted for novel sorting",setting_novelHideWork:"Hide works with bookmark count less than set value",setting_novelHideFav:"Hide favorites when sorting",setting_previewFullScreen:"Full screen preview",setting_scrollLockWhenPreview:"Prevent page scrolling during preview",setting_logLevel:"Log Level",setting_novelSection:"Novel Sorting",setting_close:"Close",setting_maxXhr:"Bookmark count concurrency (recommended 64)",setting_hideByCountLessThan:"Hide works with image count less than set value",setting_hideByCountMoreThan:"Hide works with image count more than set value",sort_noWork:"No works to display (%1 works hideen)",sort_getWorks:"Getting artworks of page: %1 of %2",sort_getBookmarkCount:"Getting bookmark count of artworks\uFF1A%1 of %2",sort_getPublicFollowing:"Getting public following list",sort_getPrivateFollowing:"Getting private following list",sort_filtering:"Filtering%1works with bookmark count less than %2",sort_filteringHideFavorite:" favorited works and ",sort_fullSizeThumb:"Display not cropped images.(Search page and User page only.)",nsort_getWorks:"Getting novels of page: 1% of 2%",nsort_sorting:"Sorting by bookmark cound",nsort_hideFav:"Hide favorites when sorting",nsort_hideFollowed:"Hide artworks of followed authors when sorting",text_sort:"sort"},Texts[Lang.ru_RU]={install_title:"\u0414\u043E\u0431\u0440\u043E \u043F\u043E\u0436\u0430\u043B\u043E\u0432\u0430\u0442\u044C \u0432 PixivPreviewer",install_body:'<div style="position: absolute;left: 50%;top: 30%;font-size: 20px; color: white;transform:translate(-50%,0);"><p style="text-indent: 2em;">\u0412\u043E\u043F\u0440\u043E\u0441\u044B \u0438 \u043F\u0440\u0435\u0434\u043B\u043E\u0436\u0435\u043D\u0438\u044F \u043F\u0440\u0438\u0432\u0435\u0442\u0441\u0442\u0432\u0443\u044E\u0442\u0441\u044F! \u261E<a style="color: green;" href="https://greasyfork.org/zh-CN/scripts/30766-pixiv-previewer/feedback" target="_blank">\u0421\u0442\u0440\u0430\u043D\u0438\u0446\u0430 \u043E\u0431\u0440\u0430\u0442\u043D\u043E\u0439 \u0441\u0432\u044F\u0437\u0438</a></p><br><p style="text-indent: 2em;">\u0415\u0441\u043B\u0438 \u0432\u044B \u0438\u0441\u043F\u043E\u043B\u044C\u0437\u0443\u0435\u0442\u0435 \u044D\u0442\u043E \u0432\u043F\u0435\u0440\u0432\u044B\u0435, \u0440\u0435\u043A\u043E\u043C\u0435\u043D\u0434\u0443\u0435\u0442\u0441\u044F \u043F\u0435\u0440\u0435\u0439\u0442\u0438 \u043A \u261E<a style="color: green;" href="https://greasyfork.org/zh-CN/scripts/30766-pixiv-previewer" target="_blank">\u0421\u0442\u0440\u0430\u043D\u0438\u0446\u0435 \u043F\u043E\u0434\u0440\u043E\u0431\u043D\u043E\u0441\u0442\u0435\u0439</a>, \u0447\u0442\u043E\u0431\u044B \u043F\u043E\u0441\u043C\u043E\u0442\u0440\u0435\u0442\u044C \u0432\u0432\u0435\u0434\u0435\u043D\u0438\u0435 \u0432 \u0441\u043A\u0440\u0438\u043F\u0442.</p></div>',upgrade_body:'<h3>\u041D\u043E\u0432\u043E\u0435 \u043C\u0435\u043D\u044E \u043D\u0430\u0441\u0442\u0440\u043E\u0435\u043A!</h3>&nbsp&nbsp<p style="text-indent: 2em;">\u0421\u043F\u0430\u0441\u0438\u0431\u043E \u0432\u0441\u0435\u043C \u043F\u043E\u043B\u044C\u0437\u043E\u0432\u0430\u0442\u0435\u043B\u044F\u043C Pixiv Previewer, \u044D\u0442\u043E \u043E\u0431\u043D\u043E\u0432\u043B\u0435\u043D\u0438\u0435 \u0438\u0437\u043C\u0435\u043D\u0438\u043B\u043E \u0432\u0438\u0437\u0443\u0430\u043B\u044C\u043D\u044B\u0439 \u044D\u0444\u0444\u0435\u043A\u0442 \u043C\u0435\u043D\u044E \u043D\u0430\u0441\u0442\u0440\u043E\u0435\u043A, \u0432\u043E\u043F\u0440\u043E\u0441\u044B \u0438 \u043F\u0440\u0435\u0434\u043B\u043E\u0436\u0435\u043D\u0438\u044F \u043F\u0440\u0438\u0432\u0435\u0442\u0441\u0442\u0432\u0443\u044E\u0442\u0441\u044F! \u261E<a style="color: green;" href="https://greasyfork.org/zh-CN/scripts/30766-pixiv-previewer/feedback" target="_blank">\u0421\u0442\u0440\u0430\u043D\u0438\u0446\u0430 \u043E\u0431\u0440\u0430\u0442\u043D\u043E\u0439 \u0441\u0432\u044F\u0437\u0438</a></p>',setting_settingSection:"\u041D\u0430\u0441\u0442\u0440\u043E\u0439\u043A\u0438",setting_language:"\u042F\u0437\u044B\u043A",setting_preview:"\u041F\u0440\u0435\u0434\u043F\u0440\u043E\u0441\u043C\u043E\u0442\u0440",setting_animePreview:"\u0410\u043D\u0438\u043C\u0430\u0446\u0438\u044F \u043F\u0440\u0435\u0434\u043F\u0440\u043E\u0441\u043C\u043E\u0442\u0440\u0430",setting_sortSection:"\u0421\u043E\u0440\u0442\u0438\u0440\u043E\u0432\u043A\u0430",setting_sort:"\u0421\u043E\u0440\u0442\u0438\u0440\u043E\u0432\u043A\u0430 (\u0421\u0442\u0440\u0430\u043D\u0438\u0446\u0430 \u043F\u043E\u0438\u0441\u043A\u0430)",setting_anime:"\u0410\u043D\u0438\u043C\u0430\u0446\u0438\u044F \u0441\u043A\u0430\u0447\u0438\u0432\u0430\u043D\u0438\u044F (\u0421\u0442\u0440\u0430\u043D\u0438\u0446\u044B \u043F\u0440\u0435\u0434\u043F\u0440\u043E\u0441\u043C\u043E\u0442\u0440\u0430 \u0438 Artwork)",setting_origin:"\u041F\u0440\u0438 \u043F\u0440\u0435\u0434\u043F\u0440\u043E\u0441\u043C\u043E\u0442\u0440\u0435, \u043F\u043E\u043A\u0430\u0437\u044B\u0432\u0430\u0442\u044C \u0438\u0437\u043E\u0431\u0440\u0430\u0436\u0435\u043D\u0438\u044F \u0441 \u043E\u0440\u0438\u0433\u0438\u043D\u0430\u043B\u044C\u043D\u044B\u043C \u043A\u0430\u0447\u0435\u0441\u0442\u0432\u043E\u043C (\u043C\u0435\u0434\u043B\u0435\u043D\u043D\u043E)",setting_previewDelay:"\u0417\u0430\u0434\u0435\u0440\u0436\u043A\u0430 \u043E\u0442\u043E\u0431\u0440\u0430\u0436\u0435\u043D\u0438\u044F \u043F\u0440\u0435\u0434\u043F\u0440\u043E\u0441\u043C\u043E\u0442\u0440\u0430 \u0438\u0437\u043E\u0431\u0440\u0430\u0436\u0435\u043D\u0438\u044F (\u041C\u0438\u043B\u043B\u0438\u043E\u043D \u0441\u0435\u043A\u0443\u043D\u0434)",setting_previewByKey:"\u0418\u0441\u043F\u043E\u043B\u044C\u0437\u043E\u0432\u0430\u0442\u044C \u043A\u043B\u0430\u0432\u0438\u0448\u0438 \u0434\u043B\u044F \u0443\u043F\u0440\u0430\u0432\u043B\u0435\u043D\u0438\u044F \u043E\u0442\u043E\u0431\u0440\u0430\u0436\u0435\u043D\u0438\u0435\u043C \u043F\u0440\u0435\u0434\u043F\u0440\u043E\u0441\u043C\u043E\u0442\u0440\u0430 \u0438\u0437\u043E\u0431\u0440\u0430\u0436\u0435\u043D\u0438\u044F (Ctrl)",setting_previewByKeyHelp:'\u041F\u043E\u0441\u043B\u0435 \u0432\u043A\u043B\u044E\u0447\u0435\u043D\u0438\u044F, \u043F\u0435\u0440\u0435\u043C\u0435\u0449\u0435\u043D\u0438\u0435 \u043C\u044B\u0448\u0438 \u043A \u0438\u0437\u043E\u0431\u0440\u0430\u0436\u0435\u043D\u0438\u044E \u0431\u043E\u043B\u044C\u0448\u0435 \u043D\u0435 \u043E\u0442\u043E\u0431\u0440\u0430\u0436\u0430\u0435\u0442 \u043F\u0440\u0435\u0434\u043F\u0440\u043E\u0441\u043C\u043E\u0442\u0440 \u0438\u0437\u043E\u0431\u0440\u0430\u0436\u0435\u043D\u0438\u044F. \u041D\u0430\u0436\u043C\u0438\u0442\u0435 \u043A\u043B\u0430\u0432\u0438\u0448\u0443 Ctrl, \u0447\u0442\u043E\u0431\u044B \u043E\u0442\u043E\u0431\u0440\u0430\u0437\u0438\u0442\u044C \u0435\u0433\u043E, \u0438 \u043F\u0430\u0440\u0430\u043C\u0435\u0442\u0440 "\u0417\u0430\u0434\u0435\u0440\u0436\u043A\u0430 \u043E\u0442\u043E\u0431\u0440\u0430\u0436\u0435\u043D\u0438\u044F \u043F\u0440\u0435\u0434\u043F\u0440\u043E\u0441\u043C\u043E\u0442\u0440\u0430" \u043D\u0435 \u0431\u0443\u0434\u0435\u0442 \u0434\u0435\u0439\u0441\u0442\u0432\u043E\u0432\u0430\u0442\u044C.',setting_maxPage:"\u041C\u0430\u043A\u0441\u0438\u043C\u0430\u043B\u044C\u043D\u043E\u0435 \u043A\u043E\u043B\u0438\u0447\u0435\u0441\u0442\u0432\u043E \u0441\u0442\u0440\u0430\u043D\u0438\u0446, \u043F\u043E\u0434\u0441\u0447\u0438\u0442\u0430\u043D\u043D\u044B\u0445 \u0437\u0430 \u0441\u043E\u0440\u0442\u0438\u0440\u043E\u0432\u043A\u0443",setting_hideWork:"\u0421\u043A\u0440\u044B\u0442\u044C \u0440\u0430\u0431\u043E\u0442\u044B \u0441 \u043A\u043E\u043B\u0438\u0447\u0435\u0441\u0442\u0432\u043E\u043C \u0437\u0430\u043A\u043B\u0430\u0434\u043E\u043A \u043C\u0435\u043D\u044C\u0448\u0435 \u0443\u0441\u0442\u0430\u043D\u043E\u0432\u043B\u0435\u043D\u043D\u043E\u0433\u043E \u0437\u043D\u0430\u0447\u0435\u043D\u0438\u044F",setting_hideAiWork:"\u0421\u043A\u0440\u044B\u0442\u044C \u0440\u0430\u0431\u043E\u0442\u044B, \u0441\u043E\u0437\u0434\u0430\u043D\u043D\u044B\u0435 \u0418\u0418",setting_hideFav:"\u041F\u0440\u0438 \u0441\u043E\u0440\u0442\u0438\u0440\u043E\u0432\u043A\u0435, \u0441\u043A\u0440\u044B\u0442\u044C \u0438\u0437\u0431\u0440\u0430\u043D\u043D\u043E\u0435",setting_hideFollowed:"\u041F\u0440\u0438 \u0441\u043E\u0440\u0442\u0438\u0440\u043E\u0432\u043A\u0435, \u0441\u043A\u0440\u044B\u0442\u044C \u0440\u0430\u0431\u043E\u0442\u044B \u0445\u0443\u0434\u043E\u0436\u043D\u0438\u043A\u043E\u0432 \u043D\u0430 \u043A\u043E\u0442\u043E\u0440\u044B\u0445 \u043F\u043E\u0434\u043F\u0438\u0441\u0430\u043D\u044B",setting_hideByTag:"\u041F\u0440\u0438 \u0441\u043E\u0440\u0442\u0438\u0440\u043E\u0432\u043A\u0435, \u0441\u043A\u0440\u044B\u0442\u044C \u0440\u0430\u0431\u043E\u0442\u044B \u0441 \u0443\u043A\u0430\u0437\u0430\u043D\u043D\u044B\u043C \u0442\u0435\u0433\u043E\u043C",setting_hideByTagPlaceholder:'\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u0438\u043C\u044F \u0442\u0435\u0433\u0430, \u043D\u0430\u043F\u0440\u0438\u043C\u0435\u0440 "tag1|tag2", \u043F\u043E\u0434\u0434\u0435\u0440\u0436\u0438\u0432\u0430\u0435\u0442\u0441\u044F \u0440\u0435\u0433\u0443\u043B\u044F\u0440\u043D\u043E\u0435 \u0432\u044B\u0440\u0430\u0436\u0435\u043D\u0438\u0435',setting_clearFollowingCache:"\u041E\u0447\u0438\u0441\u0442\u0438\u0442\u044C \u043A\u044D\u0448",setting_clearFollowingCacheHelp:"\u0421\u043B\u0435\u0434\u0443\u044E\u0449\u0430\u044F \u0438\u043D\u0444\u043E\u0440\u043C\u0430\u0446\u0438\u044F \u043E \u0445\u0443\u0434\u043E\u0436\u043D\u0438\u043A\u0430\u0445 \u0431\u0443\u0434\u0435\u0442 \u0441\u043E\u0445\u0440\u0430\u043D\u0435\u043D\u0430 \u043B\u043E\u043A\u0430\u043B\u044C\u043D\u043E \u0432 \u0442\u0435\u0447\u0435\u043D\u0438\u0435 \u043E\u0434\u043D\u043E\u0433\u043E \u0434\u043D\u044F, \u0435\u0441\u043B\u0438 \u0432\u044B \u0445\u043E\u0442\u0438\u0442\u0435 \u043E\u0431\u043D\u043E\u0432\u0438\u0442\u044C \u0435\u0451 \u043D\u0435\u043C\u0435\u0434\u043B\u0435\u043D\u043D\u043E, \u043D\u0430\u0436\u043C\u0438\u0442\u0435 \u043D\u0430 \u044D\u0442\u0443 \u043A\u043D\u043E\u043F\u043A\u0443, \u0447\u0442\u043E\u0431\u044B \u043E\u0447\u0438\u0441\u0442\u0438\u0442\u044C \u043A\u044D\u0448",setting_followingCacheCleared:"\u0413\u043E\u0442\u043E\u0432\u043E, \u043E\u0431\u043D\u043E\u0432\u0438\u0442\u0435 \u0441\u0442\u0440\u0430\u043D\u0438\u0446\u0443.",setting_blank:"\u041E\u0442\u043A\u0440\u044B\u0432\u0430\u0442\u044C \u0441\u0442\u0440\u0430\u043D\u0438\u0446\u0443 \u0441 \u043E\u043F\u0438\u0441\u0430\u043D\u0438\u0435\u043C \u0440\u0430\u0431\u043E\u0442\u044B \u043D\u0430 \u043D\u043E\u0432\u043E\u0439 \u0432\u043A\u043B\u0430\u0434\u043A\u0435",setting_turnPage:"\u0418\u0441\u043F\u043E\u043B\u044C\u0437\u043E\u0432\u0430\u0442\u044C \u2190 \u2192 \u0434\u043B\u044F \u043F\u0435\u0440\u0435\u043B\u0438\u0441\u0442\u044B\u0432\u0430\u043D\u0438\u044F \u0441\u0442\u0440\u0430\u043D\u0438\u0446 (\u0421\u0442\u0440\u0430\u043D\u0438\u0446\u0430 \u043F\u043E\u0438\u0441\u043A\u0430)",setting_save:"\u0421\u043E\u0445\u0440\u0430\u043D\u0438\u0442\u044C",setting_reset:"\u0421\u0431\u0440\u043E\u0441\u0438\u0442\u044C",setting_resetHint:"\u042D\u0442\u043E \u0443\u0434\u0430\u043B\u0438\u0442 \u0432\u0441\u0435 \u043D\u0430\u0441\u0442\u0440\u043E\u0439\u043A\u0438 \u0438 \u0443\u0441\u0442\u0430\u043D\u043E\u0432\u0438\u0442 \u0438\u0445 \u043F\u043E \u0443\u043C\u043E\u043B\u0447\u0430\u043D\u0438\u044E. \u041F\u0440\u043E\u0434\u043E\u043B\u0436\u0438\u0442\u044C?",setting_novelSort:"\u0421\u043E\u0440\u0442\u0438\u0440\u043E\u0432\u043A\u0430 (\u0420\u043E\u043C\u0430\u043D)",setting_novelMaxPage:"\u041C\u0430\u043A\u0441\u0438\u043C\u0430\u043B\u044C\u043D\u043E\u0435 \u043A\u043E\u043B\u0438\u0447\u0435\u0441\u0442\u0432\u043E \u0441\u0442\u0440\u0430\u043D\u0438\u0446, \u043F\u043E\u0434\u0441\u0447\u0438\u0442\u0430\u043D\u043D\u044B\u0445 \u0437\u0430 \u0441\u043E\u0440\u0442\u0438\u0440\u043E\u0432\u043A\u0443 \u0440\u043E\u043C\u0430\u043D\u0430",setting_novelHideWork:"\u0421\u043A\u0440\u044B\u0442\u044C \u0440\u0430\u0431\u043E\u0442\u044B \u0441 \u043A\u043E\u043B\u0438\u0447\u0435\u0441\u0442\u0432\u043E\u043C \u0437\u0430\u043A\u043B\u0430\u0434\u043E\u043A \u043C\u0435\u043D\u044C\u0448\u0435 \u0443\u0441\u0442\u0430\u043D\u043E\u0432\u043B\u0435\u043D\u043D\u043E\u0433\u043E \u0437\u043D\u0430\u0447\u0435\u043D\u0438\u044F",setting_novelHideFav:"\u041F\u0440\u0438 \u0441\u043E\u0440\u0442\u0438\u0440\u043E\u0432\u043A\u0435, \u0441\u043A\u0440\u044B\u0442\u044C \u0438\u0437\u0431\u0440\u0430\u043D\u043D\u043E\u0435",setting_previewFullScreen:"\u041F\u0440\u0435\u0434\u043F\u0440\u043E\u0441\u043C\u043E\u0442\u0440 \u0432 \u043F\u043E\u043B\u043D\u043E\u044D\u043A\u0440\u0430\u043D\u043D\u043E\u043C \u0440\u0435\u0436\u0438\u043C\u0435",setting_scrollLockWhenPreview:"\u0411\u043B\u043E\u043A\u0438\u0440\u043E\u0432\u0430\u0442\u044C \u043F\u0440\u043E\u043A\u0440\u0443\u0442\u043A\u0443 \u0441\u0442\u0440\u0430\u043D\u0438\u0446\u044B \u043F\u0440\u0438 \u043F\u0440\u0435\u0434\u043F\u0440\u043E\u0441\u043C\u043E\u0442\u0440\u0435",setting_novelSection:"\u0421\u043E\u0440\u0442\u0438\u0440\u043E\u0432\u043A\u0430 (\u0420\u043E\u043C\u0430\u043D)",setting_close:"\u0417\u0430\u043A\u0440\u044B\u0442\u044C",setting_maxXhr:"\u041A\u043E\u043B\u0438\u0447\u0435\u0441\u0442\u0432\u043E \u0437\u0430\u043A\u043B\u0430\u0434\u043E\u043A (\u0440\u0435\u043A\u043E\u043C\u0435\u043D\u0434\u0443\u0435\u0442\u0441\u044F 64)",setting_hideByCountLessThan:"\u0421\u043A\u0440\u044B\u0442\u044C \u0440\u0430\u0431\u043E\u0442\u044B \u0441 \u043A\u043E\u043B\u0438\u0447\u0435\u0441\u0442\u0432\u043E\u043C \u0438\u0437\u043E\u0431\u0440\u0430\u0436\u0435\u043D\u0438\u0439 \u043C\u0435\u043D\u044C\u0448\u0435 \u0443\u0441\u0442\u0430\u043D\u043E\u0432\u043B\u0435\u043D\u043D\u043E\u0433\u043E \u0437\u043D\u0430\u0447\u0435\u043D\u0438\u044F",setting_hideByCountMoreThan:"\u0421\u043A\u0440\u044B\u0442\u044C \u0440\u0430\u0431\u043E\u0442\u044B \u0441 \u043A\u043E\u043B\u0438\u0447\u0435\u0441\u0442\u0432\u043E\u043C \u0438\u0437\u043E\u0431\u0440\u0430\u0436\u0435\u043D\u0438\u0439 \u0431\u043E\u043B\u044C\u0448\u0435 \u0443\u0441\u0442\u0430\u043D\u043E\u0432\u043B\u0435\u043D\u043D\u043E\u0433\u043E \u0437\u043D\u0430\u0447\u0435\u043D\u0438\u044F",sort_noWork:"\u041D\u0435\u0442 \u0440\u0430\u0431\u043E\u0442 \u0434\u043B\u044F \u043E\u0442\u043E\u0431\u0440\u0430\u0436\u0435\u043D\u0438\u044F (%1 works hidden)",sort_getWorks:"\u041F\u043E\u043B\u0443\u0447\u0435\u043D\u0438\u0435 \u0438\u043B\u043B\u044E\u0441\u0442\u0440\u0430\u0446\u0438\u0439 \u0441\u0442\u0440\u0430\u043D\u0438\u0446\u044B: %1 \u0438\u0437 %2",sort_getBookmarkCount:"\u041F\u043E\u043B\u0443\u0447\u0435\u043D\u0438\u0435 \u043A\u043E\u043B\u0438\u0447\u0435\u0441\u0442\u0432\u0430 \u0437\u0430\u043A\u043B\u0430\u0434\u043E\u043A artworks\uFF1A%1 \u0438\u0437 %2",sort_getPublicFollowing:"\u041F\u043E\u043B\u0443\u0447\u0435\u043D\u0438\u0435 \u043F\u0443\u0431\u043B\u0438\u0447\u043D\u043E\u0433\u043E \u0441\u043F\u0438\u0441\u043A\u0430 \u043F\u043E\u0434\u043F\u0438\u0441\u043E\u043A",sort_getPrivateFollowing:"\u041F\u043E\u043B\u0443\u0447\u0435\u043D\u0438\u0435 \u043F\u0440\u0438\u0432\u0430\u0442\u043D\u043E\u0433\u043E \u0441\u043F\u0438\u0441\u043A\u0430 \u043F\u043E\u0434\u043F\u0438\u0441\u043E\u043A",sort_filtering:"\u0424\u0438\u043B\u044C\u0442\u0440\u0430\u0446\u0438\u044F %1 \u0440\u0430\u0431\u043E\u0442 \u0441 \u043A\u043E\u043B\u0438\u0447\u0435\u0441\u0442\u0432\u043E\u043C \u0437\u0430\u043A\u043B\u0430\u0434\u043E\u043A \u043C\u0435\u043D\u044C\u0448\u0435 \u0447\u0435\u043C %2",sort_filteringHideFavorite:" \u0438\u0437\u0431\u0440\u0430\u043D\u043D\u044B\u0435 \u0440\u0430\u0431\u043E\u0442\u044B \u0438 ",sort_fullSizeThumb:"\u041F\u043E\u043A\u0430\u0437\u0430\u0442\u044C \u043D\u0435\u043E\u0442\u0440\u0435\u0434\u0430\u043A\u0442\u0438\u0440\u043E\u0432\u0430\u043D\u043D\u043E\u0435 \u0438\u0437\u043E\u0431\u0440\u0430\u0436\u0435\u043D\u0438\u0435 (\u0421\u0442\u0440\u0430\u043D\u0438\u0446\u044B \u043F\u043E\u0438\u0441\u043A\u0430 \u0438 Artwork)",nsort_getWorks:"\u041F\u043E\u043B\u0443\u0447\u0435\u043D\u0438\u0435 \u0440\u043E\u043C\u0430\u043D\u043E\u0432 \u0441\u0442\u0440\u0430\u043D\u0438\u0446\u044B: 1% \u0438\u0437 2%",nsort_sorting:"\u0421\u043E\u0440\u0442\u0438\u0440\u043E\u0432\u043A\u0430 \u043F\u043E \u043A\u043E\u043B\u0438\u0447\u0435\u0441\u0442\u0432\u0443 \u0437\u0430\u043A\u043B\u0430\u0434\u043E\u043A",nsort_hideFav:"\u041F\u0440\u0438 \u0441\u043E\u0440\u0442\u0438\u0440\u043E\u0432\u043A\u0435, \u0441\u043A\u0440\u044B\u0442\u044C \u0438\u0437\u0431\u0440\u0430\u043D\u043D\u043E\u0435",nsort_hideFollowed:"\u041F\u0440\u0438 \u0441\u043E\u0440\u0442\u0438\u0440\u043E\u0432\u043A\u0435, \u0441\u043A\u0440\u044B\u0442\u044C \u0440\u0430\u0431\u043E\u0442\u044B \u0445\u0443\u0434\u043E\u0436\u043D\u0438\u043A\u043E\u0432 \u043D\u0430 \u043A\u043E\u0442\u043E\u0440\u044B\u0445 \u043F\u043E\u0434\u043F\u0438\u0441\u0430\u043D\u044B",text_sort:"\u0421\u043E\u0440\u0442\u0438\u0440\u043E\u0432\u0430\u0442\u044C"},Texts[Lang.ja_JP]={install_title:"Welcome to PixivPreviewer",install_body:'<div style="position: absolute;left: 50%;top: 30%;font-size: 20px; color: white;transform:translate(-50%,0);"><p style="text-indent: 2em;">\u3054\u610F\u898B\u3084\u63D0\u6848\u306F\u5927\u6B53\u8FCE\u3067\u3059! \u261E<a style="color: green;" href="https://greasyfork.org/ja/scripts/30766-pixiv-previewer/feedback" target="_blank">\u30D5\u30A3\u30FC\u30C9\u30D0\u30C3\u30AF\u30DA\u30FC\u30B8</a></p><br><p style="text-indent: 2em;">\u521D\u3081\u3066\u4F7F\u3046\u5834\u5408\u306F\u3001\u261E<a style="color: green;" href="https://greasyfork.org/ja/scripts/30766-pixiv-previewer" target="_blank">\u8A73\u7D30\u30DA\u30FC\u30B8</a> \u3067\u30B9\u30AF\u30EA\u30D7\u30C8\u306E\u7D39\u4ECB\u3092\u898B\u308B\u3053\u3068\u3092\u304A\u52E7\u3081\u3057\u307E\u3059\u3002</p></div>',upgrade_body:'<h3>\u65B0\u3057\u3044\u8A2D\u5B9A\u30E1\u30CB\u30E5\u30FC!</h3>&nbsp&nbsp<p style="text-indent: 2em;">Pixiv Previewer\u3092\u3054\u5229\u7528\u3044\u305F\u3060\u304D\u3042\u308A\u304C\u3068\u3046\u3054\u3056\u3044\u307E\u3059\u3002\u3053\u306E\u30A2\u30C3\u30D7\u30C7\u30FC\u30C8\u3067\u306F\u3001\u8A2D\u5B9A\u30E1\u30CB\u30E5\u30FC\u306E\u30D3\u30B8\u30E5\u30A2\u30EB\u30A8\u30D5\u30A7\u30AF\u30C8\u304C\u8ABF\u6574\u3055\u308C\u307E\u3057\u305F\u3002\u554F\u984C\u3084\u63D0\u6848\u3092\u304A\u5F85\u3061\u3057\u3066\u304A\u308A\u307E\u3059! \u261E<a style="color: green;" href="https://greasyfork.org/ja/scripts/30766-pixiv-previewer/feedback" target="_blank">\u30D5\u30A3\u30FC\u30C9\u30D0\u30C3\u30AF\u30DA\u30FC\u30B8</a></p>',setting_settingSection:"\u8A2D\u5B9A",setting_language:"\u8A00\u8A9E",setting_preview:"\u30D7\u30EC\u30D3\u30E5\u30FC\u6A5F\u80FD",setting_animePreview:"\u3046\u3054\u30A4\u30E9\u30D7\u30EC\u30D3\u30E5\u30FC",setting_sortSection:"\u30BD\u30FC\u30C8",setting_sort:"\u30BD\u30FC\u30C8",setting_anime:"\u3046\u3054\u30A4\u30E9\u30C0\u30A6\u30F3\u30ED\u30FC\u30C9",setting_origin:"\u6700\u5927\u30B5\u30A4\u30BA\u306E\u753B\u50CF\u3092\u8868\u793A\u3059\u308B(\u9045\u304F\u306A\u308B\u53EF\u80FD\u6027\u304C\u3042\u308B)",setting_previewDelay:"\u30AB\u30FC\u30BD\u30EB\u3092\u91CD\u306D\u3066\u304B\u3089\u30D7\u30EC\u30D3\u30E5\u30FC\u3059\u308B\u307E\u3067\u306E\u9045\u5EF6(\u30DF\u30EA\u79D2)",setting_previewByKey:"\u30AD\u30FC\u3067\u30D7\u30EC\u30D3\u30E5\u30FC\u753B\u50CF\u306E\u8868\u793A\u3092\u5236\u5FA1\u3059\u308B (Ctrl)",setting_previewByKeyHelp:'\u3053\u308C\u3092\u6709\u52B9\u306B\u3059\u308B\u3068\u3001\u753B\u50CF\u306B\u30DE\u30A6\u30B9\u3092\u79FB\u52D5\u3057\u3066\u3082\u30D7\u30EC\u30D3\u30E5\u30FC\u753B\u50CF\u304C\u8868\u793A\u3055\u308C\u306A\u304F\u306A\u308A\u307E\u3059\u3002Ctrl\u30AD\u30FC\u3092\u62BC\u3059\u3068\u8868\u793A\u3055\u308C\u3001 "\u9045\u5EF6\u8868\u793A\u30D7\u30EC\u30D3\u30E5\u30FC" \u306E\u8A2D\u5B9A\u9805\u76EE\u306F\u7121\u52B9\u306B\u306A\u308A\u307E\u3059\u3002',setting_maxPage:"\u30BD\u30FC\u30C8\u3059\u308B\u3068\u304D\u306B\u53D6\u5F97\u3059\u308B\u6700\u5927\u30DA\u30FC\u30B8\u6570",setting_hideWork:"\u4E00\u5B9A\u4EE5\u4E0B\u306E\u30D6\u30AF\u30DE\u30FC\u30AF\u6570\u306E\u4F5C\u54C1\u3092\u975E\u8868\u793A\u306B\u3059\u308B",setting_hideAiWork:"AI\u306E\u4F5C\u54C1\u3092\u975E\u8868\u793A\u306B\u3059\u308B",setting_hideFav:"\u30D6\u30C3\u30AF\u30DE\u30FC\u30AF\u6570\u3092\u30BD\u30FC\u30C8\u6642\u306B\u975E\u8868\u793A\u306B\u3059\u308B",setting_hideFollowed:"\u30BD\u30FC\u30C8\u6642\u306B\u30D5\u30A9\u30ED\u30FC\u3057\u3066\u3044\u308B\u30A2\u30FC\u30C6\u30A3\u30B9\u30C8\u306E\u4F5C\u54C1\u3092\u975E\u8868\u793A",setting_hideByTag:"\u30BD\u30FC\u30C8\u6642\u306B\u6307\u5B9A\u3057\u305F\u30BF\u30B0\u306E\u4F5C\u54C1\u3092\u975E\u8868\u793A",setting_hideByTagPlaceholder:'\u30BF\u30B0\u540D\u3092\u5165\u529B\u3057\u3066\u304F\u3060\u3055\u3044\uFF08\u4F8B\uFF1A"tag1|tag2"\u3001\u6B63\u898F\u8868\u73FE\u5BFE\u5FDC\uFF09',setting_clearFollowingCache:"\u30AD\u30E3\u30C3\u30B7\u30E5\u3092\u30AF\u30EA\u30A2",setting_clearFollowingCacheHelp:"\u30D5\u30A9\u30ED\u30FC\u3057\u3066\u3044\u308B\u30A2\u30FC\u30C6\u30A3\u30B9\u30C8\u306E\u60C5\u5831\u304C\u30ED\u30FC\u30AB\u30EB\u306B1\u65E5\u4FDD\u5B58\u3055\u308C\u307E\u3059\u3002\u3059\u3050\u306B\u66F4\u65B0\u3057\u305F\u3044\u5834\u5408\u306F\u3001\u3053\u306E\u30AD\u30E3\u30C3\u30B7\u30E5\u3092\u30AF\u30EA\u30A2\u3057\u3066\u304F\u3060\u3055\u3044\u3002",setting_followingCacheCleared:"\u6210\u529F\u3057\u307E\u3057\u305F\u3002\u30DA\u30FC\u30B8\u3092\u66F4\u65B0\u3057\u3066\u304F\u3060\u3055\u3044\u3002",setting_blank:"\u4F5C\u54C1\u306E\u8A73\u7D30\u30DA\u30FC\u30B8\u3092\u65B0\u3057\u3044\u30BF\u30D6\u3067\u958B\u304F",setting_turnPage:"\u2190 \u2192 \u3092\u4F7F\u7528\u3057\u3066\u30DA\u30FC\u30B8\u3092\u3081\u304F\u308B\uFF08\u691C\u7D22\u30DA\u30FC\u30B8\uFF09",setting_save:"Save",setting_reset:"Reset",setting_resetHint:"\u3053\u308C\u306B\u3088\u308A\u3001\u3059\u3079\u3066\u306E\u8A2D\u5B9A\u304C\u524A\u9664\u3055\u308C\u3001\u30C7\u30D5\u30A9\u30EB\u30C8\u306B\u8A2D\u5B9A\u3055\u308C\u307E\u3059\u3002\u3088\u308D\u3057\u3044\u3067\u3059\u304B\uFF1F",setting_novelSort:"\u30BD\u30FC\u30C8\uFF08\u5C0F\u8AAC\uFF09",setting_novelMaxPage:"\u5C0F\u8AAC\u306E\u30BD\u30FC\u30C8\u306E\u30DA\u30FC\u30B8\u6570\u306E\u6700\u5927\u5024",setting_novelHideWork:"\u8A2D\u5B9A\u5024\u672A\u6E80\u306E\u30D6\u30C3\u30AF\u30DE\u30FC\u30AF\u6570\u306E\u4F5C\u54C1\u3092\u975E\u8868\u793A",setting_novelHideFav:"\u30BD\u30FC\u30C8\u6642\u306B\u304A\u6C17\u306B\u5165\u308A\u3092\u975E\u8868\u793A",setting_previewFullScreen:"\u5168\u753B\u9762\u30D7\u30EC\u30D3\u30E5\u30FC",setting_scrollLockWhenPreview:"\u30D7\u30EC\u30D3\u30E5\u30FC\u6642\u306B\u30DA\u30FC\u30B8\u306E\u30B9\u30AF\u30ED\u30FC\u30EB\u3092\u30ED\u30C3\u30AF\u3059\u308B",setting_novelSection:"\u30BD\u30FC\u30C8\uFF08\u5C0F\u8AAC\uFF09",setting_close:"\u9589\u3058\u308B",setting_maxXhr:"\u30D6\u30C3\u30AF\u30DE\u30FC\u30AF\u6570\u306E\u540C\u6642\u30EA\u30AF\u30A8\u30B9\u30C8\u6570\uFF08\u63A8\u596864\uFF09",setting_hideByCountLessThan:"\u753B\u50CF\u6570\u304C\u8A2D\u5B9A\u5024\u672A\u6E80\u306E\u4F5C\u54C1\u3092\u975E\u8868\u793A",setting_hideByCountMoreThan:"\u753B\u50CF\u6570\u304C\u8A2D\u5B9A\u5024\u3092\u8D85\u3048\u308B\u4F5C\u54C1\u3092\u975E\u8868\u793A",sort_noWork:"\u8868\u793A\u3059\u308B\u4F5C\u54C1\u304C\u3042\u308A\u307E\u305B\u3093\uFF08%1 \u4F5C\u54C1\u304C\u975E\u8868\u793A\uFF09",sort_getWorks:"\u30DA\u30FC\u30B8\u306E\u4F5C\u54C1\u3092\u53D6\u5F97\u4E2D\uFF1A%1 / %2",sort_getBookmarkCount:"\u4F5C\u54C1\u306E\u30D6\u30C3\u30AF\u30DE\u30FC\u30AF\u6570\u3092\u53D6\u5F97\u4E2D\uFF1A%1 / %2",sort_getPublicFollowing:"\u516C\u958B\u30D5\u30A9\u30ED\u30FC\u4E00\u89A7\u3092\u53D6\u5F97\u4E2D",sort_getPrivateFollowing:"\u975E\u516C\u958B\u30D5\u30A9\u30ED\u30FC\u4E00\u89A7\u3092\u53D6\u5F97\u4E2D",sort_filtering:"\u30D6\u30C3\u30AF\u30DE\u30FC\u30AF\u6570\u304C%2\u672A\u6E80\u306E\u4F5C\u54C1%1\u4EF6\u3092\u30D5\u30A3\u30EB\u30BF\u30EA\u30F3\u30B0",sort_filteringHideFavorite:" \u304A\u6C17\u306B\u5165\u308A\u767B\u9332\u6E08\u307F\u306E\u4F5C\u54C1\u304A\u3088\u3073  ",sort_fullSizeThumb:"\u30C8\u30EA\u30DF\u30F3\u30B0\u3055\u308C\u3066\u3044\u306A\u3044\u753B\u50CF\u3092\u8868\u793A\uFF08\u691C\u7D22\u30DA\u30FC\u30B8\u304A\u3088\u3073\u30E6\u30FC\u30B6\u30FC\u30DA\u30FC\u30B8\u306E\u307F\uFF09\u3002",nsort_getWorks:"\u5C0F\u8AAC\u306E\u30DA\u30FC\u30B8\u3092\u53D6\u5F97\u4E2D\uFF1A1% / 2%",nsort_sorting:"\u30D6\u30C3\u30AF\u30DE\u30FC\u30AF\u6570\u3067\u4E26\u3079\u66FF\u3048",nsort_hideFav:"\u30BD\u30FC\u30C8\u6642\u306B\u304A\u6C17\u306B\u5165\u308A\u3092\u975E\u8868\u793A",nsort_hideFollowed:"\u30BD\u30FC\u30C8\u6642\u306B\u30D5\u30A9\u30ED\u30FC\u6E08\u307F\u4F5C\u8005\u306E\u4F5C\u54C1\u3092\u975E\u8868\u793A",text_sort:"\u30BD\u30FC\u30C8"};let g_language=Lang.auto,g_version="3.7.37",g_csrfToken="",g_logCount=0,g_pageType=-1,g_artworkUrl="/artworks/#id#",g_getArtworkUrl="/ajax/illust/#id#/pages",g_getUgoiraUrl="/ajax/illust/#id#/ugoira_meta",g_getNovelUrl="/ajax/search/novels/#key#?word=#key#&p=#page#",g_mousePos={x:0,y:0},g_loadingImage="https://pp-1252089172.cos.ap-chengdu.myqcloud.com/loading.gif",initialUrl=location.href,g_settings,g_maxXhr=64,g_sortComplete=!0,PageType={Search:0,BookMarkNew:1,Discovery:2,Member:3,Home:4,Ranking:5,NewIllust:6,R18:7,BookMark:8,Stacc:9,Artwork:10,NovelSearch:11,SearchTop:12,PageTypeCount:13},Pages={},ReturnMapSample={loadingComplete:!1,controlElements:[],forceUpdate:!1},ControlElementsAttributesSample={illustId:0,illustType:0,pageCount:1,title:"",userId:0,userName:"",bookmarkCount:0};function findToolbarCommon(){let e=$("#pp-toolbar");return e.length>0?e.get(0):($("body").append('<div id="pp-toolbar" style="position:fixed;right:28px;bottom:160px;"></div>'),$("#pp-toolbar").get(0))}function findToolbarOld(){return $("._toolmenu").get(0)}function convertThumbUrlToSmall(e){let t="c/540x540_70/img-master",n="_master";return e.replace(/c\/.*\/custom-thumb/,t).replace("_custom",n).replace(/c\/.*\/img-master/,t).replace("_square",n)}function processElementListCommon(e){$.each(e,function(t,n){let r=$(n),i={illustId:0,illustType:0,pageCount:1},d=r.find("a:first"),u=d.children("div:first").find("svg:first"),v=d.children("div:last").find("span:last");if(d==null){iLog.w("Can not found img or imageLink, skip this.");return}let x=d.attr("href");if(x==null){iLog.w("Invalid href, skip this.");return}let M=x.match(/artworks\/(\d+)/);if(M)i.illustId=M[1];else{iLog.e("Get illustId failed, skip this list item!");return}u.length>0&&(i.illustType=2),v.length>0&&(i.pageCount=parseInt(v.text()));let F=r.children("div:first");F.children().length==0?r.children("div").length>1&&(F=$(r.children("div").get(1))):F=F.children("div:first"),F.attr({illustId:i.illustId,illustType:i.illustType,pageCount:i.pageCount}),F.addClass("pp-control")})}function replaceThumbCommon(e){$.each(e,(t,n)=>{n=$(n);let r=n.find("img");if(r.length==0)return iLog.w("No img in the control element."),!0;let i=r.attr("src"),d=convertThumbUrlToSmall(i);i!=d&&r.attr("src",d).css("object-fit","contain")})}function findLiByImgTag(){let e=[];return $.each($("img"),(t,n)=>{let r=$(n),i=r;for(let d=0;d<3&&(i=i.parent(),i.length!=0);++d){if(i.attr("data-gtm-value")=="")continue;let u=i.attr("href");if(!(u==null||u=="")&&u.indexOf("/artwork")!=-1)for(let v=0;v<10&&(r=r.parent(),r.length!=0);++v){if(r.get(0).tagName=="LI"){e.push(r);break}if(r.parent().length>0&&r.parent().get(0).tagName=="UL"){e.push(r);break}r.parent().parent().length>0&&r.parent().parent().get(0).tagName=="NAV"&&e.push(r)}}}),e}function showSearchLinksForDeletedArtworks(){const e=[{name:"Google",url:"https://www.google.com/search?q="},{name:"Bing",url:"https://www.bing.com/search?q="},{name:"Baidu",url:"https://www.baidu.com/s?wd="}];document.querySelectorAll("span[to]").forEach(n=>{const r=n.getAttribute("to");if(n.textContent.trim()==="-----"&&r.startsWith("/artworks/")){const i=`pixiv "${r.slice(10)}"`,d=document.createElement("span");d.className=n.className,e.forEach((u,v)=>{const x=document.createElement("a");x.href=u.url+encodeURIComponent(i),x.textContent=u.name,x.target="_blank",d.appendChild(x),v<e.length-1&&d.appendChild(document.createTextNode(" | "))}),n.parentNode.replaceChild(d,n)}})}Pages[PageType.Search]={PageTypeString:"SearchPage",CheckUrl:function(e){return/^https?:\/\/www.pixiv.net\/tags\/.*\/(artworks|illustrations|manga)/.test(e)||/^https?:\/\/www.pixiv.net\/en\/tags\/.*\/(artworks|illustrations|manga)/.test(e)},ProcessPageElements:function(){let e={loadingComplete:!1,controlElements:[]},t=$("section");iLog.d("Page has "+t.length+" <section>."),iLog.d(t);let n=-1,r=0;if(t.length==0)return iLog.e("No suitable <section>!"),e;$.each(t,(u,v)=>{$(v).find("aside").length>0?n=u:r=u}),iLog.v("premium: "+n),iLog.v("result: "+r);let i=$(t[r]).find("ul"),d=i.find("li").toArray();if(n!=-1){let u=$(t[n]).find("ul").find("li");d=d.concat(u.toArray())}if(n!=-1){let u=$(t[n]).find("aside");$.each(u.children(),(v,x)=>{x.tagName.toLowerCase()!="ul"?x.remove():$(x).css("-webkit-mask","0")}),u.next().remove()}return processElementListCommon(d),e.controlElements=$(".pp-control"),this.private.pageSelector=i.next().get(0),this.private.pageSelector==null&&(this.private.pageSelector=i.parent().next().get(0)),e.loadingComplete=!0,this.private.imageListConrainer=i.get(0),iLog.d("Process page elements complete."),iLog.d(e),this.private.returnMap=e,e},GetProcessedPageElements:function(){return this.private.returnMap==null?this.ProcessPageElements():this.private.returnMap},GetToolBar:function(){return findToolbarCommon()},HasAutoLoad:!0,GetImageListContainer:function(){return this.private.imageListConrainer},GetFirstImageElement:function(){return $(this.private.imageListConrainer).find("li").get(0)},GetPageSelector:function(){return this.private.pageSelector},private:{imageListContainer:null,pageSelector:null,returnMap:null}},Pages[PageType.BookMarkNew]={PageTypeString:"BookMarkNewPage",CheckUrl:function(e){return/^https:\/\/www.pixiv.net\/bookmark_new_illust.php.*/.test(e)||/^https:\/\/www.pixiv.net\/bookmark_new_illust_r18.php.*/.test(e)},ProcessPageElements:function(){let e={loadingComplete:!1,controlElements:[]},t=$("section");iLog.d("Page has "+t.length+" <section>."),iLog.d(t);let n=t.find("ul").find("li");if(processElementListCommon(n),e.controlElements=$(".pp-control"),e.loadingComplete=!0,iLog.d("Process page elements complete."),iLog.d(e),this.private.returnMap=e,g_settings.fullSizeThumb){if(!this.private.returnMap.loadingComplete)return;replaceThumbCommon(this.private.returnMap.controlElements)}return e},GetProcessedPageElements:function(){return this.private.returnMap==null?this.ProcessPageElements():this.private.returnMap},GetToolBar:function(){return findToolbarCommon()},HasAutoLoad:!0,private:{returnMap:null}},Pages[PageType.Discovery]={PageTypeString:"DiscoveryPage",CheckUrl:function(e){return/^https?:\/\/www.pixiv.net\/discovery.*/.test(e)},ProcessPageElements:function(){let e={loadingComplete:!1,controlElements:[]},t=$(".gtm-illust-recommend-zone");if(t.length>0)iLog.d("Found container div."),iLog.d(t);else return iLog.e("Can not found container div."),e;let n=t.find("ul").children("li");return processElementListCommon(n),e.controlElements=$(".pp-control"),e.loadingComplete=!0,iLog.d("Process page elements complete."),iLog.d(e),this.private.returnMap=e,e},GetProcessedPageElements:function(){return this.private.returnMap==null?this.ProcessPageElements():this.private.returnMap},GetToolBar:function(){return findToolbarCommon()},HasAutoLoad:!0,private:{returnMap:null}},Pages[PageType.Member]={PageTypeString:"MemberPage/MemberIllustPage/MemberBookMark",CheckUrl:function(e){return/^https?:\/\/www.pixiv.net\/(en\/)?users\/\d+/.test(e)},ProcessPageElements:function(){showSearchLinksForDeletedArtworks();let e={loadingComplete:!1,controlElements:[]},t=findLiByImgTag();iLog.d(t);let n=$("section");if(iLog.d("Page has "+n.length+" <section>."),iLog.d(n),processElementListCommon(t),e.controlElements=$(".pp-control"),e.loadingComplete=!0,iLog.d("Process page elements complete."),iLog.d(e),this.private.returnMap=e,g_settings.fullSizeThumb){if(!this.private.returnMap.loadingComplete)return;replaceThumbCommon(this.private.returnMap.controlElements)}return e},GetProcessedPageElements:function(){return this.private.returnMap==null?this.ProcessPageElements():this.private.returnMap},GetToolBar:function(){return findToolbarCommon()},HasAutoLoad:!0,private:{returnMap:null}},Pages[PageType.Home]={PageTypeString:"HomePage",CheckUrl:function(e){return/https?:\/\/www.pixiv.net\/?$/.test(e)||/https?:\/\/www.pixiv.net\/en\/?$/.test(e)||/https?:\/\/www.pixiv.net\/illustration\/?$/.test(e)||/https?:\/\/www.pixiv.net\/manga\/?$/.test(e)||/https?:\/\/www.pixiv.net\/cate_r18\.php$/.test(e)||/https?:\/\/www.pixiv.net\/en\/cate_r18\.php$/.test(e)},ProcessPageElements:function(){let e={loadingComplete:!1,controlElements:[]},t=findLiByImgTag();if(processElementListCommon(t),e.controlElements=$(".pp-control"),e.loadingComplete=!0,iLog.d("Process page elements complete."),iLog.d(e),this.private.returnMap){let n=new Set;$.each(this.private.returnMap.controlElements,(r,i)=>{n.add($(i).attr("illustId"))}),$.each(e.controlElements,(r,i)=>{if(!n.has($(i).attr("illustId")))return e.forceUpdate=!0,!1})}if(this.private.returnMap=e,g_settings.fullSizeThumb){if(!this.private.returnMap.loadingComplete)return;replaceThumbCommon(this.private.returnMap.controlElements)}return e},GetProcessedPageElements:function(){return this.private.returnMap==null?this.ProcessPageElements():this.private.returnMap},GetToolBar:function(){return findToolbarCommon()},HasAutoLoad:!0,private:{returnMap:null}},Pages[PageType.Ranking]={PageTypeString:"RankingPage",CheckUrl:function(e){return/^https?:\/\/www.pixiv.net\/ranking.php.*/.test(e)},ProcessPageElements:function(){let e={loadingComplete:!1,controlElements:[]},t=$("._work");return iLog.d("Found .work, length: "+t.length),iLog.d(t),t.each(function(n,r){let i=$(r),d={illustId:0,illustType:0,pageCount:1},u=i.attr("href");if(u==null||u===""){iLog.w("Can not found illust id, skip this.");return}let v=u.match(/artworks\/(\d+)/);if(v)d.illustId=v[1];else{iLog.w("Can not found illust id, skip this.");return}i.hasClass("multiple")&&(d.pageCount=i.find(".page-count").find("span").text()),i.hasClass("ugoku-illust")&&(d.illustType=2),i.attr({illustId:d.illustId,illustType:d.illustType,pageCount:d.pageCount}),e.controlElements.push(r)}),e.loadingComplete=!0,iLog.d("Process page elements complete."),iLog.d(e),this.private.returnMap=e,e},GetProcessedPageElements:function(){return this.private.returnMap==null?this.ProcessPageElements():this.private.returnMap},GetToolBar:function(){return findToolbarOld()},HasAutoLoad:!0,private:{returnMap:null}},Pages[PageType.NewIllust]={PageTypeString:"NewIllustPage",CheckUrl:function(e){return/^https?:\/\/www.pixiv.net\/new_illust.php.*/.test(e)},ProcessPageElements:function(){let e={loadingComplete:!1,controlElements:[]},t=findLiByImgTag();if(processElementListCommon(t),e.controlElements=$(".pp-control"),e.loadingComplete=!0,iLog.d("Process page elements complete."),iLog.d(e),this.private.returnMap=e,g_settings.fullSizeThumb){if(!this.private.returnMap.loadingComplete)return;replaceThumbCommon(this.private.returnMap.controlElements)}return e},GetProcessedPageElements:function(){return this.private.returnMap==null?this.ProcessPageElements():this.private.returnMap},GetToolBar:function(){return findToolbarCommon()},HasAutoLoad:!0,private:{returnMap:null}},Pages[PageType.R18]={PageTypeString:"R18Page",CheckUrl:function(e){return/^https?:\/\/www.pixiv.net\/cate_r18.php.*/.test(e)},ProcessPageElements:function(){},GetToolBar:function(){},HasAutoLoad:!1},Pages[PageType.BookMark]={PageTypeString:"BookMarkPage",CheckUrl:function(e){return/^https:\/\/www.pixiv.net\/bookmark.php\/?$/.test(e)},ProcessPageElements:function(){let e={loadingComplete:!1,controlElements:[]},t=$(".image-item");return iLog.d("Found images, length: "+t.length),iLog.d(t),t.each(function(n,r){let i=$(r),d=i.find("._work");if(d.length===0){iLog.w("Can not found ._work, skip this.");return}let u={illustId:0,illustType:0,pageCount:1},v=d.attr("href");if(v==null||v===""){iLog.w("Can not found illust id, skip this.");return}let x=v.match(/artworks\/(\d+)/);if(x)u.illustId=x[1];else{iLog.w("Can not found illust id, skip this.");return}d.hasClass("multiple")&&(u.pageCount=i.find(".page-count").find("span").text()),d.hasClass("ugoku-illust")&&(u.illustType=2);let M=i.children("a:first");M.attr({illustId:u.illustId,illustType:u.illustType,pageCount:u.pageCount}),e.controlElements.push(M.get(0))}),e.loadingComplete=!0,iLog.d("Process page elements complete."),iLog.d(e),this.private.returnMap=e,e},GetProcessedPageElements:function(){return this.private.returnMap==null?this.ProcessPageElements():this.private.returnMap},GetToolBar:function(){return findToolbarOld()},HasAutoLoad:!1,private:{returnMap:null}},Pages[PageType.Stacc]={PageTypeString:"StaccPage",CheckUrl:function(e){return/^https:\/\/www.pixiv.net\/stacc.*/.test(e)},ProcessPageElements:function(){let e={loadingComplete:!1,controlElements:[]},t=$("._work");return iLog.d("Found .work, length: "+t.length),iLog.d(t),t.each(function(n,r){let i=$(r),d={illustId:0,illustType:0,pageCount:1},u=i.attr("href");if(u==null||u===""){iLog.w("Can not found illust id, skip this.");return}let v=u.match(/illust_id=(\d+)/);if(v)d.illustId=v[1];else{iLog.w("Can not found illust id, skip this.");return}i.hasClass("multiple")&&(d.pageCount=i.find(".page-count").find("span").text()),i.hasClass("ugoku-illust")&&(d.illustType=2),i.attr({illustId:d.illustId,illustType:d.illustType,pageCount:d.pageCount}),e.controlElements.push(r)}),e.loadingComplete=!0,iLog.d("Process page elements complete."),iLog.d(e),this.private.returnMap=e,e},GetProcessedPageElements:function(){return this.private.returnMap==null?this.ProcessPageElements():this.private.returnMap},GetToolBar:function(){return findToolbarOld()},HasAutoLoad:!0,private:{returnMap:null}},Pages[PageType.Artwork]={PageTypeString:"ArtworkPage",CheckUrl:function(e){return/^https:\/\/www.pixiv.net\/artworks\/.*/.test(e)||/^https:\/\/www.pixiv.net\/en\/artworks\/.*/.test(e)},ProcessPageElements:function(){let e=$("main").find("figure").find("canvas");$("main").find("figure").find("canvas").length>0&&(this.private.needProcess=!0,e.addClass("pp-canvas"));let t={loadingComplete:!1,controlElements:[]},n=findLiByImgTag();if(processElementListCommon(n),t.controlElements=$(".pp-control"),t.loadingComplete=!0,iLog.d("Process page elements complete."),iLog.d(t),this.private.returnMap=t,g_settings.fullSizeThumb){if(!this.private.returnMap.loadingComplete)return;replaceThumbCommon(this.private.returnMap.controlElements)}return t},GetProcessedPageElements:function(){return this.private.returnMap==null?this.ProcessPageElements():this.private.returnMap},GetToolBar:function(){return findToolbarCommon()},HasAutoLoad:!0,Work:function(){function e(t,n){if(!g_settings.enableAnimeDownload)return;let r=t.clone().css({bottom:"50px",padding:0,width:"48px",height:"48px",opacity:"0.4",cursor:"pointer"});r.get(0).innerHTML='<svg viewBox="0 0 120 120" style="width: 40px; height: 40px; stroke-width: 10; stroke-linecap: round; stroke-linejoin: round; border-radius: 24px; background-color: black; stroke: limegreen; fill: none;" class="_3Fo0Hjg"><polyline points="60,30 60,90"></polyline><polyline points="30,60 60,90 90,60"></polyline></svg></button>';function i(){function d(u){if(u.offsetParent){let v=d(u.offsetParent);return{offsetTop:u.offsetTop+v.offsetTop,offsetLeft:u.offsetLeft+v.offsetLeft}}else return{offsetTop:u.offsetTop,offsetLeft:u.offsetLeft}}}i(),$(window).on("resize",i),t.after(r),r.mouseover(function(){$(this).css("opacity","0.2")}).mouseleave(function(){$(this).css("opacity","0.4")}).click(function(){let d="",u=location.href.match(/artworks\/(\d+)/);if(u)d=u[1],iLog.i("IllustId="+d);else{iLog.e("Can not found illust id!");return}$.ajax(g_getUgoiraUrl.replace("#id#",d),{method:"GET",success:function(v){if(iLog.d(v),v.error==!0){iLog.e("Server response an error: "+v.message);return}let x=window.open("_blank");x.location=v.body.originalSrc},error:function(){iLog.e("Request zip file failed!")}})})}if(this.private.needProcess){let t=$(".pp-canvas"),r=$('div[role="presentation"]:last').find("button"),i=parseInt($("header").css("height"))+parseInt($("header").css("padding-top"))+parseInt($("header").css("padding-bottom"))+parseInt($("header").css("margin-top"))+parseInt($("header").css("margin-bottom"))+parseInt($("header").css("border-bottom-width"))+parseInt($("header").css("border-top-width"));e(r,i)}},private:{needProcess:!1,returnMap:null}},Pages[PageType.NovelSearch]={PageTypeString:"NovelSearchPage",CheckUrl:function(e){return/^https:\/\/www.pixiv.net\/tags\/.*\/novels/.test(e)||/^https:\/\/www.pixiv.net\/en\/tags\/.*\/novels/.test(e)},ProcessPageElements:function(){let e={loadingComplete:!1,controlElements:[]};return $("section:first").find("ul:first").length>0&&(e.loadingComplete=!0),this.private.returnMap=e,e},GetProcessedPageElements:function(){return this.private.returnMap==null?this.ProcessPageElements():this.private.returnMap},GetToolBar:function(){return findToolbarCommon()},GetPageSelector:function(){return $("section:first").find("nav:first")},HasAutoLoad:!1,private:{returnMap:null}},Pages[PageType.SearchTop]={PageTypeString:"SearchTopPage",CheckUrl:function(e){return/^https?:\/\/www.pixiv.net(\/en)?\/tags\/[^/*]/.test(e)},ProcessPageElements:function(){let e={loadingComplete:!1,controlElements:[]},t=$("section");iLog.d("Page has "+t.length+" <section>."),iLog.d(t);let n=-1,r=0;if(t.length==0)return iLog.e("No suitable <section>!"),e;t.length>1&&(n=0,r=1),iLog.v("premium: "+n),iLog.v("result: "+r);let i=$(t[r]).find("ul"),d=i.find("li").toArray();if(n!=-1){let u=$(t[n]).find("ul").find("li");d=d.concat(u.toArray())}if(n!=-1){let u=$(t[n]).find("aside");$.each(u.children(),(v,x)=>{x.tagName.toLowerCase()!="ul"?x.remove():$(x).css("-webkit-mask","0")}),u.next().remove()}return processElementListCommon(d),e.controlElements=$(".pp-control"),this.private.pageSelector=i.next().get(0),this.private.pageSelector==null&&(this.private.pageSelector=i.parent().next().get(0)),e.loadingComplete=!0,this.private.imageListConrainer=i.get(0),iLog.d("Process page elements complete."),iLog.d(e),this.private.returnMap=e,e},GetProcessedPageElements:function(){return this.private.returnMap==null?this.ProcessPageElements():this.private.returnMap},GetToolBar:function(){return findToolbarCommon()},HasAutoLoad:!1,GetImageListContainer:function(){return this.private.imageListConrainer},GetFirstImageElement:function(){return $(this.private.imageListConrainer).find("li").get(0)},GetPageSelector:function(){return this.private.pageSelector},private:{imageListContainer:null,pageSelector:null,returnMap:null}};function CheckUrlTest(){let e=["http://www.pixiv.net","http://www.pixiv.net","https://www.pixiv.net","https://www.pixiv.net/","https://www.pixiv.net/?lang=en","https://www.pixiv.net/search.php?s_mode=s_tag&word=miku","https://www.pixiv.net/search.php?word=VOCALOID&s_mode=s_tag_full","https://www.pixiv.net/discovery","https://www.pixiv.net/discovery?x=1","https://www.pixiv.net/member.php?id=3207350","https://www.pixiv.net/member_illust.php?id=3207350&type=illust","https://www.pixiv.net/bookmark.php?id=3207350&rest=show","https://www.pixiv.net/ranking.php?mode=daily&content=ugoira","https://www.pixiv.net/ranking.php?mode=daily","https://www.pixiv.net/new_illust.php","https://www.pixiv.net/new_illust.php?x=1","https://www.pixiv.net/cate_r18.php","https://www.pixiv.net/cate_r18.php?x=1","https://www.pixiv.net/bookmark.php","https://www.pixiv.net/bookmark.php?x=1","https://www.pixiv.net/stacc?mode=unify","https://www.pixiv.net/artworks/77996773","https://www.pixiv.net/artworks/77996773#preview","https://www.pixiv.net/tags/miku/novels"];for(let t=0;t<e.length;t++)for(let n=0;n<PageType.PageTypeCount;n++)Pages[n].CheckUrl(e[t])&&(console.log(e[t]),console.log("["+t+"] is "+Pages[n].PageTypeString))}function preventDefault(e){e.preventDefault()}const wheelOpt={passive:!1},wheelEvent="onwheel"in document.createElement("div")?"wheel":"mousewheel";function disableScroll(){window.addEventListener(wheelEvent,preventDefault,wheelOpt)}function enableScroll(){window.removeEventListener(wheelEvent,preventDefault,wheelOpt)}function gmcBuildFrame(){iLog.d("gmcBuildFrame()");let e=$('<div id="gmc" class="hidden"></div>'),t=$('<div id="gmc-frame"></div>');return e.append(t),$("body").append(e),gmcBuildStyle(),t.get(0)}function gmcBuildStyle(){iLog.d("gmcBuildStyle()");const e=document.createElement("style");e.textContent+=`
      /* Modal */

      #gmc
      {
        display: inline-flex !important;
        justify-content: center !important;
        align-items: center !important;
        position: fixed !important;
        top: 0 !important;
        left: 0 !important;
        width: 100vw !important;
        height: 100vh !important;
        z-index: 9999;
        background: none !important;

        pointer-events: none;
      }

      #gmc.hidden
      {
        display: none !important;
      }

      #gmc-frame
      {
        font-family: -apple-system,BlinkMacSystemFont,"Segoe UI","Noto Sans",Helvetica,Arial,sans-serif,"Apple Color Emoji","Segoe UI Emoji";
        text-align: left;

        inset: initial !important;
        border: none !important;
        max-height: initial !important;
        max-width: initial !important;
        opacity: 1 !important;
        position: static !important;
        z-index: initial !important;

        width: 85% !important;
        height: 75% !important;
        overflow-y: auto !important;

        border: none !important;
        border-radius: 0.375rem !important;

        pointer-events: auto;
      }

      #gmc-frame_wrapper
      {
        display: flow-root !important;
        padding: 2rem !important;
      }

      /* Sections */

      #gmc-frame #gmc-frame_section_0
      {
        width: 100%;
        border-radius: 6px;
        display: table;
      }

      #gmc-frame #gmc-frame_section_1,
      #gmc-frame #gmc-frame_section_2,
      #gmc-frame #gmc-frame_section_3,
      #gmc-frame #gmc-frame_section_4
      {
        margin-top: 2rem;
        width: 49%;
        box-sizing: border-box;
      }

      #gmc-frame #gmc-frame_section_1
      {
        border-radius: 6px;
        float: left;
      }

      #gmc-frame #gmc-frame_section_2
      {
        border-radius: 6px;
        float: right;
      }

      #gmc-frame #gmc-frame_section_3
      {
        width: 49%;
        margin-top: 2rem;
        box-sizing: border-box;
        border-radius: 6px;
        float: left;
      }

      #gmc-frame #gmc-frame_section_4
      {
        display: inline-grid;
        width: 49%;
        margin-top: 2rem;
        box-sizing: border-box;
        border-radius: 6px;
        float: right
      }

      #gmc-frame #gmc-frame_section_3 .config_var:not(:last-child),
      #gmc-frame #gmc-frame_section_4 .config_var:not(:last-child)
      {
        padding-bottom: 1rem;
      }

      /* Fields */

      #gmc-frame .config_header
      {
        font-size: 2em;
        font-weight: 400;
        line-height: 1.25;

        padding-bottom: 0.3em;
        margin-bottom: 16px;
      }

      #gmc-frame #gmc-frame_type_var
      {
        display: inline-flex;
      }

      #gmc-frame .section_header
      {
        font-size: 1.5em;
        font-weight: 600;
        line-height: 1.25;

        margin-bottom: 16px;
        padding: 1rem 1.5rem;
      }

      #gmc-frame .section_desc,
      #gmc-frame h3
      {
        background: none;
        border: none;
        font-size: 1.25em;

        margin-bottom: 16px;
        font-weight: 600;
        line-height: 1.25;
        text-align: left;
      }

      #gmc-frame .config_var
      {
        padding: 0rem 1.5rem;
        margin-bottom: 1rem;
        display: flex;
      }

      #gmc-frame .config_var[id*='flipCreateInbox_var'],
      #gmc-frame .config_var[id*='flipIssuesPullRequests_var']
      {
        display: flex;
      }

      #gmc-frame .field_label
      {
        font-weight: 600;
        margin-right: 0.5rem;
      }

      #gmc-frame .field_label,
      #gmc-frame .gmc-label
      {
        width: 15vw;
      }

      #gmc-frame .radio_label:not(:last-child)
      {
        margin-right: 4rem;
      }

      #gmc-frame .radio_label
      {
        line-height: 17px;
      }

      #gmc-frame .gmc-label
      {
        display: table-caption;
        line-height: 17px;
      }

      #gmc-frame input[type="radio"]
      {
        appearance: none;
        border-style: solid;
        cursor: pointer;
        height: 1rem;
        place-content: center;
        position: relative;
        width: 1rem;
        border-radius: 624rem;
        transition: background-color 0s ease 0s, border-color 80ms cubic-bezier(0.33, 1, 0.68, 1) 0s;
        margin-right: 0.5rem;
        flex: none;
      }

      #gmc-frame input[type="checkbox"]
      {
        appearance: none;
        border-style: solid;
        border-width: 1px;
        cursor: pointer;
        place-content: center;
        position: relative;
        height: 17px;
        width: 17px;
        border-radius: 3px;
        transition: background-color 0s ease 0s, border-color 80ms cubic-bezier(0.33, 1, 0.68, 1) 0s;
      }

      #gmc-frame #gmc-frame_field_type
      {
        display: flex;
      }

      #gmc-frame input[type="radio"]:checked
      {
        border-width: 0.25rem;
      }

      #gmc-frame input[type="radio"]:checked,
      #gmc-frame .gmc-checkbox:checked
      {
        border-color: #2f81f7;
      }

      #gmc-frame .gmc-checkbox:checked
      {
        background-color: #2f81f7;
      }

      #gmc-frame .gmc-checkbox:checked::before
      {
        visibility: visible;
        transition: visibility 0s linear 0s;
      }

      #gmc-frame .gmc-checkbox::before,
      #gmc-frame .gmc-checkbox:indeterminate::before
      {
        animation: 80ms cubic-bezier(0.65, 0, 0.35, 1) 80ms 1 normal forwards running checkmarkIn;
      }

      #gmc-frame .gmc-checkbox::before
      {
        width: 1rem;
        height: 1rem;
        visibility: hidden;
        content: "";
        background-color: #FFFFFF;
        clip-path: inset(0);
        -webkit-mask-image: url("data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTIiIGhlaWdodD0iOSIgdmlld0JveD0iMCAwIDEyIDkiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxwYXRoIGZpbGwtcnVsZT0iZXZlbm9kZCIgY2xpcC1ydWxlPSJldmVub2RkIiBkPSJNMTEuNzgwMyAwLjIxOTYyNUMxMS45MjEgMC4zNjA0MjcgMTIgMC41NTEzMDUgMTIgMC43NTAzMTNDMTIgMC45NDkzMjEgMTEuOTIxIDEuMTQwMTkgMTEuNzgwMyAxLjI4MUw0LjUxODYgOC41NDA0MkM0LjM3Nzc1IDguNjgxIDQuMTg2ODIgOC43NiAzLjk4Nzc0IDguNzZDMy43ODg2NyA4Ljc2IDMuNTk3NzMgOC42ODEgMy40NTY4OSA4LjU0MDQyTDAuMjAxNjIyIDUuMjg2MkMwLjA2ODkyNzcgNS4xNDM4MyAtMC4wMDMzMDkwNSA0Ljk1NTU1IDAuMDAwMTE2NDkzIDQuNzYwOThDMC4wMDM1NTIwNSA0LjU2NjQzIDAuMDgyMzg5NCA0LjM4MDgxIDAuMjIwMDMyIDQuMjQzMjFDMC4zNTc2NjUgNC4xMDU2MiAwLjU0MzM1NSA0LjAyNjgxIDAuNzM3OTcgNC4wMjMzOEMwLjkzMjU4NCA0LjAxOTk0IDEuMTIwOTMgNC4wOTIxNyAxLjI2MzM0IDQuMjI0ODJMMy45ODc3NCA2Ljk0ODM1TDEwLjcxODYgMC4yMTk2MjVDMTAuODU5NSAwLjA3ODk5MjMgMTEuMDUwNCAwIDExLjI0OTUgMEMxMS40NDg1IDAgMTEuNjM5NSAwLjA3ODk5MjMgMTEuNzgwMyAwLjIxOTYyNVoiIGZpbGw9IndoaXRlIi8+Cjwvc3ZnPgo=");
        -webkit-mask-size: 75%;
        -webkit-mask-repeat: no-repeat;
        -webkit-mask-position: center center;
        display: block;
      }

      #gmc-frame .gmc-checkbox
      {
        appearance: none;
        border-style: solid;
        border-width: 1px;
        cursor: pointer;

        height: var(--base-size-16,16px);
        margin: 0.125rem 0px 0px;
        place-content: center;
        position: relative;
        width: var(--base-size-16,16px);
        border-radius: 3px;
        transition: background-color 0s ease 0s, border-color 80ms cubic-bezier(0.33, 1, 0.68, 1) 0s;
      }

      #gmc-frame input
      {
        color: fieldtext;
        letter-spacing: normal;
        word-spacing: normal;
        text-transform: none;
        text-indent: 0px;
        text-shadow: none;
        display: inline-block;
        text-align: start;
        appearance: auto;
        -webkit-rtl-ordering: logical;
      }

      #gmc-frame .gmc-checkbox:checked
      {
        transition: background-color 0s ease 0s, border-color 80ms cubic-bezier(0.32, 0, 0.67, 0) 0ms;
      }

      #gmc-frame input[type="text"],
      #gmc-frame textarea,
      #gmc-frame select
      {
        padding: 5px 12px;
        border-radius: 6px;
      }

      #gmc-frame input[type="text"]:focus,
      #gmc-frame textarea:focus,
      #gmc-frame select:focus
      {
        border-color: #2f81f7;
        outline: 1px solid #2f81f7;
      }

      #gmc-frame svg
      {
        height: 17px;
        width: 17px;
        margin-left: 0.5rem;
      }

      #gmc small
      {
        font-size: x-small;
        font-weight: 600;
        margin-left: 3px;
      }

      /* Button bar */

      #gmc-frame #gmc-frame_buttons_holder
      {
        position: fixed;
        width: 85%;
        text-align: right;

        left: 50%;
        bottom: 2%;
        transform: translate(-50%, 0%);
        padding: 1rem;

        border-radius: 0.375rem;

        display: flex;
        align-items: center;
      }

      #gmc-frame #gmc-frame_buttons_holder .left-aligned
      {
        order: 1;
        margin-right: auto;
      }

      #gmc-frame #gmc-frame_buttons_holder > *
      {
        order: 2;
      }

      #gmc-frame .saveclose_buttons
      {
        margin-left: 0.5rem;
      }

      #gmc-frame [type=button],
      #gmc-frame .saveclose_buttons
      {
        position: relative;
        display: inline-block;
        padding: 5px 16px;
        font-size: 14px;
        font-weight: 500;
        line-height: 20px;
        white-space: nowrap;
        vertical-align: middle;
        cursor: pointer;
        -webkit-user-select: none;
        user-select: none;
        border: 1px solid;
        border-radius: 6px;
        -webkit-appearance: none;
        appearance: none;

        font-family: -apple-system,BlinkMacSystemFont,"Segoe UI","Noto Sans",Helvetica,Arial,sans-serif,"Apple Color Emoji","Segoe UI Emoji";
      }

      @keyframes fadeOut
      {
        from {
          opacity: 1;
        }
        to {
          opacity: 0;
        }
      }

      #gmc-saved
      {
        display: none;
        margin-right: 10px;
        animation: fadeOut 0.75s ease 2s forwards;
      }

        #gmc-frame
        {
          background-color: #F6F8FA;
          color: #1F2328;
          box-shadow: 0 0 0 1px #D0D7DE, 0 16px 32px rgba(1,4,9,0.2) !important;
        }

        #gmc-frame .section_header_holder
        {
          background-color: #FFFFFF;
          border: 1px solid #D0D7DE;
        }

        #gmc-frame_buttons_holder
        {
          background-color: #FFFFFF;
          box-shadow: 0 0 0 1px #D0D7DE, 0 16px 32px rgba(1,4,9,0.2) !important;
        }

        #gmc-frame input[type="text"],
        #gmc-frame textarea,
        #gmc-frame select
        {
          border: 1px solid #D0D7DE;
        }

        #gmc-frame select
        {
          background-color: #F6F8FA;
        }

        #gmc-frame select:hover
        {
          background-color: #F3F4F6;
          border-color: #1F232826;
        }

        #gmc-frame input[type="text"],
        #gmc-frame textarea
        {
          background-color: #F6F8FA;
          color: #1F2328;
        }

        #gmc-frame input[type="text"]:focus,
        #gmc-frame textarea:focus
        {
          background-color: #FFFFFF;
        }

        #gmc-frame [type=button],
        #gmc-frame .saveclose_buttons
        {
          background-color: #f6f8fa;
          border-color: #1f232826;
          box-shadow: 0 1px 0 rgba(31,35,40,0.04), inset 0 1px 0 rgba(255,255,255,0.25);
          color: #24292f;
        }

        #gmc-frame [type=button]:hover,
        #gmc-frame .saveclose_buttons:hover
        {
          background-color: #f3f4f6;
          border-color: #1f232826;
        }

        #gmc-frame .gmc-checkbox
        {
          border-color: #6E7781;
        }

        #gmc-frame input[type="radio"]
        {
          color: #6E7781;
        }

        #gmc-frame svg
        {
          fill: #000000;
        }

        #gmc-frame .section_header
        {
          border-bottom: 1px solid #D0D7DE;
        }

        #gmc-frame #gmc-frame_section_3 .config_var:not(:last-child),
        #gmc-frame #gmc-frame_section_4 .config_var:not(:last-child)
        {
          border-bottom: 1px solid #D0D7DE;
        }

        #gmc-frame #gmc-frame_saveBtn
        {
          background-color: #1F883D;
          border-color: rgba(31, 35, 40, 0.15);
          box-shadow: rgba(31, 35, 40, 0.1) 0px 1px 0px;
          color: #FFFFFF;
        }

        #gmc-frame #gmc-frame_saveBtn:hover
        {
          background-color: rgb(26, 127, 55);
        }

        #gmc-frame #gmc-frame_section_4
        {
          border: 1px solid #FF818266;
        }

        #gmc-frame #gmc-frame_section_4 input
        {
          background-color: #F6F8FA;
          border-color: #1F232826;
          box-shadow: 0 1px 0 rgba(31,35,40,0.04), inset 0 1px 0 rgba(255,255,255,0.25);
          color: #CF222E;
        }

        #gmc-frame #gmc-frame_section_4 input:hover
        {
          background-color: #A40E26;
          border-color: #1F232826;
          box-shadow: 0 1px 0 rgba(31,35,40,0.04);
          color: #ffffff;
        }

        #gmc-saved
        {
          color: #1a7f37;
        }

        #gmc-saved svg path
        {
          fill: #1a7f37;
        }

        #gmc-frame .reset_holder {
          display: none;
        }

        #gmc-frame_hideByTagList_var {
            display: none !important;
        }
      `,document.head.appendChild(e)}function gmcInitialized(){iLog.d("gmcInitialized()"),GMC.css.basic="",UpdateLogLevel(),StartLoad()}function gmcOpened(){iLog.d("gmcOpened()"),$("#gmc").removeClass("hidden"),$("#gmc-frame_saveBtn").text(Texts[g_language].setting_save),$("#gmc-frame_closeBtn").text(Texts[g_language].setting_close);function e(){iLog.d("updateCheckboxes()");const t=$('#gmc-frame input[type="checkbox"]');t.length>0?t.addClass("gmc-checkbox"):setTimeout(e,100)}e()}function gmcSaved(){iLog.d("gmcSaved()");let e=GMC.get("lang"),t;e=="Auto"?t=Lang.auto:e=="\u7B80\u4F53\u4E2D\u6587"?t=Lang.zh_CN:e=="English"?t=Lang.en_US:e=="\u0420\u0443\u0441\u0441\u043A\u0438\u0439 \u044F\u0437\u044B\u043A"?t=Lang.ru_RU:e=="\u65E5\u672C\u8A9E"&&(t=Lang.ja_JP),SetLocalStorage("PixivPreviewLang",t),location.href=location.href}function gmcClosed(){iLog.d("gmcClosed()")}var GMC;function gmcInit(){iLog.d("gmcInit()"),GMC=new GM_config({id:"gmc-frame",title:"Pixiv Previewer",events:{init:gmcInitialized,open:gmcOpened,save:gmcSaved,close:gmcClosed},frame:gmcBuildFrame(),fields:{lang:{label:Texts[g_language].setting_language,section:[Texts[g_language].setting_settingSection],type:"select",options:["Auto","\u7B80\u4F53\u4E2D\u6587","English","\u0420\u0443\u0441\u0441\u043A\u0438\u0439 \u044F\u0437\u044B\u043A","\u65E5\u672C\u8A9E"],default:"Auto"},fullSizeThumb:{label:Texts[g_language].sort_fullSizeThumb,type:"checkbox",default:!1},linkBlank:{label:Texts[g_language].setting_blank,type:"checkbox",default:!0},enableAnimeDownload:{label:Texts[g_language].setting_anime,type:"checkbox",default:!0},logLevel:{label:Texts[g_language].setting_logLevel,type:"select",options:["error","warning","info","debug"],default:"info"},clearSettings:{label:Texts[g_language].setting_reset,type:"button",click:()=>{confirm(Texts[g_language].setting_resetHint)||(SetLocalStorage("gmc-frame",""),location.href=location.href)}},clearFollowedUserCache:{label:Texts[g_language].setting_clearFollowingCache,type:"button",click:()=>{let e=dataLayer[0].user_id;SetLocalStorage("followingOfUid-"+e,null,-1)}},enablePreview:{label:Texts[g_language].setting_preview,section:[Texts[g_language].setting_preview],type:"checkbox",default:!0},enableAnimePreview:{label:Texts[g_language].setting_animePreview,type:"checkbox",default:!0},original:{label:Texts[g_language].setting_origin,type:"checkbox",default:!1},previewDelay:{label:Texts[g_language].setting_previewDelay,type:"text",default:200},previewByKey:{label:Texts[g_language].setting_previewByKey,type:"checkbox",default:!1},previewFullScreen:{label:Texts[g_language].setting_previewFullScreen,type:"checkbox",default:!1},scrollLockWhenPreview:{label:Texts[g_language].setting_scrollLockWhenPreview,type:"checkbox",default:!0},enableSort:{label:Texts[g_language].setting_sort,section:[Texts[g_language].setting_sortSection],type:"checkbox",default:!0},pageCount:{label:Texts[g_language].setting_maxPage,type:"text",default:3},favFilter:{label:Texts[g_language].setting_hideWork,type:"text",default:0},aiFilter:{label:Texts[g_language].setting_hideAiWork,type:"checkbox",default:!1},hideFavorite:{label:Texts[g_language].setting_hideFav,type:"checkbox",default:!1},hideFollowed:{label:Texts[g_language].setting_hideFollowed,type:"checkbox",default:!1},hideByTag:{label:Texts[g_language].setting_hideByTag,type:"checkbox",default:!1},hideByTagList:{label:Texts[g_language].setting_hideByTagPlaceholder,type:"hidden",default:""},hideByTagRegex:{label:Texts[g_language].setting_hideByTagPlaceholder,type:"text",default:""},hideCountLessThan:{label:Texts[g_language].setting_hideByCountLessThan,type:"text",default:0},hideCountMoreThan:{label:Texts[g_language].setting_hideByCountMoreThan,type:"text",default:0},pageByKey:{label:Texts[g_language].setting_turnPage,type:"checkbox",default:!1},maxXhr:{label:Texts[g_language].setting_maxXhr,type:"text",default:64},enableNovelSort:{label:Texts[g_language].setting_novelSort,section:[Texts[g_language].setting_novelSection],type:"checkbox",default:!0},novelPageCount:{label:Texts[g_language].setting_novelMaxPage,type:"text",default:3},novelFavFilter:{label:Texts[g_language].setting_novelHideWork,type:"text",default:0},novelHideFavorite:{label:Texts[g_language].setting_novelHideFav,type:"checkbox",default:!1}}})}let autoLoadInterval=null;function PixivPreview(){let e="";function t(m){var b=document.createElement("canvas"),y={canvas:b,chunkSize:3e5,loop:!0,autoStart:!0,debug:!1};if(m)for(var k in m)y[k]=m[k];var L=new ZipImagePlayer(y);return L.canvas=b,L}function n(){let m=Pages[g_pageType].GetProcessedPageElements();if(!m.loadingComplete){iLog.e("Page not load, should not call Preview!");return}function b(){let k=$(".pp-main");k.length!=0&&(k.css("display")=="none"?(iLog.d("Show main."),d(),k.show(),g_settings.previewFullScreen&&disableScroll()):(iLog.d("Hide main."),k.hide(),g_settings.previewFullScreen&&enableScroll()))}function y(){let k=$(".pp-main");k.length!=0&&k.css("display")=="none"&&(iLog.d("Show main."),d(),k.show(),g_settings.scrollLockWhenPreview&&disableScroll())}g_settings.previewByKey&&($(document).unbind("keydown"),$(document).keydown(k=>{k.keyCode==g_settings.previewKey&&b()})),$(m.controlElements).mouseenter(function(k){if(k.ctrlKey)return;let L=new Date().getTime(),P=parseInt(g_settings.previewDelay),T=$(this),p=T.attr("illustId"),a=T.attr("illustType"),o=T.attr("pageCount");if(p==null){iLog.e("Can not found illustId in this element's attrbutes.");return}if(a==null){iLog.e("Can not found illustType in this element's attrbutes.");return}if(o==null){iLog.e("Can not found pageCount in this element's attrbutes.");return}if(e=p,a==2&&!g_settings.enableAnimePreview){iLog.d("Anime preview disabled.");return}g_mousePos={x:k.pageX,y:k.pageY};let g=$(document.createElement("div")).addClass("pp-main").attr("illustId",p).css({position:"absolute","z-index":"999999",left:g_mousePos.x+"px",top:g_mousePos.y+"px","border-style":"solid","border-color":"#6495ed","border-width":"2px","border-radius":"20px",width:"48px",height:"48px","background-image":"url(https://pp-1252089172.cos.ap-chengdu.myqcloud.com/transparent.png)",display:"none","text-align":"center"});if($(".pp-main").remove(),$("body").append(g),g_settings.previewFullScreen&&(g.css({background:"#ffffff80",position:"fixed"}),g.click(f=>{$(f.target).hasClass("pp-image")||b()})),!g_settings.previewByKey){let f=P-(new Date().getTime()-L);f>0?setTimeout(y,f):y()}let l=$(new Image).addClass("pp-loading").attr("src",g_loadingImage).css({position:"absolute","border-radius":"20px",left:"0px",top:"0px"});g.append(l);let s=$(new Image).addClass("pp-image").css({height:"0px",width:"0px",display:"none","border-radius":"20px"});g.append(s);let c=$(new Image).addClass("pp-original").attr("src","https://source.pixiv.net/www/images/pixivcomic-favorite.png").css({position:"absolute",bottom:"5px",right:"5px",display:"none"});g.append(c),c.click(function(){window.open($(g).children("img")[1].src)});let h=$('<div class="pp-pageCount" style="display: flex;-webkit-box-align: center;align-items: center;box-sizing: border-box;margin-left: auto;height: 20px;color: rgb(255, 255, 255);font-size: 10px;line-height: 12px;font-weight: bold;flex: 0 0 auto;padding: 4px 6px;background: rgba(0, 0, 0, 0.32);border-radius: 10px;margin-top:5px;margin-right:5px;"><svg viewBox="0 0 9 10" width="9" height="10" style="stroke: none;line-height: 0;font-size: 0px;fill: currentcolor;"><path d="M8,3 C8.55228475,3 9,3.44771525 9,4 L9,9 C9,9.55228475 8.55228475,10 8,10 L3,10 C2.44771525,10 2,9.55228475 2,9 L6,9 C7.1045695,9 8,8.1045695 8,7 L8,3 Z M1,1 L6,1 C6.55228475,1 7,1.44771525 7,2 L7,7 C7,7.55228475 6.55228475,8 6,8 L1,8 C0.44771525,8 0,7.55228475 0,7 L0,2 C0,1.44771525 0.44771525,1 1,1 Z"></path></svg><span style="margin-left:2px;" class="pp-page">0/0</span></div>').css({position:"absolute",top:"0px",display:"none",right:"0px",display:"none"});g.append(h),$(".pp-main").mouseleave(function(f){g_settings.previewFullScreen||$(this).remove()});let w="";a==2?w=g_getUgoiraUrl.replace("#id#",p):w=g_getArtworkUrl.replace("#id#",p),$.ajax(w,{method:"GET",success:function(f){if(iLog.d("Got artwork urls:"),iLog.d(f),f.error===!0){iLog.e("Server responsed an error: "+f.message);return}if(p!=e){iLog.d("Drop this preview request.");return}if(a==2){let C=f.body.src,I=f.body.originalSrc,S=f.body.mime_type,B=f.body.frames;iLog.d("Process urls complete."),iLog.d(C),iLog.d(I),M(C,I,S,B,g_settings.original,p)}else{let C=[],I=[];for(let S=0;S<f.body.length;S++)C.push(f.body[S].urls.regular),I.push(f.body[S].urls.original);iLog.d("Process urls complete."),iLog.d(C),iLog.d(I),v(C,0,I,g_settings.original,p)}},error:function(f){iLog.e("Request image urls failed!"),f&&iLog.d(f)}})}),$(m.controlElements).mouseleave(function(k){if(g_settings.previewByKey)return;let L=$(this),P=L.attr("illustId"),T=L.attr("illustType"),p=L.attr("pageCount"),a=$(k.relatedTarget),o=!1;for(;a.hasClass("pp-main")&&a.attr("illustId")==P&&(o=!0),!(a.parent().length<1);)a=a.parent();o||($(".pp-main").remove(),g_settings.scrollLockWhenPreview&&enableScroll())}),$(m.controlElements).mousemove(function(k){k.ctrlKey||k.buttons&4||(g_mousePos.x=k.pageX,g_mousePos.y=k.pageY,g_settings.previewByKey&&$(".pp-main").css("display")!="none"||d())}),g_settings.scrollLockWhenPreview&&$(m.controlElements).bind("onwheel"in document.createElement("div")?"wheel":"mousewheel",function(k){$(".pp-image").trigger(k)}),Pages[g_pageType].HasAutoLoad&&autoLoadInterval==null&&(autoLoadInterval=setInterval(F,1e3),iLog.d("Auto load interval set.")),unsafeWindow.PreviewCallback=i,iLog.d("Callback function was inserted."),iLog.d(unsafeWindow.PreviewCallback),iLog.i("Preview enable succeed!")}function r(){let m=Pages[g_pageType].GetProcessedPageElements();if(!m.loadingComplete){iLog.e("Page not load, should not call Preview!");return}$(m.controlElements).unbind("mouseenter").unbind("mouseleave").unbind("mousemove"),autoLoadInterval&&(clearInterval(autoLoadInterval),autoLoadInterval=null),iLog.i("Preview disable succeed!")}function i(m,b){iLog.d("iframe callback, width: "+m+", height: "+b);let y=d();$(".pp-loading").hide(),$(".pp-iframe").css({width:y.width,height:y.height}).show()}function d(){let m=30,b=document.documentElement.clientWidth,y=document.documentElement.clientHeight,k=0,L=document.body.scrollTop+document.documentElement.scrollTop,P=0,T=0;$(".pp-main").find("canvas").length>0?(P=$(".pp-image").get(0)==null?0:$(".pp-image").get(0).width,T=$(".pp-image").get(0)==null?0:$(".pp-image").get(0).height):($(".pp-image").css({width:"",height:""}),P=$(".pp-image").get(0)==null?0:$(".pp-image").get(0).width,T=$(".pp-image").get(0)==null?0:$(".pp-image").get(0).height);let a=48,o=48;if(g_settings.previewFullScreen)return a=b,o=T/P*a,o>y&&(o=y,a=o/T*P),o-=5,a-=5,$(".pp-image").css({height:o+"px",width:a+"px"}),$(".pp-main").css({left:"0px",top:"0px",width:b-5,height:y-5}),{width:a,height:o};let g=g_mousePos.x>b/2;return P>0&&T>0&&(a=g?g_mousePos.x-m:b-g_mousePos.x-m,o=T/P*a,o>y&&(o=y,a=o/T*P),a-=5,o-=5,$(".pp-image").css({height:o+"px",width:a+"px"}),$(".pp-loading").css({left:a/2-24+"px",top:o/2-24+"px"})),L+o<=g_mousePos.y&&(L=g_mousePos.y-o-m),k=g?g_mousePos.x-a-m:g_mousePos.x+m,$(".pp-main").css({left:k+"px",top:L+"px",width:a,height:o}),{width:a,height:o}}let u="";function v(m,b,y,k,L){if(u=L,!m||m.length===0){iLog.e("Regular url array is null, can not view images!");return}if(b==null||b<0||b>=m.length){iLog.e("Index("+b+") out of range, can not view images!");return}(y==null||y.length===0)&&(iLog.w("Original array is null, replace it with regular array."),y=m),y.length<m&&(iLog.w("Original array's length is less than regular array, replace it with regular array."),y=m),k==null&&(k=!1),y.length>1&&($(".pp-page").text(b+1+"/"+m.length),$(".pp-pageCount").show()),k?$(".pp-image").addClass("original"):$(".pp-image").removeClass("original"),g_settings.original=k,$(".pp-original, .pp-pageCount").hide(),($(".pp-image").attr("index")==null||$(".pp-image").attr("pageCount")!=m.length)&&($(".pp-image").attr("pageCount",m.length),$(".pp-image").on("click",function(P){let T=$(this),p=T.hasClass("original"),a=T.attr("index");if(a==null?a=0:a=parseInt(a),P.ctrlKey)p=!p,v(m,a,y,p,L);else if(P.shiftKey)window.open(y[a]);else{if(m.length==1)return;++a>=m.length&&(a=0),v(m,a,y,p,L);for(let o=a+1;o<m.length&&o<=a+3;o++){let g=new Image;g.src=p?y[o]:m[o]}}}),$(".pp-image").bind("onwheel"in document.createElement("div")?"wheel":"mousewheel",function(P){let T=$(this),p=T.hasClass("original"),a=T.attr("index");if(a==null?a=0:a=parseInt(a),m.length==1)return!1;P.originalEvent.wheelDelta<0?++a>=m.length&&(a=0):--a<0&&(a=m.length-1),v(m,a,y,p,L);for(let o=a+1;o<m.length&&o<=a+3;o++){let g=new Image;g.src=p?y[o]:m[o]}return!1}),g_settings.previewFullScreen&&$(".pp-main").bind("onwheel"in document.createElement("div")?"wheel":"mousewheel",function(P){$(".pp-image").trigger(P)}),g_settings.scrollLockWhenPreview||$(".pp-image").mouseenter(disableScroll),$(".pp-image").mouseleave(function(){enableScroll()}),$(".pp-image").on("load",function(){if(u!=e){iLog.i("(2)Drop this preview request.");return}let P=$(this),T=d(),p=P.hasClass("original");$(".pp-loading").css("display","none"),$(".pp-image").css("display",""),m.length>1&&$(".pp-pageCount").show(),p&&$(".pp-original").show();for(let a=b+1;a<m.length&&a<=b+3;a++){let o=new Image;o.src=p?y[a]:m[a]}}).on("error",function(){iLog.e("Load image failed!")})),$(".pp-image").attr("src",k?y[b]:m[b]).attr("index",b)}var x;function M(m,b,y,k,L,P){u=P,L==null&&(L=!1),g_settings.original=L,g_settings.previewFullScreen||$(".pp-image").mouseenter(function(){disableScroll()}).mouseleave(function(){enableScroll()}),x&&x.stop(),x=t({source:m,metadata:{mime_type:y,frames:k}}),$(x.canvas).mouseenter(function(){disableScroll()}).mouseleave(function(){enableScroll()}),$(x).on("frameLoaded",function(T,p){if(u!=e||p!=0)return;let a=$(".pp-image");a.after(x.canvas),a.remove();let o=$(x.canvas);o.addClass("pp-image"),$(".pp-loading").css("display","none");let g=T.currentTarget._frameImages[0].width,l=T.currentTarget._frameImages[0].height;o.attr({width:g,height:l}).css({"border-radius":"20px"}),o.attr({originWidth:g,originHeight:l}),d()})}function F(){if(Pages[g_pageType].GetProcessedPageElements()==null){iLog.e("Call ProcessPageElements first!");return}let m=Pages[g_pageType].GetProcessedPageElements(),b=Pages[g_pageType].ProcessPageElements();if(b.loadingComplete){if(m.controlElements.length!=b.controlElements.length||b.forceUpdate){iLog.i("Page loaded "+(b.controlElements.length-m.controlElements.length)+" new work(s)."),g_settings.linkBlank&&$(b.controlElements).find("a").attr("target","_blank"),SetTargetBlank(b),r(),n();return}else if(m.controlElements.length>b.controlElements.length){iLog.w("works become less?"),Pages[g_pageType].private.returnMap=m;return}}iLog.d("Page not change.")}n()}let imageElementTemplate=null;function PixivSK(e){(g_settings.pageCount<1||g_settings.favFilter<0)&&(g_settings.pageCount=3,g_settings.favFilter=0);let t=0,n="https://www.pixiv.net/ajax/search/",r=0,i=[],d=0;if(g_pageType!=PageType.Search)return;let u=function(o){$("#progress").text(Texts[g_language].sort_getWorks.replace("%1",t+1).replace("%2",g_settings.pageCount));let g=n.replace(/p=\d+/,"p="+r);if(location.href.indexOf("?")!=-1){let s=location.href.split("?")[1];s=s.replace(/^p=\d+/,""),s=s.replace(/&p=\d+/,""),g+="&"+s}g.indexOf("order=")==-1&&(g+="&order=date_d"),g.indexOf("mode=")==-1&&(g+="&mode=all"),g.indexOf("s_mode=")==-1&&(g+="&s_mode=s_tag_full"),iLog.i("getWorks url: "+g);let l=new XMLHttpRequest;l.open("GET",g,!0),l.onload=function(s){o(l)},l.onerror=function(s){iLog.e("Request search page error!")},l.send(null)};function v(o,g,l){return new Promise(function(s,c){l==null&&(l=0);let _=100,h=[];$.ajax("https://www.pixiv.net/ajax/user/"+o+"/following?offset="+l+"&limit="+_+"&rest="+g,{async:!0,success:function(w){if(w==null||w.error){iLog.e("Following response contains an error."),s([]);return}if(w.body.users.length==0){s([]);return}$.each(w.body.users,function(f,C){h.push(C.userId)}),v(o,g,l+_).then(function(f){s(h.concat(f))})},error:function(){iLog.e("Request following failed."),s([])}})})}function x(){return new Promise(function(o,g){let l="";try{l=dataLayer[0].user_id}catch{iLog.e("Get user id failed."),o([]);return}$("#progress").text(Texts[g_language].sort_getPublicFollowing);let s=GetLocalStorage("followingOfUid-"+l);if(s!=null&&s!="null"){o(s);return}v(l,"show").then(function(c){$("#progress").text(Texts[g_language].sort_getPrivateFollowing),v(l,"hide").then(function(_){let h=c.concat(_);SetLocalStorage("followingOfUid-"+l,h),o(h)})})})}let M=function(){return new Promise(function(o,g){g_settings.hideFollowed||o(),x().then(function(l){let s=[],c=0;$(i).each(function(_,h){let w=!1;for(let f=0;f<l.length;f++)if(l[f]==h.userId){w=!0;break}w?c++:s.push(h)}),i=s,iLog.i(c+" works were hide by followed user."),iLog.d(i),o()})})},F=function(){return new Promise(function(o,g){iLog.i("Start sort."),iLog.d(i);let l=Texts[g_language].sort_filtering.replace("%2",g_settings.favFilter);l=l.replace("%1",g_settings.hideFavorite?Texts[g_language].sort_filteringHideFavorite:""),$("#progress").text(l);let s=[],c=0,_=0,h=0,w=0;$(i).each(function(f,C){if((C.bookmarkCount?C.bookmarkCount:0)<g_settings.favFilter||g_settings.hideFavorite&&C.bookmarkData)return c++,!0;if(g_settings.aiFilter==1&&C.aiType==2)return _++,!0;if(g_settings.hideByTag){let S=null;try{g_settings.hideByTagRegex&&g_settings.hideByTagRegex.trim()!==""&&(S=new RegExp(g_settings.hideByTagRegex))}catch{iLog.w("Invalid hideByTagRegex: "+g_settings.hideByTagRegex)}if(S&&S.test(C.tags))return h++,!0}if(g_settings.hideCountLessThan>=0&&g_settings.hideCountMoreThan>=0){let S=g_settings.hideCountLessThan,B=g_settings.hideCountMoreThan,E=1;if(C.pageCount&&(E=C.pageCount),S>0&&E<S||B>0&&E>B)return w++,!0}s.push(C)}),iLog.i(c+" works were hide by bookmark count."),iLog.i(_+" works were hide by AI type."),iLog.i(h+" works were hide by tag."),iLog.i(w+" works were hide by page count."),i=s,M().then(function(){i.sort(function(f,C){let I=f.bookmarkCount,S=C.bookmarkCount;return I||(I=0),S||(S=0),I>S?-1:I<S?1:0}),iLog.i("Sort complete."),iLog.d(i),o()})})};if(r===0){let o=location.href;o.indexOf("&p=")==-1&&o.indexOf("?p=")==-1&&(iLog.w("Can not found page in url."),o.indexOf("?")==-1?(o+="?p=1",iLog.d('Add "?p=1": '+o)):(o+="&p=1",iLog.d('Add "&p=1": '+o)));let g=o.match(/\/tags\/([^/]*)\//),l="";if(g)iLog.i("Search key word: "+l),l=g[1];else{iLog.e("Can not found search key word!");return}let s=o.match(/p=(\d*)/)[1];r=parseInt(s),iLog.i("Current page: "+r);let c=o.match(/tags\/.*\/(.*)[?$]/)[1];n+=c+"/",n+=l+"?word="+l+"&p="+r,iLog.i("Current url: "+n)}else iLog.e("???");let m=Pages[PageType.Search].GetImageListContainer();$(m).hide().before('<div id="loading" style="width:100%;text-align:center;"><img src="'+g_loadingImage+'" /><p id="progress" style="text-align: center;font-size: large;font-weight: bold;padding-top: 10px;">0%</p></div>');{let o=Pages[PageType.Search].GetPageSelector();if(o==null){iLog.e("Can not found page selector!");return}if($(o).find("a").length>2){let l=$(o).find("a").get(1),s=[],c="Previewer";for(let I=0;I<9;I++){let S=l.cloneNode(!0);$(S).find("span").text(c[I]),s.push(S)}for($(o).find("button").remove();$(o).find("a").length>2;)$(o).find("a:first").next().remove();for(let I=0;I<9;I++)$(o).find("a:last").before(s[I]);$(o).find("a").attr("href","javascript:;");let _=location.href;_.indexOf("&p=")==-1&&_.indexOf("?p=")==-1&&(_.indexOf("?")==-1?_+="?p=1":_+="&p=1");let h=_.replace(/p=\d+/,"p="+(r-g_settings.pageCount>1?r-g_settings.pageCount:1)),w=_.replace(/p=\d+/,"p="+(r+g_settings.pageCount));iLog.i("Previous page url: "+h),iLog.i("Next page url: "+w);let f=$(o).find("a:first");f.before(f.clone()),f.remove();let C=$(o).find("a:last");C.before(C.clone()),C.remove(),$(o).find("a:first").attr("href",h).addClass("pp-prevPage"),$(o).find("a:last").attr("href",w).addClass("pp-nextPage")}let g=function(l){let s=!1;try{let c=JSON.parse(l.responseText);if(c.hasOwnProperty("error"))if(c.error===!1){let _;c.body.illustManga?_=c.body.illustManga.data:c.body.manga?_=c.body.manga.data:c.body.illust&&(_=c.body.illust.data),_.length>0?i=i.concat(_):s=!0}else{iLog.e("ajax error!");return}else{iLog.e('Key "error" not found!');return}}catch{iLog.e("A invalid json string!"),iLog.i(l.responseText)}if(r++,t++,s&&(iLog.w("No artworks found, ignore "+(g_settings.pageCount-t)+" pages."),r+=g_settings.pageCount-t,t=g_settings.pageCount),t==g_settings.pageCount){iLog.i("Load complete, start to load bookmark count."),iLog.d(i);let c=[],_=new Set;for(let h=0;h<i.length;h++)i[h].id&&!_.has(i[h].id)?(c.push(i[h]),_.add(i[h].id)):iLog.w("ignore work: "+i[h].id);i=c,d=i.length,iLog.i("Clear ad container complete."),iLog.d(i),p(0)}else u(g)};u(g)}let b=0,y=0,k=0,L=function(o,g){let l=null;try{l=JSON.parse(g.responseText)}catch(s){iLog.e("Parse json failed!"),iLog.d(s)}if(l&&!l.error){let s=l.body.illust_details.bookmark_user_total;i[o].bookmarkCount=parseInt(s),iLog.d("IllustId: "+i[o].id+", bookmarkCount: "+s)}else iLog.e("Some error occured: "+l.message);$("#loading").find("#progress").text(Texts[g_language].sort_getBookmarkCount.replace("%1",++b).replace("%2",i.length)),b==k&&T(k)},P=function(o){iLog.e("Send request failed, set this illust("+i[o].id+")'s bookmark count to 0!"),i[o].bookmarkCount=0,$("#loading").find("#progress").text(Texts[g_language].sort_getBookmarkCount.replace("%1",++b).replace("%2",i.length)),b==k&&T(k)},T=function(o){if(o>=i.length){a();return}let g=i.length-o;g>g_maxXhr&&(g=g_maxXhr),k=o+g;for(let l=0;l<g;l++){let s=o+l,_="https://www.pixiv.net/touch/ajax/illust/details?illust_id="+i[s].id;GM__xmlHttpRequest({method:"GET",url:_,anonymous:!0,onabort:()=>P(s),onerror:()=>P(s),onload:h=>L(s,h),ontimeout:()=>P(s)})}},p=function(o){if(o>=i.length){a();return}let g=i.length-o;g>g_maxXhr&&(g=g_maxXhr),k=o+g;let l=0;for(let s=0;s<g;s++){let c=o+s,_=i[c].id,h="https://www.pixiv.net/touch/ajax/illust/details?illust_id="+_;fetch(h,{credentials:"omit"}).then(w=>w.json()).then(w=>{if(w&&!w.error){let f=w.body.illust_details.bookmark_user_total;i[c].bookmarkCount=parseInt(f),iLog.d("IllustId: "+i[c].id+", bookmarkCount: "+f)}else iLog.e("Some error occured: "+(w&&w.message)),i[c].bookmarkCount=0}).catch(w=>{iLog.e("Fetch failed for illustId "+_+": "+w),i[c].bookmarkCount=0,++y}).finally(()=>{let w=Texts[g_language].sort_getBookmarkCount.replace("%1",++b).replace("%2",i.length);y>0&&(w+=" ("+y+" failed)"),$("#loading").find("#progress").text(w),++l===g&&p(k)})}},a=function(){F().then(function(){let o=Pages[PageType.Search].GetImageListContainer(),g=Pages[PageType.Search].GetFirstImageElement();if($(g).find("[data-mouseover]").removeAttr("data-mouseover"),imageElementTemplate==null){imageElementTemplate=g.cloneNode(!0);let l=$(imageElementTemplate).find(".pp-control");if(l==null){iLog.w("Cannot found some elements!");return}let s=l.find("a:first"),c=s.find("img:first"),_=c.parent(),h=s.parent(),w=l.next();(c==null||_==null||s==null||h==null||w==null)&&iLog.e("Can not found some elements!");let f=$("<a></a>");w.children().length==0?w.append(f):f=w.children("a:first");let C=w.next(),I=C.find("a:first"),S=C.find("a:last"),B=S,E=$(C.find("img").get(0)),A=s.next().find("svg"),D=s.children("div:last"),N=D.clone();N.css({top:"auto",bottom:"0px",width:"65%"}),D.parent().append(N),c.addClass("ppImg"),s.addClass("ppImageLink"),f.addClass("ppTitleLink"),I.addClass("ppAuthorLinkProfileImage"),S.addClass("ppAuthorLink"),B.addClass("ppAuthorName"),E.addClass("ppAuthorImage"),A.attr("class",A.attr("class")+" ppBookmarkSvg"),D.addClass("ppAdditionTag"),N.addClass("ppBookmarkCount"),c.attr("src","");let H=c.next();H.length!=0&&H.get(0).tagName=="SVG"&&H.remove(),D.empty(),N.empty(),A.find("path:first").css("fill","rgb(31, 31, 31)"),A.find("path:last").css("fill","rgb(255, 255, 255)"),_.find("svg").remove(),g_settings.linkBlank&&(s.attr("target","_blank"),f.attr("target","_blank"),I.attr("target","_blank"),S.attr("target","_blank"))}$(o).empty();for(let l=0;l<i.length;l++){let s=$(imageElementTemplate.cloneNode(!0)),c=i[l].url;if(g_settings.fullSizeThumb&&(c=convertThumbUrlToSmall(i[l].url)),s.find(".ppImg").attr("src",c).css("object-fit","contain"),s.find(".ppImageLink").attr("href","/artworks/"+i[l].id),s.find(".ppTitleLink").attr("href","/artworks/"+i[l].id).text(i[l].title),s.find(".ppAuthorLink, .ppAuthorLinkProfileImage").attr("href","/member.php?id="+i[l].userId).attr({userId:i[l].userId,profileImageUrl:i[l].profileImageUrl,userName:i[l].userName}),s.find(".ppAuthorName").text(i[l].userName),s.find(".ppAuthorImage").parent().attr("titile",i[l].userName),s.find(".ppAuthorImage").attr("src",i[l].profileImageUrl),s.find(".ppBookmarkSvg").attr("illustId",i[l].id),i[l].bookmarkData&&(s.find(".ppBookmarkSvg").find("path").css("fill","rgb(255, 64, 96)"),s.find(".ppBookmarkSvg").attr("bookmarkId",i[l].bookmarkData.id)),i[l].xRestrict!==0&&s.find(".ppAdditionTag").append('<div style="margin-top: 2px; margin-left: 2px;"><div style="color: rgb(255, 255, 255);font-weight: bold;font-size: 10px;line-height: 1;padding: 3px 6px;border-radius: 3px;background: rgb(255, 64, 96);">R-18</div></div>'),i[l].pageCount>1){let h='<div style="display: flex;-webkit-box-align: center;align-items: center;box-sizing: border-box;margin-left: auto;height: 20px;color: rgb(255, 255, 255);font-size: 10px;line-height: 12px;font-weight: bold;flex: 0 0 auto;padding: 4px 6px;background: rgba(0, 0, 0, 0.32);border-radius: 10px;"><svg viewBox="0 0 9 10" width="9" height="10" style="stroke: none;line-height: 0;font-size: 0px;fill: currentcolor;"><path d="M8,3 C8.55228475,3 9,3.44771525 9,4 L9,9 C9,9.55228475 8.55228475,10 8,10 L3,10 C2.44771525,10 2,9.55228475 2,9 L6,9 C7.1045695,9 8,8.1045695 8,7 L8,3 Z M1,1 L6,1 C6.55228475,1 7,1.44771525 7,2 L7,7 C7,7.55228475 6.55228475,8 6,8 L1,8 C0.44771525,8 0,7.55228475 0,7 L0,2 C0,1.44771525 0.44771525,1 1,1 Z"></path></svg><span style="margin-left: 2px;">'+i[l].pageCount+"</span></div>";s.find(".ppAdditionTag").append(h)}let _='<div style="margin-bottom: 6px; margin-left: 2px;"><div style="color: rgb(7, 95, 166);font-weight: bold;font-size: 13px;line-height: 1;padding: 3px 6px;border-radius: 3px;background: rgb(204, 236, 255);">'+i[l].bookmarkCount+" likes</div></div>";s.find(".ppBookmarkCount").append(_),i[l].illustType==2&&s.find(".ppImg").after('<svg viewBox="0 0 24 24" style="width: 48px; height: 48px;stroke: none;fill: rgb(255, 255, 255);line-height: 0;font-size: 0px;vertical-align: middle;position:absolute;"><circle cx="12" cy="12" r="10" style="fill: rgb(0, 0, 0);fill-opacity: 0.4;"></circle><path d="M9,8.74841664 L9,15.2515834 C9,15.8038681 9.44771525,16.2515834 10,16.2515834 C10.1782928,16.2515834 10.3533435,16.2039156 10.5070201,16.1135176 L16.0347118,12.8619342 C16.510745,12.5819147 16.6696454,11.969013 16.3896259,11.4929799 C16.3034179,11.3464262 16.1812655,11.2242738 16.0347118,11.1380658 L10.5070201,7.88648243 C10.030987,7.60646294 9.41808527,7.76536339 9.13806578,8.24139652 C9.04766776,8.39507316 9,8.57012386 9,8.74841664 Z"></path></svg>'),$(o).append(s)}$(".ppBookmarkSvg").parent().on("click",function(l){if(g_csrfToken==""){iLog.e("No g_csrfToken, failed to add bookmark!"),alert("\u83B7\u53D6 Token \u5931\u8D25\uFF0C\u65E0\u6CD5\u6DFB\u52A0\uFF0C\u8BF7\u5230\u8BE6\u60C5\u9875\u64CD\u4F5C\u3002");return}let s=0;l.ctrlKey&&(s=1);let c=$(this).children("svg:first"),_=c.attr("illustId"),h=c.attr("bookmarkId");h==null||h==""?(iLog.i("Add bookmark, illustId: "+_),$.ajax("/ajax/illusts/bookmarks/add",{method:"POST",contentType:"application/json;charset=utf-8",headers:{"x-csrf-token":g_csrfToken},data:'{"illust_id":"'+_+'","restrict":'+s+',"comment":"","tags":[]}',success:function(w){if(iLog.d("addBookmark result: "),iLog.d(w),w.error){iLog.e("Server returned an error: "+w.message);return}let f=w.body.last_bookmark_id;iLog.i("Add bookmark success, bookmarkId is "+f),c.attr("bookmarkId",f),c.find("path").css("fill","rgb(255, 64, 96)")}})):(iLog.i("Delete bookmark, bookmarkId: "+h),$.ajax("/rpc/index.php",{method:"POST",headers:{"x-csrf-token":g_csrfToken},data:{mode:"delete_illust_bookmark",bookmark_id:h},success:function(w){if(iLog.d("delete bookmark result: "),iLog.d(w),w.error){iLog.e("Server returned an error: "+w.message);return}iLog.i("Delete bookmark success."),c.attr("bookmarkId",""),c.find("path:first").css("fill","rgb(31, 31, 31)"),c.find("path:last").css("fill","rgb(255, 255, 255)")}})),c.parent().focus()}),$(".ppAuthorLink").on("mouseenter",function(l){let s=$(this);function c(f){if(f.offsetParent){let C=c(f.offsetParent);return{offsetTop:f.offsetTop+C.offsetTop,offsetLeft:f.offsetLeft+C.offsetLeft}}else return{offsetTop:f.offsetTop,offsetLeft:f.offsetLeft}}let _=!1;$.ajax("https://www.pixiv.net/ajax/user/"+s.attr("userId")+"?full=1",{method:"GET",async:!1,success:function(f){f.error==!1&&f.body.isFollowed&&(_=!0)}}),$(".pp-authorDiv").remove();let h=$('<div class="pp-authorDiv"><div class="ppa-main" style="position: absolute; top: 0px; left: 0px; border-width: 1px; border-style: solid; z-index: 1; border-color: rgba(0, 0, 0, 0.08); border-radius: 8px;"><div class=""style="    width: 336px;    background-color: rgb(255, 255, 255);    padding-top: 24px;    flex-flow: column;"><div class=""style=" display: flex; align-items: center; flex-flow: column;"><a class="ppa-authorLink"><div role="img"size="64"class=""style=" display: inline-block; width: 64px; height: 64px; border-radius: 50%; overflow: hidden;"><img class="ppa-authorImage" width="64"height="64"style="object-fit: cover; object-position: center top;"></div></a><a class="ppa-authorLink"><div class="ppa-authorName" style=" line-height: 24px; font-size: 16px; font-weight: bold; margin: 4px 0px 0px;"></div></a><div class=""style=" margin: 12px 0px 24px;"><button type="button"class="ppa-follow"style=" padding: 9px 25px; line-height: 1; border: none; border-radius: 16px; font-weight: 700; background-color: #0096fa; color: #fff; cursor: pointer;"><span style="margin-right: 4px;"><svg viewBox="0 0 8 8"width="10"height="10"class=""style=" stroke: rgb(255, 255, 255); stroke-linecap: round; stroke-width: 2;"><line x1="1"y1="4"x2="7"y2="4"></line><line x1="4"y1="1"x2="4"y2="7"></line></svg></span>\u5173\u6CE8</button></div></div></div></div></div>');$("body").append(h);let w=c(this);h.find(".ppa-main").css({top:w.offsetTop-196+"px",left:w.offsetLeft-113+"px"}),h.find(".ppa-authorLink").attr("href","/member.php?id="+s.attr("userId")),h.find(".ppa-authorImage").attr("src",s.attr("profileImageUrl")),h.find(".ppa-authorName").text(s.attr("userName")),_&&(h.find(".ppa-follow").get(0).outerHTML='<button type="button" class="ppa-follow followed" data-click-action="click" data-click-label="follow" style="padding: 9px 25px;line-height: 1;border: none;border-radius: 16px;font-size: 14px;font-weight: 700;cursor: pointer;">\u5173\u6CE8\u4E2D</button>'),h.find(".ppa-follow").attr("userId",s.attr("userId")),h.on("mouseleave",function(f){$(this).remove()}).on("mouseenter",function(){$(this).addClass("mouseenter")}),h.find(".ppa-follow").on("click",function(){let f=$(this).attr("userId");$(this).hasClass("followed")?$.ajax("https://www.pixiv.net/rpc_group_setting.php",{method:"POST",headers:{"x-csrf-token":g_csrfToken},data:"mode=del&type=bookuser&id="+f,success:function(C){iLog.d("delete bookmark result: "),iLog.d(C),C.type=="bookuser"?$(".ppa-follow").get(0).outerHTML='<button type="button"class="ppa-follow"style=" padding: 9px 25px; line-height: 1; border: none; border-radius: 16px; font-weight: 700; background-color: #0096fa; color: #fff; cursor: pointer;"><span style="margin-right: 4px;"><svg viewBox="0 0 8 8"width="10"height="10"class=""style=" stroke: rgb(255, 255, 255); stroke-linecap: round; stroke-width: 2;"><line x1="1"y1="4"x2="7"y2="4"></line><line x1="4"y1="1"x2="4"y2="7"></line></svg></span>\u5173\u6CE8</button>':iLog.e("Delete follow failed!")}}):$.ajax("https://www.pixiv.net/bookmark_add.php",{method:"POST",headers:{"x-csrf-token":g_csrfToken},data:"mode=add&type=user&user_id="+f+"&tag=&restrict=0&format=json",success:function(C){iLog.d("addBookmark result: "),iLog.d(C),C.length===0?$(".ppa-follow").get(0).outerHTML='<button type="button" class="ppa-follow followed" data-click-action="click" data-click-label="follow" style="padding: 9px 25px;line-height: 1;border: none;border-radius: 16px;font-size: 14px;font-weight: 700;cursor: pointer;">\u5173\u6CE8\u4E2D</button>':iLog.e("Follow failed!")}})})}).on("mouseleave",function(l){setTimeout(function(){$(".pp-authorDiv").hasClass("mouseenter")||$(".pp-authorDiv").remove()},200)}),i.length===0&&($(o).show().get(0).outerHTML='<div class=""style="display: flex;align-items: center;justify-content: center; height: 408px;flex-flow: column;"><div class=""style="margin-bottom: 12px;color: rgba(0, 0, 0, 0.16);"><svg viewBox="0 0 16 16"size="72"style="fill: currentcolor;height: 72px;vertical-align: middle;"><path d="M8.25739 9.1716C7.46696 9.69512 6.51908 10 5.5 10C2.73858 10 0.5 7.76142 0.5 5C0.5 2.23858 2.73858 0 5.5 0C8.26142 0 10.5 2.23858 10.5 5C10.5 6.01908 10.1951 6.96696 9.67161 7.75739L11.7071 9.79288C12.0976 10.1834 12.0976 10.8166 11.7071 11.2071C11.3166 11.5976 10.6834 11.5976 10.2929 11.2071L8.25739 9.1716ZM8.5 5C8.5 6.65685 7.15685 8 5.5 8C3.84315 8 2.5 6.65685 2.5 5C2.5 3.34315 3.84315 2 5.5 2C7.15685 2 8.5 3.34315 8.5 5Z"transform="translate(2.25 2.25)"fill-rule="evenodd"clip-rule="evenodd"></path></svg></div><span class="sc-LzMCO fLDUzU">'+Texts[g_language].sort_noWork.replace("%1",d)+"</span></div>"),$("#loading").remove(),$(o).show(),Pages[PageType.Search].ProcessPageElements(),$(document).keydown(function(l){if(g_settings.pageByKey==1){if(l.keyCode==39){let s=$(".pp-nextPage");if(s.length<1||s.attr("hidden")=="hidden")return;location.href=s.attr("href")}else if(l.keyCode==37){let s=$(".pp-prevPage");if(s.length<1||s.attr("hidden")=="hidden")return;location.href=s.attr("href")}}}),e&&e()})}}function PixivNS(e){function t(){let p=$("section:first").find("ul:first");return p.length==0?(iLog.e("Can not found novel list."),null):p}function n(){return location.search.substr(1).replace(/&?p=\d+/,"")}function r(p){if(!p)return null;if(p.length==0)return iLog.e("Empty list, can not create template."),null;let a=p.children().eq(0).clone(!0),o=a.children().eq(0).children().eq(0);o.find("a:first").addClass("pns-link"),o.find("img:first").addClass("pns-img");let g=a.children().eq(0).children().eq(1).children().eq(0),l=g.children().eq(0);if(l.children().length>1)l.children().eq(0).addClass("pns-series");else{let f=$('<a class="pns-series" href="/novel/series/000000"></a>');f.css({display:"inline-block","white-space":"nowrap","text-overflow":"ellipsis",overflow:"hidden","max-width":"100%","line-height":"22px","font-size":"14px","text-decoration":"none"}),$("head").append("<style>.pns-series:visited{color:rgb(173,173,173)}</style>"),l.prepend(f)}l.children().eq(1).children().eq(0).addClass("pns-title").addClass("pns-link"),g.find(".gtm-novel-searchpage-result-user:first").addClass("pns-author-img"),g.find(".gtm-novel-searchpage-result-user:last").addClass("pns-author");let s=g.children().eq(2).children().eq(0),c=s.children().eq(2);if(c.find("span:first").addClass("pns-text-count"),c.find("span").length<2){let f=c.find(".pns-text-count");f.append('<span class="pns-bookmark-count"><span><div class="sc-eoqmwo-1 grSeZG"><span class="sc-14heosd-0 gbNjEj"><svg viewBox="0 0 12 12" size="12" class="sc-14heosd-1 YtZop"><path fill-rule="evenodd" clip-rule="evenodd" d="M9 0.75C10.6569 0.75 12 2.09315 12 3.75C12 7.71703 7.33709 10.7126 6.23256 11.3666C6.08717 11.4526 5.91283 11.4526 5.76744 11.3666C4.6629 10.7126 0 7.71703 0 3.75C0 2.09315 1.34315 0.75 3 0.75C4.1265 0.75 5.33911 1.60202 6 2.66823C6.66089 1.60202 7.8735 0.75 9 0.75Z"></path></svg></span><span class="sc-eoqmwo-2 dfUmJJ">2,441</span></div></span></span>'),c.find(".pns-bookmark-count").addClass(f.get(0).className)}else c.find("span:last").addClass("pns-bookmark-count").parent().addClass("pns-bookmark-div");s.children().eq(0).empty().addClass("pns-tag-list"),s.children().eq(1).children().eq(0).addClass("pns-desc");let h=g.children().eq(2).children().eq(1),w=h.find("svg");return w.attr("class",w.attr("class")+" pns-like"),h.find("path:first").css("color","rgb(31, 31, 31)"),h.find("path:last").css("fill","rgb(255, 255, 255)"),a}function i(p,a){if(p==null||a==null)return null;let o=p.find(".pns-link:first").attr("href").replace(/id=\d+/g,"id="+a.id);if(p.find(".pns-link").attr("href",o),p.find(".pns-img").attr("src",a.url),a.seriesId){let _=p.find(".pns-series").attr("href").replace(/\d+$/,a.seriesId);p.find(".pns-series").text(a.seriesTitle).attr("title",a.seriesTitle).attr("href",_)}else p.find(".pns-series").hide();p.find(".pns-title").text(a.title).attr("title",a.title),p.find(".pns-title").parent().attr("title",a.title);let g=p.find(".pns-author").attr("href").replace(/\d+$/,a.userId);p.find(".pns-author").text(a.userName).attr("href",g),p.find(".pns-author-img").attr("href",g).find("img").attr("src",a.profileImageUrl),p.find(".pns-text-count").text(a.textCount+"\u6587\u5B57"),a.bookmarkCount==0?p.find(".pns-bookmark-div").hide():p.find(".pns-bookmark-count").text(a.bookmarkCount);let l=p.find(".pns-tag-list"),s=n();s.length>0&&(s="?"+s),$.each(a.tags,function(_,h){let w=$('<span"><a style="color: rgb(61, 118, 153);" href="/tags/'+encodeURIComponent(h)+"/novels"+s+'">'+h+"</a></span>");(h=="R-18"||h=="R-18G")&&w.find("a").css({color:"rgb(255, 64, 96)","font-weight":"bold"}).text(h),l.append(w)}),p.find(".pns-desc").html(a.description).attr("title",p.find(".pns-desc").text());let c=p.find(".pns-like");return c.attr("novel-id",a.id),a.bookmarkData&&(c.attr("bookmark-id",a.bookmarkData.id),c.find("path:first").css("color","rgb(255, 64, 96)"),c.find("path:last").css("fill","rgb(255, 64, 96)")),c.click(function(){if($(this).attr("disable"))return;let _=$(this).attr("bookmark-id"),h=$(this).attr("novel-id");_?k($(this),_):y($(this),h,0),$(this).blur()}),g_settings.linkBlank&&p.find("a").attr("target","_blank"),p}function d(p,a,o,g){g==null&&(g=o-a);let l=location.origin+g_getNovelUrl.replace(/#key#/g,p).replace(/#page#/g,a),s=n();s.length>0&&(l+="&"+s),b(Texts[g_language].nsort_getWorks.replace("1%",g-o+a+1).replace("2%",g));let c=[];function _(h,w){h&&h.body&&h.body.novel&&h.body.novel.data&&(c=c.concat(h.body.novel.data)),a==o-1?w(c):d(p,a+1,o,g).then(function(f){f&&f.length>0&&(c=c.concat(f)),w(c)})}return new Promise(function(h,w){$.ajax({url:l,success:function(f){_(f,h)},error:function(){iLog.e("get novel page "+a+" failed!"),_(null,h)}})})}function u(p){b(Texts[g_language].nsort_sorting),p.sort(function(o,g){let l=o.bookmarkCount,s=g.bookmarkCount;return l||(l=0),s||(s=0),l>s?-1:l<s?1:0});let a=[];return $.each(p,function(o,g){let l=g.bookmarkCount;if(l||(l=0),l<g_settings.novelFavFilter||g_settings.novelHideFavorite&&g.bookmarkData)return!0;a.push(g)}),a}function v(p){let a=t();if(a==null)return;let o=r(a);if(o==null)return;let g=[];$.each(p,function(l,s){let c=i(o.clone(!0),s);c!=null&&g.push(c)}),a.empty(),$.each(g,function(l,s){$(s).css("display","block"),a.append(s)}),m()}function x(){let p=location.pathname.match(/\/tags\/(.+)\/novels/);return p?p[1]:""}function M(){let p=location.search.match(/p=(\d+)/);return p?parseInt(p[1]):1}function F(){let p=t();if(p==null){iLog.e("Can not found novel section!");return}p.hide().before('<div id="loading" style="width:100%;text-align:center;"><img src="'+g_loadingImage+'" /><p id="progress" style="text-align: center;font-size: large;font-weight: bold;padding-top: 10px;">0%</p></div>')}function m(){let p=t();if(p==null){iLog.e("Can not found novel section!");return}$("#loading").remove(),p.show()}function b(p){$("#progress").text(p)}function y(p,a,o){if(g_csrfToken==""){iLog.e("No g_csrfToken, failed to add bookmark!"),alert("\u83B7\u53D6 Token \u5931\u8D25\uFF0C\u65E0\u6CD5\u6DFB\u52A0\uFF0C\u8BF7\u5230\u8BE6\u60C5\u9875\u64CD\u4F5C\u3002");return}p.attr("disable","disable"),iLog.i("add bookmark: "+a),$.ajax("/ajax/novels/bookmarks/add",{method:"POST",contentType:"application/json;charset=utf-8",headers:{"x-csrf-token":g_csrfToken},data:'{"novel_id":"'+a+'","restrict":'+o+',"comment":"","tags":[]}',success:function(g){if(iLog.d("add novel bookmark result: "),iLog.d(g),g.error){iLog.e("Server returned an error: "+g.message);return}let l=g.body;iLog.i("Add novel bookmark success, bookmarkId is "+l),p.attr("bookmark-id",l),p.find("path:first").css("color","rgb(255, 64, 96)"),p.find("path:last").css("fill","rgb(255, 64, 96)"),p.removeAttr("disable")},error:function(){p.removeAttr("disable")}})}function k(p,a){if(g_csrfToken==""){iLog.e("No g_csrfToken, failed to add bookmark!"),alert("\u83B7\u53D6 Token \u5931\u8D25\uFF0C\u65E0\u6CD5\u6DFB\u52A0\uFF0C\u8BF7\u5230\u8BE6\u60C5\u9875\u64CD\u4F5C\u3002");return}p.attr("disable","disable"),iLog.i("delete bookmark: "+a),$.ajax("/ajax/novels/bookmarks/delete",{method:"POST",headers:{"x-csrf-token":g_csrfToken},data:{del:1,book_id:a},success:function(o){if(iLog.d("delete novel bookmark result: "),iLog.d(o),o.error){iLog.e("Server returned an error: "+o.message);return}iLog.i("delete novel bookmark success"),p.removeAttr("bookmark-id"),p.find("path:first").css("color","rgb(31, 31, 31)"),p.find("path:last").css("fill","rgb(255, 255, 255)"),p.removeAttr("disable")},error:function(){p.removeAttr("disable")}})}function L(){let p=Pages[PageType.NovelSearch].GetPageSelector();if(p.length==0){iLog.e("can not found page selector!");return}let a=p.find("a:first").clone().attr("aria-disabled","false").removeAttr("hidden").addClass("pp-prevPage"),o=p.find("a:last").clone().attr("aria-disabled","false").removeAttr("hidden").addClass("pp-nextPage"),g=p.find("a").eq(1).clone().removeAttr("href"),l=location.href,s=l.match(/[?&]p=(\d+)/),c=1;s?c=parseInt(s[1]):location.search==""?l+="?p=1":l+="&p=1",c==1&&a.attr("hidden","hidden"),p.empty();let _=c-g_settings.novelPageCount;a.attr("href",l.replace("?p="+c,"?p="+_).replace("&p="+c,"&p="+_)),p.append(a);let h="Previewer";for(let f=0;f<h.length;++f){let C=g.clone().text(h[f]);p.append(C)}let w=c+g_settings.novelPageCount;o.attr("href",l.replace("?p="+c,"?p="+w).replace("&p="+c,"&p="+w)),p.append(o)}function P(){$(document).keydown(function(p){if(g_settings.pageByKey==1){if(p.keyCode==39){let a=$(".pp-nextPage");if(a.length<1||a.attr("hidden")=="hidden")return;location.href=a.attr("href")}else if(p.keyCode==37){let a=$(".pp-prevPage");if(a.length<1||a.attr("hidden")=="hidden")return;location.href=a.attr("href")}}})}function T(){let p=x();if(p.length==0){iLog.e("Parse key word error.");return}let a=M();if($(".gtm-novel-searchpage-gs-toggle-button").attr("data-gtm-label")=="off"){F(),$(".gtm-novel-searchpage-gs-toggle-button").parent().next().text(),$("#loading").find("#progress").text('\u7531\u4E8E\u542F\u7528\u4E86 "'+$(".gtm-novel-searchpage-gs-toggle-button").parent().next().text()+'"\uFF0C\u65E0\u6CD5\u8FDB\u884C\u6392\u5E8F\u3002'),setTimeout(()=>m(),3e3);return}F(),L(),P(),d(p,a,a+g_settings.novelPageCount).then(function(o){v(u(o))})}T()}function SetLocalStorage(e,t){localStorage.setItem(e,JSON.stringify(t))}function GetLocalStorage(e){const t=localStorage.getItem(e);return t||null}function ShowInstallMessage(){$("#pp-bg").remove();let e=$('<div id="pp-bg"></div>').css({width:document.documentElement.clientWidth+"px",height:document.documentElement.clientHeight+"px",position:"fixed","z-index":999999,"background-color":"rgba(0,0,0,0.8)",left:"0px",top:"0px"});$("body").append(e),e.get(0).innerHTML='<img id="pps-close"src="https://pp-1252089172.cos.ap-chengdu.myqcloud.com/Close.png"style="position: absolute; right: 35px; top: 20px; width: 32px; height: 32px; cursor: pointer;"><div style="position: absolute;width: 40%;left: 30%;top: 25%;font-size: 25px; text-align: center; color: white;">'+Texts[g_language].install_title+"</div><br>"+Texts[g_language].install_body,$("#pps-close").click(function(){$("#pp-bg").remove()})}function ShowUpgradeMessage(){$("#pp-bg").remove();let e=$('<div id="pp-bg"></div>').css({width:document.documentElement.clientWidth+"px",height:document.documentElement.clientHeight+"px",position:"fixed","z-index":999999,"background-color":"rgba(0,0,0,0.8)",left:"0px",top:"0px"});$("body").append(e);let t=Texts[g_language].upgrade_body;e.get(0).innerHTML='<img id="pps-close"src="https://pp-1252089172.cos.ap-chengdu.myqcloud.com/Close.png"style="position: absolute; right: 35px; top: 20px; width: 32px; height: 32px; cursor: pointer;"><div style="position: absolute;width: 40%;left: 30%;top: 25%;font-size: 25px; text-align: center; color: white;">'+Texts[g_language].install_title+'</div><br><div style="position:absolute;left:50%;top:30%;font-size:20px;color:white;transform:translate(-50%,0);height:50%;overflow:auto;">'+t+"</div>",$("#pps-close").click(function(){$("#pp-bg").remove()})}function ConvertSettingsFromGMC(){let e=GMC.get("hideByTagList");if(e!=null&&e!=""){let n=e.replace(/,|/g,"|");GMC.set("hideByTagRegex",n),GMC.set("hideByTagList",""),GMC.save()}return{enablePreview:GMC.get("enablePreview"),enableAnimePreview:GMC.get("enableAnimePreview"),enableSort:GMC.get("enableSort"),enableAnimeDownload:GMC.get("enableAnimeDownload"),original:GMC.get("original"),previewDelay:parseInt(GMC.get("previewDelay"))||200,previewByKey:GMC.get("previewByKey"),pageCount:parseInt(GMC.get("pageCount"))||3,favFilter:parseInt(GMC.get("favFilter"))||0,aiFilter:GMC.get("aiFilter"),hideFavorite:GMC.get("hideFavorite"),hideFollowed:GMC.get("hideFollowed"),hideByTag:GMC.get("hideByTag"),hideByTagRegex:GMC.get("hideByTagRegex"),hideCountLessThan:parseInt(GMC.get("hideCountLessThan"))||0,hideCountMoreThan:parseInt(GMC.get("hideCountMoreThan"))||0,linkBlank:GMC.get("linkBlank"),pageByKey:GMC.get("pageByKey"),fullSizeThumb:GMC.get("fullSizeThumb"),enableNovelSort:GMC.get("enableNovelSort"),novelPageCount:parseInt(GMC.get("novelPageCount"))||3,novelFavFilter:parseInt(GMC.get("novelFavFilter"))||0,novelHideFavorite:GMC.get("novelHideFavorite"),previewFullScreen:GMC.get("previewFullScreen"),previewKey:17,scrollLockWhenPreview:GMC.get("scrollLockWhenPreview")}}function MigrateFromOldSetting(){let e=GetLocalStorage("PixivPreview");if(e&&e!="null"){let t=JSON.parse(e);if(t)return GMC.set("enablePreview",t.enablePreview),GMC.set("enableAnimePreview",t.enableAnimePreview),GMC.set("enableSort",t.enableSort),GMC.set("enableAnimeDownload",t.enableAnimeDownload),GMC.set("original",t.original),GMC.set("previewDelay",t.previewDelay),GMC.set("previewByKey",t.previewByKey),GMC.set("pageCount",t.pageCount),GMC.set("favFilter",t.favFilter),GMC.set("aiFilter",t.aiFilter),GMC.set("hideFavorite",t.hideFavorite),GMC.set("hideFollowed",t.hideFollowed),GMC.set("hideByTag",t.hideByTag),GMC.set("hideByTagRegex",t.hideByTagRegex),GMC.set("linkBlank",t.linkBlank),GMC.set("pageByKey",t.pageByKey),GMC.set("fullSizeThumb",t.fullSizeThumb),GMC.set("enableNovelSort",t.enableNovelSort),GMC.set("novelPageCount",t.novelPageCount),GMC.set("novelFavFilter",t.novelFavFilter),GMC.set("novelHideFavorite",t.novelHideFavorite),SetLocalStorage("PixivPreviewLang",parseInt(t.lang)),SetLocalStorage("PixivPreview",null),!0}return!1}function GetSettings(){let e=MigrateFromOldSetting(),t="PixivPreviewVersion",n=GetLocalStorage(t),r=null;return n&&(r=JSON.parse(n)),e?(SetLocalStorage(t,g_version),ShowUpgradeMessage()):r==null?(SetLocalStorage(t,g_version),ShowInstallMessage()):r!=g_version&&(SetLocalStorage(t,g_version),ShowUpgradeMessage()),ConvertSettingsFromGMC()}function UpdateLogLevel(){let e=GMC.get("logLevel");e=="error"?iLog.setLogLevel(iLog.LogLevel.Error):e=="warning"?iLog.setLogLevel(iLog.LogLevel.Warning):e=="info"?iLog.setLogLevel(iLog.LogLevel.Info):e=="debug"&&iLog.setLogLevel(iLog.LogLevel.Verbose)}function ShowSetting(){GMC.open()}function SetTargetBlank(e){if(g_settings.linkBlank){let t=[];$.each(e.controlElements,function(n,r){r.tagName=="A"&&t.push(r)}),$.each($(e.controlElements).find("a"),function(n,r){t.push(r)}),$.each(t,function(n,r){$(r).attr({target:"_blank",rel:"external"}),(g_pageType==PageType.Home||g_pageType==PageType.Member||g_pageType==PageType.Artwork||g_pageType==PageType.BookMarkNew)&&r.addEventListener("click",function(i){i.stopPropagation()})})}}let loadInterval=null,itv=null;function MigrationLanguage(){let e=GetLocalStorage("PixivPreview");if(e&&e!="null"){let r=JSON.parse(e);if(r)return parseInt(r.lang)}let n=GetLocalStorage("PixivPreviewLang");return n==null||n=="null"?Lang.auto:parseInt(n)}function AutoDetectLanguage(){if(g_language=MigrationLanguage(),g_language==Lang.auto){let e=$("html").attr("lang");e&&e.indexOf("zh")!=-1?g_language=Lang.zh_CN:e&&e.indexOf("ja")!=-1?g_language=Lang.ja_JP:g_language=Lang.en_US}}function Load(){for(let n=0;n<PageType.PageTypeCount;n++)if(Pages[n].CheckUrl(location.href)){g_pageType=n;break}if(g_pageType>=0)iLog.i("Current page is "+Pages[g_pageType].PageTypeString);else{iLog.w("Unsupported page."),clearInterval(loadInterval);return}let e=Pages[g_pageType].GetToolBar();if(e)iLog.d(e),clearInterval(loadInterval);else{iLog.w("Get toolbar failed.");return}if(window.onresize=function(){if($("#pp-bg").length>0){let n=document.documentElement.clientWidth,r=document.documentElement.clientHeight;$("#pp-bg").css({width:n+"px",height:r+"px"})}},g_maxXhr=parseInt(GMC.get("maxXhr")),g_settings=GetSettings(),$("#pp-sort").length===0&&!g_settings?.enableSort){const n=document.createElement("div"),r=document.createElement("button");r.id="pp-sort",r.style.cssText="background-color: rgb(0, 0, 0); margin-top: 5px; opacity: 0.8; cursor: pointer; border: none; padding: 0px; border-radius: 24px; width: 48px; height: 48px;",r.innerHTML=`<span style="color: white;vertical-align: text-top;">${Texts[g_language].text_sort}</span>`,n.appendChild(r),e.appendChild(n),$(r).click(function(){this.disabled=!0,t(!0),setTimeout(()=>{this.disabled=!1},7e3)})}if($("#pp-nextPage-fixed").length===0){const n=document.createElement("div");n.innerHTML="";const r=document.createElement("button");r.id="pp-nextPage-fixed",r.style.cssText="background-color: rgb(0, 0, 0); margin-top: 5px; opacity: 0.8; cursor: pointer; border: none; padding: 12px; border-radius: 24px; width: 48px; height: 48px;",r.innerHTML='<svg viewBox="0 0 120 120" width="24" height="24" stroke="white" fill="none" stroke-width="10" stroke-linecap="round" stroke-linejoin="round" style="transform: rotate(90deg);"> <polyline points="60,105 60,8"></polyline> <polyline points="10,57 60,8 110,57"></polyline> </svg>',n.appendChild(r),e.appendChild(n),$(r).click(function(){let i=null,d=$(".pp-nextPage");d.length>0&&d.attr("hidden")!=="hidden"?i=d.attr("href"):i=[...document.querySelectorAll("nav")].find(u=>[...u.children].filter(v=>v.tagName==="A").every(v=>/\?p=\d+$/.test(v.href)))?.lastElementChild?.href??null,i!=null&&(location.href=i)})}if($("#pp-settings").length===0){const n=document.createElement("div"),r=document.createElement("button");r.id="pp-settings",r.style.cssText="background-color: rgb(0, 0, 0); margin-top: 5px; opacity: 0.8; cursor: pointer; border: none; padding: 12px; border-radius: 24px; width: 48px; height: 48px;",r.innerHTML='<svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 1000 1000" enable-background="new 0 0 1000 1000" xml:space="preserve" style="fill: white;"><metadata> Svg Vector Icons : http://www.sfont.cn </metadata><g><path d="M377.5,500c0,67.7,54.8,122.5,122.5,122.5S622.5,567.7,622.5,500S567.7,377.5,500,377.5S377.5,432.3,377.5,500z"></path><path d="M990,546v-94.8L856.2,411c-8.9-35.8-23-69.4-41.6-100.2L879,186L812,119L689,185.2c-30.8-18.5-64.4-32.6-100.2-41.5L545.9,10h-94.8L411,143.8c-35.8,8.9-69.5,23-100.2,41.5L186.1,121l-67,66.9L185.2,311c-18.6,30.8-32.6,64.4-41.5,100.3L10,454v94.8L143.8,589c8.9,35.8,23,69.4,41.6,100.2L121,814l67,67l123-66.2c30.8,18.6,64.5,32.6,100.3,41.5L454,990h94.8L589,856.2c35.8-8.9,69.4-23,100.2-41.6L814,879l67-67l-66.2-123.1c18.6-30.7,32.6-64.4,41.5-100.2L990,546z M500,745c-135.3,0-245-109.7-245-245c0-135.3,109.7-245,245-245s245,109.7,245,245C745,635.3,635.3,745,500,745z"></path></g></svg>',n.appendChild(r),e.appendChild(n),$(r).click(function(){ShowSetting()})}(g_pageType==PageType.Search||g_pageType==PageType.NovelSearch)&&$.get(location.href,function(n){let r=n.match(/token\\":\\"([a-z0-9]{32})/);r!=null&&r.length>0?(g_csrfToken=r[1],iLog.d("Got g_csrfToken: "+g_csrfToken)):iLog.e("Can not get g_csrfToken, so you can not add works to bookmark when sorting has enabled.")}),itv=setInterval(function(){let n=Pages[g_pageType].ProcessPageElements();n.loadingComplete&&(iLog.d("Process page comlete, sorting and prevewing begin."),iLog.d(n),clearInterval(itv),SetTargetBlank(n),t())},500);function t(n=!1){try{g_pageType==PageType.Artwork?(Pages[g_pageType].Work(),g_settings.enablePreview&&PixivPreview()):g_pageType==PageType.Search?g_settings.enableSort||n?(g_sortComplete=!1,PixivSK(function(){g_sortComplete=!0,g_settings.enablePreview&&PixivPreview()})):g_settings.enablePreview&&PixivPreview():g_pageType==PageType.NovelSearch?(g_settings.enableNovelSort||n)&&PixivNS():g_settings.enablePreview&&PixivPreview()}catch(r){iLog.e("Unknown error: "+r)}}}function StartLoad(){loadInterval=setInterval(Load,1e3),setInterval(function(){if(location.href!=initialUrl){if(!g_sortComplete){location.href=location.href;return}$(".pp-main").length>0&&$(".pp-main").remove(),initialUrl=location.href,clearInterval(loadInterval),clearInterval(itv),clearInterval(autoLoadInterval),autoLoadInterval=null,g_pageType=-1,loadInterval=setInterval(Load,300)}},1e3)}function LoadJQ(){checkJQuery().then(function(e){e?(AutoDetectLanguage(),gmcInit()):setTimeout(LoadJQ,1e3)})}LoadJQ();
