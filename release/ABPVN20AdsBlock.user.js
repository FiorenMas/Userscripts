// ==UserScript==
// @name        ABPVN AdsBlock
// @namespace   ABPVN
// @author      ABPVN
// @copyright   ABPVN
// @homepage    https://abpvn.com
// @supportURL  https://github.com/abpvn/abpvn/issues
// @icon        https://abpvn.com/icon.png
// @contributionURL https://abpvn.com/donate/
// @grant       GM_getValue
// @grant       GM_setValue
// @grant       GM_openInTab
// @grant       GM_registerMenuCommand
// @include     http://*
// @include     https://*
// @version     2.3.31
// @change-log  Remove redirect remove config of cakhia-tv.onl
// @run-at      document-end
// @downloadURL https://raw.githubusercontent.com/FiorenMas/Userscripts/release/release/ABPVN20AdsBlock.user.js
// @updateURL https://raw.githubusercontent.com/FiorenMas/Userscripts/release/release/ABPVN20AdsBlock.meta.js
// ==/UserScript==
String.prototype.startWith=function(t){return typeof this.indexOf=="function"&&this.indexOf(t)===0},String.prototype.ismatch=function(t){return typeof this.match=="function"&&this.match(t)!==null};var byPass={hideLinkUnlock:function(){var t=document.querySelectorAll(".onp-sl-content,.onp-locker-call,[data-locker-id]");if(t.length){if(ABPVN.cTitle(),!document.getElementById("abpvn_style")){var e=document.createElement("style");e.id="abpvn_style",e.innerHTML=".onp-sl-content{display:block!important;}.onp-sl,.onp-sl-overlap-box{display:none!important;}.onp-sl-blur-area{filter: none!important;}",document.body.appendChild(e)}for(var n in t){if(t[n].firstChild&&t[n].firstChild.innerText!="Unlocked by ABPVN.COM"){var i=document.createElement("div");i.innerHTML='<a href="http://abpvn.com" target="_blank" style="color: #08BE54;font-weight: bold;">Unlocked by ABPVN.COM</a>',i.style.textAlign="right",t[n].insertBefore(i,t[n].firstChild)}t[n].style&&(t[n].style.display="block")}var o=document.querySelectorAll('.onp-sl,div[id^="content-locker"]');for(var r in o)o[r].style&&(o[r].style.display="none !important",o[r].setAttribute("hidden","hidden"))}},removeShortLink:function(){var t=document.querySelectorAll('a[href*="/full/?api="]'),e=0;if(t.length){ABPVN.cTitle();for(var n=0;n<t.length;n++){var i=t[n],o=i.getAttribute("href"),r=o.match(/url=(.+?)&|$/);if(r[1]){i.setAttribute("href",atob(r[1].replace(/=+$/,"")));var l=i.getAttribute("title");i.setAttribute("title",l?l+" ":"Short link by pass by ABPVN.COM"),e++}}Logger.info("By pass "+e+" short link")}},showBodyLinkByPassAndRedirect:function(t){document.body.innerHTML="<style>html,body{background: #fff !important;}h1{color: #00dc58;}a{color: #015199}a h1{color: #015199;}</style><center><h1>ABPVN quick bypass \u0111\xE3 ho\u1EA1t \u0111\u1ED9ng</h1><a href='https://abpvn.com/donate'><h1>\u1EE6ng h\u1ED9 ABPVN</h1></a><br/>Kh\xF4ng t\u1EF1 chuy\u1EC3n trang? <a href='"+t+"' title='Chuy\u1EC3n trang'>Click v\xE0o \u0111\xE2y</a></center>",setTimeout(()=>location.href=t,500)},quickByPassLink:function(){var t=/123link\..*|phlame.pw|megaurl\.*|www.123l\.*|vinaurl\.*|share4you.pro|doxeaz10.site|derow.win|linkviet.net|ez4linkss.com|ckk.ai|link\.codevn\.net|linksht.com|beta.shortearn.eu|getlink\.tienichmaytinh\.net|download.baominh.tech|download3s.net/,e=/share4you.pro|derow.win/,n=/megaurl\.*|vinaurl\.*|doxeaz10.site|linkviet.net|ez4linkss.com|ckk.ai|link\.codevn\.net|beta.shortearn.eu|getlink\.tienichmaytinh\.net|download.baominh.tech|download3s.net/;if(t.test(location.hostname))try{var i=function(a){return a.attributeName==="disabled"&&!a.target.disabled||a.attributeName==="class"&&!a.target.classList.contains("disabled")},o,r=new MutationObserver(a=>{a.forEach(c=>{i(c)&&c.target.click(),c.attributeName==="href"&&(o=c.target.getAttribute("href"),this.showBodyLinkByPassAndRedirect(o))})}),l={attributes:!0},s=document.getElementById("invisibleCaptchaShortlink")||document.querySelector(".download_1");if(s)r.observe(s,l);else if(document.querySelector("#originalLink"))o=document.querySelector("#originalLink").getAttribute("href"),this.showBodyLinkByPassAndRedirect(o);else{var d=document.querySelector(".get-link"),h=e.test(location.hostname)?6e3:100;d&&(r.observe(d,l),n.test(location.hostname)||setTimeout(function(){$("#go-link").addClass("go-link").trigger("submit.adLinkFly.counterSubmit").one("submit.adLinkFly.counterSubmit",function(a){a.preventDefault(),e.test(location.hostname)||location.reload()})},h))}}catch(a){Logger.error(a)}},wikiall_org:function(){if(location.hostname=="wikiall.org"&&document.querySelector("#timer")){var t=new MutationObserver(n=>{n.forEach(i=>{if(i.type=="childList"){var o=i.target.querySelector("a");this.showBodyLinkByPassAndRedirect(o.getAttribute("href"))}})}),e=document.querySelector("#place");t.observe(e,{childList:!0})}},link1s_com:function(){window.addEventListener("DOMContentLoaded",()=>{let t=document.querySelector("a#link1s");if(t&&t.getAttribute("href").match(/http?s:\/\//)){Logger.info("Link1s.com step 1 match");let o=t.getAttribute("href");this.showBodyLinkByPassAndRedirect(o);return}if(document.querySelector("#link1s-snp .btn-primary")){Logger.info("Link1s.com step 2 match"),Logger.info("Finding next url");let r=[...document.querySelectorAll("script")].map(l=>l.innerText).join(`
`).match(/link1sLink\s=\s\'(.+)\';/);if(r&&r[1]){this.showBodyLinkByPassAndRedirect(r[1]);return}}var n=new MutationObserver(o=>{o.forEach(r=>{r.attributeName==="href"&&(link=r.target.getAttribute("href"),this.showBodyLinkByPassAndRedirect(link))})}),i={attributes:!0,subtree:!0};location.hostname==="link1s.com"&&(document.querySelector(".get-link")||document.querySelector(".skip-ad"))&&(Logger.info("Link1s.com step 3 match"),n.observe(document.querySelector(".get-link")||document.querySelector(".skip-ad"),i))})},init:function(){configure.getValue("unlock_content",!0)&&(window.addEventListener("DOMContentLoaded",this.hideLinkUnlock),window.addEventListener("load",this.hideLinkUnlock),this.hideLinkUnlock()),configure.getValue("remove_short_link",!0)&&window.addEventListener("DOMContentLoaded",this.removeShortLink),configure.getValue("quick_by_pass_link",!0)&&(this.quickByPassLink(),this.wikiall_org(),this.link1s_com())}},Logger={style:"color: #00DC58",info:function(t){console.info("%cABPVN.COM Info: ",this.style,t)},warn:function(t){console.warn("%cABPVN Warn: ",this.style,t)},error:function(t){console.error("%cABPVN Error: ",this.style,t)},log:function(t){console.log("%cABPVN Log: ",this.style,t)}},getLink={showBodyLinkDownloadAndRedirect:function(t,e){document.body.innerHTML="<style>html,body{background: #fff !important;}h1{color: #00dc58;}a{color: #015199}a h1{color: #015199;}</style><center><h1>ABPVN "+t+" download \u0111\xE3 ho\u1EA1t \u0111\u1ED9ng</h1><a href='https://abpvn.com/donate'><h1>\u1EE6ng h\u1ED9 ABPVN</h1></a><br/>Kh\xF4ng t\u1EF1 t\u1EA3i xu\u1ED1ng? <a href='"+e+"' title='Download'>Click v\xE0o \u0111\xE2y</a></center>",location.href=e},mediafire_com:function(){if(this.url.startWith("http://www.mediafire.com/file/")||this.url.startWith("https://www.mediafire.com/file/")){var t=document.querySelector(".download_link a.input"),e=t.getAttribute("href");e.startWith("http")&&this.showBodyLinkDownloadAndRedirect("MediaFire",e)}},init:function(){this.url=location.href,configure.getValue("quick_download",!0)&&this.mediafire_com()}},fixSite={elementExist:function(t){var e=document.querySelector(t);return e!=null},getAllText:function(t){var e="",n=document.querySelectorAll(t);if(n)for(var i in n)n[i].innerText&&(e+=n[i].innerText);return e},getScript:function(t){var e=new XMLHttpRequest;e.open("GET",t),e.addEventListener("load",function(n){var i=new Blob([e.responseText],{type:"text/javascript"}),o=URL.createObjectURL(i),r=document.createElement("script");r.src=o,r.type="text/javascript",document.getElementsByTagName("head")[0].appendChild(r)}),e.send()},loadCss:function(t,e){var n=document.createElement("link");n.rel="stylesheet",n.id=e,n.href=t;var i=document.getElementsByTagName("head")[0];i.appendChild(n)},antiAdblockRemover:function(){try{var t="By pass adBlock detect r\u1ED3i nh\xE9! Hahahahaha \u{1F601}\u{1F601}\u{1F601}";typeof adBlockDetected=="function"&&(adBlockDetected=function(){Logger.info(t)}),typeof showAdsBlock=="function"&&(showAdsBlock=function(){Logger.info(t)}),typeof nothingCanStopMeShowThisMessage=="function"&&(nothingCanStopMeShowThisMessage=function(){Logger.info(t)})}catch(e){Logger.error(e)}},ios_codevn_net:function(){if(this.url.match(/ios\.codevn\.net/)){const t=document.createElement("style");t.innerHTML='div[id*="ScriptRoot"]{height: 1px !important;}',document.head.appendChild(t),ABPVN.cTitle()}},linkneverdie:function(){if(this.url.match(/linkneverdie/)){const t=$.prototype.html;$.prototype.html=function(e){if(this.selector==="body"&&(e===""||e.includes("huong-dan"))){ABPVN.cTitle(),Logger.info("\u{1F601}\u{1F601}Anti Adblock \xE0? C\xF2n l\xE2u nh\xE9!");return}t.call(this,e)}}},redirect_dafontvn_com(){this.url.startWith("https://redirect.dafontvn.com")&&(ABPVN.cTitle(),window.addEventListener("load",()=>{var t=aesCrypto.decrypt(convertstr($.urlParam("o")),convertstr("root"));location.href=t}))},game24h_vn:function(){this.url.startWith("https://game24h.vn")&&typeof addGameIframe=="function"&&(ABPVN.cTitle(),document.querySelector("#playBtn").style.display="none",addGameIframe())},removeRedir:function(t){if(this.url.match(new RegExp(t.url,"g"))||this.url.startWith(t.url)){ABPVN.cTitle();var e=document.querySelectorAll(t.selector||'a[href^="'+t.replace+'"]');Logger.info("Remove Redirect for "+e.length+" links"),e.length&&e.forEach(function(n){for(var i=n.getAttribute("href").replace(t.replace,""),o=0;i.indexOf("%2")>-1&&o<5;)i=decodeURIComponent(i),o++;for(o=0;i.indexOf("aHR0c")===0&&o<5;)i=atob(i),o++;n.setAttribute("href",i),n.setAttribute("title","Link \u0111\xE3 x\xF3a chuy\u1EC3n h\u01B0\u1EDBng trung gian b\u1EDFi abpvn.com")}.bind(this))}},removeRedirect(){var t=[{url:"https://samsungvn.com",replace:"https://samsungvn.com/xfa-interstitial/redirect?url="},{url:"https://forum.vietdesigner.net",replace:"redirect/?url="},{url:"www.webtretho.com/forum/",replace:/http(s?):\/\/webtretho\.com\/forum\/links\.php\?url=/,selector:'a[href*="webtretho.com/forum/links.php?url="]'},{url:"https://tuong.me/",replace:"https://tuong.me/chuyen-huong/?url="},{url:"https://yhocdata.com/",replace:"https://yhocdata.com/redirect/?url="},{url:"https://vn-z.vn/",replace:"https://vn-z.vn/redirect?to="},{url:"https://romgoc.net",replace:"https://romgoc.net/redirect-to/?url="},{url:"https://tophanmem.com",replace:"https://tophanmem.com/redirect-to/?url="},{url:"https://anonyviet.com",replace:"https://anonyviet.com/tieptucdidentrangmoi/?url="},{url:"https://icongnghe.com",replace:"https://icongnghe.com/download/?url="},{url:"www.hdvietnam.",selector:'a[href*="/diendan/chuyenlink.php?url="]',replace:/http(s?):\/\/www.hdvietnam\.(com|me)\/diendan\/chuyenlink\.php\?url=/},{url:"anonyviet.com",replace:"https://anonyviet.com/tieptucdentrangmoi/?url="}];t.forEach(function(e){this.removeRedir(e)}.bind(this))},init:function(){this.url=location.href,configure.getValue("remove_redirect",!0)&&this.removeRedirect(),this.antiAdblockRemover(),this.ios_codevn_net(),this.linkneverdie(),this.redirect_dafontvn_com(),this.game24h_vn()}},adBlocker={mgIdAdRemover:function(){if(!/ios\.codevn\.net/.test(location.hostname)){var e=document.querySelectorAll('[id*="ScriptRoot"]');if(e&&e.length){ABPVN.cTitle(),Logger.log("Removed mgIdAd placeholder");for(var n=0;n<e.length;n++)location.hostname!=="megaup.net"&&(e[n].id="ScriptRoot-removed-by-abpvn-"+Math.random()),e[n].innerHTML=""}}},noAdsModal:function(){const t=/vebo|90phut|khomuc|xoilac|banhkhuc/;if(location.hostname.match(t)){const e=document.createElement("style");e.innerHTML="html,body{overflow: auto!important} .modal-backdrop,.modal{display: none!important}",document.head.appendChild(e),ABPVN.cTitle()}},init:function(){this.url=location.href,this.mgIdAdRemover(),this.noAdsModal()}},configure={urls:{setting:"https://abpvn.com/script-setting.html",issue:"https://github.com/abpvn/abpvn/issues/new",fanpage:"https://www.facebook.com/abpvn.org"},openUrl:function(t){typeof GM_openInTab=="function"&&GM_openInTab(t)},getValue:function(t,e){var n;return typeof GM_getValue=="function"&&(n=GM_getValue(t)),typeof n>"u"?e:n},setValue:function(t,e){if(typeof GM_setValue=="function")return GM_setValue(t,e)},setUpSetting:function(){if(this.url===this.urls.setting){var t=document.querySelector("#setting-container");if(t){t.classList.add("installed");var e=t.querySelectorAll('input[type="checkbox"]');e&&e.forEach(n=>{n.checked=this.getValue(n.name,!0),n.addEventListener("change",i=>{var o=i.target,r=o.name;this.setValue(r,i.target.checked)})})}}},init:function(){this.url=location.href,typeof GM_registerMenuCommand=="function"&&(GM_registerMenuCommand("ABPVN - C\xE0i \u0111\u1EB7t",()=>{this.openUrl(this.urls.setting)}),GM_registerMenuCommand("ABPVN - B\xE1o l\u1ED7i",()=>{this.openUrl(this.urls.issue)}),GM_registerMenuCommand("ABPVN - Fanpage",()=>{this.openUrl(this.urls.fanpage)})),this.setUpSetting()}},ABPVN={cTitle:function(){document.title.indexOf(" - Fixed by ABPVN.COM")===-1&&(document.title=document.title+" - Fixed by ABPVN.COM")},init:function(){adBlocker.init(),getLink.init(),fixSite.init(),byPass.init(),window===window.parent&&configure.init()}};ABPVN.init();
