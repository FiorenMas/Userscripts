// ==UserScript==
// @name              网盘直链下载助手
// @namespace         https://github.com/syhyz1990/baiduyun
// @version           6.2.3
// @author            YouXiaoHou
// @license           AGPL-3.0-or-later
// @homepage          https://www.youxiaohou.com/install.html
// @supportURL        https://github.com/syhyz1990/baiduyun
// @updateURL https://raw.githubusercontent.com/FiorenMas/Userscripts/release/release/panlinker.meta.js
// @downloadURL https://raw.githubusercontent.com/FiorenMas/Userscripts/release/release/panlinker.user.js
// @match             *://pan.baidu.com/disk/home*
// @match             *://yun.baidu.com/disk/home*
// @match             *://pan.baidu.com/disk/main*
// @match             *://yun.baidu.com/disk/main*
// @match             *://pan.baidu.com/s/*
// @match             *://yun.baidu.com/s/*
// @match             *://pan.baidu.com/share/*
// @match             *://yun.baidu.com/share/*
// @match             *://www.aliyundrive.com/s/*
// @match             *://www.aliyundrive.com/drive*
// @match             *://www.alipan.com/s/*
// @match             *://www.alipan.com/drive*
// @match             *://cloud.189.cn/web/*
// @match             *://pan.xunlei.com/*
// @match             *://pan.quark.cn/*
// @match             *://yun.139.com/*
// @match             *://caiyun.139.com/*
// @require           https://unpkg.com/jquery@3.7.0/dist/jquery.min.js
// @require           https://unpkg.com/sweetalert2@10.16.6/dist/sweetalert2.all.min.js
// @require           https://unpkg.com/js-md5@0.7.3/build/md5.min.js
// @connect           baidu.com
// @connect           baidupcs.com
// @connect           aliyundrive.com
// @connect           alipan.com
// @connect           189.cn
// @connect           xunlei.com
// @connect           quark.cn
// @connect           youxiaohou.com
// @connect           yun.139.com
// @connect           caiyun.139.com
// @connect           localhost
// @connect           *
// @run-at            document-idle
// @grant             unsafeWindow
// @grant             GM_xmlhttpRequest
// @grant             GM_setClipboard
// @grant             GM_setValue
// @grant             GM_getValue
// @grant             GM_openInTab
// @grant             GM_info
// @grant             GM_registerMenuCommand
// @grant             GM_cookie
// @icon              data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAxMjggMTI4Ij48cGF0aCBkPSJNMTAzLjYgMTA3LjRjMy41LTIuMiA4LjktNi4xIDEzLjgtMTIuNXM3LjMtMTIuNSA4LjUtMTYuNWMuNS0xLjcgMi4yLTcuNSAyLjItMTQuNyAwLTEwLjEtMy4zLTI1LjEtMTUuNC0zNi44LTE0LjUtMTQtMzIuMS0xNC4zLTM1LjctMTQuMy04IDAtMTUuNyAxLjktMjIuNiA1LjJDNDQgMjMgMzUuNyAzMS40IDMwLjggNDEuN2MtMS4zIDIuOC00IDQuNy03LjEgNS00IC4zLTcuNSA0LjQtOC45IDkuNi0uNSAxLjktMS42IDMuNS0zLjEgNC43QzQuNCA2Ni44IDAgNzUuNyAwIDg1YzAgNi44IDIuMyAxMy4xIDYuMSAxOC4yIDUuNSA3LjQgMTQuMiAxMi4yIDI0IDEyLjJoNDcuMWM0LjQgMCAxMS0uNSAxOC4zLTMuNSAzLjItMS40IDUuOS0zIDguMS00LjV6IiBmaWxsPSIjNDQ0Ii8+PHBhdGggZD0iTTExOS44IDY0LjNjLjEtMTcuMS0xMC40LTI4LTEyLjUtMzAuMUM5NSAyMi4xIDc5LjkgMjEuOCA3Ni45IDIxLjhjLTE3LjYgMC0zMy4zIDEwLjUtMzkuOSAyNi43LS42IDEuMy0xLjggMi4zLTMuNCAyLjNoLS40Yy01LjggMC0xMC42IDQuOC0xMC42IDEwLjd2LjVjMCAxLjQtLjggMi42LTEuOSAzLjNDMTMuNCA2OSA4LjggNzYuOCA4LjggODVjMCAxMi4yIDkuOSAyMi4zIDIyLjIgMjIuM2g0NS4yYzMuNi0uMSAxNy42LS45IDI5LjYtMTIgMi45LTIuOCAxMy45LTEzLjcgMTQtMzF6IiBmaWxsPSIjMTM5N2Q4Ii8+PHBhdGggZD0iTTExMC44IDU3LjRsLjIgMy4zYzAgMS4zLTEuMSAyLjQtMi4zIDIuNC0xLjMgMC0yLjMtMS4xLTIuMy0yLjRsLS4xLTIuOHYtLjNjMC0xLjIuOS0yLjIgMi4xLTIuM2guM2MuNyAwIDEuMy4zIDEuNy43LS4yLjEuMy41LjQgMS40em0tMy4zLTEwLjNjMCAxLjItMSAyLjMtMi4yIDIuM2gtLjFjLS44IDAtMS42LS41LTItMS4yLTQuNi04LjMtMTMuMy0xMy41LTIyLjgtMTMuNS0xLjIgMC0yLjMtMS0yLjMtMi4ydi0uMWMwLTEuMiAxLTIuMyAyLjItMi4zaC4xYTMwLjM3IDMwLjM3IDAgMCAxIDE1LjggNC40YzQuNiAyLjggOC40IDYuOCAxMS4xIDExLjUuMS4zLjIuNy4yIDEuMXpNODguMyA3My44TDczLjUgOTMuMmMtMS41IDEuOS0zLjUgMy4xLTUuNyAzLjVoLS4yYy0uNC4xLS44LjEtMS4yLjEtLjYgMC0xLjEtLjEtMS42LS4yLTIuMi0uNC00LjItMS43LTUuNi0zLjVMNDQuMyA3My45Yy0yLTIuNi0yLjUtNS40LTEuNC03LjcuMS0uMS4xLS4yLjItLjIgMS4yLTIgMy41LTMuMiA2LjQtMy4yaDYuNnYtNS43YzAtNi44IDQuNy0xMiAxMC45LTEyIDQuOCAwIDguNSAyLjYgMTAuMyA3LjIuNSAxLjMtLjIgMi43LTEuNSAzLjJzLTIuOC0uMS0zLjMtMS40Yy0xLjEtMi43LTIuOS00LTUuNS00LTMuNSAwLTYgMy02IDd2OC4xYzAgLjUtLjIgMS0uNiAxLjQtLjYuNy0xLjcgMS4xLTIuNiAxLjFoLTguNGMtMS4zIDAtMiAuNC0yLjEuNy0uMi40IDAgMS4zLjkgMi40TDYzLjEgOTBjLjkgMS4yIDIuMSAxLjggMy4zIDEuOHMyLjMtLjYgMy4xLTEuN2wxNC44LTE5LjNjLjktMS4xIDEuMS0yIC45LTIuNC0uMi0uMy0uOS0uNy0yLjEtLjdoLTcuNmMtLjkgMC0xLjctLjUtMi4xLTEuMi0uMy0uNC0uNC0uOC0uNC0xLjMgMC0xLjQgMS4xLTIuNSAyLjUtMi41aDcuNmMzLjEgMCA1LjUgMS4zIDYuNiAzLjVsLjMuN2MuNyAyLjEuMSA0LjYtMS43IDYuOXoiIGZpbGw9IiM0NDQiLz48L3N2Zz4=
// ==/UserScript==
(function(){"use strict";let f="",h=[],v={},u="",S=800,o={},k="",m=$(document),L={},x={},_={},T={};const D=GM_info.script,y=D.version,U=D.author,O=D.name,I={popup:"pl-popup",header:"pl-header",title:"pl-title",closeButton:"pl-close",content:"pl-content",input:"pl-input",footer:"pl-footer"},C={wc:"Windows CMD",wp:"Windows PowerShell",lt:"Linux \u7EC8\u7AEF",ls:"Linux Shell",mt:"MacOS \u7EC8\u7AEF"};let R=Swal.mixin({toast:!0,position:"top",showConfirmButton:!1,timer:3500,timerProgressBar:!1,didOpen:t=>{t.addEventListener("mouseenter",Swal.stopTimer),t.addEventListener("mouseleave",Swal.resumeTimer)}});const b={success:t=>{R.fire({title:t,icon:"success"})},error:t=>{R.fire({title:t,icon:"error"})},warning:t=>{R.fire({title:t,icon:"warning"})},info:t=>{R.fire({title:t,icon:"info"})},question:t=>{R.fire({title:t,icon:"question"})}};let a={getCookie(t){let i=t+"=",l=document.cookie.split(";");for(let n=0;n<l.length;n++){let s=l[n].trim();if(s.indexOf(i)==0)return s.substring(i.length,s.length)}return""},isType(t){return Object.prototype.toString.call(t).replace(/^\[object (.+)\]$/,"$1").toLowerCase()},getValue(t){return GM_getValue(t)},setValue(t,i){GM_setValue(t,i)},getStorage(t){try{return JSON.parse(localStorage.getItem(t))}catch{return localStorage.getItem(t)}},setStorage(t,i){return this.isType(i)==="object"||this.isType(i)==="array"?localStorage.setItem(t,JSON.stringify(i)):localStorage.setItem(t,i)},setClipboard(t){GM_setClipboard(t,"text")},e(t){return btoa(unescape(encodeURIComponent(t)))},d(t){return decodeURIComponent(escape(atob(t)))},getExtension(t){const i=/(?!\.)\w+$/;return i.test(t)?t.match(i)[0].toUpperCase():""},sizeFormat(t){if(t===+t){let i=["B","KB","MB","GB","TB","PB","EB","ZB","YB"],l=Math.floor(Math.log(t)/Math.log(1024)),n=t/Math.pow(1024,l);return n=n.toFixed(1),n+i[l]}return""},sortByName(t){const i=()=>(l,n)=>{const s=l.filename?l.filename:l.server_filename,r=n.filename?n.filename:n.server_filename;return s.localeCompare(r,"zh-CN")};t.sort(i())},fixFilename(t){return t.replace(/[!?&|`"'*\/:<>\\]/g,"_")},blobDownload(t,i){if(t instanceof Blob){const l=URL.createObjectURL(t),n=document.createElement("a");n.href=l,n.download=i,n.click(),URL.revokeObjectURL(l)}},post(t,i,l,n){return this.isType(i)==="object"&&(i=JSON.stringify(i)),new Promise((s,r)=>{GM_xmlhttpRequest({method:"POST",url:t,headers:l,data:i,responseType:n||"json",onload:c=>{s(n==="blob"?c:c.response||c.responseText)},onerror:c=>{r(c)}})})},get(t,i,l,n){return new Promise((s,r)=>{let c=GM_xmlhttpRequest({method:"GET",url:t,headers:i,responseType:l||"json",onload:d=>{d.status===204&&(c.abort(),T[n.index]=!0),l==="blob"?(d.status===200&&a.blobDownload(d.response,n.filename),s(d)):s(d.response||d.responseText)},onprogress:d=>{n&&n.filename&&n.index&&(d.total>0?L[n.index]=(d.loaded*100/d.total).toFixed(2):L[n.index]=0)},onloadstart(){n&&n.filename&&n.index&&(x[n.index]=c)},onerror:d=>{r(d)}})})},getFinalUrl(t,i){return new Promise((l,n)=>{let s=GM_xmlhttpRequest({method:"GET",url:t,headers:i,onload:r=>{l(r.finalUrl)},onerror:r=>{n(r)}})})},stringify(t){let i="";for(var l in t)if(t.hasOwnProperty(l)){var n=t[l];if(Array.isArray(n))for(var s=0;s<n.length;s++)i+=encodeURIComponent(l)+"="+encodeURIComponent(n[s])+"&";else i+=encodeURIComponent(l)+"="+encodeURIComponent(n)+"&"}return i.slice(0,-1)},addStyle(t,i,l){i=i||"style";let n=document;if(n.getElementById(t))return;let r=n.createElement(i);r.rel="stylesheet",r.id=t,i==="style"?r.innerHTML=l:r.href=l,n.getElementsByTagName("head")[0].appendChild(r)},sleep(t){return new Promise(i=>setTimeout(i,t))},findReact(t,i=0){const l=Object.keys(t).find(c=>c.startsWith("__reactFiber$")||c.startsWith("__reactInternalInstance$")),n=t[l];if(n==null)return null;if(n._currentElement){let c=n._currentElement._owner;for(let d=0;d<i;d++)c=c._currentElement._owner;return c._instance}const s=c=>{let d=c.return;for(;typeof d.type=="string";)d=d.return;return d};let r=s(n);for(let c=0;c<i;c++)r=s(r);return r.stateNode||r},initDefaultConfig(){[{name:"setting_rpc_domain",value:"http://localhost"},{name:"setting_rpc_port",value:"16800"},{name:"setting_rpc_path",value:"/jsonrpc"},{name:"setting_rpc_token",value:""},{name:"setting_rpc_dir",value:"D:"},{name:"setting_terminal_type",value:"wc"},{name:"setting_theme_color",value:"#09AAFF"},{name:"setting_init_code",value:""},{name:"license",value:""}].forEach(i=>{a.getValue(i.name)===void 0&&a.setValue(i.name,i.value)})},showSetting(){let t="",i="",l=["#09AAFF","#cc3235","#526efa","#518c17","#ed944b","#f969a5","#bca280"];t+=`<label class="pl-setting-label"><div class="pl-label">RPC\u4E3B\u673A</div><input type="text"  placeholder="\u4E3B\u673A\u5730\u5740\uFF0C\u9700\u5E26\u4E0Ahttp(s)://" class="pl-input listener-domain" value="${a.getValue("setting_rpc_domain")}"></label>`,t+=`<label class="pl-setting-label"><div class="pl-label">RPC\u7AEF\u53E3</div><input type="text" placeholder="\u7AEF\u53E3\u53F7\uFF0C\u4F8B\u5982\uFF1AMotrix\u4E3A16800" class="pl-input listener-port" value="${a.getValue("setting_rpc_port")}"></label>`,t+=`<label class="pl-setting-label"><div class="pl-label">RPC\u8DEF\u5F84</div><input type="text" placeholder="\u8DEF\u5F84\uFF0C\u9ED8\u8BA4\u4E3A/jsonrpc" class="pl-input listener-path" value="${a.getValue("setting_rpc_path")}"></label>`,t+=`<label class="pl-setting-label"><div class="pl-label">RPC\u5BC6\u94A5</div><input type="text" placeholder="\u65E0\u5BC6\u94A5\u65E0\u9700\u586B\u5199" class="pl-input listener-token" value="${a.getValue("setting_rpc_token")}"></label>`,t+=`<label class="pl-setting-label"><div class="pl-label">\u4FDD\u5B58\u8DEF\u5F84</div><input type="text" placeholder="\u6587\u4EF6\u4E0B\u8F7D\u540E\u4FDD\u5B58\u8DEF\u5F84\uFF0C\u4F8B\u5982\uFF1AD:" class="pl-input listener-dir" value="${a.getValue("setting_rpc_dir")}"></label>`,l.forEach(n=>{i+=`<div data-color="${n}" style="background: ${n};border: 1px solid ${n}" class="pl-color-box listener-color ${n===a.getValue("setting_theme_color")?"checked":""}"></div>`}),t+='<label class="pl-setting-label"><div class="pl-label">\u7EC8\u7AEF\u7C7B\u578B</div><select class="pl-input listener-terminal">',Object.keys(C).forEach(n=>{t+=`<option value="${n}" ${a.getValue("setting_terminal_type")===n?"selected":""}>${C[n]}</option>`}),t+="</select></label>",t+=`<label class="pl-setting-label"><div class="pl-label">\u4E3B\u9898\u989C\u8272</div> <div class="pl-color">${i}<div></label>`,t="<div>"+t+"</div>",Swal.fire({title:"\u52A9\u624B\u914D\u7F6E",html:t,icon:"info",showCloseButton:!0,showConfirmButton:!1,footer:o.footer}).then(()=>{b.success("\u8BBE\u7F6E\u6210\u529F\uFF01"),history.go(0)}),m.on("click",".listener-color",async n=>{a.setValue("setting_theme_color",n.target.dataset.color),b.success("\u8BBE\u7F6E\u6210\u529F\uFF01"),history.go(0)}),m.on("input",".listener-domain",async n=>{a.setValue("setting_rpc_domain",n.target.value)}),m.on("input",".listener-port",async n=>{a.setValue("setting_rpc_port",n.target.value)}),m.on("input",".listener-path",async n=>{a.setValue("setting_rpc_path",n.target.value)}),m.on("input",".listener-token",async n=>{a.setValue("setting_rpc_token",n.target.value)}),m.on("input",".listener-dir",async n=>{a.setValue("setting_rpc_dir",n.target.value)}),m.on("change",".listener-terminal",async n=>{a.setValue("setting_terminal_type",n.target.value)})},registerMenuCommand(){GM_registerMenuCommand("\u2699\uFE0F \u8BBE\u7F6E",()=>{this.showSetting()})},createTip(){$("body").append('<div class="pl-tooltip"></div>'),m.on("mouseenter mouseleave",".listener-tip",t=>{if(t.type==="mouseenter"){let i=t.currentTarget.innerText,l=t.currentTarget.dataset.size,n=`${i}<span style="margin-left: 10px;color: #f56c6c;">${l}</span>`;$(t.currentTarget).css({opacity:"0.5"}),$(".pl-tooltip").html(n).css({left:t.pageX+10+"px",top:t.pageY-t.currentTarget.offsetTop>14?t.pageY+"px":t.pageY+20+"px"}).show()}else $(t.currentTarget).css({opacity:"1"}),$(".pl-tooltip").hide(0)})},createLoading(){return $('<div class="pl-loading"><div class="pl-loading-box"><div><div></div><div></div></div></div></div>')},createDownloadIframe(){let t=$('<div style="padding:0;margin:0;display:block"></div>'),i=$('<iframe src="javascript:;" id="downloadIframe" style="display:none"></iframe>');t.append(i),$("body").append(t)},getMirrorList(t,i,l=2){let n=new URL(t).host,s=[];for(let r=0;r<i.length;r++)for(let c=0;c<l;c++){let d=t.replace(n,i[r])+"&".repeat(c);s.push(d)}return s.join(`
`)},listenElement(t,i){let n=!1;function s(){document.querySelector(t)?(n=!0,i()):n&&(n=!1),setTimeout(s,500)}s()},addPanLinkerStyle(){k=a.getValue("setting_theme_color");let t=`
            body::-webkit-scrollbar { display: none }
            ::-webkit-scrollbar { width: 6px; height: 10px }
            ::-webkit-scrollbar-track { border-radius: 0; background: none }
            ::-webkit-scrollbar-thumb { background-color: rgba(85,85,85,.4) }
            ::-webkit-scrollbar-thumb,::-webkit-scrollbar-thumb:hover { border-radius: 5px; -webkit-box-shadow: inset 0 0 6px rgba(0,0,0,.2) }
            ::-webkit-scrollbar-thumb:hover { background-color: rgba(85,85,85,.3) }
            .swal2-popup { font-size: 16px !important; }
            .pl-popup { font-size: 12px !important; }
            .pl-popup a { color: ${k} !important; }
            .pl-header { padding: 0!important;align-items: flex-start!important; border-bottom: 1px solid #eee!important; margin: 0 0 10px!important; padding: 0 0 5px!important; }
            .pl-title { font-size: 16px!important; line-height: 1!important;white-space: nowrap!important; text-overflow: ellipsis!important;}
            .pl-content { padding: 0 !important; font-size: 12px!important; }
            .pl-main { max-height: 400px;overflow-y:scroll; }
            .pl-footer {font-size: 12px!important;justify-content: flex-start!important; margin: 10px 0 0!important; padding: 5px 0 0!important; color: #f56c6c!important; }
            .pl-item { display: flex; align-items: center; line-height: 22px; }
            .pl-item-name { flex: 0 0 150px; text-align: left;margin-right: 10px; overflow: hidden; white-space: nowrap; text-overflow: ellipsis; cursor:default; }
            .pl-item-link { flex: 1; overflow: hidden; text-align: left; white-space: nowrap; text-overflow: ellipsis;cursor:pointer }
            .pl-item-btn { background: ${k}; padding: 4px 5px; border-radius: 3px; line-height: 1; cursor: pointer; color: #fff; }
            .pl-item-tip { display: flex; justify-content: space-between;flex: 1; }
            .pl-back { width: 70px; background: #ddd; border-radius: 3px; cursor:pointer; margin:1px 0; }
            .pl-ext { display: inline-block; width: 44px; background: #999; color: #fff; height: 16px; line-height: 16px; font-size: 12px; border-radius: 3px;}
            .pl-retry {padding: 3px 10px; background: #cc3235; color: #fff; border-radius: 3px; cursor: pointer;}
            .pl-browserdownload { padding: 3px 10px; background: ${k}; color: #fff; border-radius: 3px; cursor: pointer;}
            .pl-item-progress { display:flex;flex: 1;align-items:center}
            .pl-progress { display: inline-block;vertical-align: middle;width: 100%; box-sizing: border-box;line-height: 1;position: relative;height:15px; flex: 1}
            .pl-progress-outer { height: 15px;border-radius: 100px;background-color: #ebeef5;overflow: hidden;position: relative;vertical-align: middle;}
            .pl-progress-inner{ position: absolute;left: 0;top: 0;background-color: #409eff;text-align: right;border-radius: 100px;line-height: 1;white-space: nowrap;transition: width .6s ease;}
            .pl-progress-inner-text { display: inline-block;vertical-align: middle;color: #d1d1d1;font-size: 12px;margin: 0 5px;height: 15px}
            .pl-progress-tip{ flex:1;text-align:right}
            .pl-progress-how{ flex: 0 0 90px; background: #ddd; border-radius: 3px; margin-left: 10px; cursor: pointer; text-align: center;}
            .pl-progress-stop{ flex: 0 0 50px; padding: 0 10px; background: #cc3235; color: #fff; border-radius: 3px; cursor: pointer;margin-left:10px;height:20px}
            .pl-progress-inner-text:after { display: inline-block;content: "";height: 100%;vertical-align: middle;}
            .pl-btn-primary { background: ${k}; border: 0; border-radius: 4px; color: #ffffff; cursor: pointer; font-size: 12px; outline: none; display:flex; align-items: center; justify-content: center; margin: 2px 0; padding: 6px 0;transition: 0.3s opacity; }
            .pl-btn-primary:hover { opacity: 0.9;transition: 0.3s opacity; }
            .pl-btn-success { background: #55af28; animation: easeOpacity 1.2s 2; animation-fill-mode:forwards }
            .pl-btn-info { background: #606266; }
            .pl-btn-warning { background: #da9328; }
            .pl-btn-warning { background: #da9328; }
            .pl-btn-danger { background: #cc3235; }
            .ali-button {display: inline-flex;align-items: center;justify-content: center;border: 0 solid transparent;border-radius: 5px;box-shadow: 0 0 0 0 transparent;width: fit-content;white-space: nowrap;flex-shrink: 0;font-size: 14px;line-height: 1.5;outline: 0;touch-action: manipulation;transition: background .3s ease,color .3s ease,border .3s ease,box-shadow .3s ease;color: #fff;background: rgb(99 125 255);margin-left: 20px;padding: 1px 12px;position: relative; cursor:pointer; height: 32px;}
            .ali-button:hover {background: rgb(122, 144, 255)}
            .tianyi-button {margin-right: 20px; padding: 4px 12px; border-radius: 4px; color: #fff; font-size: 12px; border: 1px solid #0073e3; background: #2b89ea; cursor: pointer; position: relative;}
            .tianyi-button:hover {border-color: #1874d3; background: #3699ff;}
            .yidong-button {float: left; position: relative; margin: 20px 24px 20px 0; width: 98px; height: 36px; background: #3181f9; border-radius: 2px; font-size: 14px; color: #fff; line-height: 39px; text-align: center; cursor: pointer;}
            .yidong-share-button {display: inline-block; position: relative; font-size: 14px; line-height: 36px; height: 36px; text-align: center; color: #fff; border: 1px solid #5a9afa; border-radius: 2px; padding: 0 24px; margin-left: 24px; background: #3181f9; cursor: pointer;}
            .yidong-button:hover {background: #2d76e5;}
            .xunlei-button {display: inline-flex;align-items: center;justify-content: center;border: 0 solid transparent;border-radius: 5px;box-shadow: 0 0 0 0 transparent;width: fit-content;white-space: nowrap;flex-shrink: 0;font-size: 14px;line-height: 1.5;outline: 0;touch-action: manipulation;transition: background .3s ease,color .3s ease,border .3s ease,box-shadow .3s ease;color: #fff;background: #3f85ff;margin-left: 12px;padding: 0px 12px;position: relative; cursor:pointer; height: 36px;}
            .xunlei-button:hover {background: #619bff}
            .quark-button {display: inline-flex; align-items: center; justify-content: center; border: 1px solid #ddd; border-radius: 8px; white-space: nowrap; flex-shrink: 0; font-size: 14px; line-height: 1.5; outline: 0; color: #333; background: #fff; margin-right: 10px; padding: 0px 14px; position: relative; cursor: pointer; height: 36px;}
            .quark-button:hover { background:#f6f6f6 }
            .pl-dropdown-menu {position: absolute;right: 0;top: 30px;padding: 5px 0;color: rgb(37, 38, 43);background: #fff;z-index: 999;width: 102px;border: 1px solid #ddd;border-radius: 10px; box-shadow: 0 0 1px 1px rgb(28 28 32 / 5%), 0 8px 24px rgb(28 28 32 / 12%);}
            .pl-dropdown-menu-item { height: 30px;display: flex;align-items: center;justify-content: center;cursor:pointer }
            .pl-dropdown-menu-item:hover { background-color: rgba(132,133,141,0.08);}
            .pl-button .pl-dropdown-menu { display: none; }
            .pl-button:hover .pl-dropdown-menu { display: block!important; }
            .pl-button-init { opacity: 0.5; animation: easeInitOpacity 1.2s 3; animation-fill-mode:forwards }
             @keyframes easeInitOpacity { from { opacity: 0.5; } 50% { opacity: 1 } to { opacity: 0.5; } }
             @keyframes easeOpacity { from { opacity: 1; } 50% { opacity: 0.35 } to { opacity: 1; } }
            .element-clicked { opacity: 0.5; }
            .pl-extra { margin-top: 10px;display:flex}
            .pl-extra button { flex: 1}
            .pointer { cursor:pointer }
            .pl-setting-label { display: flex;align-items: center;justify-content: space-between;padding-top: 10px; }
            .pl-label { flex: 0 0 100px;text-align:left; }
            .pl-input { flex: 1; padding: 8px 10px; border: 1px solid #c2c2c2; border-radius: 5px; font-size: 14px }
            .pl-color { flex: 1;display: flex;flex-wrap: wrap; margin-right: -10px;}
            .pl-color-box { width: 35px;height: 35px;margin:10px 10px 0 0;; box-sizing: border-box;border:1px solid #fff;cursor:pointer }
            .pl-color-box.checked { border:3px dashed #111!important }
            .pl-close:focus { outline: 0; box-shadow: none; }
            .tag-danger {color:#cc3235;margin: 0 5px;}
            .pl-tooltip { position: absolute; color: #ffffff; max-width: 600px; font-size: 12px; padding: 5px 10px; background: #333; border-radius: 5px; z-index: 110000; line-height: 1.3; display:none; word-break: break-all;}
             @keyframes load { 0% { transform: rotate(0deg) } 100% { transform: rotate(360deg) } }
            .pl-loading-box > div > div { position: absolute;border-radius: 50%;}
            .pl-loading-box > div > div:nth-child(1) { top: 9px;left: 9px;width: 82px;height: 82px;background: #ffffff;}
            .pl-loading-box > div > div:nth-child(2) { top: 14px;left: 38px;width: 25px;height: 25px;background: #666666;animation: load 1s linear infinite;transform-origin: 12px 36px;}
            .pl-loading { width: 16px;height: 16px;display: inline-block;overflow: hidden;background: none;}
            .pl-loading-box { width: 100%;height: 100%;position: relative;transform: translateZ(0) scale(0.16);backface-visibility: hidden;transform-origin: 0 0;}
            .pl-loading-box div { box-sizing: content-box; }
            .swal2-container { z-index:100000!important; }
            body.swal2-height-auto { height: inherit!important; }
            .btn-operate .btn-main { display:flex; align-items:center; }
            `;this.addStyle("panlinker-style","style",t)},async initDialog(){let t=await Swal.fire({title:o.init[0],html:`<div><img style="width: 250px;margin-bottom: 10px;" src="${o.img}" alt="${o.img}"><input class="swal2-input" id="init" type="text" placeholder="${o.init[1]}"></div>`,allowOutsideClick:!1,showCloseButton:!0,confirmButtonText:"\u786E\u5B9A"});t.isDismissed&&t.dismiss==="close"||(o.num===$("#init").val()||o.license===$("#init").val()?(a.setValue("setting_init_code",o.num),a.setValue("license",o.license),b.success(o.init[2]),setTimeout(()=>{history.go(0)},1500)):(await Swal.fire({title:o.init[3],text:o.init[4],confirmButtonText:"\u91CD\u65B0\u8F93\u5165",imageUrl:o.img}),await this.initDialog()))}},P={_getExtra(){return'{"sekey":"'+decodeURIComponent(a.getCookie("BDCLND"))+'"}'},_getSurl(){let t=/(?<=s\/|surl=)([a-zA-Z0-9_-]+)/g;return t.test(location.href)?location.href.match(t)[0]:""},_getFidList(){let t=[];return h.forEach(i=>{+i.isdir!=1&&t.push(i.fs_id)}),"["+t+"]"},_resetData(){L={},$.each(x,t=>{x[t].abort()}),$.each(_,t=>{clearInterval(_[t])}),T={},_={},x={}},setBDUSS(){try{GM_cookie&&GM_cookie("list",{name:"BDUSS"},(t,i)=>{i||a.setStorage("baiduyunPlugin_BDUSS",{BDUSS:t[0].value})})}catch{}},getBDUSS(){return(a.getStorage("baiduyunPlugin_BDUSS")?a.getStorage("baiduyunPlugin_BDUSS"):'{"baiduyunPlugin_BDUSS":""}').BDUSS||""},convertLinkToAria(t,i,l){let n=this.getBDUSS();return n?(i=a.fixFilename(i),encodeURIComponent(`aria2c "${t}" --out "${i}" --header "User-Agent: ${l}" --header "Cookie: BDUSS=${n}"`)):{link:o.assistant,text:o.init[5]}},convertLinkToBC(t,i,l){let n=this.getBDUSS();if(n){let s=`BDUSS=${n}`,r=`AA/${encodeURIComponent(i)}/?url=${encodeURIComponent(t)}&cookie=${encodeURIComponent(s)}&user_agent=${encodeURIComponent(l)}ZZ`;return encodeURIComponent(`bc://http/${a.e(r)}`)}return{link:o.assistant,text:o.init[5]}},convertLinkToCurl(t,i,l){let n=this.getBDUSS();if(n){let s=a.getValue("setting_terminal_type");return i=a.fixFilename(i),encodeURIComponent(`${s!=="wp"?"curl":"curl.exe"} -L -C - "${t}" -o "${i}" -A "${l}" -b "BDUSS=${n}"`)}return{link:o.assistant,text:o.init[5]}},addPageListener(){function t(l){let n=$(l.target),s=n.parents(".pl-item"),r=s.find(".pl-item-link"),c=s.find(".pl-item-progress"),d=s.find(".pl-item-tip");return{item:s,link:r,progress:c,tip:d,target:n}}function i(l){_[l]&&clearInterval(_[l]),x[l]&&x[l].abort(),L[l]=0,T[l]=!1}m.on("mouseenter mouseleave click",".pl-button.g-dropdown-button",l=>{l.type==="mouseleave"?$(l.currentTarget).removeClass("button-open"):($(l.currentTarget).addClass("button-open"),$(l.currentTarget).find(".pl-dropdown-menu").show())}),m.on("mouseleave",".pl-button.g-dropdown-button .pl-dropdown-menu",l=>{$(l.currentTarget).hide()}),m.on("click",".pl-button-mode",l=>{u=l.target.dataset.mode,Swal.showLoading(),this.getPCSLink()}),m.on("click",".listener-link-api",async l=>{l.preventDefault();let n=t(l),s=n.item.find(".pl-progress-inner"),r=n.item.find(".pl-progress-inner-text"),c=n.link[0].dataset.filename,d=n.link[0].dataset.index;i(d),a.get(n.link[0].dataset.link,{"User-Agent":o.ua},"blob",{filename:c,index:d}),_[d]=setInterval(()=>{let p=+L[d]||0;T[d]||!1?(n.tip.hide(),n.progress.hide(),n.link.text("\u5DF2\u6210\u529F\u5524\u8D77IDM\uFF0C\u8BF7\u67E5\u770BIDM\u4E0B\u8F7D\u6846\uFF01").animate({opacity:"0.5"},"slow").show(),clearInterval(_[d]),T[d]=!1):(n.link.hide(),n.tip.hide(),n.progress.show(),s.css("width",p+"%"),r.text(p+"%"),p===100&&(clearInterval(_[d]),L[d]=0,n.item.find(".pl-progress-stop").hide(),n.item.find(".pl-progress-tip").html("\u4E0B\u8F7D\u5B8C\u6210\uFF0C\u6B63\u5728\u5F39\u51FA\u6D4F\u89C8\u5668\u4E0B\u8F7D\u6846\uFF01")))},500)}),m.on("click",".listener-retry",async l=>{let n=t(l);n.tip.hide(),n.link.show()}),m.on("click",".listener-how",async l=>{let n=t(l),s=n.link[0].dataset.index;x[s]&&(x[s].abort(),clearInterval(_[s]),n.progress.hide(),n.tip.show())}),m.on("click",".listener-stop",async l=>{let n=t(l),s=n.link[0].dataset.index;x[s]&&(x[s].abort(),clearInterval(_[s]),n.tip.hide(),n.progress.hide(),n.link.show(0))}),m.on("click",".listener-back",async l=>{let n=t(l);n.tip.hide(),n.link.show()}),m.on("click",".listener-link-aria, .listener-copy-all",l=>{l.preventDefault(),l.target.dataset.link?(a.setClipboard(decodeURIComponent(l.target.dataset.link)),$(l.target).text("\u590D\u5236\u6210\u529F\uFF0C\u5FEB\u53BB\u7C98\u8D34\u5427\uFF01").animate({opacity:"0.5"},"slow")):$(l.target).removeClass("listener-copy-all").addClass("pl-btn-danger").html(`${o.init[5]}\u{1F449}<a href="${o.assistant}" target="_blank" class="pl-a">\u70B9\u51FB\u6B64\u5904\u5B89\u88C5</a>\u{1F448}`)}),m.on("click",".listener-link-rpc",async l=>{let n=$(l.currentTarget);n.find(".icon").remove(),n.find(".pl-loading").remove(),n.prepend(a.createLoading());let s=await this.sendLinkToRPC(l.currentTarget.dataset.filename,l.currentTarget.dataset.link);s==="success"?($(".listener-rpc-task").show(),n.removeClass("pl-btn-danger").html("\u53D1\u9001\u6210\u529F\uFF0C\u5FEB\u53BB\u770B\u770B\u5427\uFF01").animate({opacity:"0.5"},"slow")):s==="assistant"?n.addClass("pl-btn-danger").html(`${o.init[5]}\u{1F449}<a href="${o.assistant}" target="_blank" class="pl-a">\u70B9\u51FB\u6B64\u5904\u5B89\u88C5</a>\u{1F448}`):n.addClass("pl-btn-danger").text("\u53D1\u9001\u5931\u8D25\uFF0C\u8BF7\u68C0\u67E5\u60A8\u7684RPC\u914D\u7F6E\u4FE1\u606F\uFF01").animate({opacity:"0.5"},"slow")}),m.on("click",".listener-send-rpc",l=>{$(".listener-link-rpc").click(),$(l.target).text("\u53D1\u9001\u5B8C\u6210\uFF0C\u53D1\u9001\u7ED3\u679C\u89C1\u4E0A\u65B9\u6309\u94AE\uFF01").animate({opacity:"0.5"},"slow")}),m.on("click",".listener-open-setting",()=>{a.showSetting()}),m.on("click",".listener-rpc-task",()=>{let l=JSON.stringify({domain:a.getValue("setting_rpc_domain"),port:a.getValue("setting_rpc_port")}),n=`${o.d}/?rpc=${a.e(l)}#${a.getValue("setting_rpc_token")}`;GM_openInTab(n,{active:!0})}),document.documentElement.addEventListener("mouseup",l=>{l.target.nodeName==="A"&&~l.target.className.indexOf("pl-a")&&l.stopPropagation()},!0)},addButton(){if(!f)return;let t,i=$(`<div class="g-dropdown-button pointer pl-button"><div style="color:#fff;background: ${k};border-color:${k}" class="g-button g-button-blue"><span class="g-button-right"><em class="icon icon-download"></em><span class="text" style="width: 60px;">\u4E0B\u8F7D\u52A9\u624B</span></span></div><div class="menu" style="width:auto;z-index:41;border-color:${k}"><div style="color:${k}" class="g-button-menu pl-button-mode" data-mode="api">API\u4E0B\u8F7D</div><div style="color:${k}" class="g-button-menu pl-button-mode" data-mode="aria">Aria\u4E0B\u8F7D</div><div style="color:${k}" class="g-button-menu pl-button-mode" data-mode="rpc">RPC\u4E0B\u8F7D</div><div style="color:${k}" class="g-button-menu pl-button-mode" data-mode="curl">cURL\u4E0B\u8F7D</div><div style="color:${k}" class="g-button-menu pl-button-mode" data-mode="bc">BC\u4E0B\u8F7D</div><li class="g-button-menu pl-button-mode listener-open-setting">\u52A9\u624B\u8BBE\u7F6E</li>${o.code==200&&y<o.version?o.new:""}</div></div>`);f==="home"&&(t=$(o.btn.home)),f==="main"&&(t=$(o.btn.main),i=$(`<div class="pl-button" style="position: relative; display: inline-block; margin-right: 8px;"><button class="u-button u-button--primary u-button--small is-round is-has-icon" style="background: ${k};border-color: ${k};font-size: 14px; padding: 8px 16px; border: none;"><i class="u-icon u-icon-download"></i><span>\u4E0B\u8F7D\u52A9\u624B</span></button><ul class="dropdown-list nd-common-float-menu pl-dropdown-menu"><li class="sub cursor-p pl-button-mode" data-mode="api">API\u4E0B\u8F7D</li><li class="sub cursor-p pl-button-mode" data-mode="aria">Aria\u4E0B\u8F7D</li><li class="sub cursor-p pl-button-mode" data-mode="rpc">RPC\u4E0B\u8F7D</li><li class="sub cursor-p pl-button-mode" data-mode="curl">cURL\u4E0B\u8F7D</li><li class="sub cursor-p pl-button-mode" data-mode="bc" >BC\u4E0B\u8F7D</li><li class="sub cursor-p pl-button-mode listener-open-setting">\u52A9\u624B\u8BBE\u7F6E</li>${o.code==200&&y<o.version?o.newX:""}</ul></div>`)),f==="share"&&(t=$(o.btn.share)),t.prepend(i),this.setBDUSS(),this.addPageListener()},addInitButton(){if(!f)return;let t,i=$(`<div class="g-dropdown-button pointer pl-button-init" style="opacity:.5"><div style="color:#fff;background: ${k};border-color:${k}" class="g-button g-button-blue"><span class="g-button-right"><em class="icon icon-download"></em><span class="text" style="width: 60px;">\u4E0B\u8F7D\u52A9\u624B</span></span></div></div>`);f==="home"&&(t=$(o.btn.home)),f==="main"&&(t=$(o.btn.main),i=$(`<div class="pl-button-init" style="opacity:.5; display: inline-block; margin-right: 8px;"><button class="u-button u-button--primary u-button--small is-round is-has-icon" style="background: ${k};border-color: ${k};font-size: 14px; padding: 8px 16px; border: none;"><i class="u-icon u-icon-download"></i><span>\u4E0B\u8F7D\u52A9\u624B</span></button></div>`)),f==="share"&&(t=$(o.btn.share)),t.prepend(i),i.click(()=>a.initDialog())},async getToken(){let t=await a.getFinalUrl(o.pcs[3]);if(t.indexOf("access_token")===-1){let l=await a.get(o.pcs[3],{},"text"),n=l.match(/name="bdstoken"\s+value="([^"]+)"/)?.[1],s=l.match(/name="client_id"\s+value="([^"]+)"/)?.[1],r={grant_permissions_arr:"netdisk",bdstoken:n,client_id:s,response_type:"token",display:"page",grant_permissions:"basic,netdisk"};await a.post(o.pcs[3],a.stringify(r),{"Content-Type":"application/x-www-form-urlencoded"});let d=(await a.getFinalUrl(o.pcs[3])).match(/access_token=([^&]+)/)?.[1];return d&&a.setStorage("accessToken",d),d}let i=t.match(/access_token=([^&]+)/)?.[1];return i&&a.setStorage("accessToken",i),i},async getPCSLink(t=1){h=this.getSelectedList();let i=this._getFidList(),l,n;if(f==="home"||f==="main"){if(h.length===0)return b.error("\u63D0\u793A\uFF1A\u8BF7\u5148\u52FE\u9009\u8981\u4E0B\u8F7D\u7684\u6587\u4EF6\uFF01");if(i.length===2)return b.error("\u63D0\u793A\uFF1A\u8BF7\u6253\u5F00\u6587\u4EF6\u5939\u540E\u52FE\u9009\u6587\u4EF6\uFF01");i=encodeURIComponent(i);let s=a.getStorage("accessToken")||await this.getToken();l=`${o.pcs[0]}&fsids=${i}&access_token=${s}`,n=await a.get(l,{"User-Agent":o.ua})}if(f==="share"){if(this.getShareData(),!v.bdstoken)return b.error("\u63D0\u793A\uFF1A\u8BF7\u5148\u767B\u5F55\u7F51\u76D8\uFF01");if(h.length===0)return b.error("\u63D0\u793A\uFF1A\u8BF7\u5148\u52FE\u9009\u8981\u4E0B\u8F7D\u7684\u6587\u4EF6\uFF01");if(i.length===2)return b.error("\u63D0\u793A\uFF1A\u8BF7\u6253\u5F00\u6587\u4EF6\u5939\u540E\u52FE\u9009\u6587\u4EF6\uFF01");(await Swal.fire({toast:!0,icon:"info",title:'\u63D0\u793A\uFF1A\u8BF7\u5C06\u6587\u4EF6<span class="tag-danger">[\u4FDD\u5B58\u5230\u7F51\u76D8]</span>\u{1F449}\u524D\u5F80<span class="tag-danger">[\u6211\u7684\u7F51\u76D8]</span>\u4E2D\u4E0B\u8F7D\uFF01',showConfirmButton:!0,confirmButtonText:"\u70B9\u51FB\u4FDD\u5B58",position:"top"})).isConfirmed&&$(".tools-share-save-hb")[0].click();return}if(n.errno===0){let s=this.generateDom(n.list);this.showMainDialog(o[u][0],s,o[u][1])}else{if(n.errno===112)return b.error("\u63D0\u793A\uFF1A\u9875\u9762\u8FC7\u671F\uFF0C\u8BF7\u5237\u65B0\u91CD\u8BD5\uFF01");n.errno===9019?(t--,await this.getToken(),t>0?await this.getPCSLink(t):b.error("\u63D0\u793A\uFF1A\u83B7\u53D6\u4E0B\u8F7D\u94FE\u63A5\u5931\u8D25\uFF01\u8BF7\u5237\u65B0\u7F51\u9875\u540E\u91CD\u8BD5\uFF01")):b.error("\u63D0\u793A\uFF1A\u83B7\u53D6\u4E0B\u8F7D\u94FE\u63A5\u5931\u8D25\uFF01\u8BF7\u5237\u65B0\u7F51\u9875\u540E\u91CD\u8BD5\uFF01")}},generateDom(t){let i='<div class="pl-main">',l="";if(a.sortByName(t),t.forEach((n,s)=>{if(n.isdir===1)return;let r=n.server_filename||n.filename,c=a.getExtension(r),d=a.sizeFormat(n.size),p=n.dlink;if(u==="api"&&(i+=`<div class="pl-item">
                                <div class="pl-item-name listener-tip" data-size="${d}">${r}</div>
                                <a class="pl-item-link pl-a listener-link-api" href="${p}" data-filename="${r}" data-link="${p}" data-index="${s}">${p}</a>
                                <div class="pl-item-tip" style="display: none"><span>\u82E5\u6CA1\u6709\u5F39\u51FAIDM\u4E0B\u8F7D\u6846\uFF0C\u627E\u5230IDM <b>\u9009\u9879</b> -> <b>\u6587\u4EF6\u7C7B\u578B</b> -> <b>\u7B2C\u4E00\u4E2A\u6846</b> \u4E2D\u6DFB\u52A0\u540E\u7F00 <span class="pl-ext">${c}</span>\uFF0C<a href="${o.idm}" target="_blank" class="pl-a">\u8BE6\u89C1\u6B64\u5904</a></span> <span class="pl-back listener-back">\u8FD4\u56DE</span></div>
                                <div class="pl-item-progress" style="display: none">
                                    <div class="pl-progress">
                                        <div class="pl-progress-outer"></div>
                                        <div class="pl-progress-inner" style="width:5%">
                                          <div class="pl-progress-inner-text">0%</div>
                                        </div>
                                    </div>
                                    <span class="pl-progress-stop listener-stop">\u53D6\u6D88\u4E0B\u8F7D</span>
                                    <span class="pl-progress-tip">\u672A\u53D1\u73B0IDM\uFF0C\u4F7F\u7528\u81EA\u5E26\u6D4F\u89C8\u5668\u4E0B\u8F7D</span>
                                    <span class="pl-progress-how listener-how">\u5982\u4F55\u5524\u8D77IDM\uFF1F</span>
                                </div></div>`),u==="aria"){let g=this.convertLinkToAria(p,r,o.ua);typeof g=="object"?i+=`<div class="pl-item">
                                <div class="pl-item-name listener-tip" data-size="${d}">${r}</div>
                                <a class="pl-item-link pl-a" target="_blank" href="${g.link}" data-filename="${r}" data-link="${g.link}">${decodeURIComponent(g.text)}</a> </div>`:(l+=g+`\r
`,i+=`<div class="pl-item">
                                <div class="pl-item-name listener-tip" data-size="${d}">${r}</div>
                                <a class="pl-item-link pl-a listener-link-aria" href="${g}" title="\u70B9\u51FB\u590D\u5236aria2c\u94FE\u63A5" data-filename="${r}" data-link="${g}">${decodeURIComponent(g)}</a> </div>`)}if(u==="rpc"&&(i+=`<div class="pl-item">
                                <div class="pl-item-name listener-tip" data-size="${d}">${r}</div>
                                <button class="pl-item-link listener-link-rpc pl-btn-primary pl-btn-info" data-filename="${r}" data-link="${p}"><em class="icon icon-device"></em><span style="margin-left: 5px;">\u63A8\u9001\u5230 RPC \u4E0B\u8F7D\u5668</span></button></div>`),u==="curl"){let g=this.convertLinkToCurl(p,r,o.ua);typeof g=="object"?i+=`<div class="pl-item">
                                <div class="pl-item-name listener-tip" data-size="${d}">${r}</div>
                                <a class="pl-item-link pl-a" target="_blank" href="${g.link}" data-filename="${r}" data-link="${g.link}">${decodeURIComponent(g.text)}</a> </div>`:(l+=g+`\r
`,i+=`<div class="pl-item">
                                <div class="pl-item-name listener-tip" data-size="${d}">${r}</div>
                                <a class="pl-item-link pl-a listener-link-aria" href="${g}" title="\u70B9\u51FB\u590D\u5236curl\u94FE\u63A5" data-filename="${r}" data-link="${g}">${decodeURIComponent(g)}</a> </div>`)}if(u==="bc"){let g=this.convertLinkToBC(p,r,o.ua);typeof g=="object"?i+=`<div class="pl-item">
                                <div class="pl-item-name listener-tip" data-size="${d}">${r}</div>
                                <a class="pl-item-link pl-a" target="_blank" href="${g.link}" data-filename="${r}" data-link="${g.link}">${decodeURIComponent(g.text)}</a> </div>`:i+=`<div class="pl-item">
                                <div class="pl-item-name listener-tip" data-size="${d}">${r}</div>
                                <a class="pl-item-link pl-a" href="${decodeURIComponent(g)}" title="\u70B9\u51FB\u7528\u6BD4\u7279\u5F57\u661F\u4E0B\u8F7D" data-filename="${r}" data-link="${g}">${decodeURIComponent(g)}</a> </div>`}}),i+="</div>",u==="aria"&&(i+=`<div class="pl-extra"><button class="pl-btn-primary listener-copy-all" data-link="${l}">\u590D\u5236\u5168\u90E8\u94FE\u63A5</button></div>`),u==="rpc"){let n=a.getValue("setting_rpc_domain")+":"+a.getValue("setting_rpc_port")+a.getValue("setting_rpc_path");i+=`<div class="pl-extra"><button class="pl-btn-primary listener-send-rpc">\u53D1\u9001\u5168\u90E8\u94FE\u63A5</button><button title="${n}" class="pl-btn-primary pl-btn-warning listener-open-setting" style="margin-left: 10px">\u8BBE\u7F6E RPC \u53C2\u6570\uFF08\u5F53\u524D\u4E3A\uFF1A${n}\uFF09</button><button class="pl-btn-primary pl-btn-success listener-rpc-task" style="margin-left: 10px;display: none">\u67E5\u770B\u4E0B\u8F7D\u4EFB\u52A1</button></div>`}return u==="curl"&&(i+=`<div class="pl-extra"><button class="pl-btn-primary listener-copy-all" data-link="${l}">\u590D\u5236\u5168\u90E8\u94FE\u63A5</button><button class="pl-btn-primary pl-btn-warning listener-open-setting" style="margin-left: 10px;">\u8BBE\u7F6E\u7EC8\u7AEF\u7C7B\u578B\uFF08\u5F53\u524D\u4E3A\uFF1A${C[a.getValue("setting_terminal_type")]}\uFF09</button></div>`),i},async sendLinkToRPC(t,i){let l={domain:a.getValue("setting_rpc_domain"),port:a.getValue("setting_rpc_port"),path:a.getValue("setting_rpc_path"),token:a.getValue("setting_rpc_token"),dir:a.getValue("setting_rpc_dir")},n=this.getBDUSS();if(!n)return"assistant";let s=`${l.domain}:${l.port}${l.path}`,r={id:new Date().getTime(),jsonrpc:"2.0",method:"aria2.addUri",params:[`token:${l.token}`,[i],{dir:l.dir,out:t,header:[`User-Agent: ${o.ua}`,`Cookie: BDUSS=${n}`]}]};try{return(await a.post(s,r,{"User-Agent":o.ua},"")).result?"success":"fail"}catch{return"fail"}},getSelectedList(){try{return require("system-core:context/context.js").instanceForSystem.list.getSelected()}catch{return document.querySelector(".wp-s-core-pan").__vue__.selectedList}},getLogid(){return require("system-core:context/context.js").instanceForSystem.tools.baseService.base64Encode(a.getCookie("BAIDUID"))},getShareData(){let t=locals.dump();v.shareType="secret",v.sign="",v.timestamp="",v.bdstoken=t.bdstoken.value,v.channel="chunlei",v.clienttype=0,v.web=1,v.app_id=250528,v.encrypt=0,v.product="share",v.logid=this.getLogid(),v.primaryid=t.shareid.value,v.uk=t.share_uk.value,v.shareType==="secret"&&(v.extra=this._getExtra()),v.surl=this._getSurl()},detectPage(){let t=location.pathname;return/^\/disk\/home/.test(t)?"home":/^\/disk\/main/.test(t)?"main":/^\/(s|share)\//.test(t)?"share":""},showMainDialog(t,i,l){Swal.fire({title:t,html:i,footer:l,allowOutsideClick:!1,showCloseButton:!0,showConfirmButton:!1,position:"top",width:S,padding:"15px 20px 5px",customClass:I}).then(()=>{this._resetData()})},async initPanLinker(){a.initDefaultConfig(),a.addPanLinkerStyle(),f=this.detectPage();let t=await a.post(`https://api.youxiaohou.com/config/v2?ver=${y}&a=${U}`,{},{},"text");o=JSON.parse(a.d(t)),Object.freeze&&Object.freeze(o),o.num===a.getValue("setting_init_code")||o.license===a.getValue("license")?this.addButton():this.addInitButton(),a.createTip(),a.registerMenuCommand()}},B={convertLinkToAria(t,i,l){return i=a.fixFilename(i),encodeURIComponent(`aria2c "${t}" --out "${i}" --header "Referer: https://www.aliyundrive.com/"`)},convertLinkToBC(t,i,l){let n=`AA/${encodeURIComponent(i)}/?url=${encodeURIComponent(t)}&refer=${encodeURIComponent("https://www.aliyundrive.com/")}ZZ`;return encodeURIComponent(`bc://http/${a.e(n)}`)},convertLinkToCurl(t,i,l){let n=a.getValue("setting_terminal_type");return i=a.fixFilename(i),encodeURIComponent(`${n!=="wp"?"curl":"curl.exe"} -L -C - "${t}" -o "${i}" -e "https://www.aliyundrive.com/"`)},addPageListener(){m.on("click",".pl-button-mode",t=>{u=t.target.dataset.mode,Swal.showLoading(),this.getPCSLink()}),m.on("click",".listener-link-api",async t=>{t.preventDefault();let l=t.currentTarget.dataset.link;$("#downloadIframe").attr("src",l)}),m.on("click",".listener-link-api-btn",async t=>{a.setClipboard(t.target.dataset.filename),$(t.target).text("\u590D\u5236\u6210\u529F").animate({opacity:"0.5"},"slow")}),m.on("click",".listener-link-aria, .listener-copy-all",t=>{t.preventDefault(),a.setClipboard(decodeURIComponent(t.target.dataset.link)),$(t.target).text("\u590D\u5236\u6210\u529F\uFF0C\u5FEB\u53BB\u7C98\u8D34\u5427\uFF01").animate({opacity:"0.5"},"slow")}),m.on("click",".listener-link-rpc",async t=>{let i=$(t.currentTarget);i.find(".icon").remove(),i.find(".pl-loading").remove(),i.prepend(a.createLoading()),await this.sendLinkToRPC(t.currentTarget.dataset.filename,t.currentTarget.dataset.link)==="success"?($(".listener-rpc-task").show(),i.removeClass("pl-btn-danger").html("\u53D1\u9001\u6210\u529F\uFF0C\u5FEB\u53BB\u770B\u770B\u5427\uFF01").animate({opacity:"0.5"},"slow")):i.addClass("pl-btn-danger").text("\u53D1\u9001\u5931\u8D25\uFF0C\u8BF7\u68C0\u67E5\u60A8\u7684RPC\u914D\u7F6E\u4FE1\u606F\uFF01").animate({opacity:"0.5"},"slow")}),m.on("click",".listener-send-rpc",t=>{$(".listener-link-rpc").click(),$(t.target).text("\u53D1\u9001\u5B8C\u6210\uFF0C\u53D1\u9001\u7ED3\u679C\u89C1\u4E0A\u65B9\u6309\u94AE\uFF01").animate({opacity:"0.5"},"slow")}),m.on("click",".listener-open-setting",()=>{a.showSetting()}),m.on("click",".listener-rpc-task",()=>{let t=JSON.stringify({domain:a.getValue("setting_rpc_domain"),port:a.getValue("setting_rpc_port")}),i=`${o.d}/?rpc=${a.e(t)}#${a.getValue("setting_rpc_token")}`;GM_openInTab(i,{active:!0})})},async getRealLink(t,i){let l=`${a.getStorage("token").token_type} ${a.getStorage("token").access_token}`,n=await a.post(o.pcs[1],{drive_id:t,file_id:i},{authorization:l,"content-type":"application/json;charset=utf-8",referer:"https://www.aliyundrive.com/","x-canary":"client=windows,app=adrive,version=v6.0.0"});return n.code==="AccessTokenInvalid"?b.error("\u63D0\u793A\uFF1AToken\u8FC7\u671F\uFF0C\u8BF7\u5237\u65B0\u7F51\u9875\u540E\u91CD\u8BD5\uFF01"):n.url?n.url:""},addButton(){if(!f)return;let t,i=$(`<div class="ali-button pl-button"><svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" width="16" height="16"><path d="M853.333 938.667H170.667a85.333 85.333 0 0 1-85.334-85.334v-384A85.333 85.333 0 0 1 170.667 384H288a32 32 0 0 1 0 64H170.667a21.333 21.333 0 0 0-21.334 21.333v384a21.333 21.333 0 0 0 21.334 21.334h682.666a21.333 21.333 0 0 0 21.334-21.334v-384A21.333 21.333 0 0 0 853.333 448H736a32 32 0 0 1 0-64h117.333a85.333 85.333 0 0 1 85.334 85.333v384a85.333 85.333 0 0 1-85.334 85.334z" fill="#fff"/><path d="M715.03 543.552a32.81 32.81 0 0 0-46.251 0L554.005 657.813v-540.48a32 32 0 0 0-64 0v539.734L375.893 543.488a32.79 32.79 0 0 0-46.229 0 32.427 32.427 0 0 0 0 46.037l169.557 168.811a32.81 32.81 0 0 0 46.251 0l169.557-168.81a32.47 32.47 0 0 0 0-45.974z" fill="#FF9C00"/></svg><span>\u4E0B\u8F7D\u52A9\u624B</span><ul class="pl-dropdown-menu"><li class="pl-dropdown-menu-item pl-button-mode" data-mode="api">API\u4E0B\u8F7D</li><li class="pl-dropdown-menu-item pl-button-mode" data-mode="aria" >Aria\u4E0B\u8F7D</li><li class="pl-dropdown-menu-item pl-button-mode" data-mode="rpc">RPC\u4E0B\u8F7D</li><li class="pl-dropdown-menu-item pl-button-mode" data-mode="curl">cURL\u4E0B\u8F7D</li><li class="pl-dropdown-menu-item pl-button-mode" data-mode="bc" >BC\u4E0B\u8F7D</li><li class="pl-dropdown-menu-item pl-button-mode listener-open-setting">\u52A9\u624B\u8BBE\u7F6E</li>${o.code==200&&y<o.version?o.new:""}</ul></div>`);f==="home"&&a.listenElement(o.btn.home,()=>{t=$(o.btn.home),$(".pl-button").length===0&&t.append(i)}),f==="share"&&(i.css({"margin-right":"10px"}),a.listenElement(o.btn.share,()=>{t=$(o.btn.share),$(".pl-button").length===0&&t.prepend(i)})),a.createDownloadIframe(),this.addPageListener()},addInitButton(){if(!f)return;let t,i=$('<div class="ali-button pl-button-init"><svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" width="16" height="16"><path d="M853.333 938.667H170.667a85.333 85.333 0 0 1-85.334-85.334v-384A85.333 85.333 0 0 1 170.667 384H288a32 32 0 0 1 0 64H170.667a21.333 21.333 0 0 0-21.334 21.333v384a21.333 21.333 0 0 0 21.334 21.334h682.666a21.333 21.333 0 0 0 21.334-21.334v-384A21.333 21.333 0 0 0 853.333 448H736a32 32 0 0 1 0-64h117.333a85.333 85.333 0 0 1 85.334 85.333v384a85.333 85.333 0 0 1-85.334 85.334z" fill="#fff"/><path d="M715.03 543.552a32.81 32.81 0 0 0-46.251 0L554.005 657.813v-540.48a32 32 0 0 0-64 0v539.734L375.893 543.488a32.79 32.79 0 0 0-46.229 0 32.427 32.427 0 0 0 0 46.037l169.557 168.811a32.81 32.81 0 0 0 46.251 0l169.557-168.81a32.47 32.47 0 0 0 0-45.974z" fill="#FF9C00"/></svg><span>\u4E0B\u8F7D\u52A9\u624B</span></div>');f==="home"&&a.listenElement(o.btn.home,()=>{t=$(o.btn.home),$(".pl-button-init").length===0&&t.append(i)}),f==="share"&&(i.css({"margin-right":"10px"}),a.listenElement(o.btn.share,()=>{t=$(o.btn.share),$(".pl-butto-init").length===0&&t.prepend(i)})),i.click(()=>a.initDialog())},async getPCSLink(){if(document.querySelector(o.dom.grid))return await Swal.fire({title:"\u63D0\u793A",html:'<div style="display: flex;align-items: center;justify-content: center;">\u8BF7\u5148\u5207\u6362\u5230 <b>\u5217\u8868\u89C6\u56FE</b>\uFF08<svg class="icon" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" width="16" height="16"><path d="M132 928c-32.8 0-59.2-26.4-59.2-59.2s26.4-59.2 59.2-59.2h760c32.8 0 59.2 26.4 59.2 59.2S924.8 928 892 928H132zm0-356.8c-32.8 0-59.2-26.4-59.2-59.2s26.4-59.2 59.2-59.2h760c32.8 0 59.2 26.4 59.2 59.2s-26.4 59.2-59.2 59.2H132zm0-356c-32.8 0-59.2-26.4-59.2-59.2S99.2 96.8 132 96.8h760c32.8 0 59.2 26.4 59.2 59.2s-26.4 59.2-59.2 59.2H132z"/></svg>\uFF09\u540E\u83B7\u53D6\uFF01</div>',confirmButtonText:"\u70B9\u51FB\u5207\u6362"})?(document.querySelector(o.dom.switch).click(),b.success("\u5207\u6362\u6210\u529F\uFF0C\u8BF7\u91CD\u65B0\u83B7\u53D6\u4E0B\u8F7D\u94FE\u63A5\uFF01")):!1;if(h=this.getSelectedList(),h.length===0)return b.error("\u63D0\u793A\uFF1A\u8BF7\u5148\u52FE\u9009\u8981\u4E0B\u8F7D\u7684\u6587\u4EF6\uFF01");if(this.isOnlyFolder())return b.error("\u63D0\u793A\uFF1A\u8BF7\u6253\u5F00\u6587\u4EF6\u5939\u540E\u52FE\u9009\u6587\u4EF6\uFF01");if(f==="share"){if(h.length>20)return b.error("\u63D0\u793A\uFF1A\u5355\u6B21\u6700\u591A\u53EF\u52FE\u9009 20 \u4E2A\u6587\u4EF6\uFF01");try{let l=`${a.getStorage("token").token_type} ${a.getStorage("token").access_token}`,n=a.getStorage("shareToken").share_token;for(let s=0;s<h.length;s++){let r=await a.post(o.pcs[0],{expire_sec:600,file_id:h[s].fileId,share_id:h[s].shareId},{authorization:l,"content-type":"application/json;charset=utf-8","x-share-token":n});r.download_url&&(h[s].downloadUrl=r.download_url)}}catch{return b.error("\u63D0\u793A\uFF1A\u8BF7\u5148\u767B\u5F55\u7F51\u76D8\uFF01")}}else{if(h.length>20)return b.error("\u63D0\u793A\uFF1A\u5355\u6B21\u6700\u591A\u53EF\u52FE\u9009 20 \u4E2A\u6587\u4EF6\uFF01");let l=h.filter(r=>!r.url),n=[];l.forEach((r,c)=>{n.push(this.getRealLink(r.driveId,r.fileId))}),(await Promise.all(n)).forEach((r,c)=>{l[c].url=r})}let i=this.generateDom(h);this.showMainDialog(o[u][0],i,o[u][1])},generateDom(t){let i='<div class="pl-main">',l="";if(t.forEach((n,s)=>{if(n.type==="folder")return;let r=n.name,c=n.fileId,d=n.driveId,p=a.sizeFormat(n.size),g=n.downloadUrl||n.url;if(u==="api"&&(i+=`<div class="pl-item">
                                <div class="pl-item-name listener-tip" data-size="${p}">${r}</div>
                                <a class="pl-item-link listener-link-api" data-did="${d}" data-fid="${c}" data-filename="${r}" data-link="${g}" data-index="${s}">${g}</a>
                                <div class="pl-item-btn listener-link-api-btn" data-filename="${r}">\u590D\u5236\u6587\u4EF6\u540D</div>
                                </div>`),u==="aria"){let w=this.convertLinkToAria(g,r,navigator.userAgent);l+=w+`\r
`,i+=`<div class="pl-item">
                                <div class="pl-item-name listener-tip" data-size="${p}">${r}</div>
                                <a class="pl-item-link listener-link-aria" href="${w}" title="\u70B9\u51FB\u590D\u5236aria2c\u94FE\u63A5" data-filename="${r}" data-link="${w}">${decodeURIComponent(w)}</a> </div>`}if(u==="rpc"&&(i+=`<div class="pl-item">
                                <div class="pl-item-name listener-tip" data-size="${p}">${r}</div>
                                <button class="pl-item-link listener-link-rpc pl-btn-primary pl-btn-info" data-filename="${r}" data-link="${g}"><em class="icon icon-device"></em><span style="margin-left: 5px;">\u63A8\u9001\u5230 RPC \u4E0B\u8F7D\u5668</span></button></div>`),u==="curl"){let w=this.convertLinkToCurl(g,r,navigator.userAgent);l+=w+`\r
`,i+=`<div class="pl-item">
                                <div class="pl-item-name listener-tip" data-size="${p}">${r}</div>
                                <a class="pl-item-link listener-link-aria" href="${w}" title="\u70B9\u51FB\u590D\u5236curl\u94FE\u63A5" data-filename="${r}" data-link="${w}">${decodeURIComponent(w)}</a> </div>`}if(u==="bc"){let w=this.convertLinkToBC(g,r,navigator.userAgent);i+=`<div class="pl-item">
                                <div class="pl-item-name listener-tip" data-size="${p}">${r}</div>
                                <a class="pl-item-link" href="${decodeURIComponent(w)}" title="\u70B9\u51FB\u7528\u6BD4\u7279\u5F57\u661F\u4E0B\u8F7D" data-filename="${r}" data-link="${w}">${decodeURIComponent(w)}</a> </div>`}}),i+="</div>",u==="aria"&&(i+=`<div class="pl-extra"><button class="pl-btn-primary listener-copy-all" data-link="${l}">\u590D\u5236\u5168\u90E8\u94FE\u63A5</button></div>`),u==="rpc"){let n=a.getValue("setting_rpc_domain")+":"+a.getValue("setting_rpc_port")+a.getValue("setting_rpc_path");i+=`<div class="pl-extra"><button class="pl-btn-primary listener-send-rpc">\u53D1\u9001\u5168\u90E8\u94FE\u63A5</button><button title="${n}" class="pl-btn-primary pl-btn-warning listener-open-setting" style="margin-left: 10px">\u8BBE\u7F6E RPC \u53C2\u6570\uFF08\u5F53\u524D\u4E3A\uFF1A${n}\uFF09</button><button class="pl-btn-primary pl-btn-success listener-rpc-task" style="margin-left: 10px;display: none">\u67E5\u770B\u4E0B\u8F7D\u4EFB\u52A1</button></div>`}return u==="curl"&&(i+=`<div class="pl-extra"><button class="pl-btn-primary listener-copy-all" data-link="${l}">\u590D\u5236\u5168\u90E8\u94FE\u63A5</button><button class="pl-btn-primary pl-btn-warning listener-open-setting" style="margin-left: 10px;">\u8BBE\u7F6E\u7EC8\u7AEF\u7C7B\u578B\uFF08\u5F53\u524D\u4E3A\uFF1A${C[a.getValue("setting_terminal_type")]}\uFF09</button></div>`),i},async sendLinkToRPC(t,i){let l={domain:a.getValue("setting_rpc_domain"),port:a.getValue("setting_rpc_port"),path:a.getValue("setting_rpc_path"),token:a.getValue("setting_rpc_token"),dir:a.getValue("setting_rpc_dir")},n=`${l.domain}:${l.port}${l.path}`,s={id:new Date().getTime(),jsonrpc:"2.0",method:"aria2.addUri",params:[`token:${l.token}`,[i],{dir:l.dir,out:t,header:["Referer: https://www.aliyundrive.com/"]}]};try{return(await a.post(n,s,{Referer:"https://www.aliyundrive.com/"},"")).result?"success":"fail"}catch{return"fail"}},getSelectedList(){try{let t=[],i=document.querySelector(o.dom.list),n=a.findReact(i,1).pendingProps;if(n){let s=n.dataSource||[],r=n.selectedKeys.split(",");s.forEach(c=>{r.includes(c.fileId)&&t.push(c)})}return t}catch{return[]}},detectPage(){let t=location.pathname;return/^\/(drive)/.test(t)?"home":/^\/(s|share)\//.test(t)?"share":""},isOnlyFolder(){for(let t=0;t<h.length;t++)if(h[t].type==="file")return!1;return!0},showMainDialog(t,i,l){Swal.fire({title:t,html:i,footer:l,allowOutsideClick:!1,showCloseButton:!0,showConfirmButton:!1,position:"top",width:S,padding:"15px 20px 5px",customClass:I})},async initPanLinker(){a.initDefaultConfig(),a.addPanLinkerStyle(),f=this.detectPage();let t=await a.post(`https://api.youxiaohou.com/config/v2/ali?ver=${y}&a=${U}`,{},{},"text");o=JSON.parse(a.d(t)),Object.freeze&&Object.freeze(o),o.num===a.getValue("setting_init_code")||o.license===a.getValue("license")?this.addButton():this.addInitButton(),a.createTip(),a.registerMenuCommand()}},V={convertLinkToAria(t,i,l){return i=a.fixFilename(i),encodeURIComponent(`aria2c "${t}" --out "${i}"`)},convertLinkToBC(t,i,l){let n=`AA/${encodeURIComponent(i)}/?url=${encodeURIComponent(t)}ZZ`;return encodeURIComponent(`bc://http/${a.e(n)}`)},convertLinkToCurl(t,i,l){let n=a.getValue("setting_terminal_type");return i=a.fixFilename(i),encodeURIComponent(`${n!=="wp"?"curl":"curl.exe"} -L -C - "${t}" -o "${i}"`)},addPageListener(){m.on("click",".pl-button-mode",t=>{u=t.target.dataset.mode,Swal.showLoading(),this.getPCSLink()}),m.on("click",".listener-link-api",async t=>{t.preventDefault(),$("#downloadIframe").attr("src",t.currentTarget.dataset.link)}),m.on("click",".listener-link-aria, .listener-copy-all",t=>{t.preventDefault(),a.setClipboard(decodeURIComponent(t.target.dataset.link)),$(t.target).text("\u590D\u5236\u6210\u529F\uFF0C\u5FEB\u53BB\u7C98\u8D34\u5427\uFF01").animate({opacity:"0.5"},"slow")}),m.on("click",".listener-link-rpc",async t=>{let i=$(t.currentTarget);i.find(".icon").remove(),i.find(".pl-loading").remove(),i.prepend(a.createLoading()),await this.sendLinkToRPC(t.currentTarget.dataset.filename,t.currentTarget.dataset.link)==="success"?($(".listener-rpc-task").show(),i.removeClass("pl-btn-danger").html("\u53D1\u9001\u6210\u529F\uFF0C\u5FEB\u53BB\u770B\u770B\u5427\uFF01").animate({opacity:"0.5"},"slow")):i.addClass("pl-btn-danger").text("\u53D1\u9001\u5931\u8D25\uFF0C\u8BF7\u68C0\u67E5\u60A8\u7684RPC\u914D\u7F6E\u4FE1\u606F\uFF01").animate({opacity:"0.5"},"slow")}),m.on("click",".listener-send-rpc",t=>{$(".listener-link-rpc").click(),$(t.target).text("\u53D1\u9001\u5B8C\u6210\uFF0C\u53D1\u9001\u7ED3\u679C\u89C1\u4E0A\u65B9\u6309\u94AE\uFF01").animate({opacity:"0.5"},"slow")}),m.on("click",".listener-open-setting",()=>{a.showSetting()}),m.on("click",".listener-rpc-task",()=>{let t=JSON.stringify({domain:a.getValue("setting_rpc_domain"),port:a.getValue("setting_rpc_port")}),i=`${o.d}/?rpc=${a.e(t)}#${a.getValue("setting_rpc_token")}`;GM_openInTab(i,{active:!0})})},addButton(){if(!f)return;let t,i=$(`<div class="tianyi-button pl-button">\u4E0B\u8F7D\u52A9\u624B<ul class="pl-dropdown-menu" style="top: 26px;"><li class="pl-dropdown-menu-item pl-button-mode" data-mode="api">API\u4E0B\u8F7D</li><li class="pl-dropdown-menu-item pl-button-mode" data-mode="aria" >Aria\u4E0B\u8F7D</li><li class="pl-dropdown-menu-item pl-button-mode" data-mode="rpc">RPC\u4E0B\u8F7D</li><li class="pl-dropdown-menu-item pl-button-mode" data-mode="curl">cURL\u4E0B\u8F7D</li><li class="pl-dropdown-menu-item pl-button-mode" data-mode="bc" >BC\u4E0B\u8F7D</li><li class="pl-dropdown-menu-item pl-button-mode listener-open-setting">\u52A9\u624B\u8BBE\u7F6E</li>${o.code==200&&y<o.version?o.new:""}</ul></div>`);f==="home"&&a.listenElement(o.btn.home,()=>{t=$(o.btn.home),$(".pl-button").length===0&&t.prepend(i)}),f==="share"&&a.listenElement(o.btn.share,()=>{t=$(o.btn.share),$(".pl-button").length===0&&t.prepend(i)}),a.createDownloadIframe(),this.addPageListener()},addInitButton(){if(!f)return;let t,i=$('<div class="tianyi-button pl-button-init">\u4E0B\u8F7D\u52A9\u624B</div>');f==="home"&&a.listenElement(o.btn.home,()=>{t=$(o.btn.home),$(".pl-button-init").length===0&&t.prepend(i)}),f==="share"&&(i.css({"margin-right":"10px"}),a.listenElement(o.btn.share,()=>{t=$(o.btn.share),$(".pl-button-init").length===0&&t.prepend(i)})),i.click(()=>a.initDialog())},async getToken(){let i=(await a.getFinalUrl(o.pcs[1],{})).match(/accessToken=(\w+)/)?.[1];return i&&a.setStorage("accessToken",i),i},async getFileUrlByOnce(t,i,l){try{if(t.downloadUrl)return{index:i,downloadUrl:t.downloadUrl};let n=Date.now(),s=t.fileId,r="AccessToken="+l+"&Timestamp="+n+"&fileId="+s,c=o.pcs[2]+"?fileId="+s;t.shareId&&(r="AccessToken="+l+"&Timestamp="+n+"&dt=1&fileId="+s+"&shareId="+t.shareId,c+="&dt=1&shareId="+t.shareId);let d=md5(r).toString(),p=await a.get(c,{accept:"application/json;charset=UTF-8","sign-type":1,accesstoken:l,timestamp:n,signature:d});return p.res_code===0?{index:i,downloadUrl:p.fileDownloadUrl}:p.errorCode==="InvalidSessionKey"?{index:i,downloadUrl:"\u63D0\u793A\uFF1A\u8BF7\u5148\u767B\u5F55\u7F51\u76D8\uFF01"}:p.res_code==="ShareNotFoundFlatDir"?{index:i,downloadUrl:"\u63D0\u793A\uFF1A\u8BF7\u5148[\u8F6C\u5B58]\u6587\u4EF6\uFF0C\u{1F449}\u524D\u5F80[\u6211\u7684\u7F51\u76D8]\u4E2D\u4E0B\u8F7D\uFF01"}:{index:i,downloadUrl:"\u83B7\u53D6\u4E0B\u8F7D\u5730\u5740\u5931\u8D25\uFF0C\u8BF7\u5237\u65B0\u91CD\u8BD5\uFF01"}}catch{return{index:i,downloadUrl:"\u83B7\u53D6\u4E0B\u8F7D\u5730\u5740\u5931\u8D25\uFF0C\u8BF7\u5237\u65B0\u91CD\u8BD5\uFF01"}}},async getPCSLink(){if(h=this.getSelectedList(),h.length===0)return b.error("\u63D0\u793A\uFF1A\u8BF7\u5148\u52FE\u9009\u8981\u4E0B\u8F7D\u7684\u6587\u4EF6\uFF01");if(this.isOnlyFolder())return b.error("\u63D0\u793A\uFF1A\u8BF7\u6253\u5F00\u6587\u4EF6\u5939\u540E\u52FE\u9009\u6587\u4EF6\uFF01");let t=a.getStorage("accessToken")||await this.getToken();if(!t)return b.error("\u63D0\u793A\uFF1A\u8BF7\u5148\u767B\u5F55\u7F51\u76D8\uFF01");let i=[];h.forEach((s,r)=>{i.push(this.getFileUrlByOnce(s,r,t))}),(await Promise.all(i)).forEach(s=>{h[s.index].downloadUrl=s.downloadUrl});let n=this.generateDom(h);this.showMainDialog(o[u][0],n,o[u][1])},generateDom(t){let i='<div class="pl-main">',l="";if(t.forEach((n,s)=>{if(n.isFolder)return;let r=n.fileName,c=a.sizeFormat(n.size),d=n.downloadUrl;if(u==="api"&&(i+=`<div class="pl-item">
                                <div class="pl-item-name listener-tip" data-size="${c}">${r}</div>
                                <a class="pl-item-link listener-link-api" data-filename="${r}" data-link="${d}" data-index="${s}">${d}</a>
                                </div>`),u==="aria"){let p=this.convertLinkToAria(d,r,navigator.userAgent);l+=p+`\r
`,i+=`<div class="pl-item">
                                <div class="pl-item-name listener-tip" data-size="${c}">${r}</div>
                                <a class="pl-item-link listener-link-aria" href="${p}" title="\u70B9\u51FB\u590D\u5236aria2c\u94FE\u63A5" data-filename="${r}" data-link="${p}">${decodeURIComponent(p)}</a> </div>`}if(u==="rpc"&&(i+=`<div class="pl-item">
                                <div class="pl-item-name listener-tip" data-size="${c}">${r}</div>
                                <button class="pl-item-link listener-link-rpc pl-btn-primary pl-btn-info" data-filename="${r}" data-link="${d}"><em class="icon icon-device"></em><span style="margin-left: 5px;">\u63A8\u9001\u5230 RPC \u4E0B\u8F7D\u5668</span></button></div>`),u==="curl"){let p=this.convertLinkToCurl(d,r,navigator.userAgent);l+=p+`\r
`,i+=`<div class="pl-item">
                                <div class="pl-item-name listener-tip" data-size="${c}">${r}</div>
                                <a class="pl-item-link listener-link-aria" href="${p}" title="\u70B9\u51FB\u590D\u5236curl\u94FE\u63A5" data-filename="${r}" data-link="${p}">${decodeURIComponent(p)}</a> </div>`}if(u==="bc"){let p=this.convertLinkToBC(d,r,navigator.userAgent);i+=`<div class="pl-item">
                                <div class="pl-item-name listener-tip" data-size="${c}">${r}</div>
                                <a class="pl-item-link" href="${decodeURIComponent(p)}" title="\u70B9\u51FB\u7528\u6BD4\u7279\u5F57\u661F\u4E0B\u8F7D" data-filename="${r}" data-link="${p}">${decodeURIComponent(p)}</a> </div>`}}),i+="</div>",u==="aria"&&(i+=`<div class="pl-extra"><button class="pl-btn-primary listener-copy-all" data-link="${l}">\u590D\u5236\u5168\u90E8\u94FE\u63A5</button></div>`),u==="rpc"){let n=a.getValue("setting_rpc_domain")+":"+a.getValue("setting_rpc_port")+a.getValue("setting_rpc_path");i+=`<div class="pl-extra"><button class="pl-btn-primary listener-send-rpc">\u53D1\u9001\u5168\u90E8\u94FE\u63A5</button><button title="${n}" class="pl-btn-primary pl-btn-warning listener-open-setting" style="margin-left: 10px">\u8BBE\u7F6E RPC \u53C2\u6570\uFF08\u5F53\u524D\u4E3A\uFF1A${n}\uFF09</button><button class="pl-btn-primary pl-btn-success listener-rpc-task" style="margin-left: 10px;display: none">\u67E5\u770B\u4E0B\u8F7D\u4EFB\u52A1</button></div>`}return u==="curl"&&(i+=`<div class="pl-extra"><button class="pl-btn-primary listener-copy-all" data-link="${l}">\u590D\u5236\u5168\u90E8\u94FE\u63A5</button><button class="pl-btn-primary pl-btn-warning listener-open-setting" style="margin-left: 10px;">\u8BBE\u7F6E\u7EC8\u7AEF\u7C7B\u578B\uFF08\u5F53\u524D\u4E3A\uFF1A${C[a.getValue("setting_terminal_type")]}\uFF09</button></div>`),i},async sendLinkToRPC(t,i){let l={domain:a.getValue("setting_rpc_domain"),port:a.getValue("setting_rpc_port"),path:a.getValue("setting_rpc_path"),token:a.getValue("setting_rpc_token"),dir:a.getValue("setting_rpc_dir")},n=`${l.domain}:${l.port}${l.path}`,s={id:new Date().getTime(),jsonrpc:"2.0",method:"aria2.addUri",params:[`token:${l.token}`,[i],{dir:l.dir,out:t,header:[]}]};try{return(await a.post(n,s,{},"")).result?"success":"fail"}catch{return"fail"}},getSelectedList(){try{return document.querySelector(".c-file-list").__vue__.selectedList}catch{return[document.querySelector(".info-detail").__vue__.fileDetail]}},detectPage(){let t=location.pathname;return/^\/web\/main/.test(t)?"home":/^\/web\/share/.test(t)?"share":""},isOnlyFolder(){for(let t=0;t<h.length;t++)if(!h[t].isFolder)return!1;return!0},showMainDialog(t,i,l){Swal.fire({title:t,html:i,footer:l,allowOutsideClick:!1,showCloseButton:!0,showConfirmButton:!1,position:"top",width:S,padding:"15px 20px 5px",customClass:I})},async initPanLinker(){a.initDefaultConfig(),a.addPanLinkerStyle(),f=this.detectPage();let t=await a.post(`https://api.youxiaohou.com/config/v2/tianyi?ver=${y}&a=${U}`,{},{},"text");o=JSON.parse(a.d(t)),Object.freeze&&Object.freeze(o),o.num===a.getValue("setting_init_code")||o.license===a.getValue("license")?this.addButton():this.addInitButton(),this.getToken(),a.createTip(),a.registerMenuCommand()}},z={convertLinkToAria(t,i,l){return i=a.fixFilename(i),encodeURIComponent(`aria2c "${t}" --out "${i}"`)},convertLinkToBC(t,i,l){let n=`AA/${encodeURIComponent(i)}/?url=${encodeURIComponent(t)}ZZ`;return encodeURIComponent(`bc://http/${a.e(n)}`)},convertLinkToCurl(t,i,l){let n=a.getValue("setting_terminal_type");return i=a.fixFilename(i),encodeURIComponent(`${n!=="wp"?"curl":"curl.exe"} -L -C - "${t}" -o "${i}"`)},addPageListener(){m.on("click",".pl-button-mode",t=>{u=t.target.dataset.mode,Swal.showLoading(),this.getPCSLink()}),m.on("click",".listener-link-api",async t=>{t.preventDefault(),$("#downloadIframe").attr("src",t.currentTarget.dataset.link)}),m.on("click",".listener-link-api-btn",async t=>{a.setClipboard(t.target.dataset.filename),$(t.target).text("\u590D\u5236\u6210\u529F").animate({opacity:"0.5"},"slow")}),m.on("click",".listener-link-bc-btn",async t=>{let i=a.getMirrorList(t.target.dataset.dlink,o.mirror);a.setClipboard(i),$(t.target).text("\u590D\u5236\u6210\u529F").animate({opacity:"0.5"},"slow")}),m.on("click",".listener-link-aria, .listener-copy-all",t=>{t.preventDefault(),a.setClipboard(decodeURIComponent(t.target.dataset.link)),$(t.target).text("\u590D\u5236\u6210\u529F\uFF0C\u5FEB\u53BB\u7C98\u8D34\u5427\uFF01").animate({opacity:"0.5"},"slow")}),m.on("click",".listener-link-rpc",async t=>{let i=$(t.currentTarget);i.find(".icon").remove(),i.find(".pl-loading").remove(),i.prepend(a.createLoading()),await this.sendLinkToRPC(t.currentTarget.dataset.filename,t.currentTarget.dataset.link)==="success"?($(".listener-rpc-task").show(),i.removeClass("pl-btn-danger").html("\u53D1\u9001\u6210\u529F\uFF0C\u5FEB\u53BB\u770B\u770B\u5427\uFF01").animate({opacity:"0.5"},"slow")):i.addClass("pl-btn-danger").text("\u53D1\u9001\u5931\u8D25\uFF0C\u8BF7\u68C0\u67E5\u60A8\u7684RPC\u914D\u7F6E\u4FE1\u606F\uFF01").animate({opacity:"0.5"},"slow")}),m.on("click",".listener-send-rpc",t=>{$(".listener-link-rpc").click(),$(t.target).text("\u53D1\u9001\u5B8C\u6210\uFF0C\u53D1\u9001\u7ED3\u679C\u89C1\u4E0A\u65B9\u6309\u94AE\uFF01").animate({opacity:"0.5"},"slow")}),m.on("click",".listener-open-setting",()=>{a.showSetting()}),m.on("click",".listener-rpc-task",()=>{let t=JSON.stringify({domain:a.getValue("setting_rpc_domain"),port:a.getValue("setting_rpc_port")}),i=`${o.d}/?rpc=${a.e(t)}#${a.getValue("setting_rpc_token")}`;GM_openInTab(i,{active:!0})})},addButton(){if(!f)return;let t,i=$(`<div class="xunlei-button pl-button"><i class="xlpfont xlp-download"></i><span style="font-size: 13px;margin-left: 6px;">\u4E0B\u8F7D\u52A9\u624B</span><ul class="pl-dropdown-menu" style="top: 34px;"><li class="pl-dropdown-menu-item pl-button-mode" data-mode="api">API\u4E0B\u8F7D</li><li class="pl-dropdown-menu-item pl-button-mode" data-mode="aria" >Aria\u4E0B\u8F7D</li><li class="pl-dropdown-menu-item pl-button-mode" data-mode="rpc">RPC\u4E0B\u8F7D</li><li class="pl-dropdown-menu-item pl-button-mode" data-mode="curl">cURL\u4E0B\u8F7D</li><li class="pl-dropdown-menu-item pl-button-mode" data-mode="bc" >BC\u4E0B\u8F7D</li><li class="pl-dropdown-menu-item pl-button-mode listener-open-setting">\u52A9\u624B\u8BBE\u7F6E</li>${o.code==200&&y<o.version?o.new:""}</ul></div>`);f==="home"&&a.listenElement(o.btn.home,()=>{t=$(o.btn.home),$(".pl-button").length===0&&t.prepend(i)}),f==="share"&&(i.css({"margin-right":"10px"}),a.listenElement(o.btn.share,()=>{t=$(o.btn.share),$(".pl-button").length===0&&t.prepend(i)})),a.createDownloadIframe(),this.addPageListener()},addInitButton(){if(!f)return;let t,i=$('<div class="xunlei-button pl-button-init"><i class="xlpfont xlp-download"></i><span style="font-size: 13px;margin-left: 6px;">\u4E0B\u8F7D\u52A9\u624B</span></div>');f==="home"&&a.listenElement(o.btn.home,()=>{t=$(o.btn.home),$(".pl-button-init").length===0&&t.prepend(i)}),f==="share"&&(i.css({"margin-right":"10px"}),a.listenElement(o.btn.share,()=>{t=$(o.btn.share),$(".pl-button-init").length===0&&t.prepend(i)})),i.click(()=>a.initDialog())},getToken(){let t={},i={};for(let s=0;s<localStorage.length;s++)/^credentials_/.test(localStorage.key(s))&&(t=a.getStorage(localStorage.key(s)),a.setStorage("")),/^captcha_[\w]{16}/.test(localStorage.key(s))&&(i=a.getStorage(localStorage.key(s)));let l=/(\w{32})/.exec(a.getStorage("deviceid").split(","))[0];return{credentials:t,captcha:i,deviceid:l}},async getFileUrlByOnce(t,i,l){try{if(t.downloadUrl)return{index:i,downloadUrl:t.downloadUrl};let n=await a.get(o.pcs[0]+t.id,{Authorization:`${l.credentials.token_type} ${l.credentials.access_token}`,"content-type":"application/json","x-captcha-token":l.captcha.token,"x-device-id":l.deviceid});return n.web_content_link?{index:i,downloadUrl:n.web_content_link}:{index:i,downloadUrl:"\u83B7\u53D6\u4E0B\u8F7D\u5730\u5740\u5931\u8D25\uFF0C\u8BF7\u5237\u65B0\u91CD\u8BD5\uFF01"}}catch{return b.error("\u63D0\u793A\uFF1A\u8BF7\u5148\u767B\u5F55\u7F51\u76D8\u540E\u5237\u65B0\u9875\u9762\uFF01")}},async getPCSLink(){if(h=this.getSelectedList(),h.length===0)return b.error("\u63D0\u793A\uFF1A\u8BF7\u5148\u52FE\u9009\u8981\u4E0B\u8F7D\u7684\u6587\u4EF6\uFF01");if(this.isOnlyFolder())return b.error("\u63D0\u793A\uFF1A\u8BF7\u6253\u5F00\u6587\u4EF6\u5939\u540E\u52FE\u9009\u6587\u4EF6\uFF01");if(f==="home"){let i=[],l=this.getToken();h.forEach((s,r)=>{i.push(this.getFileUrlByOnce(s,r,l))}),(await Promise.all(i)).forEach(s=>{h[s.index].downloadUrl=s.downloadUrl})}else if((await Swal.fire({toast:!0,icon:"info",title:'\u63D0\u793A\uFF1A\u8BF7\u5C06\u6587\u4EF6<span class="tag-danger">[\u4FDD\u5B58\u5230\u7F51\u76D8]</span>\u{1F449}\u524D\u5F80<span class="tag-danger">[\u6211\u7684\u7F51\u76D8]</span>\u4E2D\u4E0B\u8F7D\uFF01',showConfirmButton:!0,confirmButtonText:"\u70B9\u51FB\u4FDD\u5B58",position:"top"})).isConfirmed){document.querySelector(".saveToCloud").click();return}let t=this.generateDom(h);this.showMainDialog(o[u][0],t,o[u][1])},generateDom(t){let i='<div class="pl-main">',l="";if(t.forEach((n,s)=>{if(n.kind==="drive#folder")return;let r=n.name,c=a.sizeFormat(+n.size),d=n.downloadUrl;if(u==="api"&&(i+=`<div class="pl-item">
                                <div class="pl-item-name listener-tip" data-size="${c}">${r}</div>
                                <a class="pl-item-link listener-link-api" data-filename="${r}" data-link="${d}" data-index="${s}">${d}</a>
                                <div class="pl-item-btn listener-link-api-btn" data-filename="${r}">\u590D\u5236\u6587\u4EF6\u540D</div>
                                </div>`),u==="aria"){let p=this.convertLinkToAria(d,r,navigator.userAgent);l+=p+`\r
`,i+=`<div class="pl-item">
                                <div class="pl-item-name listener-tip" data-size="${c}">${r}</div>
                                <a class="pl-item-link listener-link-aria" href="${p}" title="\u70B9\u51FB\u590D\u5236aria2c\u94FE\u63A5" data-filename="${r}" data-link="${p}">${decodeURIComponent(p)}</a> </div>`}if(u==="rpc"&&(i+=`<div class="pl-item">
                                <div class="pl-item-name listener-tip" data-size="${c}">${r}</div>
                                <button class="pl-item-link listener-link-rpc pl-btn-primary pl-btn-info" data-filename="${r}" data-link="${d}"><em class="icon icon-device"></em><span style="margin-left: 5px;">\u63A8\u9001\u5230 RPC \u4E0B\u8F7D\u5668</span></button></div>`),u==="curl"){let p=this.convertLinkToCurl(d,r,navigator.userAgent);l+=p+`\r
`,i+=`<div class="pl-item">
                                <div class="pl-item-name listener-tip" data-size="${c}">${r}</div>
                                <a class="pl-item-link listener-link-aria" href="${p}" title="\u70B9\u51FB\u590D\u5236curl\u94FE\u63A5" data-filename="${r}" data-link="${p}">${decodeURIComponent(p)}</a> </div>`}if(u==="bc"){let p=this.convertLinkToBC(d,r,navigator.userAgent);i+=`<div class="pl-item">
                                <div class="pl-item-name listener-tip" data-size="${c}">${r}</div>
                                <a class="pl-item-link" href="${decodeURIComponent(p)}" title="\u70B9\u51FB\u7528\u6BD4\u7279\u5F57\u661F\u4E0B\u8F7D" data-filename="${r}" data-link="${p}">${decodeURIComponent(p)}</a> 
                                <div class="pl-item-btn listener-link-bc-btn" data-dlink="${d}">\u590D\u5236\u955C\u50CF\u5730\u5740</div>
                                </div>`}}),i+="</div>",u==="aria"&&(i+=`<div class="pl-extra"><button class="pl-btn-primary listener-copy-all" data-link="${l}">\u590D\u5236\u5168\u90E8\u94FE\u63A5</button></div>`),u==="rpc"){let n=a.getValue("setting_rpc_domain")+":"+a.getValue("setting_rpc_port")+a.getValue("setting_rpc_path");i+=`<div class="pl-extra"><button class="pl-btn-primary listener-send-rpc">\u53D1\u9001\u5168\u90E8\u94FE\u63A5</button><button title="${n}" class="pl-btn-primary pl-btn-warning listener-open-setting" style="margin-left: 10px">\u8BBE\u7F6E RPC \u53C2\u6570\uFF08\u5F53\u524D\u4E3A\uFF1A${n}\uFF09</button><button class="pl-btn-primary pl-btn-success listener-rpc-task" style="margin-left: 10px;display: none">\u67E5\u770B\u4E0B\u8F7D\u4EFB\u52A1</button></div>`}return u==="curl"&&(i+=`<div class="pl-extra"><button class="pl-btn-primary listener-copy-all" data-link="${l}">\u590D\u5236\u5168\u90E8\u94FE\u63A5</button><button class="pl-btn-primary pl-btn-warning listener-open-setting" style="margin-left: 10px;">\u8BBE\u7F6E\u7EC8\u7AEF\u7C7B\u578B\uFF08\u5F53\u524D\u4E3A\uFF1A${C[a.getValue("setting_terminal_type")]}\uFF09</button></div>`),i},async sendLinkToRPC(t,i){let l={domain:a.getValue("setting_rpc_domain"),port:a.getValue("setting_rpc_port"),path:a.getValue("setting_rpc_path"),token:a.getValue("setting_rpc_token"),dir:a.getValue("setting_rpc_dir")},n=`${l.domain}:${l.port}${l.path}`,s={id:new Date().getTime(),jsonrpc:"2.0",method:"aria2.addUri",params:[`token:${l.token}`,[i],{dir:l.dir,out:t,header:[]}]};try{return(await a.post(n,s,{},"")).result?"success":"fail"}catch{return"fail"}},getSelectedList(){try{let t=document.querySelectorAll(".SourceListItem__item--XxpOC"),i=[];for(let l of t){let n=l.__vue__;n.selected.includes(n.info.id)&&i.push(n.info)}return i}catch{return[]}},detectPage(){let t=location.pathname;return/^\/$/.test(t)?"home":/^\/(s|share)\//.test(t)?"share":""},isOnlyFolder(){for(let t=0;t<h.length;t++)if(h[t].kind==="drive#file")return!1;return!0},showMainDialog(t,i,l){Swal.fire({title:t,html:i,footer:l,allowOutsideClick:!1,showCloseButton:!0,showConfirmButton:!1,position:"top",width:S,padding:"15px 20px 5px",customClass:I})},async initPanLinker(){a.initDefaultConfig(),a.addPanLinkerStyle(),f=this.detectPage();let t=await a.post(`https://api.youxiaohou.com/config/v2/xunlei?ver=${y}&a=${U}`,{},{},"text");o=JSON.parse(a.d(t)),Object.freeze&&Object.freeze(o),o.num===a.getValue("setting_init_code")||o.license===a.getValue("license")?this.addButton():this.addInitButton(),a.createTip(),a.registerMenuCommand()}},A={convertLinkToAria(t,i,l){return i=a.fixFilename(i),encodeURIComponent(`aria2c "${t}" --out "${i}" --header "Cookie: ${document.cookie}"`)},convertLinkToBC(t,i,l){let n=`AA/${encodeURIComponent(i)}/?url=${encodeURIComponent(t)}&cookie=${encodeURIComponent(document.cookie)}ZZ`;return encodeURIComponent(`bc://http/${a.e(n)}`)},convertLinkToCurl(t,i,l){let n=a.getValue("setting_terminal_type");return i=a.fixFilename(i),encodeURIComponent(`${n!=="wp"?"curl":"curl.exe"} -L -C - "${t}" -o "${i}" -b "${document.cookie}"`)},addPageListener(){window.addEventListener("hashchange",async t=>{t.oldURL==="https://pan.quark.cn/list#/"&&t.newURL==="https://pan.quark.cn/list#/list/all"||(await a.sleep(150),!($(".quark-button").length>0)&&(o.num===a.getValue("setting_init_code")||o.license===a.getValue("license")?this.addButton():this.addInitButton()))}),m.on("click",".pl-button-mode",t=>{u=t.target.dataset.mode,Swal.showLoading(),this.getPCSLink()}),m.on("click",".listener-link-api",async t=>{t.preventDefault(),$("#downloadIframe").attr("src",t.currentTarget.dataset.link)}),m.on("click",".listener-link-aria, .listener-copy-all",t=>{t.preventDefault(),a.setClipboard(decodeURIComponent(t.target.dataset.link)),$(t.target).text("\u590D\u5236\u6210\u529F\uFF0C\u5FEB\u53BB\u7C98\u8D34\u5427\uFF01").animate({opacity:"0.5"},"slow")}),m.on("click",".listener-link-rpc",async t=>{let i=$(t.currentTarget);i.find(".icon").remove(),i.find(".pl-loading").remove(),i.prepend(a.createLoading()),await this.sendLinkToRPC(t.currentTarget.dataset.filename,t.currentTarget.dataset.link)==="success"?($(".listener-rpc-task").show(),i.removeClass("pl-btn-danger").html("\u53D1\u9001\u6210\u529F\uFF0C\u5FEB\u53BB\u770B\u770B\u5427\uFF01").animate({opacity:"0.5"},"slow")):i.addClass("pl-btn-danger").text("\u53D1\u9001\u5931\u8D25\uFF0C\u8BF7\u68C0\u67E5\u60A8\u7684RPC\u914D\u7F6E\u4FE1\u606F\uFF01").animate({opacity:"0.5"},"slow")}),m.on("click",".listener-send-rpc",t=>{$(".listener-link-rpc").click(),$(t.target).text("\u53D1\u9001\u5B8C\u6210\uFF0C\u53D1\u9001\u7ED3\u679C\u89C1\u4E0A\u65B9\u6309\u94AE\uFF01").animate({opacity:"0.5"},"slow")}),m.on("click",".listener-open-setting",()=>{a.showSetting()}),m.on("click",".listener-rpc-task",()=>{let t=JSON.stringify({domain:a.getValue("setting_rpc_domain"),port:a.getValue("setting_rpc_port")}),i=`${o.d}/?rpc=${a.e(t)}#${a.getValue("setting_rpc_token")}`;GM_openInTab(i,{active:!0})})},addButton(){if(!f)return;let t,i=$(`<div class="quark-button pl-button"><svg width="22" height="22" xmlns="http://www.w3.org/2000/svg"><g fill="none" fill-rule="evenodd" stroke="#555" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M9 12l2 2 2-2z"/><path d="M14 8h1.553c.85 0 1.16.093 1.47.267.311.174.556.43.722.756.166.326.255.65.255 1.54v4.873c0 .892-.089 1.215-.255 1.54-.166.327-.41.583-.722.757-.31.174-.62.267-1.47.267H6.447c-.85 0-1.16-.093-1.47-.267a1.778 1.778 0 01-.722-.756c-.166-.326-.255-.65-.255-1.54v-4.873c0-.892.089-1.215.255-1.54.166-.327.41-.583.722-.757.31-.174.62-.267 1.47-.267H11"/><path stroke-linecap="round" stroke-linejoin="round" d="M11 3v10"/></g></svg><b>\u4E0B\u8F7D\u52A9\u624B</b><ul class="pl-dropdown-menu"><li class="pl-dropdown-menu-item pl-button-mode" data-mode="api">API\u4E0B\u8F7D</li><li class="pl-dropdown-menu-item pl-button-mode" data-mode="aria" >Aria\u4E0B\u8F7D</li><li class="pl-dropdown-menu-item pl-button-mode" data-mode="rpc">RPC\u4E0B\u8F7D</li><li class="pl-dropdown-menu-item pl-button-mode" data-mode="curl">cURL\u4E0B\u8F7D</li><li class="pl-dropdown-menu-item pl-button-mode" data-mode="bc" >BC\u4E0B\u8F7D</li><li class="pl-dropdown-menu-item pl-button-mode listener-open-setting">\u52A9\u624B\u8BBE\u7F6E</li>${o.code==200&&y<o.version?o.new:""}</ul></div>`);f==="home"&&a.listenElement(o.btn.home,()=>{t=$(o.btn.home),$(".pl-button").length===0&&t.prepend(i)}),f==="share"&&(i.css({"margin-right":"10px"}),a.listenElement(o.btn.share,()=>{t=$(o.btn.share),$(".pl-button").length===0&&t.prepend(i)}))},addInitButton(){if(!f)return;let t,i=$('<div class="quark-button pl-button-init"><svg width="22" height="22" xmlns="http://www.w3.org/2000/svg"><g fill="none" fill-rule="evenodd" stroke="#555" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M9 12l2 2 2-2z"/><path d="M14 8h1.553c.85 0 1.16.093 1.47.267.311.174.556.43.722.756.166.326.255.65.255 1.54v4.873c0 .892-.089 1.215-.255 1.54-.166.327-.41.583-.722.757-.31.174-.62.267-1.47.267H6.447c-.85 0-1.16-.093-1.47-.267a1.778 1.778 0 01-.722-.756c-.166-.326-.255-.65-.255-1.54v-4.873c0-.892.089-1.215.255-1.54.166-.327.41-.583.722-.757.31-.174.62-.267 1.47-.267H11"/><path stroke-linecap="round" stroke-linejoin="round" d="M11 3v10"/></g></svg><b>\u4E0B\u8F7D\u52A9\u624B</b></div>');f==="home"&&a.listenElement(o.btn.home,()=>{t=$(o.btn.home),$(".pl-button-init").length===0&&t.prepend(i)}),f==="share"&&(i.css({"margin-right":"10px"}),a.listenElement(o.btn.share,()=>{t=$(o.btn.share),$(".pl-button-init").length===0&&t.prepend(i)})),i.click(()=>a.initDialog())},async getPCSLink(){if(h=this.getSelectedList(),h.length===0)return b.error("\u63D0\u793A\uFF1A\u8BF7\u5148\u52FE\u9009\u8981\u4E0B\u8F7D\u7684\u6587\u4EF6\uFF01");if(this.isOnlyFolder())return b.error("\u63D0\u793A\uFF1A\u8BF7\u6253\u5F00\u6587\u4EF6\u5939\u540E\u52FE\u9009\u6587\u4EF6\uFF01");let t=[];if(h.forEach(i=>{t.push(i.fid)}),f==="home"){let i=await a.post(o.pcs[0],{fids:t},{"content-type":"application/json;charset=utf-8","user-agent":o.ua});if(i.code===31001)return b.error("\u63D0\u793A\uFF1A\u8BF7\u5148\u767B\u5F55\u7F51\u76D8\uFF01");if(i.code!==0)return b.error("\u63D0\u793A\uFF1A\u83B7\u53D6\u94FE\u63A5\u5931\u8D25\uFF01");let l=this.generateDom(i.data);this.showMainDialog(o[u][0],l,o[u][1])}else if((await Swal.fire({toast:!0,icon:"info",title:'\u63D0\u793A\uFF1A\u8BF7\u5C06\u6587\u4EF6<span class="tag-danger">[\u4FDD\u5B58\u5230\u7F51\u76D8]</span>\u{1F449}\u524D\u5F80<span class="tag-danger">[\u6211\u7684\u7F51\u76D8]</span>\u4E2D\u4E0B\u8F7D\uFF01',showConfirmButton:!0,confirmButtonText:"\u70B9\u51FB\u4FDD\u5B58",position:"top"})).isConfirmed){document.querySelector(".file-info_r").click();return}},generateDom(t){let i='<div class="pl-main">',l="";if(t.forEach((n,s)=>{if(n.file===!1)return;let r=n.file_name,c=n.fid,d=a.sizeFormat(n.size),p=n.download_url;if(u==="api"&&(i+=`<div class="pl-item">
                                <div class="pl-item-name listener-tip" data-size="${d}">${r}</div>
                                <a class="pl-item-link listener-link-api" data-fid="${c}" data-filename="${r}" data-link="${p}" data-index="${s}">${p}</a>
                                </div>`),u==="aria"){let g=this.convertLinkToAria(p,r,navigator.userAgent);l+=g+`\r
`,i+=`<div class="pl-item">
                                <div class="pl-item-name listener-tip" data-size="${d}">${r}</div>
                                <a class="pl-item-link listener-link-aria" href="${g}" title="\u70B9\u51FB\u590D\u5236aria2c\u94FE\u63A5" data-filename="${r}" data-link="${g}">${decodeURIComponent(g)}</a> </div>`}if(u==="rpc"&&(i+=`<div class="pl-item">
                                <div class="pl-item-name listener-tip" data-size="${d}">${r}</div>
                                <button class="pl-item-link listener-link-rpc pl-btn-primary pl-btn-info" data-filename="${r}" data-link="${p}"><em class="icon icon-device"></em><span style="margin-left: 5px;">\u63A8\u9001\u5230 RPC \u4E0B\u8F7D\u5668</span></button></div>`),u==="curl"){let g=this.convertLinkToCurl(p,r,navigator.userAgent);l+=g+`\r
`,i+=`<div class="pl-item">
                                <div class="pl-item-name listener-tip" data-size="${d}">${r}</div>
                                <a class="pl-item-link listener-link-aria" href="${g}" title="\u70B9\u51FB\u590D\u5236curl\u94FE\u63A5" data-filename="${r}" data-link="${g}">${decodeURIComponent(g)}</a> </div>`}if(u==="bc"){let g=this.convertLinkToBC(p,r,navigator.userAgent);i+=`<div class="pl-item">
                                <div class="pl-item-name listener-tip" data-size="${d}">${r}</div>
                                <a class="pl-item-link" href="${decodeURIComponent(g)}" title="\u70B9\u51FB\u7528\u6BD4\u7279\u5F57\u661F\u4E0B\u8F7D" data-filename="${r}" data-link="${g}">${decodeURIComponent(g)}</a> </div>`}}),i+="</div>",u==="aria"&&(i+=`<div class="pl-extra"><button class="pl-btn-primary listener-copy-all" data-link="${l}">\u590D\u5236\u5168\u90E8\u94FE\u63A5</button></div>`),u==="rpc"){let n=a.getValue("setting_rpc_domain")+":"+a.getValue("setting_rpc_port")+a.getValue("setting_rpc_path");i+=`<div class="pl-extra"><button class="pl-btn-primary listener-send-rpc">\u53D1\u9001\u5168\u90E8\u94FE\u63A5</button><button title="${n}" class="pl-btn-primary pl-btn-warning listener-open-setting" style="margin-left: 10px">\u8BBE\u7F6E RPC \u53C2\u6570\uFF08\u5F53\u524D\u4E3A\uFF1A${n}\uFF09</button><button class="pl-btn-primary pl-btn-success listener-rpc-task" style="margin-left: 10px;display: none">\u67E5\u770B\u4E0B\u8F7D\u4EFB\u52A1</button></div>`}return u==="curl"&&(i+=`<div class="pl-extra"><button class="pl-btn-primary listener-copy-all" data-link="${l}">\u590D\u5236\u5168\u90E8\u94FE\u63A5</button><button class="pl-btn-primary pl-btn-warning listener-open-setting" style="margin-left: 10px;">\u8BBE\u7F6E\u7EC8\u7AEF\u7C7B\u578B\uFF08\u5F53\u524D\u4E3A\uFF1A${C[a.getValue("setting_terminal_type")]}\uFF09</button></div>`),i},async sendLinkToRPC(t,i){let l={domain:a.getValue("setting_rpc_domain"),port:a.getValue("setting_rpc_port"),path:a.getValue("setting_rpc_path"),token:a.getValue("setting_rpc_token"),dir:a.getValue("setting_rpc_dir")},n=`${l.domain}:${l.port}${l.path}`,s={id:new Date().getTime(),jsonrpc:"2.0",method:"aria2.addUri",params:[`token:${l.token}`,[i],{dir:l.dir,out:t,header:[`Cookie: ${document.cookie}`]}]};try{return(await a.post(n,s,{Cookie:document.cookie},"")).result?"success":"fail"}catch{return"fail"}},getSelectedList(){try{let t=[],i=document.getElementsByClassName("file-list")[0],n=a.findReact(i).props;if(n){let s=n.list||[],r=n.selectedRowKeys||[];s.forEach(c=>{r.includes(c.fid)&&t.push(c)})}return t}catch{return[]}},detectPage(){let t=location.pathname;return/^\/(list)/.test(t)?"home":/^\/(s|share)\//.test(t)?"share":""},isOnlyFolder(){for(let t=0;t<h.length;t++)if(h[t].file)return!1;return!0},showMainDialog(t,i,l){Swal.fire({title:t,html:i,footer:l,allowOutsideClick:!1,showCloseButton:!0,showConfirmButton:!1,position:"top",width:S,padding:"15px 20px 5px",customClass:I})},async initPanLinker(){a.initDefaultConfig(),a.addPanLinkerStyle(),f=this.detectPage();let t=await a.post(`https://api.youxiaohou.com/config/v2/quark?ver=${y}&a=${U}`,{},{},"text");o=JSON.parse(a.d(t)),Object.freeze&&Object.freeze(o),o.num===a.getValue("setting_init_code")||o.license===a.getValue("license")?this.addButton():this.addInitButton(),this.addPageListener(),a.createTip(),a.createDownloadIframe(),a.registerMenuCommand()}},F={convertLinkToAria(t,i,l){return i=a.fixFilename(i),encodeURIComponent(`aria2c "${t}" --out "${i}"`)},convertLinkToBC(t,i,l){let n=`AA/${encodeURIComponent(i)}/?url=${encodeURIComponent(t)}ZZ`;return encodeURIComponent(`bc://http/${a.e(n)}`)},convertLinkToCurl(t,i,l){let n=a.getValue("setting_terminal_type");return i=a.fixFilename(i),encodeURIComponent(`${n!=="wp"?"curl":"curl.exe"} -L -C - "${t}" -o "${i}"`)},addPageListener(){m.on("click",".pl-button-mode",t=>{u=t.target.dataset.mode,Swal.showLoading(),this.getPCSLink()}),m.on("click",".listener-link-api",async t=>{t.preventDefault(),$("#downloadIframe").attr("src",t.currentTarget.dataset.link)}),m.on("click",".listener-link-aria, .listener-copy-all",t=>{t.preventDefault(),a.setClipboard(decodeURIComponent(t.target.dataset.link)),$(t.target).text("\u590D\u5236\u6210\u529F\uFF0C\u5FEB\u53BB\u7C98\u8D34\u5427\uFF01").animate({opacity:"0.5"},"slow")}),m.on("click",".listener-link-rpc",async t=>{let i=$(t.currentTarget);i.find(".icon").remove(),i.find(".pl-loading").remove(),i.prepend(a.createLoading()),await this.sendLinkToRPC(t.currentTarget.dataset.filename,t.currentTarget.dataset.link)==="success"?($(".listener-rpc-task").show(),i.removeClass("pl-btn-danger").html("\u53D1\u9001\u6210\u529F\uFF0C\u5FEB\u53BB\u770B\u770B\u5427\uFF01").animate({opacity:"0.5"},"slow")):i.addClass("pl-btn-danger").text("\u53D1\u9001\u5931\u8D25\uFF0C\u8BF7\u68C0\u67E5\u60A8\u7684RPC\u914D\u7F6E\u4FE1\u606F\uFF01").animate({opacity:"0.5"},"slow")}),m.on("click",".listener-send-rpc",t=>{$(".listener-link-rpc").click(),$(t.target).text("\u53D1\u9001\u5B8C\u6210\uFF0C\u53D1\u9001\u7ED3\u679C\u89C1\u4E0A\u65B9\u6309\u94AE\uFF01").animate({opacity:"0.5"},"slow")}),m.on("click",".listener-open-setting",()=>{a.showSetting()}),m.on("click",".listener-rpc-task",()=>{let t=JSON.stringify({domain:a.getValue("setting_rpc_domain"),port:a.getValue("setting_rpc_port")}),i=`${o.d}/?rpc=${a.e(t)}#${a.getValue("setting_rpc_token")}`;GM_openInTab(i,{active:!0})})},addButton(){if(!f)return;let t,i=$(`<div class="yidong-button pl-button">\u4E0B\u8F7D\u52A9\u624B<ul class="pl-dropdown-menu" style="top: 36px;"><li class="pl-dropdown-menu-item pl-button-mode" data-mode="api">API\u4E0B\u8F7D</li><li class="pl-dropdown-menu-item pl-button-mode" data-mode="aria" >Aria\u4E0B\u8F7D</li><li class="pl-dropdown-menu-item pl-button-mode" data-mode="rpc">RPC\u4E0B\u8F7D</li><li class="pl-dropdown-menu-item pl-button-mode" data-mode="curl">cURL\u4E0B\u8F7D</li><li class="pl-dropdown-menu-item pl-button-mode" data-mode="bc" >BC\u4E0B\u8F7D</li><li class="pl-dropdown-menu-item pl-button-mode listener-open-setting">\u52A9\u624B\u8BBE\u7F6E</li>${o.code==200&&y<o.version?o.new:""}</ul></div>`);f==="home"&&a.listenElement(o.btn.home,()=>{t=$(o.btn.home),$(".pl-button").length===0&&t.prepend(i)}),f==="share"&&(i.removeClass("yidong-button").addClass("yidong-share-button"),a.listenElement(o.btn.share,()=>{t=$(o.btn.share),$(".pl-button").length===0&&t.prepend(i)})),a.createDownloadIframe(),this.addPageListener()},addInitButton(){if(!f)return;let t,i=$('<div class="yidong-button pl-button-init">\u4E0B\u8F7D\u52A9\u624B</div>');f==="home"&&a.listenElement(o.btn.home,()=>{t=$(o.btn.home),$(".pl-button-init").length===0&&t.prepend(i)}),f==="share"&&(i.removeClass("yidong-button").addClass("yidong-share-button"),a.listenElement(o.btn.share,()=>{t=$(o.btn.share),$(".pl-button-init").length===0&&t.prepend(i)})),i.click(()=>a.initDialog())},getRandomString(t){t=t||16;let i="ABCDEFGHJKMNPQRSTWXYZabcdefhijkmnprstwxyz2345678",l=i.length,n="";for(let s=0;s<t;s++)n+=i.charAt(Math.floor(Math.random()*l));return n},utob(t){const i=String.fromCharCode;return t.replace(/[\uD800-\uDBFF][\uDC00-\uDFFFF]|[^\x00-\x7F]/g,l=>{if(l.length<2){let n=l.charCodeAt(0);return n<128?l:n<2048?i(192|n>>>6)+i(128|63&n):i(224|n>>>12&15)+i(128|n>>>6&63)+i(128|63&n)}return e=65536+1024*(l.charCodeAt(0)-55296)+(l.charCodeAt(1)-56320),i(240|e>>>18&7)+i(128|e>>>12&63)+i(128|e>>>6&63)+i(128|63&e)})},getSign(t,i,l,n){let s="",r="";if(i){let p=Object.assign({},i);r=JSON.stringify(p),r=r.replace(/\s*/g,""),r=encodeURIComponent(r),r=r.split("").sort().join("")}let c=md5(a.e(this.utob(r))),d=md5(l+":"+n);return md5(c+d).toUpperCase()},async getFileUrlByOnce(t,i){try{if(t.downloadUrl)return{index:i,downloadUrl:t.downloadUrl};if(this.detectPage()==="home"){let l={contentID:t.contentID,commonAccountInfo:{account:t.owner,accountType:1},operation:"0",inline:"0",extInfo:{isReturnCdnDownloadUrl:"1"}},n=new Date(+new Date+8*3600*1e3).toJSON().substr(0,19).replace("T"," "),s=this.getRandomString(16),r=this.getSign(void 0,l,n,s),c=await a.post(o.pcs[0],l,{authorization:a.getCookie("authorization"),"x-huawei-channelSrc":"10000034","x-inner-ntwk":"2","mcloud-channel":"1000101","mcloud-client":"10701","mcloud-sign":n+","+s+","+r,"content-type":"application/json;charset=UTF-8",caller:"web","CMS-DEVICE":"default","x-DeviceInfo":"||9|7.12.0|chrome|118.0.0.0||windows 10||zh-CN|||","x-SvcType":"1"});return c.success?{index:i,downloadUrl:c.data.downloadURL}:{index:i,downloadUrl:"\u83B7\u53D6\u4E0B\u8F7D\u5730\u5740\u5931\u8D25\uFF0C\u8BF7\u5237\u65B0\u91CD\u8BD5\uFF01"}}if(this.detectPage()==="share"){let l=document.querySelector(".main_file_list").__vue__,n=await a.post(o.pcs[1],`linkId=${l.linkID}&contentIds=${t.path}&catalogIds=`,{"Content-Type":"application/x-www-form-urlencoded"});return n.code===0?{index:i,downloadUrl:n.data.redrUrl}:{index:i,downloadUrl:"\u83B7\u53D6\u4E0B\u8F7D\u5730\u5740\u5931\u8D25\uFF0C\u8BF7\u5237\u65B0\u91CD\u8BD5\uFF01"}}}catch{return{index:i,downloadUrl:"\u83B7\u53D6\u4E0B\u8F7D\u5730\u5740\u5931\u8D25\uFF0C\u8BF7\u5237\u65B0\u91CD\u8BD5\uFF01"}}},async getPCSLink(){if(h=this.getSelectedList(),h.length===0)return b.error("\u63D0\u793A\uFF1A\u8BF7\u5148\u52FE\u9009\u8981\u4E0B\u8F7D\u7684\u6587\u4EF6\uFF01");if(this.isOnlyFolder())return b.error("\u63D0\u793A\uFF1A\u8BF7\u6253\u5F00\u6587\u4EF6\u5939\u540E\u52FE\u9009\u6587\u4EF6\uFF01");let t=[];h.forEach((n,s)=>{t.push(this.getFileUrlByOnce(n,s))}),(await Promise.all(t)).forEach(n=>{h[n.index].downloadUrl=n.downloadUrl});let l=this.generateDom(h);this.showMainDialog(o[u][0],l,o[u][1])},generateDom(t){let i='<div class="pl-main">',l="";if(t.forEach((n,s)=>{if(n.dirEtag||n.caName)return;let r=n.contentName||n.coName,c=a.sizeFormat(n.contentSize||n.coSize),d=n.downloadUrl;if(u==="api"&&(i+=`<div class="pl-item">
                                <div class="pl-item-name listener-tip" data-size="${c}">${r}</div>
                                <a class="pl-item-link listener-link-api" data-filename="${r}" data-link="${d}" data-index="${s}">${d}</a>
                                </div>`),u==="aria"){let p=this.convertLinkToAria(d,r,navigator.userAgent);l+=p+`\r
`,i+=`<div class="pl-item">
                                <div class="pl-item-name listener-tip" data-size="${c}">${r}</div>
                                <a class="pl-item-link listener-link-aria" href="${p}" title="\u70B9\u51FB\u590D\u5236aria2c\u94FE\u63A5" data-filename="${r}" data-link="${p}">${decodeURIComponent(p)}</a> </div>`}if(u==="rpc"&&(i+=`<div class="pl-item">
                                <div class="pl-item-name listener-tip" data-size="${c}">${r}</div>
                                <button class="pl-item-link listener-link-rpc pl-btn-primary pl-btn-info" data-filename="${r}" data-link="${d}"><em class="icon icon-device"></em><span style="margin-left: 5px;">\u63A8\u9001\u5230 RPC \u4E0B\u8F7D\u5668</span></button></div>`),u==="curl"){let p=this.convertLinkToCurl(d,r,navigator.userAgent);l+=p+`\r
`,i+=`<div class="pl-item">
                                <div class="pl-item-name listener-tip" data-size="${c}">${r}</div>
                                <a class="pl-item-link listener-link-aria" href="${p}" title="\u70B9\u51FB\u590D\u5236curl\u94FE\u63A5" data-filename="${r}" data-link="${p}">${decodeURIComponent(p)}</a> </div>`}if(u==="bc"){let p=this.convertLinkToBC(d,r,navigator.userAgent);i+=`<div class="pl-item">
                                <div class="pl-item-name listener-tip" data-size="${c}">${r}</div>
                                <a class="pl-item-link" href="${decodeURIComponent(p)}" title="\u70B9\u51FB\u7528\u6BD4\u7279\u5F57\u661F\u4E0B\u8F7D" data-filename="${r}" data-link="${p}">${decodeURIComponent(p)}</a> </div>`}}),i+="</div>",u==="aria"&&(i+=`<div class="pl-extra"><button class="pl-btn-primary listener-copy-all" data-link="${l}">\u590D\u5236\u5168\u90E8\u94FE\u63A5</button></div>`),u==="rpc"){let n=a.getValue("setting_rpc_domain")+":"+a.getValue("setting_rpc_port")+a.getValue("setting_rpc_path");i+=`<div class="pl-extra"><button class="pl-btn-primary listener-send-rpc">\u53D1\u9001\u5168\u90E8\u94FE\u63A5</button><button title="${n}" class="pl-btn-primary pl-btn-warning listener-open-setting" style="margin-left: 10px">\u8BBE\u7F6E RPC \u53C2\u6570\uFF08\u5F53\u524D\u4E3A\uFF1A${n}\uFF09</button><button class="pl-btn-primary pl-btn-success listener-rpc-task" style="margin-left: 10px;display: none">\u67E5\u770B\u4E0B\u8F7D\u4EFB\u52A1</button></div>`}return u==="curl"&&(i+=`<div class="pl-extra"><button class="pl-btn-primary listener-copy-all" data-link="${l}">\u590D\u5236\u5168\u90E8\u94FE\u63A5</button><button class="pl-btn-primary pl-btn-warning listener-open-setting" style="margin-left: 10px;">\u8BBE\u7F6E\u7EC8\u7AEF\u7C7B\u578B\uFF08\u5F53\u524D\u4E3A\uFF1A${C[a.getValue("setting_terminal_type")]}\uFF09</button></div>`),i},async sendLinkToRPC(t,i){let l={domain:a.getValue("setting_rpc_domain"),port:a.getValue("setting_rpc_port"),path:a.getValue("setting_rpc_path"),token:a.getValue("setting_rpc_token"),dir:a.getValue("setting_rpc_dir")},n=`${l.domain}:${l.port}${l.path}`,s={id:new Date().getTime(),jsonrpc:"2.0",method:"aria2.addUri",params:[`token:${l.token}`,[i],{dir:l.dir,out:t,header:[]}]};try{return(await a.post(n,s,{},"")).result?"success":"fail"}catch{return"fail"}},getSelectedList(){try{return document.querySelector(".main_file_list").__vue__.selectList.map(t=>t.item)}catch{let i=document.querySelector(".home-page").__vue__,l=i._computedWatchers.fileList.value,n=i._computedWatchers.dirList.value,s=i.selectedFile,r=i.selectedDir,c=l.filter((p,g)=>s.includes(g)),d=n.filter((p,g)=>r.includes(g));return[...c,...d]}},detectPage(){let t=location.pathname;return/^\/w/.test(t)?"home":/^\/link|shareweb/.test(t)?"share":""},isOnlyFolder(){for(let t=0;t<h.length;t++)if(h[t].fileEtag||h[t].coName)return!1;return!0},showMainDialog(t,i,l){Swal.fire({title:t,html:i,footer:l,allowOutsideClick:!1,showCloseButton:!0,showConfirmButton:!1,position:"top",width:S,padding:"15px 20px 5px",customClass:I})},async initPanLinker(){a.initDefaultConfig(),a.addPanLinkerStyle(),f=this.detectPage();let t=await a.post(`https://api.youxiaohou.com/config/v2/yidong?ver=${y}&a=${U}`,{},{},"text");o=JSON.parse(a.d(t)),Object.freeze&&Object.freeze(o),o.num===a.getValue("setting_init_code")||o.license===a.getValue("license")?this.addButton():this.addInitButton(),a.createTip(),a.registerMenuCommand()}};({init(){/(pan|yun).baidu.com/.test(location.host)&&P.initPanLinker(),/www.(aliyundrive|alipan).com/.test(location.host)&&B.initPanLinker(),/cloud.189.cn/.test(location.host)&&V.initPanLinker(),/pan.xunlei.com/.test(location.host)&&z.initPanLinker(),/pan.quark.cn/.test(location.host)&&A.initPanLinker(),/(yun|caiyun).139.com/.test(location.host)&&F.initPanLinker()}}).init()})();
