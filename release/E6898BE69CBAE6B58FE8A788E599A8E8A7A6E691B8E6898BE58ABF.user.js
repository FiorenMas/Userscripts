// ==UserScript==
// @name		手机浏览器触摸手势
// @name:en		Mobile browser touch gestures
// @version		10.0.7
// @author		L.Xavier
// @namespace	https://greasyfork.org/zh-CN/users/128493
// @match		*://*/*
// @license		MIT
// @grant		window.close
// @grant		GM_setValue
// @grant		GM_getValue
// @grant		GM_openInTab
// @grant		GM_setClipboard
// @run-at		document-start
// @downloadURL https://raw.githubusercontent.com/FiorenMas/Userscripts/release/release/E6898BE69CBAE6B58FE8A788E599A8E8A7A6E691B8E6898BE58ABF.user.js
// @updateURL https://raw.githubusercontent.com/FiorenMas/Userscripts/release/release/E6898BE69CBAE6B58FE8A788E599A8E8A7A6E691B8E6898BE58ABF.meta.js
// ==/UserScript==
const gestureData={};gestureData.gesture={"\u2191\u2192\u2193\u2190":{name:"\u6253\u5F00\u8BBE\u7F6E",code:"/*ONLY TOP*/gestureData.openSet();"},"\u25C6\u25C6":{name:"\u89C6\u9891\u5168\u5C4F",code:"gestureData.videoFullScreen();"},"\u25CF":{name:"\u624B\u52BF\u7A7F\u900F",code:`if(/^[TIV]/.test(gestureData.path)){gestureData.path=(gestureData.path.indexOf("I")) ? "" : "I";}if(gestureData.path!=="I" && gestureData.settings["\u56FE\u7247\u624B\u52BF"]){if(gestureData.touchEle.nodeName!=="IMG"){let imgs=[...document.querySelectorAll("[_imgShow_='1']")];if(gestureData.shadowList){for(let Ti=0,len=gestureData.shadowList.length;Ti<len;++Ti){imgs.push(...gestureData.shadowList[Ti].querySelectorAll("[_imgShow_='1']"));}}for(let Ti=0,len=imgs.length;Ti<len;++Ti){if(imgs[Ti].nodeName!=="IMG" && getComputedStyle(imgs[Ti]).backgroundImage==="none"){continue;}let imgRect=imgs[Ti].getBoundingClientRect();if(gestureData.touchStart.clientX>imgRect.x && gestureData.touchStart.clientX<(imgRect.x+imgRect.width) && gestureData.touchStart.clientY>imgRect.y && gestureData.touchStart.clientY<(imgRect.y+imgRect.height)){gestureData.touchEle=imgs[Ti];break;}}}if(gestureData.path || gestureData.selectWords || !(gestureData.touchEle.compareDocumentPosition(gestureData.videoPlayer) & Node.DOCUMENT_POSITION_FOLLOWING)){if(gestureData.touchEle.nodeName==="IMG"){gestureData.path="I";}else{let bgImg=getComputedStyle(gestureData.touchEle).backgroundImage;if(bgImg!=="none"){gestureData.touchEle.src=bgImg.split('"')[1];gestureData.path="I";}}}}`},"\u2192\u2190":{name:"\u540E\u9000",code:"/*ONLY TOP*/function pageBack(){if(gestureData.backTimer){history.go(-1);setTimeout(pageBack,20);}}gestureData.backTimer=setTimeout(()=>{gestureData.backTimer=0;window.close();},200);pageBack();"},"\u2190\u2192":{name:"\u524D\u8FDB",code:"/*ONLY TOP*/history.go(1);"},"\u2193\u2191":{name:"\u56DE\u5230\u9876\u90E8",code:'/*WITH TOP*/let boxNode=gestureData.touchEle.parentNode;while(boxNode.nodeName!=="#document"){boxNode.scrollIntoView(true);if(boxNode.scrollTop){boxNode.scrollTo(0,0);}boxNode=boxNode.parentNode;}'},"\u2191\u2193":{name:"\u56DE\u5230\u5E95\u90E8",code:'/*WITH TOP*/let boxNode=gestureData.touchEle.parentNode;while(boxNode.nodeName!=="#document"){if(getComputedStyle(boxNode).overflowY!=="hidden"){boxNode.scrollTo(0,boxNode.scrollHeight+999999);}boxNode=boxNode.parentNode;}'},"\u2190\u2193":{name:"\u5237\u65B0\u9875\u9762",code:'/*ONLY TOP*/document.documentElement.style.cssText="filter:grayscale(100%)";history.go(0);'},"\u2190\u2191":{name:"\u65B0\u5EFA\u9875\u9762",code:'/*ONLY TOP*/gestureData.GM_openInTab("//limestart.cn",false);'},"\u2192\u2193":{name:"\u5173\u95ED\u9875\u9762",code:"/*ONLY TOP*/window.close();"},"\u2192\u2191":{name:"\u6062\u590D\u9875\u9762",code:'/*ONLY TOP*/gestureData.GM_openInTab("chrome-native://recent-tabs",false);'},"\u2193\u2191\u25CF":{name:"\u65B0\u9875\u9762\u6253\u5F00",code:'let linkNode=gestureData.touchEle;while(true){if(linkNode.href){gestureData.GM_openInTab(linkNode.href,false);break;}linkNode=linkNode.parentNode;if(linkNode.nodeName==="BODY"){gestureData.touchEle.click();break;}}'},"\u2191\u2193\u25CF":{name:"\u9690\u85CF\u5143\u7D20",code:'let boxNode=gestureData.touchEle,area=boxNode.offsetWidth*boxNode.offsetHeight,area_p=boxNode.parentNode.offsetWidth*boxNode.parentNode.offsetHeight,area_s=screen.width*screen.height;while(boxNode.parentNode.nodeName!=="BODY" && area/area_p>0.2 && area_p/area_s<0.9){boxNode=boxNode.parentNode;area_p=boxNode.parentNode.offsetWidth*boxNode.parentNode.offsetHeight;}if(boxNode.nodeName!=="HTML"){boxNode.remove();}'},"\u2193\u2192":{name:"\u590D\u5236\u9875\u9762",code:"/*ONLY TOP*/gestureData.GM_openInTab(location.href,false);"},"\u2192\u2190\u2192":{name:"\u534A\u5C4F\u6A21\u5F0F",code:'/*ONLY TOP*/if(gestureData.halfScreen){setTimeout(()=>{gestureData.halfScreen.remove();halfClose.remove();gestureData.halfScreen=null;document.documentElement.scrollTop=gestureData.scrollTop;},500);gestureData.scrollTop=document.body.scrollTop;let halfClose=gestureData.addStyle("html{transform:translateY(0) !important;}");}else{gestureData.scrollTop=document.documentElement.scrollTop;gestureData.halfScreen=gestureData.addStyle("html,body{height:43vh !important;overflow-y:auto !important;}html{transform:translateY(50vh) !important;transition:0.5s !important;overflow:hidden !important;}");document.body.scrollTop=gestureData.scrollTop;}'},"\u2192\u2193\u2191\u2190":{name:"\u89C6\u9891\u89E3\u6790",code:"/*ONLY TOP*/gestureData.GM_openInTab(`https://jx.xmflv.com/?url=${location.href}`,false);"},"\u2191\u2192\u2193":{name:"\u505C\u6B62\u5B9A\u65F6\u5668",code:'/*WITH TOP*/let start=gestureData.maxID|0,script=document.createElement("script");gestureData.maxID=setTimeout(Date);script.textContent=`for(let Ti=${start};Ti<${gestureData.maxID+1000};++Ti){clearTimeout(Ti);clearInterval(Ti);}`;document.body.insertAdjacentElement("beforeend",script);alert("\u5DF2\u505C\u6B62\u7F51\u9875\u5F53\u524D\u5B58\u5728\u7684\u5B9A\u65F6\u5668");'},"T\u2192\u2191":{name:"\u767E\u5EA6\u7FFB\u8BD1",code:"gestureData.GM_openInTab(`//fanyi.baidu.com/#auto/auto/${encodeURIComponent(gestureData.selectWords)}`,false);"},"T\u2190\u2191":{name:"\u6709\u9053\u7FFB\u8BD1",code:"gestureData.GM_openInTab(`//dict.youdao.com/w/eng/${encodeURIComponent(gestureData.selectWords)}`,false);"},"T\u25C6\u25C6":{name:"\u53CC\u51FB\u641C\u7D22",code:"gestureData.GM_setClipboard(gestureData.selectWords);if(!/^((https?:)?\\/\\/)?([\\w\\-]+\\.)+\\w{2,4}(:\\d{1,5})?(\\/\\S*)?$/.test(gestureData.selectWords.trim())){gestureData.selectWords=`//bing.com/search?q=${encodeURIComponent(gestureData.selectWords)}&FORM=CHROMN`;}else if(!/^(https?:)?\\/\\//.test(gestureData.selectWords.trim())){gestureData.selectWords=`//${gestureData.selectWords.trim()}`;}gestureData.GM_openInTab(gestureData.selectWords.trim(),false);"},"I\u2193\u2191\u25CF":{name:"\u6253\u5F00\u56FE\u7247",code:"gestureData.GM_openInTab(gestureData.touchEle.src,false);"},"I\u2192\u2191\u25CF":{name:"\u767E\u5EA6\u641C\u56FE",code:"gestureData.GM_openInTab(`//graph.baidu.com/details?isfromtusoupc=1&tn=pc&carousel=0&promotion_name=pc_image_shituindex&extUiData%5bisLogoShow%5d=1&image=${gestureData.touchEle.src}`,false);"},"V\u2192":{name:"\u524D\u8FDB10s",code:'gestureData.videoPlayer.currentTime+=10;gestureData.tipBox.textContent="+10s ";gestureData.tipBox.style.visibility="visible";setTimeout(()=>{gestureData.tipBox.style.visibility="hidden";},500);'},"V\u2190":{name:"\u540E\u900010s",code:'gestureData.videoPlayer.currentTime-=10;gestureData.tipBox.textContent="-10s ";gestureData.tipBox.style.visibility="visible";setTimeout(()=>{gestureData.tipBox.style.visibility="hidden";},500);'},"V\u2191":{name:"\u589E\u52A0\u500D\u901F",code:'if(document.fullscreen){let playSpeed=gestureData.videoPlayer.playbackRate;playSpeed+=(playSpeed<1.5) ? 0.25 : 0.5;gestureData.tipBox.textContent=`\xD7${playSpeed} \u221E `;gestureData.tipBox.style.visibility="visible";gestureData.videoPlayer.playbackRate=playSpeed;setTimeout(()=>{gestureData.tipBox.style.visibility="hidden";},500)}'},"V\u2193":{name:"\u51CF\u5C0F\u500D\u901F",code:'if(document.fullscreen){let playSpeed=gestureData.videoPlayer.playbackRate;playSpeed-=(playSpeed>1.5) ? 0.5 : (playSpeed>0.25 && 0.25);gestureData.tipBox.textContent=`\xD7${playSpeed} \u221E `;gestureData.tipBox.style.visibility="visible";gestureData.videoPlayer.playbackRate=playSpeed;setTimeout(()=>{gestureData.tipBox.style.visibility="hidden";},500)}'},"V\u2192\u25CF":{name:"\u5FEB\u8FDB\u64AD\u653E",code:'gestureData.playSpeed=gestureData.videoPlayer.playbackRate;gestureData.videoPlayer.playbackRate=10;gestureData.tipBox.textContent="\xD710 ";gestureData.tipBox.style.visibility="visible";'},"V\u2192\u25CB":{name:"\u505C\u6B62\u5FEB\u8FDB",code:'gestureData.videoPlayer.playbackRate=gestureData.playSpeed;gestureData.tipBox.style.visibility="hidden";'},"V\u2190\u25CF":{name:"\u5FEB\u9000\u64AD\u653E",code:'gestureData.videoTimer=setInterval(()=>{--gestureData.videoPlayer.currentTime;},100);gestureData.tipBox.textContent="- \xD710 ";gestureData.tipBox.style.visibility="visible";'},"V\u2190\u25CB":{name:"\u505C\u6B62\u5FEB\u9000",code:'clearInterval(gestureData.videoTimer);gestureData.tipBox.style.visibility="hidden";'},"V\u2191\u25BC":{name:"\u589E\u52A0\u97F3\u91CF",code:'if(document.fullscreen){gestureData.videoPlayer.muted=false;gestureData.tipBox.textContent=(gestureData.videoPlayer.volume*100|0)+"%";gestureData.tipBox.style.visibility="visible";let lastY=gestureData.touchEnd.screenY;gestureData.videoTimer=setInterval(()=>{if(lastY-gestureData.touchEnd.screenY){let tempVolume=gestureData.videoPlayer.volume+(lastY-gestureData.touchEnd.screenY)/100;gestureData.videoPlayer.volume=+(tempVolume>1) || (+(tempVolume>0) && tempVolume);gestureData.tipBox.textContent=(gestureData.videoPlayer.volume*100|0)+"%";lastY=gestureData.touchEnd.screenY;}},50);}'},"V\u2191\u25BD":{name:"\u5173\u95ED\u589E\u52A0\u97F3\u91CF",code:'clearInterval(gestureData.videoTimer);gestureData.tipBox.style.visibility="hidden";'},"V\u2193\u25BC":{name:"\u51CF\u5C11\u97F3\u91CF",code:'if(document.fullscreen){gestureData.videoPlayer.muted=false;gestureData.tipBox.textContent=(gestureData.videoPlayer.volume*100|0)+"%";gestureData.tipBox.style.visibility="visible";let lastY=gestureData.touchEnd.screenY;gestureData.videoTimer=setInterval(()=>{if(lastY-gestureData.touchEnd.screenY){let tempVolume=gestureData.videoPlayer.volume+(lastY-gestureData.touchEnd.screenY)/100;gestureData.videoPlayer.volume=+(tempVolume>1) || (+(tempVolume>0) && tempVolume);gestureData.tipBox.textContent=(gestureData.videoPlayer.volume*100|0)+"%";lastY=gestureData.touchEnd.screenY;}},50);}'},"V\u2193\u25BD":{name:"\u5173\u95ED\u51CF\u5C11\u97F3\u91CF",code:'clearInterval(gestureData.videoTimer);gestureData.tipBox.style.visibility="hidden";'},"V\u2192\u25BC":{name:"\u53F3\u6ED1\u8FDB\u5EA6",code:'if(!gestureData.formatTime){gestureData.formatTime=function(time){let minu=time/60,sec=time%60;hour=minu/60;minu%=60;return `${hour|0}:${(minu<10) ? "0":""}${minu|0}:${(sec<10) ? "0" : ""}${sec|0}`;};gestureData.showTip=function(){gestureData.tipBox.innerHTML=`<div style="background:#e1780f;width:100%;height:3px;margin:0 1vw;"><div style="width:${gestureData.videoPlayer.currentTime/gestureData.videoPlayer.duration*100|0}%;background:#1e87f0;height:3px;"></div></div><div style="font-size:min(5vw,18px);">${gestureData.formatTime(gestureData.videoPlayer.currentTime)}<span style="color:#e1780f;">/${gestureData.formatTime(gestureData.videoPlayer.duration)}</span></div>`;}}gestureData.showTip();gestureData.tipBox.style.visibility="visible";let lastX=gestureData.touchEnd.screenX;gestureData.videoTimer=setInterval(()=>{let len=gestureData.touchEnd.screenX-lastX;if(len){gestureData.videoPlayer.currentTime+=len*(1+Math.abs(len)*gestureData.videoPlayer.duration/3600).toFixed(2);lastX=gestureData.touchEnd.screenX;}gestureData.showTip();},50);'},"V\u2192\u25BD":{name:"\u5173\u95ED\u53F3\u6ED1\u8FDB\u5EA6",code:'clearInterval(gestureData.videoTimer);gestureData.tipBox.style.visibility="hidden";'},"V\u2190\u25BC":{name:"\u5DE6\u6ED1\u8FDB\u5EA6",code:'if(!gestureData.formatTime){gestureData.formatTime=function(time){let minu=time/60,sec=time%60;hour=minu/60;minu%=60;return `${hour|0}:${(minu<10) ? "0":""}${minu|0}:${(sec<10) ? "0" : ""}${sec|0}`;};gestureData.showTip=function(){gestureData.tipBox.innerHTML=`<div style="background:#e1780f;width:100%;height:3px;margin:0 1vw;"><div style="width:${gestureData.videoPlayer.currentTime/gestureData.videoPlayer.duration*100|0}%;background:#1e87f0;height:3px;"></div></div><div style="font-size:min(5vw,18px);">${gestureData.formatTime(gestureData.videoPlayer.currentTime)}<span style="color:#e1780f;">/${gestureData.formatTime(gestureData.videoPlayer.duration)}</span></div>`;}}gestureData.showTip();gestureData.tipBox.style.visibility="visible";let lastX=gestureData.touchEnd.screenX;gestureData.videoTimer=setInterval(()=>{let len=gestureData.touchEnd.screenX-lastX;if(len){gestureData.videoPlayer.currentTime+=len*(1+Math.abs(len)*gestureData.videoPlayer.duration/3600).toFixed(2);lastX=gestureData.touchEnd.screenX;}gestureData.showTip();},50);'},"V\u2190\u25BD":{name:"\u5173\u95ED\u5DE6\u6ED1\u8FDB\u5EA6",code:'clearInterval(gestureData.videoTimer);gestureData.tipBox.style.visibility="hidden";'},"\u25C6\u25C6\u25C6":{name:"\u89C6\u9891\u753B\u4E2D\u753B",code:"if(document.pictureInPictureElement){let playState=document.pictureInPictureElement.paused;document.exitPictureInPicture().then(()=>{if(!playState){gestureData.videoPlayer.play();}}).catch(Date);}else{gestureData.videoPlayer?.requestPictureInPicture().then(()=>{gestureData.videoPlayer.play();}).catch(Date);}"}},gestureData.settings={\u6ED1\u52A8\u7CFB\u6570:[.2,0,.5,2],\u6587\u5B57\u624B\u52BF:!0,\u56FE\u7247\u624B\u52BF:!0,\u89C6\u9891\u624B\u52BF:!0,\u9009\u8BCD\u7FFB\u8BD1:!1,\u7F51\u9875\u52A0\u901F:!1,\u89C6\u9891\u4E0B\u8F7D:!1,\u907F\u514D\u65AD\u89E6:!1},gestureData.GM_setValue=GM_setValue,gestureData.GM_getValue=GM_getValue,gestureData.GM_openInTab=GM_openInTab,gestureData.GM_setClipboard=GM_setClipboard,gestureData.gesture=gestureData.GM_getValue("gesture",gestureData.gesture),gestureData.settings=gestureData.GM_getValue("settings",gestureData.settings);const LIMIT=((screen.width>screen.height?screen.height:screen.width)*gestureData.settings.\u6ED1\u52A8\u7CFB\u6570[0])**2,ATTACH_SHADOW=Element.prototype.attachShadow,CANVAS_2D_DRAWIMAGE=CanvasRenderingContext2D.prototype.drawImage,CHECK_M_OBSERVER=new MutationObserver(()=>{checkTimer||(checkTimer=setTimeout(loadCheck,200))}),IMG_I_OBSERVER=new IntersectionObserver(e=>{for(let t=0,r=e.length;t<r;++t)e[t].intersectionRatio?e[t].target.setAttribute("_imgShow_","1"):e[t].target.setAttribute("_imgShow_","0")},{threshold:[0,.5,1]}),A_I_OBSERVER=new IntersectionObserver(e=>{let t=null,r=Date.now();for(let i=0,a=e.length;i<a;++i)t=e[i].target,e[i].intersectionRatio?(t.setAttribute("_linkShow_","1"),r>t._prefetch_&&(t._prefetch_=r+3e5,document.head.insertAdjacentHTML("beforeend",`<link rel="prefetch" href="${t.href.replace(/^https?:/,"")}"/>`))):t.setAttribute("_linkShow_","0")},{rootMargin:"50%",threshold:[0,.5,1]});let startPoint={},timeSpan=0,pressTime=0,raiseTime=0,slideTime=0,slideStamp=0,slideLimit=0,fingersNum=0,gestureTimer=0,clickTimer=0,isAllow=0,isClick=0;gestureData.runCode=code=>{try{eval(code)}catch(error){(error+"").indexOf("unsafe-eval")>-1?(window.eval=function(){this.gestureData=gestureData,this.close=window.close;let e=document.createElement("script");return t=>{e.remove(),e=document.createElement("script"),e.textContent=`try{${t}}catch(error){alert(\`\u201C${gestureData.path}\u201D \u624B\u52BF\u6267\u884C\u811A\u672C\u9519\u8BEF\uFF1A\\n${error} \uFF01\`);}`,document.body.insertAdjacentElement("beforeend",e)}}(),eval(code)):alert(`\u201C${gestureData.path}\u201D \u624B\u52BF\u6267\u884C\u811A\u672C\u9519\u8BEF\uFF1A
${error} \uFF01`)}},gestureData.runFrame=e=>{let t=gestureData.gesture[e].code;if(top===self||/^[TIV]/.test(e))gestureData.runCode(t);else if(t.indexOf("/*ONLY TOP*/")<0&&gestureData.runCode(t),/\/\*(ONLY|WITH) TOP\*\//.test(t)){/[●▼]$/.test(e)&&(window._isPushing_=()=>{let i={};i.touchEnd=copyTouch(gestureData.touchEnd),top.postMessage({type:"pushTouch",gestureData:i},"*")});let r={};r.touchStart=copyTouch(gestureData.touchStart),r.touchEnd=copyTouch(gestureData.touchEnd),top.postMessage({type:"runPath",runPath:gestureData.path,gestureData:r},"*")}},gestureData.runGesture=e=>{gestureData.gesture[gestureData.path]?(gestureData.runFrame(gestureData.path),gestureData.gesture[e]&&(gestureData.path=e)):gestureData.gesture[gestureData.path.slice(1)]&&/^[TIV]/.test(gestureData.path)&&(gestureData.runFrame(gestureData.path.slice(1)),gestureData.gesture[e?.slice(1)]&&(gestureData.path=e)),raiseTime=0};function longPress(){if(isAllow&&!/[●○▽]$/.test(gestureData.path)){isAllow=isClick=0,startPoint=gestureData.touchEnd;let e=gestureData.path+"\u25CB";gestureData.path+="\u25CF",gestureData.runGesture(e)}}function slidingRun(){slideStamp=0;let e=gestureData.path+"\u25BD";gestureData.path+="\u25BC",gestureData.runGesture(e),gestureData.path=gestureData.path.replace("\u25BC","")}function touchStart(e){if(clearTimeout(gestureTimer),fingersNum===e.touches?.length&&(window._isPushing_=null,/[○▽]$/.test(gestureData.path)&&gestureData.runGesture()),(fingersNum=e.touches?.length)!==1)return;pressTime=Date.now(),timeSpan=pressTime-raiseTime;let t=raiseTime&&(e.changedTouches[0].screenX-gestureData.touchEnd.screenX)**2+(e.changedTouches[0].screenY-gestureData.touchEnd.screenY)**2;if(timeSpan>50||t>LIMIT){if(startPoint=e.changedTouches[0],timeSpan>200||t>LIMIT*4){if(gestureData.path="",slideLimit=LIMIT,gestureData.touchEle=e.target,gestureData.touchEnd=gestureData.touchStart=startPoint,gestureData.selectWords=window.getSelection()+"",gestureData.selectWords&&gestureData.settings.\u6587\u5B57\u624B\u52BF)gestureData.path="T";else if(document.contains(gestureData.videoPlayer)&&gestureData.settings.\u89C6\u9891\u624B\u52BF){let r=gestureData.findVideoBox()?.getBoundingClientRect()||new DOMRect;fullsState>0&&gestureData.touchStart.clientY<r.y+r.height/8?gestureData.path="!":gestureData.touchStart.clientX>r.x&&gestureData.touchStart.clientX<r.x+r.width&&gestureData.touchStart.clientY>r.y&&gestureData.touchStart.clientY<r.y+r.height&&(gestureData.path="V")}}else isClick&&e.preventDefault();slideTime=pressTime,isAllow=isClick=1}else isClick&&(clearTimeout(clickTimer),gestureData.path=gestureData.path.slice(0,-1));gestureTimer=setTimeout(longPress,300+slideTime-pressTime)}function touchMove(e){if(clearTimeout(gestureTimer),gestureData.touchEnd=e.changedTouches?e.changedTouches[0]:e,window._isPushing_&&setTimeout(window._isPushing_),/[○▽]$/.test(gestureData.path)||fingersNum>1)return;let t=(gestureData.touchEnd.screenX-startPoint.screenX)**2,r=(gestureData.touchEnd.screenY-startPoint.screenY)**2,i=t>r*1.42?gestureData.touchEnd.screenX>startPoint.screenX?"\u2192":"\u2190":gestureData.touchEnd.screenY>startPoint.screenY?"\u2193":"\u2191",a=Date.now(),s=t+r,l=gestureData.path?.slice(-1);s>LIMIT/100&&(slideTime=a,isClick=0,l===i||s>slideLimit?(l!==i&&(timeSpan<50||"TIV\u25C6".indexOf(l)>-1)&&(gestureData.path+=i,slideLimit*=slideLimit<LIMIT/2||.64,slideStamp=a+300,isAllow=1,timeSpan=0),startPoint=gestureData.touchEnd,slideStamp&&a>slideStamp&&setTimeout(slidingRun)):s>slideLimit/16&&(slideStamp=isAllow=0)),gestureTimer=setTimeout(longPress,300+slideTime-a)}function touchEnd(e){if(clearTimeout(gestureTimer),--fingersNum>0){/[○▽]$/.test(gestureData.path)||(gestureData.path="!");return}if(window._isPushing_=null,gestureData.touchEnd=e.changedTouches[0],raiseTime=Date.now(),top!==self&&top.postMessage({type:"iframeLock"},"*"),/[○▽]$/.test(gestureData.path)){setTimeout(gestureData.runGesture);return}isClick&&(gestureData.path+="\u25C6",gestureData.path.indexOf("T")||(e.preventDefault(),window.getSelection().empty())),isAllow&&(gestureTimer=setTimeout(gestureData.runGesture,199))}function delayClick(e){if(e.isTrusted){if(e.preventDefault(),e.stopImmediatePropagation(),timeSpan<50)return;let t=new PointerEvent("click",{bubbles:!0,cancelable:!0,clientX:e.clientX,clientY:e.clientY,composed:!0,detail:1,layerX:e.layerX,layerY:e.layerY,offsetX:e.offsetX,offsetY:e.offsetY,pageX:e.pageX,pageY:e.pageY,pointerId:e.pointerId,pointerType:e.pointerType,screenX:e.screenX,screenY:e.screenY,sourceCapabilities:e.sourceCapabilities,view:e.view,x:e.x,y:e.y});clickTimer=setTimeout(()=>{e.target.dispatchEvent(t)},50)}}let oriLock=0,resizeTimer=0,fullsState=0,iframeEles=document.getElementsByTagName("iframe"),iframeLock=null;async function setVideo(e){let t=e.target||e;document.contains(gestureData.videoPlayer)&&t.muted||(gestureData.videoPlayer=t,videoOriLock(),gestureData.videoPlayer.insertAdjacentElement("afterend",gestureData.tipBox),gestureData.settings.\u89C6\u9891\u4E0B\u8F7D&&(await gestureData.findVideoBox()?.insertAdjacentElement("beforeend",gestureData.videoPlayer._downloadTip_),window._urlObjects_[gestureData.videoPlayer.src]?(gestureData.videoPlayer._downloadTip_.textContent="\u6B63\u5728\u6355\u83B7",gestureData.videoPlayer._downloadTip_.buffers=window._urlObjects_[gestureData.videoPlayer.src].sourceBuffers,window._urlObjects_[gestureData.videoPlayer.src]._downloadTip_=gestureData.videoPlayer._downloadTip_,delete window._urlObjects_[gestureData.videoPlayer.src]):gestureData.videoPlayer._downloadTip_.textContent==="\u672A\u52A0\u8F7D"&&(!gestureData.videoPlayer.src&&gestureData.videoPlayer.children.length&&(gestureData.videoPlayer.src=gestureData.videoPlayer.firstChild.src),gestureData.videoPlayer.src.indexOf("blob:")&&gestureData.videoPlayer.src&&(gestureData.videoPlayer._downloadTip_.textContent="\u53EF\u4E0B\u8F7D"))))}function videoOriLock(){if(!gestureData.videoPlayer.videoWidth){!gestureData.videoPlayer.error&&document.contains(gestureData.videoPlayer)&&setTimeout(videoOriLock,100),oriLock=0;return}oriLock=+(gestureData.videoPlayer.videoWidth>gestureData.videoPlayer.videoHeight),fullsState>0&&oriLock?top.postMessage({type:"GYRO"},"*"):screen.orientation.unlock()}CanvasRenderingContext2D.prototype.drawImage=function(){let e=arguments[0];return e.nodeName==="VIDEO"&&!document.contains(e)&&(e.style.display="none",this.canvas.insertAdjacentElement("afterend",e)),CANVAS_2D_DRAWIMAGE.call(this,...arguments)},gestureData.videoFullScreen=async()=>{resizeTimer||(document.fullscreen?await document.exitFullscreen()?.catch(Date):gestureData.videoPlayer?await gestureData.findVideoBox()?.requestFullscreen()?.catch(Date):iframeLock&&iframeLock.postMessage({type:"fullscreen"},"*"))},gestureData.findVideoBox=(e=gestureData.videoPlayer)=>{if(!document.contains(e))return null;if(e._videoBox_?.contains(e)&&(document.fullscreen||e._checkHeight_===e.clientHeight))return e._videoBox_;let t=e.parentNode,r=getComputedStyle(e),i=getComputedStyle(t),a=0,s=0,l=0,d=0,c="";for(e.setAttribute("_videobox_",""),e._checkHeight_=e.clientHeight,e._videoBox_=t,e.offsetParent===e.parentNode||!e.offsetParent?(a=Math.round(e.offsetWidth+ +r.marginLeft.slice(0,-2)+ +r.marginRight.slice(0,-2)),s=Math.round(e.offsetHeight+ +r.marginTop.slice(0,-2)+ +r.marginBottom.slice(0,-2)),l=Math.round(t.offsetWidth+ +i.marginLeft.slice(0,-2)+ +i.marginRight.slice(0,-2)),d=Math.round(t.offsetHeight+ +i.marginTop.slice(0,-2)+ +i.marginBottom.slice(0,-2))):(a=Math.round(e.offsetWidth+(+r.left.slice(0,-2)||0)+ +r.marginLeft.slice(0,-2)+ +r.marginRight.slice(0,-2)+(+r.right.slice(0,-2)||0)),s=Math.round(e.offsetHeight+(+r.top.slice(0,-2)||0)+ +r.marginTop.slice(0,-2)+ +r.marginBottom.slice(0,-2)+(+r.bottom.slice(0,-2)||0)),l=Math.round(t.offsetWidth+(+i.left.slice(0,-2)||0)+ +i.marginLeft.slice(0,-2)+ +i.marginRight.slice(0,-2)+(+i.right.slice(0,-2)||0)),d=Math.round(t.offsetHeight+(+i.top.slice(0,-2)||0)+ +i.marginTop.slice(0,-2)+ +i.marginBottom.slice(0,-2)+(+i.bottom.slice(0,-2)||0))),a=a>l?a:l,s=s>d?s:d;(a>=t.clientWidth||e.clientWidth*1.08>t.clientWidth)&&(a<1.15*t.clientWidth||!t.clientWidth)&&(s<1.15*t.clientHeight||!t.clientHeight)&&t.nodeName!=="BODY";){if(s<t.clientHeight&&e.clientHeight*1.08<t.clientHeight){let f=1;for(let p of t.children)if(r=getComputedStyle(p),s=Math.round(p.offsetHeight+(+r.top.slice(0,-2)||0)+ +r.marginTop.slice(0,-2)+ +r.marginBottom.slice(0,-2)+(+r.bottom.slice(0,-2)||0)),s>=t.clientHeight&&e.clientHeight*1.15>t.clientHeight){f=0;break}if(f)break}t.clientHeight&&(e._videoBox_=t,t.setAttribute("_videobox_",""),c=t.style.cssText,/\s*!\s*important/.test(c)&&(t._cssText_=c,t._fullscreenCSS_=c.replace(/\s*!\s*important/g,""),t.setAttribute("_videobox_","!important")),i=getComputedStyle(t),t.offsetParent===t.parentNode||!t.offsetParent?(l=Math.round(t.offsetWidth+ +i.marginLeft.slice(0,-2)+ +i.marginRight.slice(0,-2)),d=Math.round(t.offsetHeight+ +i.marginTop.slice(0,-2)+ +i.marginBottom.slice(0,-2))):(l=Math.round(t.offsetWidth+(+i.left.slice(0,-2)||0)+ +i.marginLeft.slice(0,-2)+ +i.marginRight.slice(0,-2)+(+i.right.slice(0,-2)||0)),d=Math.round(t.offsetHeight+(+i.top.slice(0,-2)||0)+ +i.marginTop.slice(0,-2)+ +i.marginBottom.slice(0,-2)+(+i.bottom.slice(0,-2)||0))),a=a>l?a:l,s=s>d?s:d),t=t.parentNode}return e._videoBox_.setAttribute("_videobox_",`${e._videoBox_.getAttribute("_videobox_")||""} outer`.trim()),e._videoBox_};function regRESIZE(){let e=gestureData.addStyle(""),t=()=>{resizeTimer=0},r=null;window.addEventListener("resize",()=>{if(document.fullscreen&&!fullsState){if(resizeTimer=setTimeout(t,400),fullsState=document.fullscreenElement,fullsState.nodeName==="IFRAME"){fullsState=-1;return}let i=fullsState.getElementsByTagName("video"),a=fullsState.nodeName==="VIDEO"?fullsState:i[0];if(!fullsState.hasAttribute("_videobox_")&&(!a||i.length>1||a._videoBox_.offsetWidth*a._videoBox_.offsetHeight*1.2<fullsState.offsetWidth*fullsState.offsetHeight)){fullsState=-1;return}a!==gestureData.videoPlayer&&(gestureData.videoPlayer?.pause(),setVideo(a)),r=fullsState.parentNode.querySelectorAll('*[_videobox_*="!important"]'),fullsState=1,oriLock&&top.postMessage({type:"GYRO"},"*"),e.textContent="*[_videobox_]{inset:0 !important;margin:0 !important;padding:0 !important;width:100% !important;height:100% !important;max-width:100% !important;max-height:100% !important;}video{position:absolute;transform:none !important;object-fit:contain !important;}",r.forEach(s=>{s.style.cssText=s._fullscreenCSS_})}else fullsState&&!document.fullscreen&&(resizeTimer=setTimeout(t,400),fullsState=0,e.textContent="",r.forEach(i=>{i.style.cssText=i._cssText_}))},!0)}if(gestureData.settings.\u89C6\u9891\u4E0B\u8F7D){const e=URL.createObjectURL,t=MediaSource.prototype.addSourceBuffer,r=SourceBuffer.prototype.appendBuffer,i=MediaSource.prototype.endOfStream;window._initDownload_=a=>{a._downloadTip_=document.createElement("div"),a._downloadTip_.style.cssText="position:absolute;right:0;top:20px;background:#3498db;border-radius:20px 0 0 20px;text-align:center;padding:20px;line-height:0px;color:#fff;min-width:60px;font-size:16px;font-family:system-ui;z-index:2147483647;",a._downloadTip_.target=a,a._downloadTip_.textContent="\u672A\u52A0\u8F7D",window._urlObjects_[a.src]?(a._downloadTip_.textContent="\u6B63\u5728\u6355\u83B7",a._downloadTip_.buffers=window._urlObjects_[a.src].sourceBuffers,window._urlObjects_[a.src]._downloadTip_=a._downloadTip_,delete window._urlObjects_[a.src]):(!a.src&&a.children.length&&(a.src=a.firstChild.src),a.src.indexOf("blob:")&&a.src&&(a._downloadTip_.textContent="\u53EF\u4E0B\u8F7D")),a._downloadTip_.addEventListener("click",window._downloadVideo_,!0),a._videoBox_.insertAdjacentElement("beforeend",a._downloadTip_)},window._downloadVideo_=function(a){if(this.textContent==="\u672A\u52A0\u8F7D")return;a.target&&(a=this,a.src=this.target.src);let s=a.buffers;if(top!==self){let d=[];for(let c=0,f=s.length;c<f;++c)d.push({mime:s[c]._mime_,bufferList:s[c]._bufferList_});top.postMessage({type:"download",buffers:d,src:a.src},"*");return}let l=document.createElement("a");if(l.download=document.title,l.style.display="none",document.body.insertAdjacentElement("beforeend",l),a.src.indexOf("blob:")&&a.src)l.href=a.src,l.click();else if(s.length)for(let d=0,c=s.length;d<c;++d)l.href=URL.createObjectURL(new Blob(s[d]._bufferList_,{type:s[d]._mime_})),l.click(),URL.revokeObjectURL(l.href);l.remove()},window._urlObjects_={},URL.createObjectURL=a=>{let s=e(a);return a.sourceBuffers&&(window._urlObjects_[s]=a),s},MediaSource.prototype.addSourceBuffer=function(a){let s=t.call(this,a);return s._bufferList_=[],s._mime_=a,s._mediaSource_=this,s},SourceBuffer.prototype.appendBuffer=function(a){this._bufferList_.push(a),this._mime_.indexOf("video")>-1&&this._mediaSource_._downloadTip_&&(this._mediaSource_._downloadTip_.textContent=`\u5DF2\u6355\u83B7${this._bufferList_.length}\u4E2A\u7247\u6BB5`),r.call(this,a)},MediaSource.prototype.endOfStream=function(){this._downloadTip_&&(this._downloadTip_.textContent="\u53EF\u4E0B\u8F7D"),i.call(this)}}if(gestureData.settings.\u9009\u8BCD\u7FFB\u8BD1){let r=function(s){if(/[\u4E00-\u9FFF\u3400-\u4DBF\u{20000}-\u{2EBEF}]/u.test(s))return"zh-CN";let d=/[\u3040-\u309F\u30A0-\u30FF\u4E00-\u9FFF]/,c=/[\uAC00-\uD7AF]/,f=/[\u0400-\u04FF]/,p=/[\u0600-\u06FF]/;return d.test(s)?"ja":c.test(s)?"ko":f.test(s)?"ru":p.test(s)?"ar":"en"},i=function(s){let l=r(s),d=l==="zh-CN"?"en":"zh-CN";return fetch(`https://api.mymemory.translated.net/get?q=${encodeURIComponent(s)}&langpair=${l}|${d}`).then(c=>{if(!c.ok)throw new Error("\u7F51\u7EDC\u8BF7\u6C42\u5931\u8D25\uFF01");return c.json()}).then(c=>c.responseStatus===200?c.responseData.translatedText:"\u7CDF\u7CD5X\uFE4FX\uFF0C\u7FFB\u8BD1\u5931\u8D25\u4E86\uFF01").catch(()=>"\u7CDF\u7CD5X\uFE4FX\uFF0C\u7FFB\u8BD1\u5931\u8D25\u4E86\uFF01")},a=function(){clearTimeout(e),t||(t=document.createElement("div"),t.style.cssText="position:fixed;transform:translateX(-25%);max-width:80%;padding:15px 25px;background:#1e1e1e;border-radius:8px;font-size:16px;font-family:system-ui;color:#fff;z-index:2147483647;border:2px solid #eee;display:none;align-items:center;",document.body.insertAdjacentElement("beforeend",t),t.addEventListener("touchstart",function(){gestureData.GM_setClipboard(this.textContent),alert("\u7FFB\u8BD1\u590D\u5236\u6210\u529F\uFF01")},!0));let s=window.getSelection().toString().trim();if(!s){t.style.display="none";return}e=setTimeout(async()=>{if(window.getSelection().toString().trim()){if(s!==window.getSelection().toString().trim()){setTimeout(a);return}}else{t.style.display="none";return}if(t.textContent=await i(s),!window.getSelection().toString().trim()){t.style.display="none";return}t.style.left=gestureData.touchEnd.clientX+"px",t.style.top=Math.min(gestureData.touchEnd.clientY+screen.width*.05,window.innerHeight-screen.width*.2)+"px",gestureData.touchEnd.clientX<screen.width*.2?t.style.transform="translateX(-10%)":gestureData.touchEnd.clientX>window.innerWidth-screen.width*.2?(t.style.left=gestureData.touchEnd.clientX-screen.width*.2+"px",t.style.transform="none"):t.style.transform="translateX(-25%)",t.style.display="flex"},1e3)};var detectLanguage=r,translateText=i,handleSelection=a;let e=0,t=null;document.addEventListener("selectionchange",a,!0)}let videoEles=[],imgEles=[],linkEles=[],checkTimer=0;window.trustedTypes?.createPolicy("default",{createHTML:e=>e,createScript:e=>e,createScriptURL:e=>e}),Element.prototype.attachShadow=function(){gestureData.shadowList||(gestureData.shadowList=[]);let e=ATTACH_SHADOW.call(this,...arguments);return gestureData.shadowList.push(e),CHECK_M_OBSERVER.observe(e,{childList:!0,subtree:!0}),e};async function loadCheck(){if(linkEles=[...document.querySelectorAll("a:not([_linkShow_])")],videoEles=[...document.querySelectorAll("video:not([_videoBox_])")],imgEles=[...document.querySelectorAll('img:not([_imgShow_]),[style*="url("]:not([_imgShow_])')],gestureData.shadowList)for(let e=0,t=gestureData.shadowList.length;e<t;++e)linkEles.push(...gestureData.shadowList[e].querySelectorAll("a:not([_linkShow_])")),videoEles.push(...gestureData.shadowList[e].querySelectorAll("video:not([_videoBox_])")),imgEles.push(...gestureData.shadowList[e].querySelectorAll('img:not([_imgShow_]),[style*="url("]:not([_imgShow_])'));if(videoEles.length&&gestureData.settings.\u89C6\u9891\u624B\u52BF){gestureData.tipBox||(regRESIZE(),top!==self&&top.postMessage({type:"forceFullScreen"},"*"),gestureData.tipBox=document.createElement("div"),gestureData.tipBox.style.cssText="display:inline-flex;flex-wrap:wrap;text-align:center;justify-content:center;align-items:center;visibility:hidden;position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);min-width:80px;min-height:30px;padding:10px;color:#1e87f0;font-size:22px;background-color:rgba(0,0,0,0.6);border-radius:999px;font-family:system-ui;z-index:2147483647;");for(let e=0,t=videoEles.length;e<t;++e)videoEles[e]._videoBox_||(await gestureData.findVideoBox(videoEles[e]),gestureData.settings.\u89C6\u9891\u4E0B\u8F7D&&await window._initDownload_(videoEles[e]),videoEles[e].paused||(setVideo(videoEles[e]),top!==self&&top.postMessage({type:"iframeLock"},"*")),videoEles[e].addEventListener("playing",setVideo,!0),videoEles[e].addEventListener("volumechange",setVideo,!0),videoEles[e].addEventListener("contextmenu",r=>{r.preventDefault()},!0))}if(gestureData.settings.\u56FE\u7247\u624B\u52BF)for(let e=0,t=imgEles.length;e<t;++e)imgEles[e].setAttribute("_imgShow_","0"),IMG_I_OBSERVER.observe(imgEles[e]);if(gestureData.settings.\u7F51\u9875\u52A0\u901F)for(let e=0,t=linkEles.length;e<t;++e)linkEles[e].setAttribute("_linkShow_","0"),linkEles[e].href.indexOf("/")>-1&&(linkEles[e]._prefetch_=0,A_I_OBSERVER.observe(linkEles[e]),linkEles[e].addEventListener("click",function(){this._prefetch_=0},!0));document.documentElement._regEvent_||regEvent(),checkTimer=0}gestureData.addStyle=e=>{let t=document.createElement("style");if(t.textContent=e,document.head)return document.head.insertAdjacentElement("beforeend",t),t;setTimeout(()=>{gestureData.addStyle(e)})};function copyTouch(e){let t={};for(let r in e)r!=="target"&&(t[r]=e[r]);return t}gestureData.openSet=()=>{let e="",t="",r=document.createElement("div"),i=null,a=0;gestureData.addStyle('*{overflow:hidden !important;}#_gestureBox_{background-color:#fff;width:100%;height:100%;position:fixed;padding:0;margin:0;inset:0;overflow-y:auto !important;z-index:2147483647;}#_gestureBox_ *{font-family:system-ui;margin:0;padding:0;text-align:center;font-size:5vmin;line-height:12vmin;user-select:none !important;transform:none;text-indent:0;}#_gestureBox_ ::placeholder{color:#999;font-size:2.5vmin;line-height:6vmin;}#_gestureBox_ h1{width:60%;height:12vmin;color:#0074d9;background-color:#dee6ef;margin:3vmin auto;border-radius:12vmin;box-shadow:0.9vmin 0.9vmin 3vmin #dfdfdf;}#_gestureBox_ #_addGesture_{width:14vmin;height:14vmin;margin:3vmin auto;line-height:14vmin;background-color:#dee6ef;color:#032e58;font-size:7.5vmin;border-radius:15vmin;box-shadow:0.3vmin 0.3vmin 1.5vmin #dfdfdf;}#_gestureBox_ ._gestureLi_{height:18vmin;width:100%;border-bottom:0.3vmin solid #dfdfdf;}#_gestureBox_ ._gestureLi_ p{margin:3vmin 0 0 1%;width:38%;height:12vmin;border-left:1.8vmin solid;color:#ffb400;background-color:#fff1cf;float:left;white-space:nowrap;text-overflow:ellipsis;text-shadow:0.3vmin 0.3vmin 3vmin #ffcb56;}#_gestureBox_ ._gestureLi_ ._gesturePath_{margin:3vmin 0 0 3%;float:left;width:38%;height:12vmin;background-color:#f3f3f3;color:#000;box-shadow:0.3vmin 0.3vmin 1.5vmin #ccc9c9;border-radius:3vmin;white-space:nowrap;text-overflow:ellipsis;}#_gestureBox_ ._gestureLi_ ._delGesture_{margin:3vmin 2% 0 0;width:15vmin;height:12vmin;float:right;color:#f00;text-decoration:line-through;}#_gestureBox_ #_revisePath_{background-color:rgba(0,0,0,0.7);width:100%;height:100%;position:fixed;inset:0;display:none;color:#000;}#_gestureBox_ #_revisePath_ span{width:15vmin;height:15vmin;font-size:12.5vmin;line-height:15vmin;position:absolute;}#_gestureBox_ #_revisePath_ div{color:#3339f9;position:absolute;width:30%;height:12vmin;font-size:10vmin;bottom:15%;}#_gestureBox_ #_revisePath_ p{color:#3ba5d8;position:absolute;top:15%;font-size:10vmin;height:12vmin;width:100%;}#_gestureBox_ #_revisePath_ #_path_{top:40%;color:#ffee03;height:100%;word-wrap:break-word;font-size:15vmin;line-height:18vmin;}#_gestureBox_ #_editGesture_{overflow-y:auto !important;background-color:#fff;width:100%;height:100%;position:fixed;inset:0;display:none;color:#000;}#_gestureBox_ #_editGesture_ p{color:#3339f9;font-size:7.5vmin;text-align:left;margin:6vmin 0 0 9vmin;width:100%;height:9vmin;line-height:9vmin;}#_gestureBox_ #_editGesture_ #_gestureName_{margin-top:6vmin;width:80%;height:12vmin;color:#000;border:0.3vmin solid #dadada;border-radius:3vmin;text-align:left;padding:0 3vmin;}#_gestureBox_ #_editGesture_ ._label_box_>label{display:inline-block;margin-top:6vmin;position:relative;}#_gestureBox_ #_editGesture_ ._label_box_>label>input{position:absolute;top:0;left:-6vmin;}#_gestureBox_ #_editGesture_ ._label_box_>label>div{width:20vw;border:#ddd solid 0.3vmin;height:12vmin;color:#666;position:relative;}#_gestureBox_ #_editGesture_ ._label_box_>label>input:checked + div{border:#d51917 solid 0.3vmin;color:#d51917;}#_gestureBox_ #_editGesture_ ._label_box_>label>input + div:after{top:auto;left:auto;bottom:-3vmin;right:0;transition:none;}#_gestureBox_ #_editGesture_ ._label_box_>label>input:checked + div:after{content:"";display:block;border:none;width:6vmin;height:6vmin;background-color:#d51917;transform:skewY(-45deg);position:absolute;}#_gestureBox_ #_editGesture_ ._label_box_>label>input:checked + div:before{content:"";display:block;width:0.9vmin;height:2.4vmin;border-right:#fff solid 0.6vmin;border-bottom:#fff solid 0.6vmin;transform:rotate(35deg);position:absolute;bottom:0.6vmin;right:1.2vmin;z-index:1;}#_gestureBox_ #_editGesture_ #_gestureCode_{overflow-y:auto !important;width:80%;margin-top:6vmin;height:40%;text-align:left;line-height:6vmin;padding:3vmin;border:0.3vmin solid #dadada;border-radius:3vmin;}#_gestureBox_ #_editGesture_ button{width:30vmin;height:15vmin;font-size:7.5vmin;line-height:15vmin;display:inline-block;color:#fff;background-color:#2866bd;margin:6vmin 3vmin 0 3vmin;border:none;}#_gestureBox_ #_settingsBox_{overflow-y:auto !important;background-color:#fff;width:100%;height:100%;position:fixed;inset:0;display:none;color:#000;}#_gestureBox_ #_settingsBox_ p{color:#3339f9;text-align:left;margin:9vmin 0 0 9vmin;float:left;height:6vmin;line-height:6vmin;clear:both;}#_gestureBox_ #_settingsBox_ ._slideRail_{overflow:initial !important;width:55%;background-color:#a8a8a8;float:left;margin:12vmin 0 0 3vmin;height:0.6vmin;position:relative;}#_gestureBox_ #_settingsBox_ ._slideRail_ ._slideButton_{line-height:9vmin;color:#fff;background-color:#2196f3;min-width:9vmin;height:9vmin;border-radius:9vmin;font-size:4vmin;position:absolute;top:-4.5vmin;box-shadow:0.3vmin 0.3vmin 1.8vmin #5e8aee;padding:0 1vmin;}#_gestureBox_ #_settingsBox_ ._switch_{position:relative;display:inline-block;width:18vmin;height:9vmin;float:left;margin:7.5vmin 42% 0 3vmin;}#_gestureBox_ #_settingsBox_ ._switch_ input{display:none;}#_gestureBox_ #_settingsBox_ ._slider_{border-radius:9vmin;position:absolute;cursor:pointer;inset:0;background-color:#ccc;transition:0.4s;}#_gestureBox_ #_settingsBox_ ._slider_:before{border-radius:50%;position:absolute;content:"";height:7.5vmin;width:7.5vmin;left:0.6vmin;bottom:0.6vmin;background-color:white;transition:0.4s;}#_gestureBox_ #_settingsBox_ input:checked + ._slider_{background-color:#2196F3;}#_gestureBox_ #_settingsBox_ input:checked + ._slider_:before{transform:translateX(9vmin);}#_gestureBox_ #_settingsBox_ #_saveSettings_{display:block;clear:both;width:30vmin;height:15vmin;font-size:7.5vmin;line-height:15vmin;color:#fff;background-color:#2866bd;border:none;margin:12vmin 0 0 calc(50% - 15vmin);float:left;}'),r.id="_gestureBox_",document.body.insertAdjacentElement("beforeend",r),r.innerHTML=`<h1 id="_openSettings_">\u624B\u52BF\u8F68\u8FF9\u8BBE\u7F6E</h1><div id="_addGesture_">+</div><div id="_gestureUL_"></div><div id="_revisePath_"><span style="top:0;left:0;text-align:left;">\u250C</span><span style="top:0;right:0;text-align:right;">\u2510</span><span style="bottom:0;left:0;text-align:left;">\u2514</span><span style="bottom:0;right:0;text-align:right;">\u2518</span><p>\u8BF7\u6ED1\u52A8\u624B\u6307</p><p id="_path_"></p><div id="_clearPath_" style="left:10%;">\u6E05\u9664</div><div id="_cancleRevise_" style="right:10%;">\u4FDD\u5B58</div></div><div id="_editGesture_"><p>\u624B\u52BF\u540D\u79F0\uFF1A</p><input type="text" id="_gestureName_" maxlength="12" placeholder="\u6700\u5927\u8F93\u516512\u4E2A\u5B57\u7B26"><p>\u624B\u52BF\u7C7B\u578B\uFF1A</p><div class="_label_box_"><label><input type="radio" id="_G_" name="_gestureType_" value=""><div>\u4E00\u822C</div></label><label><input type="radio" id="_T_" name="_gestureType_" value="T"><div>\u6587\u5B57</div></label><label><input type="radio" id="_I_" name="_gestureType_" value="I"><div>\u56FE\u7247</div></label><label><input type="radio" id="_V_" name="_gestureType_" value="V"><div>\u89C6\u9891</div></label></div><p>\u624B\u52BF\u6267\u884C\u811A\u672C\uFF1A</p><textarea id="_gestureCode_" placeholder="\u53EF\u7528\u53D8\u91CF\u8BF4\u660E\u2193
 	gestureData\uFF1A\u624B\u52BF\u6570\u636E\u5E38\u91CF,\u5982\u679C\u4F60\u9700\u8981\u5728\u4E0D\u540C\u624B\u52BF\u95F4\u4F20\u9012\u53D8\u91CF,\u4F60\u53EF\u4EE5\u8D4B\u503CgestureData.\u53D8\u91CF\u540D=\u53D8\u91CF\u503C\uFF1B
	gestureData.touchEle\uFF1A\u624B\u6307\u89E6\u6478\u7684\u6E90\u5143\u7D20\uFF1B
	gestureData.selectWords\uFF1A\u9009\u4E2D\u7684\u6587\u5B57\uFF1B
	gestureData.touchStart\uFF1A\u89E6\u6478\u5F00\u59CB\u5750\u6807\u5BF9\u8C61\uFF1B
	gestureData.touchEnd\uFF1A\u89E6\u6478\u6700\u65B0\u5750\u6807\u5BF9\u8C61\uFF1B
	gestureData.path\uFF1A\u6ED1\u52A8\u7684\u8DEF\u5F84\uFF1B
	gestureData.videoPlayer\uFF1A\u6B63\u5728\u64AD\u653E\u7684\u89C6\u9891\u5143\u7D20\u3002

\u53EF\u7528\u65B9\u6CD5\u8BF4\u660E\u2193
	gestureData.addStyle(CSS\u6837\u5F0F)\uFF1A\u5C06CSS\u6837\u5F0F\u6DFB\u52A0\u5230\u7F51\u9875\u4E0A\uFF1B
	gestureData.runGesture()\uFF1A\u4EE5path\u4E3A\u8DEF\u5F84\u6267\u884C\u624B\u52BF,\u4F60\u53EF\u4EE5\u4FEE\u6539path\u540E\u6267\u884C\u6B64\u65B9\u6CD5\uFF1B
	gestureData.GM_openInTab(\u94FE\u63A5)\uFF1A\u6253\u5F00\u94FE\u63A5\uFF1B
	gestureData.GM_setClipboard(\u6587\u672C)\uFF1A\u590D\u5236\u6587\u672C\u5230\u526A\u5207\u677F\uFF1B
	gestureData.GM_setValue(\u53D8\u91CF\u540D,\u53D8\u91CF\u503C)\uFF1A\u5728\u6CB9\u7334\u4E2D\u5B58\u50A8\u6570\u636E\uFF1B
	gestureData.GM_getValue(\u53D8\u91CF\u540D,\u9ED8\u8BA4\u503C)\uFF1A\u4ECE\u6CB9\u7334\u4E2D\u53D6\u51FA\u6570\u636E,\u6CA1\u6709\u5219\u4F7F\u7528\u9ED8\u8BA4\u503C\u3002

\u53EF\u8BC6\u522B\u4EE3\u7801\u6CE8\u91CA\u8BF4\u660E(\u4EC5\u5BF9\u4E00\u822C\u624B\u52BF\u751F\u6548)\u2193
	\u9ED8\u8BA4\u60C5\u51B5\uFF1A\u5B58\u5728iframe\u65F6\uFF0C\u6240\u6709\u624B\u52BF\u53EA\u4F1A\u5728\u89E6\u53D1\u624B\u52BF\u7684\u9875\u9762\u5BF9\u8C61\u6267\u884C\uFF01
 	\u6DFB\u52A0/*ONLY TOP*/\uFF1A\u624B\u52BF\u53EA\u5728\u9876\u7EA7\u9875\u9762\u5BF9\u8C61\u6267\u884C\uFF1B
	\u6DFB\u52A0/*WITH TOP*/\uFF1A\u624B\u52BF\u540C\u65F6\u5728\u5F53\u524D\u9875\u9762\u5BF9\u8C61\u548C\u9876\u7EA7\u9875\u9762\u5BF9\u8C61\u6267\u884C\u3002"></textarea><div style="width:100%;height:0.3vmin;"></div><button id="_saveGesture_">\u4FDD\u5B58</button><button id="_closeEdit_">\u5173\u95ED</button></div><div id="_settingsBox_"><h1>\u529F\u80FD\u5F00\u5173\u8BBE\u7F6E</h1><span id="_settingList_"></span><button id="_saveSettings_">\u4FDD\u5B58</button></div>`,i=document.getElementById("_path_");function s(){if(e=this.parentNode.getAttribute("name"),["\u6253\u5F00\u8BBE\u7F6E","\u89C6\u9891\u5168\u5C4F","\u624B\u52BF\u7A7F\u900F"].indexOf(e)>-1){alert("\u8BE5\u624B\u52BF\u811A\u672C\u65E0\u6CD5\u4FEE\u6539\uFF01");return}t=this.parentNode.getAttribute("path");let o=/^[TIV]/.test(t)?`_${t.slice(0,1)}_`:"_G_";document.getElementById(o).click(),document.getElementById("_gestureName_").value=e,document.getElementById("_gestureCode_").value=gestureData.gesture[t].code,document.getElementById("_editGesture_").style.display="block"}function l(){e=this.parentNode.getAttribute("name"),t=this.parentNode.getAttribute("path"),i.textContent="",window.removeEventListener("touchmove",touchMove,!0),window.removeEventListener("pointermove",touchMove,!0),document.getElementById("_revisePath_").style.display="block"}function d(){if(e=this.parentNode.getAttribute("name"),["\u6253\u5F00\u8BBE\u7F6E","\u89C6\u9891\u5168\u5C4F","\u624B\u52BF\u7A7F\u900F"].indexOf(e)>-1){alert("\u8BE5\u624B\u52BF\u65E0\u6CD5\u5220\u9664\uFF01");return}confirm(`\u786E\u5B9A\u5220\u9664"${e}"\u624B\u52BF`)&&(t=this.parentNode.getAttribute("path"),delete gestureData.gesture[t],gestureData.GM_setValue("gesture",gestureData.gesture),_())}function c(o){o.preventDefault(),fingersNum=2;let g=o.changedTouches[0].clientX-gestureData.touchStart.clientX,n=+this.style.left.slice(0,-2)+g,m=this.offsetWidth/2,u=gestureData.settings[this.id];n=n<-m?-m:n>(g=this.parentNode.offsetWidth-m)?g:n,this.style.left=n+"px",this.textContent=((n+m)/this.parentNode.offsetWidth*(u[2]-u[1])+u[1]).toFixed(u[3]),gestureData.touchStart=o.changedTouches[0]}function f(){(isClick||!/^$|[●○▼▽]$/.test(i.textContent))&&(isClick=0,startPoint=gestureData.touchEnd,i.textContent+="\u25CF")}function p(){slideStamp=0,i.textContent+="\u25BC"}function v(){/[○▼▽]$/.test(i.textContent)||(i.textContent+="\u25C6")}function _(){let o=document.getElementById("_gestureUL_");o.textContent="";for(let g in gestureData.gesture){let n=document.createElement("div"),m=document.createElement("p"),u=document.createElement("div"),h=document.createElement("div");n.className="_gestureLi_",n.setAttribute("name",gestureData.gesture[g].name),n.setAttribute("path",g),m.textContent=gestureData.gesture[g].name,m.addEventListener("click",s,!0),u.className="_gesturePath_",u.textContent=g,u.addEventListener("click",l,!0),h.className="_delGesture_",h.textContent="\u5220\u9664",h.addEventListener("click",d,!0),n.insertAdjacentElement("beforeend",m),n.insertAdjacentElement("beforeend",u),n.insertAdjacentElement("beforeend",h),o.insertAdjacentElement("beforeend",n)}}_(),document.getElementById("_addGesture_").addEventListener("click",()=>{e=t="",document.getElementById("_G_").click(),document.getElementById("_gestureName_").value="",document.getElementById("_gestureCode_").value="",document.getElementById("_editGesture_").style.display="block"},!0),document.getElementById("_saveGesture_").addEventListener("click",()=>{let o=document.getElementById("_gestureName_").value;if(!o){alert("\u8BF7\u8F93\u5165\u624B\u52BF\u540D\u79F0\uFF01");return}if(document.querySelector(`#_gestureBox_ ._gestureLi_[name="${o}"]:not([path="${t}"])`)){alert("\u5B58\u5728\u540C\u540D\u624B\u52BF\uFF01");return}let g=document.getElementsByName("_gestureType_");for(let n=0,m=g.length;n<m;++n)if(g[n].checked){let u=g[n].value+(e&&t.indexOf("[")<0?/^[TIV]/.test(t)?t.slice(1):t:`[${o}]`);if(u!==t){if(gestureData.gesture[u]){let h=g[n].value+`[${gestureData.gesture[u].name}]`;gestureData.gesture[h]=gestureData.gesture[u]}gestureData.gesture[u]=gestureData.gesture[t]||{},delete gestureData.gesture[t]}gestureData.gesture[u].name=o,gestureData.gesture[u].code=document.getElementById("_gestureCode_").value;break}gestureData.GM_setValue("gesture",gestureData.gesture),_(),document.getElementById("_editGesture_").style.display="none"},!0),document.getElementById("_closeEdit_").addEventListener("click",()=>{document.getElementById("_editGesture_").style.display="none"},!0),document.getElementById("_revisePath_").addEventListener("touchstart",()=>{fingersNum>1||(clearTimeout(gestureTimer),clearTimeout(a),gestureTimer=setTimeout(f,300+slideTime-pressTime))},!0),document.getElementById("_revisePath_").addEventListener("touchmove",o=>{if(o.preventDefault(),clearTimeout(gestureTimer),gestureData.touchEnd=o.changedTouches[0],/[○▼▽]$/.test(i.textContent)||fingersNum>1)return;let g=(gestureData.touchEnd.screenX-startPoint.screenX)**2,n=(gestureData.touchEnd.screenY-startPoint.screenY)**2,m=g>n?gestureData.touchEnd.screenX>startPoint.screenX?"\u2192":"\u2190":gestureData.touchEnd.screenY>startPoint.screenY?"\u2193":"\u2191",u=Date.now(),h=g+n,D=i.textContent.slice(-1);h>LIMIT/100&&(slideTime=u,isClick=0,D===m||h>LIMIT?(D!==m&&(i.textContent+=m,slideStamp=u+300),startPoint=gestureData.touchEnd,slideStamp&&u>slideStamp&&p()):h>LIMIT/16&&(slideStamp=0)),gestureTimer=setTimeout(f,300+slideTime-u)},!0),document.getElementById("_revisePath_").addEventListener("touchend",o=>{if(!(!isClick||fingersNum>0))if(gestureData.path.indexOf("\u25C6\u25C6")>-1)switch(gestureData.path="",i.textContent.slice(-1)){case"\u25CF":{i.textContent=i.textContent.slice(0,-1)+"\u25CB";break}case"\u25CB":{i.textContent=i.textContent.slice(0,-1)+"\u25CF";break}case"\u25BC":{i.textContent=i.textContent.slice(0,-1)+"\u25BD";break}case"\u25BD":{i.textContent=i.textContent.slice(0,-1)+"\u25BC";break}default:{i.textContent+="\u25C6",setTimeout(v,100);break}}else a=setTimeout(v,200)}),document.getElementById("_clearPath_").addEventListener("touchend",o=>{o.stopPropagation(),!(!isClick||fingersNum>0)&&(gestureData.path.indexOf("\u25C6\u25C6")>-1?(gestureData.path="",i.textContent=""):i.textContent=i.textContent.slice(0,-1))}),document.getElementById("_cancleRevise_").addEventListener("touchend",o=>{if(o.preventDefault(),o.stopPropagation(),!(!isClick||fingersNum>0)){if(i.textContent){if(e==="\u89C6\u9891\u5168\u5C4F"&&i.textContent.slice(-1)!=="\u25C6"){alert("\u89C6\u9891\u5168\u5C4F\u9700\u8981\u4EE5\u25C6\u7ED3\u5C3E\uFF01");return}if(gestureData.gesture[i.textContent]?.name==="\u624B\u52BF\u7A7F\u900F"){alert('\u8DEF\u5F84\u4E0E"\u624B\u52BF\u7A7F\u900F"\u529F\u80FD\u51B2\u7A81\uFF01');return}if(/^[TIV]/.test(t)&&(i.textContent=t.slice(0,1)+i.textContent),gestureData.gesture[i.textContent]){let g=(/^[TIV]/.test(t)?t.slice(0,1):"")+`[${gestureData.gesture[i.textContent].name}]`;gestureData.gesture[g]=gestureData.gesture[i.textContent]}gestureData.gesture[i.textContent]=gestureData.gesture[t],delete gestureData.gesture[t],gestureData.GM_setValue("gesture",gestureData.gesture),_()}window.addEventListener("touchmove",touchMove,{capture:!0,passive:!0}),window.addEventListener("pointermove",touchMove,{capture:!0,passive:!0}),document.getElementById("_revisePath_").style.display="none"}}),document.getElementById("_openSettings_").addEventListener("click",()=>{r.style.cssText="overflow-y:hidden !important",document.getElementById("_settingsBox_").style.display="block";let o=document.getElementById("_settingList_");o.textContent="";for(let n in gestureData.settings)if(o.innerHTML+=`<p>${n}\uFF1A</p>`,typeof gestureData.settings[n]=="boolean")o.innerHTML+=`<label class="_switch_"><input type="checkbox" id="${n}" ${gestureData.settings[n]?"checked":""}><div class="_slider_"></div></label>`;else if(typeof gestureData.settings[n]=="object"){o.innerHTML+=`<div class="_slideRail_"><div class="_slideButton_" id="${n}"></div></div>`;let m=document.getElementById(n),u=m.parentNode.offsetWidth*(gestureData.settings[n][0]-gestureData.settings[n][1])/(gestureData.settings[n][2]-gestureData.settings[n][1])-m.offsetWidth/2;m.style.left=u+"px",m.textContent=gestureData.settings[n][0].toFixed(gestureData.settings[n][3])}let g=document.getElementsByClassName("_slideButton_");for(let n=0,m=g.length;n<m;++n)g[n].addEventListener("touchmove",c,!0)},!0),document.getElementById("_saveSettings_").addEventListener("click",()=>{r.style.cssText="";for(let o in gestureData.settings)typeof gestureData.settings[o]=="boolean"?gestureData.settings[o]=document.getElementById(o).checked:typeof gestureData.settings[o]=="object"&&(gestureData.settings[o][0]=+document.getElementById(o).textContent);gestureData.GM_setValue("settings",gestureData.settings),document.getElementById("_settingsBox_").style.display="none"},!0)};function regEvent(){if(top===self?(window.addEventListener("popstate",()=>{clearTimeout(gestureData.backTimer),gestureData.backTimer=0},!0),window.addEventListener("beforeunload",()=>{clearTimeout(gestureData.backTimer),gestureData.backTimer=0},!0),window.addEventListener("message",async e=>{let t=e.data;switch(t.type){case"iframeLock":{iframeLock=e.source;break}case"GYRO":{await screen.orientation.lock("landscape")?.catch(Date);break}case"forceFullScreen":{for(let r=0,i=iframeEles.length;r<i;++r)if(iframeEles[r].contentWindow===e.source){iframeEles[r].allowFullscreen||(iframeEles[r].allowFullscreen=!0,iframeEles[r].getAttribute("src")&&iframeEles[r].src.indexOf("/")>-1&&(iframeEles[r].src=iframeEles[r].src));break}break}case"runPath":{for(let r=0,i=iframeEles.length;r<i;++r)if(iframeEles[r].contentWindow===e.source){let a=iframeEles[r].getBoundingClientRect();gestureData.touchStart=t.gestureData.touchStart,gestureData.touchEnd=t.gestureData.touchEnd,gestureData.touchStart.target=gestureData.touchEnd.target=gestureData.touchEle=iframeEles[r],gestureData.touchStart.pageX=gestureData.touchStart.clientX+=a.x,gestureData.touchStart.pageY=gestureData.touchStart.clientY+=a.y,gestureData.touchEnd.pageX=gestureData.touchEnd.clientX+=a.x,gestureData.touchEnd.pageY=gestureData.touchEnd.clientY+=a.y;break}gestureData.path=t.runPath,setTimeout(gestureData.runGesture);break}case"pushTouch":{let r=gestureData.touchEle.getBoundingClientRect();gestureData.touchEnd=t.gestureData.touchEnd,gestureData.touchEnd.target=gestureData.touchEle,gestureData.touchEnd.pageX=gestureData.touchEnd.clientX+=r.x,gestureData.touchEnd.pageY=gestureData.touchEnd.clientY+=r.y;break}case"download":{window._downloadVideo_(t);break}}},!0)):window.addEventListener("message",async e=>{switch(e.data.type){case"fullscreen":{await gestureData.findVideoBox()?.requestFullscreen()?.catch(Date);break}}},!0),window.addEventListener("touchstart",touchStart,{capture:!0,passive:!1}),window.addEventListener("pointermove",touchMove,{capture:!0,passive:!0}),window.addEventListener("touchmove",touchMove,{capture:!0,passive:!0}),window.addEventListener("touchend",touchEnd,{capture:!0,passive:!1}),window.addEventListener("touchcancel",touchEnd,{capture:!0,passive:!1}),gestureData.settings.\u56FE\u7247\u624B\u52BF&&window.addEventListener("contextmenu",e=>{(gestureData.path.indexOf("I")>-1||e.target.nodeName==="IMG")&&gestureData.touchEle.src!==location.href&&e.preventDefault()},!0),gestureData.settings.\u907F\u514D\u65AD\u89E6&&window.addEventListener("click",delayClick,!0),window.addEventListener("visibilitychange",e=>{if(e.stopImmediatePropagation(),document.hidden){let t=gestureData.videoPlayer?.paused,r=gestureData.videoPlayer?.currentTime+.2,i=gestureData.videoPlayer?.playbackRate,a=gestureData.videoPlayer?.volume;setTimeout(()=>{t!==gestureData.videoPlayer?.paused&&(gestureData.videoPlayer.load(),gestureData.videoPlayer.currentTime=r,gestureData.videoPlayer.addEventListener("loadstart",()=>{gestureData.videoPlayer.play(),gestureData.videoPlayer.playbackRate=i,gestureData.videoPlayer.volume=a},!0))})}else if(gestureData.settings.\u7F51\u9875\u52A0\u901F){let t=[...document.querySelectorAll('a[_linkShow_="1"]')],r=Date.now();if(gestureData.shadowList)for(let i=0,a=gestureData.shadowList.length;i<a;++i)t.push(...gestureData.shadowList[i].querySelectorAll('a[_linkShow_="1"]'));for(let i=0,a=t.length;i<a;++i)r>t[i]._prefetch_&&(t[i]._prefetch_=Date.now()+3e5,document.head.insertAdjacentHTML("beforeend",`<link rel="prefetch" href="${t[i].href.replace(/^https?:/,"")}"/>`))}},!0),window.addEventListener("pagehide",e=>{e.stopImmediatePropagation()},!0),window.addEventListener("blur",e=>{e.stopImmediatePropagation()}),window.addEventListener("beforecopy",e=>{e.stopImmediatePropagation()},!0),window.addEventListener("copy",e=>{gestureData.selectWords||e.stopImmediatePropagation()},!0),document.execCommand=()=>{},navigator.clipboard&&(navigator.clipboard.writeText=()=>{},navigator.clipboard.write=()=>{}),gestureData.addStyle("html,html *{user-select:auto !important;touch-action:manipulation;overscroll-behavior-x:none !important;}"),window.addEventListener("selectstart",e=>{e.stopImmediatePropagation()},!0),gestureData.settings.\u7F51\u9875\u52A0\u901F&&HTMLScriptElement.supports&&HTMLScriptElement.supports("speculationrules")){let e=document.createElement("script"),t={prerender:[{source:"document",where:{and:[{selector_matches:'a[_linkShow_="1"]'}]},referrer_policy:"strict-origin-when-cross-origin",eagerness:"immediate"}],prefetch:[{source:"document",where:{and:[{selector_matches:'a[_linkShow_="1"]'}]},referrer_policy:"strict-origin-when-cross-origin",eagerness:"immediate"}],prefetch_with_subresources:[{source:"document",where:{and:[{selector_matches:'a[_linkShow_="1"]'}]},referrer_policy:"strict-origin-when-cross-origin",eagerness:"immediate"}]};e.type="speculationrules",e.textContent=JSON.stringify(t),document.head?.insertAdjacentElement("beforeend",e)}window.addEventListener("beforeunload",e=>{e.stopImmediatePropagation()},!0),window.addEventListener("unload",e=>{e.stopImmediatePropagation()},!0),document.documentElement._regEvent_=1}(function(){regEvent(),checkTimer=setTimeout(loadCheck,200),CHECK_M_OBSERVER.observe(document,{childList:!0,subtree:!0})})();
